/**
 * @version 1.0.0.0
 * @copyright Copyright Â©  2019
 * @compiler Bridge.NET 17.1.1
 */
Bridge.assembly("BuildBridgeB", function ($asm, globals) {
    "use strict";

    Bridge.define("BridgeBuild.App", {
        main: function Main () {
            Pidroh.BaseUtils.Debugger.ActiveStatic = false;
            BridgeBuild.App.TestEntitySystem();
            BridgeBuild.App.SetupGame(Bridge.ref(BridgeBuild.App, "gr"), Bridge.ref(BridgeBuild.App, "TextBoard"));
            BridgeBuild.App.colors = System.Array.init(30, null, System.String);
            for (var i = 0; i < Pidroh.ConsoleApp.Turnbased.ColorStuff.colors.length; i = (i + 1) | 0) {

                BridgeBuild.App.colors[System.Array.index(i, BridgeBuild.App.colors)] = Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(i, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)];
            }



            var style = document.createElement("style");
            style.innerHTML = "html,body {font-family: Courier; background-color:#1f2526; height: 100%; color:#888;}\n #canvas-container {width: 100%; height: 100%; text-align:center; vertical-align: middle; } ";
            document.head.appendChild(style);
            BridgeBuild.App.buffer = 9;
            BridgeBuild.App.bufferOn = false;

            document.onkeyup = Bridge.fn.combine(document.onkeyup, function (a) {
                var code = a.keyCode;
                if (code === 0) {
                    code = a.charCode;
                }
                var unicode = code;
                if (unicode >= 65 && unicode <= 90) {
                    unicode = (((unicode - 65) | 0) + 97) | 0;
                }
                while (BridgeBuild.App.keysDown.contains(unicode)) {
                    BridgeBuild.App.keysDown.remove(unicode);
                }



            });

            document.onkeydown = Bridge.fn.combine(document.onkeydown, function (a) {
                if (a.keyCode >= 37 && a.keyCode <= 40) {
                    BridgeBuild.App.Handle(a);
                    a.preventDefault();
                }
                if (a.keyCode === Pidroh.BaseUtils.Unicode.Escape) {
                    BridgeBuild.App.Handle(a);
                    a.preventDefault();
                }
                if (a.keyCode === Pidroh.BaseUtils.Unicode.Enter) {
                    BridgeBuild.App.Handle(a);
                    a.preventDefault();
                }


            });


            document.onkeypress = Bridge.fn.combine(document.onkeypress, function (a) {
                if (a.keyCode >= 37 && a.keyCode <= 40) {
                    return;
                }
                BridgeBuild.App.Handle(a);
                a.preventDefault();


            });

            BridgeBuild.App.UpdateGame();




        },
        statics: {
            fields: {
                buffer: 0,
                bufferOn: false,
                gr: null,
                TextBoard: null,
                colors: null,
                bufferUnicode: 0,
                aux: null,
                last: null,
                CanDraw: false,
                keysDown: null
            },
            ctors: {
                init: function () {
                    this.last = System.DateTime.getDefaultValue();
                    this.bufferUnicode = -1;
                    this.last = System.DateTime.getNow();
                    this.keysDown = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                }
            },
            methods: {
                SetupGame: function (gr, TextBoard) {

                    var rnd = new System.Random.ctor();
                    Pidroh.BaseUtils.RandomSupplier.Generate = function () {
                        var v = rnd.NextDouble();
                        return v;
                    };

                    gr.v = new Pidroh.ConsoleApp.Turnbased.GameMain();
                    TextBoard.v = gr.v.GetBoard();
                    BridgeBuild.App.aux = new Pidroh.TextRendering.TextBoard(300, 300);



                },
                Handle: function (a) {
                    var code = a.keyCode;
                    if (code === 0) {
                        code = a.charCode;
                    }
                    var unicode = code;
                    BridgeBuild.App.bufferUnicode = unicode;
                    BridgeBuild.App.keysDown.add(unicode);

                },
                TestEntitySystem: function () {

                },
                UpdateGame: function () {
                    if (BridgeBuild.App.CanDraw) {
                        var now = System.DateTime.getNow();
                        var secs = (System.DateTime.subdd(now, BridgeBuild.App.last)).getTotalSeconds();
                        if (secs > 0.08) {
                            secs = 0.08;
                        }

                        BridgeBuild.App.TextBoard = BridgeBuild.App.gr.GetBoard();
                        BridgeBuild.App.last = now;
                        BridgeBuild.App.gr.keyDownUnicode = BridgeBuild.App.bufferUnicode;
                        BridgeBuild.App.bufferUnicode = -1;
                        var mouseX = getMouseX();
                        var mouseY = getMouseY();
                        var point2D = new Pidroh.BaseUtils.Point2D.$ctor1(mouseX, mouseY);
                        if (Pidroh.BaseUtils.Point2D.op_Inequality(BridgeBuild.App.gr.Mouse.pos.$clone(), point2D.$clone())) {
                            BridgeBuild.App.gr.Mouse.pos = point2D.$clone();
                        }
                        BridgeBuild.App.gr.Keyboard.downUnicodes.clear();
                        BridgeBuild.App.gr.Keyboard.downUnicodes.AddRange(BridgeBuild.App.keysDown);

                        BridgeBuild.App.gr.Draw(secs);




                        for (var j = 0; j < BridgeBuild.App.TextBoard.Height; j = (j + 1) | 0) {
                            for (var i = 0; i < BridgeBuild.App.TextBoard.Width; i = (i + 1) | 0) {
                                if (!BridgeBuild.App.aux.SameAs(BridgeBuild.App.TextBoard, i, j)) {
                                    var tcI = BridgeBuild.App.TextBoard.TextColor.get([i, j]);
                                    var color = BridgeBuild.App.colors[System.Array.index(0, BridgeBuild.App.colors)];
                                    if (tcI < 0) {
                                    } else if (tcI >= BridgeBuild.App.colors.length) {
                                    } else {
                                        color = BridgeBuild.App.colors[System.Array.index(tcI, BridgeBuild.App.colors)];
                                    }



                                    var backColor = BridgeBuild.App.colors[System.Array.index(BridgeBuild.App.TextBoard.BackColor.get([i, j]), BridgeBuild.App.colors)];
                                    var $char = BridgeBuild.App.TextBoard.CharAt(i, j);
                                    draw(i, j, color, backColor, "" + String.fromCharCode($char));
                                    BridgeBuild.App.aux.Copy(BridgeBuild.App.TextBoard, i, j);
                                } else {
                                }


                            }
                        }
                    } else {
                        BridgeBuild.App.CanDraw = isReadyToDraw();
                    }


                    window.setTimeout(BridgeBuild.App.UpdateGame, 15);
                }
            }
        }
    });

    Bridge.define("BridgeBuild.App.Bla", {
        $kind: "nested class",
        fields: {
            i: 0,
            pos: null
        },
        ctors: {
            init: function () {
                this.pos = new BridgeBuild.App.Vector();
                this.i = 3;
            }
        }
    });

    Bridge.define("BridgeBuild.App.Vector", {
        $kind: "nested struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new BridgeBuild.App.Vector(); }
            }
        },
        fields: {
            x: 0,
            y: 0
        },
        ctors: {
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            getHashCode: function () {
                var h = Bridge.addHash([1952700357, this.x, this.y]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, BridgeBuild.App.Vector)) {
                    return false;
                }
                return Bridge.equals(this.x, o.x) && Bridge.equals(this.y, o.y);
            },
            $clone: function (to) {
                var s = to || new BridgeBuild.App.Vector();
                s.x = this.x;
                s.y = this.y;
                return s;
            }
        }
    });

    Bridge.define("Pidroh.BaseUtils.ArrayExtensions.ArrayExtensions", {
        statics: {
            methods: {
                ForEach: function (array, action) {
                    if (array.length === 0) {
                        return;
                    }
                    var walker = new Pidroh.BaseUtils.ArrayExtensions.ArrayTraverse(array);
                    do {
                        action(array, walker.Position);
                    } while (walker.Step());
                }
            }
        }
    });

    Bridge.define("Pidroh.BaseUtils.ArrayExtensions.ArrayTraverse", {
        fields: {
            Position: null,
            maxLengths: null
        },
        ctors: {
            ctor: function (array) {
                this.$initialize();
                this.maxLengths = System.Array.init(System.Array.getRank(array), 0, System.Int32);
                for (var i = 0; i < System.Array.getRank(array); i = (i + 1) | 0) {
                    this.maxLengths[System.Array.index(i, this.maxLengths)] = (System.Array.getLength(array, i) - 1) | 0;
                }
                this.Position = System.Array.init(System.Array.getRank(array), 0, System.Int32);
            }
        },
        methods: {
            Step: function () {
                for (var i = 0; i < this.Position.length; i = (i + 1) | 0) {
                    if (this.Position[System.Array.index(i, this.Position)] < this.maxLengths[System.Array.index(i, this.maxLengths)]) {
                        this.Position[System.Array.index(i, this.Position)] = (this.Position[System.Array.index(i, this.Position)] + 1) | 0;
                        for (var j = 0; j < i; j = (j + 1) | 0) {
                            this.Position[System.Array.index(j, this.Position)] = 0;
                        }
                        return true;
                    }
                }
                return false;
            }
        }
    });

    Bridge.define("Pidroh.BaseUtils.Debugger", {
        statics: {
            fields: {
                ActiveStatic: false
            },
            ctors: {
                init: function () {
                    this.ActiveStatic = true;
                }
            }
        },
        fields: {
            debugging: false,
            ident: 0,
            stringBuilder: null
        },
        ctors: {
            init: function () {
                this.stringBuilder = new System.Text.StringBuilder();
            },
            ctor: function (debugging) {
                this.$initialize();
                if (Pidroh.BaseUtils.Debugger.ActiveStatic) {
                    this.debugging = debugging;
                }
            }
        },
        methods: {
            Print$1: function (s) {
                if (!this.debugging) {
                    return;
                }
                for (var i = 0; i < this.ident; i = (i + 1) | 0) {
                    System.Console.Write(String.fromCharCode(32));
                }
                System.Console.WriteLine(s);
            },
            Print: function (obj) {
                var $t;
                if (!this.debugging) {
                    return;
                }
                this.stringBuilder.setLength(0);

                var type = Bridge.getType(obj);
                this.stringBuilder.append("Type: ");
                this.stringBuilder.append(Bridge.Reflection.getTypeName(type));
                this.stringBuilder.appendLine();
                var fields = Bridge.Reflection.getMembers(type, 4, 52);
                $t = Bridge.getEnumerator(fields);
                try {
                    while ($t.moveNext()) {
                        var f = $t.Current;
                        this.stringBuilder.append(String.fromCharCode(32));
                        this.stringBuilder.append(String.fromCharCode(32));
                        this.stringBuilder.append(Bridge.Reflection.fieldAccess(f, Bridge.unbox(obj)));
                        this.stringBuilder.append(String.fromCharCode(32));
                        this.stringBuilder.append(String.fromCharCode(32));
                        this.stringBuilder.append(f.n);
                        this.stringBuilder.appendLine();
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }System.Console.WriteLine(this.stringBuilder.toString());
            },
            Deident: function () {
                this.ident = (this.ident - 2) | 0;
                ;
            },
            Ident: function () {
                this.ident = (this.ident + 2) | 0;
            },
            Active: function () {
                if (!Pidroh.BaseUtils.Debugger.ActiveStatic) {
                    return;
                }
                this.debugging = true;
            },
            Active$1: function (v) {
                if (!Pidroh.BaseUtils.Debugger.ActiveStatic) {
                    return;
                }
                this.debugging = v;
            }
        }
    });

    Bridge.define("Pidroh.BaseUtils.DeepCloneHelper", {
        statics: {
            fields: {
                debug: null
            },
            ctors: {
                init: function () {
                    this.debug = new Pidroh.BaseUtils.Debugger(false);
                }
            },
            methods: {
                /**
                 * Get the deep clone of an object.
                 *
                 * @static
                 * @public
                 * @this Pidroh.BaseUtils.DeepCloneHelper
                 * @memberof Pidroh.BaseUtils.DeepCloneHelper
                 * @param   {Function}    T      The type of the obj.
                 * @param   {T}           obj    It is the object used to deep clone.
                 * @return  {T}                  Return the deep clone.
                 */
                DeepClone: function (T, obj) {
                    if (obj == null) {
                        throw new System.ArgumentNullException.$ctor1("Object is null");
                    }
                    return Bridge.cast(Bridge.unbox(Pidroh.BaseUtils.DeepCloneHelper.CloneProcedure(obj)), T);
                },
                DeepCopyPartial: function (from, to) {
                    if (from == null) {
                        throw new System.ArgumentNullException.$ctor1("Object is null");
                    }
                    Pidroh.BaseUtils.DeepCloneHelper.CopyProcedurePartial(from, to);
                },
                /**
                 * The method implements deep clone using reflection.
                 *
                 * @static
                 * @private
                 * @this Pidroh.BaseUtils.DeepCloneHelper
                 * @memberof Pidroh.BaseUtils.DeepCloneHelper
                 * @param   {System.Object}    obj    It is the object used to deep clone.
                 * @return  {System.Object}           Return the deep clone.
                 */
                CloneProcedure: function (obj) {
                    var $t;

                    if (obj == null) {
                        return null;
                    }

                    var type = Bridge.getType(obj);

                    Pidroh.BaseUtils.DeepCloneHelper.debug.Print$1(System.String.concat("Cloning: ", Bridge.getTypeName(type)));

                    if (Bridge.Reflection.isEnum(type) || Bridge.referenceEquals(type, System.String) || Bridge.referenceEquals(type, System.Int32) || Bridge.referenceEquals(type, System.Char) || Bridge.referenceEquals(type, System.Single) || Bridge.referenceEquals(type, System.Double) || Bridge.referenceEquals(type, System.Boolean)) {
                        Pidroh.BaseUtils.DeepCloneHelper.debug.Print$1(System.String.concat(Bridge.getTypeName(type), " ", obj) + " -V");

                        return obj;
                    } else if (Bridge.isArray(null, type)) {

                        var typeElement = (type.$elementType || null);

                        var array = Bridge.as(obj, Array);
                        var length = array.length;
                        var copiedArray = System.Array.init(length, Bridge.getDefaultValue(typeElement), typeElement);
                        for (var i = 0; i < array.length; i = (i + 1) | 0) {
                            System.Array.set(copiedArray, Pidroh.BaseUtils.DeepCloneHelper.CloneProcedure(System.Array.get(array, i)), i);

                        }
                        return copiedArray;
                    } else if (Bridge.Reflection.isClass(type) || Bridge.Reflection.isValueType(type)) {
                        var copiedObject = Bridge.createInstance(Bridge.getType(obj));

                        var fields = Bridge.Reflection.getMembers(type, 4, 52);
                        $t = Bridge.getEnumerator(fields);
                        try {
                            while ($t.moveNext()) {
                                var field = $t.Current;

                                Pidroh.BaseUtils.DeepCloneHelper.debug.Print$1("Field: " + (field.n || ""));
                                var fieldValue = Bridge.Reflection.fieldAccess(field, Bridge.unbox(obj));
                                if (fieldValue != null) {
                                    Pidroh.BaseUtils.DeepCloneHelper.debug.Print$1("Field: " + (field.n || "") + " being set");
                                    Bridge.Reflection.fieldAccess(field, Bridge.unbox(copiedObject), Bridge.unbox(Pidroh.BaseUtils.DeepCloneHelper.CloneProcedure(fieldValue)));
                                }

                            }
                        } finally {
                            if (Bridge.is($t, System.IDisposable)) {
                                $t.System$IDisposable$Dispose();
                            }
                        }
                        return copiedObject;
                    } else {
                        throw new System.ArgumentException.$ctor1("The object is unknown type");
                    }
                },
                CopyProcedurePartial: function (from, to) {
                    var $t;
                    if (from == null) {
                        return null;
                    }

                    var type = Bridge.getType(from);

                    Pidroh.BaseUtils.DeepCloneHelper.debug.Print$1(System.String.concat("Copying ", Bridge.getTypeName(type)));
                    Pidroh.BaseUtils.DeepCloneHelper.debug.Ident();

                    if (Bridge.Reflection.isEnum(type) || Bridge.referenceEquals(type, System.String) || Bridge.referenceEquals(type, System.Int32) || Bridge.referenceEquals(type, System.Char) || Bridge.referenceEquals(type, System.Single) || Bridge.referenceEquals(type, System.Double)) {

                        Pidroh.BaseUtils.DeepCloneHelper.debug.Print$1(System.String.concat(Bridge.getTypeName(type), " ", from) + " -V");
                        Pidroh.BaseUtils.DeepCloneHelper.debug.Deident();
                        return from;
                    } else if (Bridge.isArray(null, type)) {
                        Pidroh.BaseUtils.DeepCloneHelper.debug.Deident();
                        return null;
                    } else if (Bridge.Reflection.isClass(type) || Bridge.Reflection.isValueType(type)) {
                        var copiedObject = to;

                        var fields = Bridge.Reflection.getMembers(type, 4, 52);
                        $t = Bridge.getEnumerator(fields);
                        try {
                            while ($t.moveNext()) {
                                var field = $t.Current;

                                Pidroh.BaseUtils.DeepCloneHelper.debug.Print$1("Field: " + (field.n || ""));
                                var fieldValue = Bridge.Reflection.fieldAccess(field, Bridge.unbox(from));
                                if (fieldValue != null) {
                                    Pidroh.BaseUtils.DeepCloneHelper.debug.Print$1("Field: " + (field.n || "") + " not null, being set");
                                    Pidroh.BaseUtils.DeepCloneHelper.debug.Ident();
                                    Bridge.Reflection.fieldAccess(field, Bridge.unbox(copiedObject), Bridge.unbox(Pidroh.BaseUtils.DeepCloneHelper.CloneProcedure(fieldValue)));
                                    Pidroh.BaseUtils.DeepCloneHelper.debug.Deident();
                                }

                            }
                        } finally {
                            if (Bridge.is($t, System.IDisposable)) {
                                $t.System$IDisposable$Dispose();
                            }
                        }Pidroh.BaseUtils.DeepCloneHelper.debug.Deident();
                        return copiedObject;
                    } else {
                        Pidroh.BaseUtils.DeepCloneHelper.debug.Deident();
                        throw new System.ArgumentException.$ctor1("The object is unknown type");
                    }
                }
            }
        }
    });

    Bridge.define("Pidroh.BaseUtils.Extensions", {
        statics: {
            methods: {
                Shuffle: function (T, list) {
                    var n = System.Array.getCount(list, T);
                    while (n > 1) {
                        n = (n - 1) | 0;
                        var k = Pidroh.BaseUtils.RandomSupplier.Next(((n + 1) | 0));
                        var value = System.Array.getItem(list, k, T);
                        System.Array.setItem(list, k, System.Array.getItem(list, n, T), T);
                        System.Array.setItem(list, n, value, T);
                    }
                },
                RandomElement: function (T, list) {
                    var element = Pidroh.BaseUtils.RandomSupplier.Next(((System.Array.getCount(list, T) - 1) | 0));
                    return System.Array.getItem(list, element, T);
                }
            }
        }
    });

    Bridge.definei("Pidroh.BaseUtils.ICopyable$1", function (T) { return {
        $kind: "interface"
    }; });

    Bridge.define("Pidroh.BaseUtils.ObjectExtensions", {
        statics: {
            fields: {
                CloneMethod: null
            },
            ctors: {
                init: function () {
                    this.CloneMethod = Bridge.Reflection.getMembers(System.Object, 8, 36 | 256, "MemberwiseClone");
                }
            },
            methods: {
                IsPrimitiveMethod: function (type) {
                    if (Bridge.referenceEquals(type, System.String)) {
                        return true;
                    }
                    if (Bridge.referenceEquals(type, System.Int32)) {
                        return true;
                    }
                    if (Bridge.referenceEquals(type, System.Single)) {
                        return true;
                    }
                    if (Bridge.referenceEquals(type, System.Double)) {
                        return true;
                    }
                    if (Bridge.referenceEquals(type, System.Char)) {
                        return true;
                    }
                    var isValueType = Bridge.Reflection.isValueType(type);
                    return isValueType;
                },
                Copy$1: function (originalObject) {
                    return Pidroh.BaseUtils.ObjectExtensions.InternalCopy(originalObject, new (System.Collections.Generic.Dictionary$2(System.Object, System.Object))(null, new Pidroh.BaseUtils.ReferenceEqualityComparer()));
                },
                Copy: function (T, original) {
                    return Bridge.cast(Bridge.unbox(Pidroh.BaseUtils.ObjectExtensions.Copy$1(original)), T);
                },
                InternalCopy: function (originalObject, visited) {
                    if (originalObject == null) {
                        return null;
                    }
                    var typeToReflect = Bridge.getType(originalObject);
                    if (Pidroh.BaseUtils.ObjectExtensions.IsPrimitiveMethod(typeToReflect)) {
                        return originalObject;
                    }
                    if (visited.System$Collections$Generic$IDictionary$2$System$Object$System$Object$containsKey(originalObject)) {
                        return visited.System$Collections$Generic$IDictionary$2$System$Object$System$Object$getItem(originalObject);
                    }
                    if (Bridge.Reflection.isAssignableFrom(Function, typeToReflect)) {
                        return null;
                    }
                    var cloneObject = Bridge.Reflection.midel(Pidroh.BaseUtils.ObjectExtensions.CloneMethod, Bridge.unbox(originalObject)).apply(null, System.Array.init([], System.Object));
                    if (Bridge.isArray(null, typeToReflect)) {
                        var arrayType = (typeToReflect.$elementType || null);
                        if (Pidroh.BaseUtils.ObjectExtensions.IsPrimitiveMethod(arrayType) === false) {
                            var clonedArray = Bridge.cast(cloneObject, Array);
                            Pidroh.BaseUtils.ArrayExtensions.ArrayExtensions.ForEach(clonedArray, function (array, indices) {
                                System.Array.set.apply(System.Array, [array, Pidroh.BaseUtils.ObjectExtensions.InternalCopy(System.Array.get.apply(System.Array, [clonedArray].concat(indices)), visited)].concat(indices));
                            });
                        }

                    }
                    visited.System$Collections$Generic$IDictionary$2$System$Object$System$Object$add(originalObject, cloneObject);
                    Pidroh.BaseUtils.ObjectExtensions.CopyFields(originalObject, visited, cloneObject, typeToReflect);
                    Pidroh.BaseUtils.ObjectExtensions.RecursiveCopyBaseTypePrivateFields(originalObject, visited, cloneObject, typeToReflect);
                    return cloneObject;
                },
                RecursiveCopyBaseTypePrivateFields: function (originalObject, visited, cloneObject, typeToReflect) {
                    if (Bridge.Reflection.getBaseType(typeToReflect) != null) {
                        Pidroh.BaseUtils.ObjectExtensions.RecursiveCopyBaseTypePrivateFields(originalObject, visited, cloneObject, Bridge.Reflection.getBaseType(typeToReflect));
                        Pidroh.BaseUtils.ObjectExtensions.CopyFields(originalObject, visited, cloneObject, Bridge.Reflection.getBaseType(typeToReflect), 36, function (info) {
                            return (info.a === 1);
                        });
                    }
                },
                CopyFields: function (originalObject, visited, cloneObject, typeToReflect, bindingFlags, filter) {
                    var $t;
                    if (bindingFlags === void 0) { bindingFlags = 116; }
                    if (filter === void 0) { filter = null; }
                    $t = Bridge.getEnumerator(Bridge.Reflection.getMembers(typeToReflect, 4, bindingFlags));
                    try {
                        while ($t.moveNext()) {
                            var fieldInfo = $t.Current;
                            if (!Bridge.staticEquals(filter, null) && filter(fieldInfo) === false) {
                                continue;
                            }
                            if (Pidroh.BaseUtils.ObjectExtensions.IsPrimitiveMethod(fieldInfo.rt)) {
                                continue;
                            }
                            var originalFieldValue = Bridge.Reflection.fieldAccess(fieldInfo, Bridge.unbox(originalObject));
                            var clonedFieldValue = Pidroh.BaseUtils.ObjectExtensions.InternalCopy(originalFieldValue, visited);
                            Bridge.Reflection.fieldAccess(fieldInfo, Bridge.unbox(cloneObject), Bridge.unbox(clonedFieldValue));
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }}
            }
        }
    });

    Bridge.define("Pidroh.BaseUtils.Point2D", {
        inherits: function () { return [System.IEquatable$1(Pidroh.BaseUtils.Point2D)]; },
        $kind: "struct",
        statics: {
            fields: {
                zeroPoint: null
            },
            props: {
                Zero: {
                    get: function () {
                        return Pidroh.BaseUtils.Point2D.zeroPoint.$clone();
                    }
                }
            },
            ctors: {
                init: function () {
                    this.zeroPoint = new Pidroh.BaseUtils.Point2D();
                }
            },
            methods: {
                op_Equality: function (a, b) {
                    return a.equalsT(b.$clone());
                },
                op_Inequality: function (a, b) {
                    return !a.equalsT(b.$clone());
                },
                getDefaultValue: function () { return new Pidroh.BaseUtils.Point2D(); }
            }
        },
        fields: {
            X: 0,
            Y: 0
        },
        alias: ["equalsT", "System$IEquatable$1$Pidroh$BaseUtils$Point2D$equalsT"],
        ctors: {
            $ctor1: function (x, y) {
                this.$initialize();
                this.X = x;
                this.Y = y;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            equalsT: function (other) {
                return ((this.X === other.X) && (this.Y === other.Y));
            },
            equals: function (obj) {
                return (Bridge.is(obj, Pidroh.BaseUtils.Point2D)) ? this.equalsT(System.Nullable.getValue(Bridge.cast(Bridge.unbox(obj), Pidroh.BaseUtils.Point2D))) : false;
            },
            getHashCode: function () {
                return this.X ^ this.Y;
            },
            toString: function () {
                return System.String.format("{{X:{0} Y:{1}}}", Bridge.box(this.X, System.Int32), Bridge.box(this.Y, System.Int32));
            },
            $clone: function (to) {
                var s = to || new Pidroh.BaseUtils.Point2D();
                s.X = this.X;
                s.Y = this.Y;
                return s;
            }
        }
    });

    Bridge.define("Pidroh.BaseUtils.RandomSupplier", {
        statics: {
            fields: {
                Generate: null
            },
            methods: {
                Range: function (min, max) {
                    return Bridge.Int.clip32((Pidroh.BaseUtils.RandomSupplier.Generate() * (((max - min) | 0)) + min) + 0.5);
                },
                RandomElement: function (T, array) {
                    return array[System.Array.index(Pidroh.BaseUtils.RandomSupplier.Range(0, ((array.length - 1) | 0)), array)];
                },
                Next: function (count) {
                    return Pidroh.BaseUtils.RandomSupplier.Range(0, count);
                }
            }
        }
    });

    Bridge.define("Pidroh.BaseUtils.Rect", {
        inherits: function () { return [System.IEquatable$1(Pidroh.BaseUtils.Rect)]; },
        $kind: "struct",
        statics: {
            fields: {
                emptyRectangle: null
            },
            props: {
                Empty: {
                    get: function () {
                        return Pidroh.BaseUtils.Rect.emptyRectangle.$clone();
                    }
                }
            },
            ctors: {
                init: function () {
                    this.emptyRectangle = new Pidroh.BaseUtils.Rect();
                }
            },
            methods: {
                op_Equality: function (a, b) {
                    return ((a.X === b.X) && (a.Y === b.Y) && (a.Width === b.Width) && (a.Height === b.Height));
                },
                op_Inequality: function (a, b) {
                    return !(Pidroh.BaseUtils.Rect.op_Equality(a.$clone(), b.$clone()));
                },
                getDefaultValue: function () { return new Pidroh.BaseUtils.Rect(); }
            }
        },
        fields: {
            X: 0,
            Y: 0,
            Width: 0,
            Height: 0
        },
        props: {
            Left: {
                get: function () {
                    return this.X;
                }
            },
            Right: {
                get: function () {
                    return (((this.X + this.Width) | 0));
                }
            },
            Top: {
                get: function () {
                    return this.Y;
                }
            },
            Bottom: {
                get: function () {
                    return (((this.Y + this.Height) | 0));
                }
            },
            Center: {
                get: function () {
                    return new Pidroh.BaseUtils.Point2D.$ctor1(((Bridge.Int.div((((this.X + this.Width) | 0)), 2)) | 0), ((Bridge.Int.div((((this.Y + this.Height) | 0)), 2)) | 0));
                }
            },
            IsEmpty: {
                get: function () {
                    return ((((this.Width === 0) && (this.Height === 0)) && (this.X === 0)) && (this.Y === 0));
                }
            }
        },
        alias: ["equalsT", "System$IEquatable$1$Pidroh$BaseUtils$Rect$equalsT"],
        ctors: {
            $ctor1: function (x, y, width, height) {
                this.$initialize();
                this.X = x;
                this.Y = y;
                this.Width = width;
                this.Height = height;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            Contains$3: function (x, y) {
                return ((((this.X <= x) && (x < (((this.X + this.Width) | 0)))) && (this.Y <= y)) && (y < (((this.Y + this.Height) | 0))));
            },
            Contains$2: function (value) {
                return ((((this.X <= value.X) && (value.X < (((this.X + this.Width) | 0)))) && (this.Y <= value.Y)) && (value.Y < (((this.Y + this.Height) | 0))));
            },
            Contains: function (value) {
                return ((((this.X <= value.X) && (value.X < (((this.X + this.Width) | 0)))) && (this.Y <= value.Y)) && (value.Y < (((this.Y + this.Height) | 0))));
            },
            Contains$1: function (value) {
                return ((((this.X <= value.X) && ((((value.X + value.Width) | 0)) <= (((this.X + this.Width) | 0)))) && (this.Y <= value.Y)) && ((((value.Y + value.Height) | 0)) <= (((this.Y + this.Height) | 0))));
            },
            Offset: function (offset) {
                this.X = (this.X + offset.X) | 0;
                this.Y = (this.Y + offset.Y) | 0;
            },
            Offset$1: function (offsetX, offsetY) {
                this.X = (this.X + offsetX) | 0;
                this.Y = (this.Y + offsetY) | 0;
            },
            Inflate: function (horizontalValue, verticalValue) {
                this.X = (this.X - horizontalValue) | 0;
                this.Y = (this.Y - verticalValue) | 0;
                this.Width = (this.Width + (Bridge.Int.mul(horizontalValue, 2))) | 0;
                this.Height = (this.Height + (Bridge.Int.mul(verticalValue, 2))) | 0;
            },
            equalsT: function (other) {
                return Pidroh.BaseUtils.Rect.op_Equality(this, other.$clone());
            },
            equals: function (obj) {
                return (Bridge.is(obj, Pidroh.BaseUtils.Rect)) ? Pidroh.BaseUtils.Rect.op_Equality(this, System.Nullable.getValue(Bridge.cast(Bridge.unbox(obj), Pidroh.BaseUtils.Rect))) : false;
            },
            toString: function () {
                return System.String.format("{{X:{0} Y:{1} Width:{2} Height:{3}}}", Bridge.box(this.X, System.Int32), Bridge.box(this.Y, System.Int32), Bridge.box(this.Width, System.Int32), Bridge.box(this.Height, System.Int32));
            },
            getHashCode: function () {
                return (this.X ^ this.Y ^ this.Width ^ this.Height);
            },
            Intersects: function (r2) {
                return !(r2.Left > this.Right || r2.Right < this.Left || r2.Top > this.Bottom || r2.Bottom < this.Top);

            },
            Intersects$1: function (value, result) {
                result.v = !(value.v.Left > this.Right || value.v.Right < this.Left || value.v.Top > this.Bottom || value.v.Bottom < this.Top);

            },
            $clone: function (to) {
                var s = to || new Pidroh.BaseUtils.Rect();
                s.X = this.X;
                s.Y = this.Y;
                s.Width = this.Width;
                s.Height = this.Height;
                return s;
            }
        }
    });

    Bridge.define("Pidroh.BaseUtils.ReferenceEqualityComparer", {
        inherits: [System.Collections.Generic.EqualityComparer$1(System.Object)],
        alias: [
            "equals2", ["System$Collections$Generic$IEqualityComparer$1$System$Object$equals2", "System$Collections$Generic$IEqualityComparer$1$equals2"],
            "getHashCode2", ["System$Collections$Generic$IEqualityComparer$1$System$Object$getHashCode2", "System$Collections$Generic$IEqualityComparer$1$getHashCode2"]
        ],
        methods: {
            equals2: function (x, y) {
                return Bridge.referenceEquals(x, y);
            },
            getHashCode2: function (obj) {
                if (obj == null) {
                    return 0;
                }
                return Bridge.getHashCode(obj);
            }
        }
    });

    Bridge.define("Pidroh.BaseUtils.TimeStamp", {
        fields: {
            CurrentSnap: 0
        },
        methods: {
            GetSnap: function () {
                return new Pidroh.BaseUtils.TimeStampSnap.$ctor1(this.CurrentSnap);
            },
            Advance: function (delta) {
                this.CurrentSnap += delta;
            }
        }
    });

    Bridge.define("Pidroh.BaseUtils.TimeStampSnap", {
        $kind: "struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new Pidroh.BaseUtils.TimeStampSnap(); }
            }
        },
        fields: {
            TimeSnap: 0
        },
        ctors: {
            $ctor1: function (snap) {
                this.$initialize();
                this.TimeSnap = snap;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            getHashCode: function () {
                var h = Bridge.addHash([5171392903, this.TimeSnap]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, Pidroh.BaseUtils.TimeStampSnap)) {
                    return false;
                }
                return Bridge.equals(this.TimeSnap, o.TimeSnap);
            },
            $clone: function (to) {
                var s = to || new Pidroh.BaseUtils.TimeStampSnap();
                s.TimeSnap = this.TimeSnap;
                return s;
            }
        }
    });

    Bridge.define("Pidroh.BaseUtils.Unicode", {
        statics: {
            fields: {
                Space: 0,
                Enter: 0,
                Backspace: 0,
                keyDown: 0,
                keyLeft: 0,
                keyUp: 0,
                keyRight: 0,
                Uparrow2: 0,
                Downarrow2: 0,
                Rightarrow2: 0,
                Leftarrow2: 0,
                Uparrow: 0,
                Downarrow: 0,
                Leftarrow: 0,
                Rightarrow: 0,
                AsciiGridHor: 0,
                AsciiGridVer: 0,
                grids: null,
                AsciiGridUpLeft: 0,
                AsciiGridUpRight: 0,
                AsciiGridUpRightLeft: 0,
                AsciiGridDownLeft: 0,
                AsciiGridDownRight: 0,
                AsciiGridDownRightLeft: 0,
                Escape: 0
            },
            ctors: {
                init: function () {
                    this.Space = 32;
                    this.Enter = 13;
                    this.Backspace = 8;
                    this.keyDown = 40;
                    this.keyLeft = 37;
                    this.keyUp = 38;
                    this.keyRight = 39;
                    this.Uparrow2 = 24;
                    this.Downarrow2 = 25;
                    this.Rightarrow2 = 26;
                    this.Leftarrow2 = 27;
                    this.Uparrow = 30;
                    this.Downarrow = 31;
                    this.Leftarrow = 17;
                    this.Rightarrow = 16;
                    this.AsciiGridHor = 196;
                    this.AsciiGridVer = 179;
                    this.grids = System.Array.init([Pidroh.BaseUtils.Unicode.AsciiGridHor, Pidroh.BaseUtils.Unicode.AsciiGridVer], System.Char);
                    this.AsciiGridUpLeft = 217;
                    this.AsciiGridUpRight = 192;
                    this.AsciiGridUpRightLeft = 193;
                    this.AsciiGridDownLeft = 191;
                    this.AsciiGridDownRight = 218;
                    this.AsciiGridDownRightLeft = 194;
                    this.Escape = 27;
                }
            }
        }
    });

    Bridge.define("Pidroh.BaseUtils.Vector2D", {
        inherits: function () { return [System.IEquatable$1(Pidroh.BaseUtils.Vector2D)]; },
        $kind: "struct",
        statics: {
            fields: {
                zeroVector: null,
                unitVector: null,
                unitXVector: null,
                unitYVector: null
            },
            props: {
                Zero: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector2D.zeroVector.$clone();
                    }
                },
                One: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector2D.unitVector.$clone();
                    }
                },
                UnitX: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector2D.unitXVector.$clone();
                    }
                },
                UnitY: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector2D.unitYVector.$clone();
                    }
                }
            },
            ctors: {
                init: function () {
                    this.zeroVector = new Pidroh.BaseUtils.Vector2D();
                    this.unitVector = new Pidroh.BaseUtils.Vector2D();
                    this.unitXVector = new Pidroh.BaseUtils.Vector2D();
                    this.unitYVector = new Pidroh.BaseUtils.Vector2D();
                    this.zeroVector = new Pidroh.BaseUtils.Vector2D.$ctor2(0.0, 0.0);
                    this.unitVector = new Pidroh.BaseUtils.Vector2D.$ctor2(1.0, 1.0);
                    this.unitXVector = new Pidroh.BaseUtils.Vector2D.$ctor2(1.0, 0.0);
                    this.unitYVector = new Pidroh.BaseUtils.Vector2D.$ctor2(0.0, 1.0);
                }
            },
            methods: {
                InterpolateRounded: function (startPosition, endPosition, ratio) {
                    return (Pidroh.BaseUtils.Vector2D.op_Addition(Pidroh.BaseUtils.Vector2D.op_Multiply$1(startPosition.$clone(), (1 - ratio)), Pidroh.BaseUtils.Vector2D.op_Multiply$1(endPosition.$clone(), ratio))).Round();
                },
                Add: function (value1, value2) {
                    value1.X += value2.X;
                    value1.Y += value2.Y;
                    return value1.$clone();
                },
                Add$1: function (value1, value2, result) {
                    result.v.X = value1.v.X + value2.v.X;
                    result.v.Y = value1.v.Y + value2.v.Y;
                },
                Distance: function (value1, value2) {
                    var v1 = value1.X - value2.X, v2 = value1.Y - value2.Y;
                    return Math.sqrt((v1 * v1) + (v2 * v2));
                },
                Distance$1: function (value1, value2, result) {
                    var v1 = value1.v.X - value2.v.X, v2 = value1.v.Y - value2.v.Y;
                    result.v = Math.sqrt((v1 * v1) + (v2 * v2));
                },
                DistanceSquared: function (value1, value2) {
                    var v1 = value1.X - value2.X, v2 = value1.Y - value2.Y;
                    return (v1 * v1) + (v2 * v2);
                },
                DistanceSquared$1: function (value1, value2, result) {
                    var v1 = value1.v.X - value2.v.X, v2 = value1.v.Y - value2.v.Y;
                    result.v = (v1 * v1) + (v2 * v2);
                },
                Divide: function (value1, value2) {
                    value1.X /= value2.X;
                    value1.Y /= value2.Y;
                    return value1.$clone();
                },
                Divide$2: function (value1, value2, result) {
                    result.v.X = value1.v.X / value2.v.X;
                    result.v.Y = value1.v.Y / value2.v.Y;
                },
                Divide$1: function (value1, divider) {
                    var factor = 1 / divider;
                    value1.X *= factor;
                    value1.Y *= factor;
                    return value1.$clone();
                },
                Divide$3: function (value1, divider, result) {
                    var factor = 1 / divider;
                    result.v.X = value1.v.X * factor;
                    result.v.Y = value1.v.Y * factor;
                },
                Dot: function (value1, value2) {
                    return (value1.X * value2.X) + (value1.Y * value2.Y);
                },
                Dot$1: function (value1, value2, result) {
                    result.v = (value1.v.X * value2.v.X) + (value1.v.Y * value2.v.Y);
                },
                Reflect: function (vector, normal) {
                    var result = new Pidroh.BaseUtils.Vector2D();
                    var val = 2.0 * ((vector.X * normal.X) + (vector.Y * normal.Y));
                    result.X = vector.X - (normal.X * val);
                    result.Y = vector.Y - (normal.Y * val);
                    return result.$clone();
                },
                Reflect$1: function (vector, normal, result) {
                    var val = 2.0 * ((vector.v.X * normal.v.X) + (vector.v.Y * normal.v.Y));
                    result.v.X = vector.v.X - (normal.v.X * val);
                    result.v.Y = vector.v.Y - (normal.v.Y * val);
                },
                Max: function (value1, value2) {
                    return new Pidroh.BaseUtils.Vector2D.$ctor2(value1.X > value2.X ? value1.X : value2.X, value1.Y > value2.Y ? value1.Y : value2.Y);
                },
                Max$1: function (value1, value2, result) {
                    result.v.X = value1.v.X > value2.v.X ? value1.v.X : value2.v.X;
                    result.v.Y = value1.v.Y > value2.v.Y ? value1.v.Y : value2.v.Y;
                },
                Min: function (value1, value2) {
                    return new Pidroh.BaseUtils.Vector2D.$ctor2(value1.X < value2.X ? value1.X : value2.X, value1.Y < value2.Y ? value1.Y : value2.Y);
                },
                Min$1: function (value1, value2, result) {
                    result.v.X = value1.v.X < value2.v.X ? value1.v.X : value2.v.X;
                    result.v.Y = value1.v.Y < value2.v.Y ? value1.v.Y : value2.v.Y;
                },
                Multiply: function (value1, value2) {
                    value1.X *= value2.X;
                    value1.Y *= value2.Y;
                    return value1.$clone();
                },
                Multiply$1: function (value1, scaleFactor) {
                    value1.X *= scaleFactor;
                    value1.Y *= scaleFactor;
                    return value1.$clone();
                },
                Multiply$3: function (value1, scaleFactor, result) {
                    result.v.X = value1.v.X * scaleFactor;
                    result.v.Y = value1.v.Y * scaleFactor;
                },
                Multiply$2: function (value1, value2, result) {
                    result.v.X = value1.v.X * value2.v.X;
                    result.v.Y = value1.v.Y * value2.v.Y;
                },
                Negate: function (value) {
                    value.X = -value.X;
                    value.Y = -value.Y;
                    return value.$clone();
                },
                Negate$1: function (value, result) {
                    result.v.X = -value.v.X;
                    result.v.Y = -value.v.Y;
                },
                Normalize: function (value) {
                    var val = 1.0 / Math.sqrt((value.X * value.X) + (value.Y * value.Y));
                    value.X *= val;
                    value.Y *= val;
                    return value.$clone();
                },
                Normalize$1: function (value, result) {
                    var val = 1.0 / Math.sqrt((value.v.X * value.v.X) + (value.v.Y * value.v.Y));
                    result.v.X = value.v.X * val;
                    result.v.Y = value.v.Y * val;
                },
                Subtract: function (value1, value2) {
                    value1.X -= value2.X;
                    value1.Y -= value2.Y;
                    return value1.$clone();
                },
                Subtract$1: function (value1, value2, result) {
                    result.v.X = value1.v.X - value2.v.X;
                    result.v.Y = value1.v.Y - value2.v.Y;
                },
                op_UnaryNegation: function (value) {
                    value.X = -value.X;
                    value.Y = -value.Y;
                    return value.$clone();
                },
                op_Equality: function (value1, value2) {
                    return value1.X === value2.X && value1.Y === value2.Y;
                },
                op_Inequality: function (value1, value2) {
                    return value1.X !== value2.X || value1.Y !== value2.Y;
                },
                op_Addition: function (value1, value2) {
                    value1.X += value2.X;
                    value1.Y += value2.Y;
                    return value1.$clone();
                },
                op_Subtraction: function (value1, value2) {
                    value1.X -= value2.X;
                    value1.Y -= value2.Y;
                    return value1.$clone();
                },
                op_Multiply: function (value1, value2) {
                    value1.X *= value2.X;
                    value1.Y *= value2.Y;
                    return value1.$clone();
                },
                op_Multiply$1: function (value, scaleFactor) {
                    value.X *= scaleFactor;
                    value.Y *= scaleFactor;
                    return value.$clone();
                },
                op_Multiply$2: function (scaleFactor, value) {
                    value.X *= scaleFactor;
                    value.Y *= scaleFactor;
                    return value.$clone();
                },
                op_Division: function (value1, value2) {
                    value1.X /= value2.X;
                    value1.Y /= value2.Y;
                    return value1.$clone();
                },
                op_Division$1: function (value1, divider) {
                    var factor = 1 / divider;
                    value1.X *= factor;
                    value1.Y *= factor;
                    return value1.$clone();
                },
                getDefaultValue: function () { return new Pidroh.BaseUtils.Vector2D(); }
            }
        },
        fields: {
            X: 0,
            Y: 0
        },
        props: {
            XInt: {
                get: function () {
                    return Bridge.Int.clip32(this.X);
                }
            },
            YInt: {
                get: function () {
                    return Bridge.Int.clip32(this.Y);
                }
            }
        },
        alias: ["equalsT", "System$IEquatable$1$Pidroh$BaseUtils$Vector2D$equalsT"],
        ctors: {
            $ctor2: function (x, y) {
                this.$initialize();
                this.X = x;
                this.Y = y;
            },
            $ctor1: function (value) {
                this.$initialize();
                this.X = value;
                this.Y = value;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            Round: function () {
                return new Pidroh.BaseUtils.Vector2D.$ctor2(Bridge.Math.round(this.X, 0, 6), Bridge.Math.round(this.Y, 0, 6));
            },
            Set: function (x, y) {
                this.X = x;
                this.Y = y;

            },
            equals: function (obj) {
                if (Bridge.is(obj, Pidroh.BaseUtils.Vector2D)) {
                    return this.equalsT(this);
                }

                return false;
            },
            equalsT: function (other) {
                return (this.X === other.X) && (this.Y === other.Y);
            },
            getHashCode: function () {
                return ((System.Single.getHashCode(this.X) + System.Single.getHashCode(this.Y)) | 0);
            },
            Length: function () {
                return Math.sqrt((this.X * this.X) + (this.Y * this.Y));
            },
            LengthSquared: function () {
                return (this.X * this.X) + (this.Y * this.Y);
            },
            Normalize: function () {
                var val = 1.0 / Math.sqrt((this.X * this.X) + (this.Y * this.Y));
                this.X *= val;
                this.Y *= val;
            },
            toString: function () {
                var currentCulture = System.Globalization.CultureInfo.getCurrentCulture();
                return System.String.formatProvider.apply(System.String, [currentCulture, "{{X:{0} Y:{1}}}"].concat(System.Array.init([System.Single.format(this.X, "G", currentCulture), System.Single.format(this.Y, "G", currentCulture)], System.Object)));
            },
            $clone: function (to) {
                var s = to || new Pidroh.BaseUtils.Vector2D();
                s.X = this.X;
                s.Y = this.Y;
                return s;
            }
        }
    });

    Bridge.define("Pidroh.BaseUtils.Vector3D", {
        inherits: function () { return [System.IEquatable$1(Pidroh.BaseUtils.Vector3D)]; },
        $kind: "struct",
        statics: {
            fields: {
                zero: null,
                one: null,
                unitX: null,
                unitY: null,
                unitZ: null,
                up: null,
                down: null,
                right: null,
                left: null,
                forward: null,
                backward: null
            },
            props: {
                /**
                 * Returns a {@link } with components 0, 0, 0.
                 *
                 * @static
                 * @public
                 * @readonly
                 * @memberof Pidroh.BaseUtils.Vector3D
                 * @function Zero
                 * @type Pidroh.BaseUtils.Vector3D
                 */
                Zero: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector3D.zero.$clone();
                    }
                },
                /**
                 * Returns a {@link } with components 1, 1, 1.
                 *
                 * @static
                 * @public
                 * @readonly
                 * @memberof Pidroh.BaseUtils.Vector3D
                 * @function One
                 * @type Pidroh.BaseUtils.Vector3D
                 */
                One: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector3D.one.$clone();
                    }
                },
                /**
                 * Returns a {@link } with components 1, 0, 0.
                 *
                 * @static
                 * @public
                 * @readonly
                 * @memberof Pidroh.BaseUtils.Vector3D
                 * @function UnitX
                 * @type Pidroh.BaseUtils.Vector3D
                 */
                UnitX: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector3D.unitX.$clone();
                    }
                },
                /**
                 * Returns a {@link } with components 0, 1, 0.
                 *
                 * @static
                 * @public
                 * @readonly
                 * @memberof Pidroh.BaseUtils.Vector3D
                 * @function UnitY
                 * @type Pidroh.BaseUtils.Vector3D
                 */
                UnitY: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector3D.unitY.$clone();
                    }
                },
                /**
                 * Returns a {@link } with components 0, 0, 1.
                 *
                 * @static
                 * @public
                 * @readonly
                 * @memberof Pidroh.BaseUtils.Vector3D
                 * @function UnitZ
                 * @type Pidroh.BaseUtils.Vector3D
                 */
                UnitZ: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector3D.unitZ.$clone();
                    }
                },
                Up: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector3D.up.$clone();
                    }
                },
                Down: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector3D.down.$clone();
                    }
                },
                Right: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector3D.right.$clone();
                    }
                },
                Left: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector3D.left.$clone();
                    }
                },
                Forward: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector3D.forward.$clone();
                    }
                },
                Backward: {
                    get: function () {
                        return Pidroh.BaseUtils.Vector3D.backward.$clone();
                    }
                }
            },
            ctors: {
                init: function () {
                    this.zero = new Pidroh.BaseUtils.Vector3D();
                    this.one = new Pidroh.BaseUtils.Vector3D();
                    this.unitX = new Pidroh.BaseUtils.Vector3D();
                    this.unitY = new Pidroh.BaseUtils.Vector3D();
                    this.unitZ = new Pidroh.BaseUtils.Vector3D();
                    this.up = new Pidroh.BaseUtils.Vector3D();
                    this.down = new Pidroh.BaseUtils.Vector3D();
                    this.right = new Pidroh.BaseUtils.Vector3D();
                    this.left = new Pidroh.BaseUtils.Vector3D();
                    this.forward = new Pidroh.BaseUtils.Vector3D();
                    this.backward = new Pidroh.BaseUtils.Vector3D();
                    this.zero = new Pidroh.BaseUtils.Vector3D.$ctor3(0.0, 0.0, 0.0);
                    this.one = new Pidroh.BaseUtils.Vector3D.$ctor3(1.0, 1.0, 1.0);
                    this.unitX = new Pidroh.BaseUtils.Vector3D.$ctor3(1.0, 0.0, 0.0);
                    this.unitY = new Pidroh.BaseUtils.Vector3D.$ctor3(0.0, 1.0, 0.0);
                    this.unitZ = new Pidroh.BaseUtils.Vector3D.$ctor3(0.0, 0.0, 1.0);
                    this.up = new Pidroh.BaseUtils.Vector3D.$ctor3(0.0, 1.0, 0.0);
                    this.down = new Pidroh.BaseUtils.Vector3D.$ctor3(0.0, -1.0, 0.0);
                    this.right = new Pidroh.BaseUtils.Vector3D.$ctor3(1.0, 0.0, 0.0);
                    this.left = new Pidroh.BaseUtils.Vector3D.$ctor3(-1.0, 0.0, 0.0);
                    this.forward = new Pidroh.BaseUtils.Vector3D.$ctor3(0.0, 0.0, -1.0);
                    this.backward = new Pidroh.BaseUtils.Vector3D.$ctor3(0.0, 0.0, 1.0);
                }
            },
            methods: {
                /**
                 * Performs vector addition on <b /> and <b />.
                 *
                 * @static
                 * @public
                 * @this Pidroh.BaseUtils.Vector3D
                 * @memberof Pidroh.BaseUtils.Vector3D
                 * @param   {Pidroh.BaseUtils.Vector3D}    value1    The first vector to add.
                 * @param   {Pidroh.BaseUtils.Vector3D}    value2    The second vector to add.
                 * @return  {Pidroh.BaseUtils.Vector3D}              The result of the vector addition.
                 */
                Add: function (value1, value2) {
                    value1.X += value2.X;
                    value1.Y += value2.Y;
                    value1.Z += value2.Z;
                    return value1.$clone();
                },
                /**
                 * Performs vector addition on <b /> and
                 <b />, storing the result of the
                 addition in <b />.
                 *
                 * @static
                 * @public
                 * @this Pidroh.BaseUtils.Vector3D
                 * @memberof Pidroh.BaseUtils.Vector3D
                 * @param   {Pidroh.BaseUtils.Vector3D}    value1    The first vector to add.
                 * @param   {Pidroh.BaseUtils.Vector3D}    value2    The second vector to add.
                 * @param   {Pidroh.BaseUtils.Vector3D}    result    The result of the vector addition.
                 * @return  {void}
                 */
                Add$1: function (value1, value2, result) {
                    result.v.X = value1.v.X + value2.v.X;
                    result.v.Y = value1.v.Y + value2.v.Y;
                    result.v.Z = value1.v.Z + value2.v.Z;
                },
                Cross: function (vector1, vector2) {
                    vector1 = {v:vector1};
                    vector2 = {v:vector2};
                    Pidroh.BaseUtils.Vector3D.Cross$1(vector1, vector2, vector1);
                    return vector1.v.$clone();
                },
                Cross$1: function (vector1, vector2, result) {
                    var x = vector1.v.Y * vector2.v.Z - vector2.v.Y * vector1.v.Z;
                    var y = -(vector1.v.X * vector2.v.Z - vector2.v.X * vector1.v.Z);
                    var z = vector1.v.X * vector2.v.Y - vector2.v.X * vector1.v.Y;
                    result.v.X = x;
                    result.v.Y = y;
                    result.v.Z = z;
                },
                Distance: function (vector1, vector2) {
                    vector1 = {v:vector1};
                    vector2 = {v:vector2};
                    var result = { };
                    Pidroh.BaseUtils.Vector3D.DistanceSquared$1(vector1, vector2, result);
                    return Math.sqrt(result.v);
                },
                Distance$1: function (value1, value2, result) {
                    Pidroh.BaseUtils.Vector3D.DistanceSquared$1(value1, value2, result);
                    result.v = Math.sqrt(result.v);
                },
                DistanceSquared: function (value1, value2) {
                    value1 = {v:value1};
                    value2 = {v:value2};
                    var result = { };
                    Pidroh.BaseUtils.Vector3D.DistanceSquared$1(value1, value2, result);
                    return result.v;
                },
                DistanceSquared$1: function (value1, value2, result) {
                    result.v = (value1.v.X - value2.v.X) * (value1.v.X - value2.v.X) + (value1.v.Y - value2.v.Y) * (value1.v.Y - value2.v.Y) + (value1.v.Z - value2.v.Z) * (value1.v.Z - value2.v.Z);
                },
                Divide: function (value1, value2) {
                    value1.X /= value2.X;
                    value1.Y /= value2.Y;
                    value1.Z /= value2.Z;
                    return value1.$clone();
                },
                Divide$1: function (value1, value2) {
                    var factor = 1 / value2;
                    value1.X *= factor;
                    value1.Y *= factor;
                    value1.Z *= factor;
                    return value1.$clone();
                },
                Divide$3: function (value1, divisor, result) {
                    var factor = 1 / divisor;
                    result.v.X = value1.v.X * factor;
                    result.v.Y = value1.v.Y * factor;
                    result.v.Z = value1.v.Z * factor;
                },
                Divide$2: function (value1, value2, result) {
                    result.v.X = value1.v.X / value2.v.X;
                    result.v.Y = value1.v.Y / value2.v.Y;
                    result.v.Z = value1.v.Z / value2.v.Z;
                },
                Dot: function (vector1, vector2) {
                    return vector1.X * vector2.X + vector1.Y * vector2.Y + vector1.Z * vector2.Z;
                },
                Dot$1: function (vector1, vector2, result) {
                    result.v = vector1.v.X * vector2.v.X + vector1.v.Y * vector2.v.Y + vector1.v.Z * vector2.v.Z;
                },
                Multiply: function (value1, value2) {
                    value1.X *= value2.X;
                    value1.Y *= value2.Y;
                    value1.Z *= value2.Z;
                    return value1.$clone();
                },
                Multiply$1: function (value1, scaleFactor) {
                    value1.X *= scaleFactor;
                    value1.Y *= scaleFactor;
                    value1.Z *= scaleFactor;
                    return value1.$clone();
                },
                Multiply$3: function (value1, scaleFactor, result) {
                    result.v.X = value1.v.X * scaleFactor;
                    result.v.Y = value1.v.Y * scaleFactor;
                    result.v.Z = value1.v.Z * scaleFactor;
                },
                Multiply$2: function (value1, value2, result) {
                    result.v.X = value1.v.X * value2.v.X;
                    result.v.Y = value1.v.Y * value2.v.Y;
                    result.v.Z = value1.v.Z * value2.v.Z;
                },
                /**
                 * Returns a {@link } pointing in the opposite
                 direction of <b />.
                 *
                 * @static
                 * @public
                 * @this Pidroh.BaseUtils.Vector3D
                 * @memberof Pidroh.BaseUtils.Vector3D
                 * @param   {Pidroh.BaseUtils.Vector3D}    value    The vector to negate.
                 * @return  {Pidroh.BaseUtils.Vector3D}             The vector negation of <b />.
                 */
                Negate: function (value) {
                    value = new Pidroh.BaseUtils.Vector3D.$ctor3(-value.X, -value.Y, -value.Z);
                    return value.$clone();
                },
                /**
                 * Stores a {@link } pointing in the opposite
                 direction of <b /> in <b />.
                 *
                 * @static
                 * @public
                 * @this Pidroh.BaseUtils.Vector3D
                 * @memberof Pidroh.BaseUtils.Vector3D
                 * @param   {Pidroh.BaseUtils.Vector3D}    value     The vector to negate.
                 * @param   {Pidroh.BaseUtils.Vector3D}    result    The vector that the negation of <b>result</b> will be stored in.
                 * @return  {void}
                 */
                Negate$1: function (value, result) {
                    result.v.X = -value.v.X;
                    result.v.Y = -value.v.Y;
                    result.v.Z = -value.v.Z;
                },
                Normalize: function (vector) {
                    vector = {v:vector};
                    Pidroh.BaseUtils.Vector3D.Normalize$1(vector, vector);
                    return vector.v.$clone();
                },
                Normalize$1: function (value, result) {
                    var factor = { };
                    Pidroh.BaseUtils.Vector3D.Distance$1(value, Bridge.ref(Pidroh.BaseUtils.Vector3D, "zero"), factor);
                    factor.v = 1.0 / factor.v;
                    result.v.X = value.v.X * factor.v;
                    result.v.Y = value.v.Y * factor.v;
                    result.v.Z = value.v.Z * factor.v;
                },
                Reflect: function (vector, normal) {
                    var reflectedVector = new Pidroh.BaseUtils.Vector3D();
                    var dotProduct = ((vector.X * normal.X) + (vector.Y * normal.Y)) + (vector.Z * normal.Z);
                    reflectedVector.X = vector.X - (2.0 * normal.X) * dotProduct;
                    reflectedVector.Y = vector.Y - (2.0 * normal.Y) * dotProduct;
                    reflectedVector.Z = vector.Z - (2.0 * normal.Z) * dotProduct;

                    return reflectedVector.$clone();
                },
                Reflect$1: function (vector, normal, result) {

                    var dotProduct = ((vector.v.X * normal.v.X) + (vector.v.Y * normal.v.Y)) + (vector.v.Z * normal.v.Z);
                    result.v.X = vector.v.X - (2.0 * normal.v.X) * dotProduct;
                    result.v.Y = vector.v.Y - (2.0 * normal.v.Y) * dotProduct;
                    result.v.Z = vector.v.Z - (2.0 * normal.v.Z) * dotProduct;
                },
                /**
                 * Performs vector subtraction on <b /> and <b />.
                 *
                 * @static
                 * @public
                 * @this Pidroh.BaseUtils.Vector3D
                 * @memberof Pidroh.BaseUtils.Vector3D
                 * @param   {Pidroh.BaseUtils.Vector3D}    value1    The vector to be subtracted from.
                 * @param   {Pidroh.BaseUtils.Vector3D}    value2    The vector to be subtracted from <b>value2</b>.
                 * @return  {Pidroh.BaseUtils.Vector3D}              The result of the vector subtraction.
                 */
                Subtract: function (value1, value2) {
                    value1.X -= value2.X;
                    value1.Y -= value2.Y;
                    value1.Z -= value2.Z;
                    return value1.$clone();
                },
                /**
                 * Performs vector subtraction on <b /> and <b />.
                 *
                 * @static
                 * @public
                 * @this Pidroh.BaseUtils.Vector3D
                 * @memberof Pidroh.BaseUtils.Vector3D
                 * @param   {Pidroh.BaseUtils.Vector3D}    value1    The vector to be subtracted from.
                 * @param   {Pidroh.BaseUtils.Vector3D}    value2    The vector to be subtracted from <b>value2</b>.
                 * @param   {Pidroh.BaseUtils.Vector3D}    result    The result of the vector subtraction.
                 * @return  {void}
                 */
                Subtract$1: function (value1, value2, result) {
                    result.v.X = value1.v.X - value2.v.X;
                    result.v.Y = value1.v.Y - value2.v.Y;
                    result.v.Z = value1.v.Z - value2.v.Z;
                }/**
                 * // Transforms a vector by a quaternion rotation.
                //
                 *
                 * @static
                 * @public
                 * @this Pidroh.BaseUtils.Vector3D
                 * @memberof Pidroh.BaseUtils.Vector3D
                 * @param   {Pidroh.BaseUtils.Vector3D}    value1    
                 * @param   {Pidroh.BaseUtils.Vector3D}    value2
                 * @return  {boolean}
                 */
                ,
                op_Equality: function (value1, value2) {
                    return value1.X === value2.X && value1.Y === value2.Y && value1.Z === value2.Z;
                },
                op_Inequality: function (value1, value2) {
                    return !(Pidroh.BaseUtils.Vector3D.op_Equality(value1.$clone(), value2.$clone()));
                },
                op_Addition: function (value1, value2) {
                    value1.X += value2.X;
                    value1.Y += value2.Y;
                    value1.Z += value2.Z;
                    return value1.$clone();
                },
                op_UnaryNegation: function (value) {
                    value = new Pidroh.BaseUtils.Vector3D.$ctor3(-value.X, -value.Y, -value.Z);
                    return value.$clone();
                },
                op_Subtraction: function (value1, value2) {
                    value1.X -= value2.X;
                    value1.Y -= value2.Y;
                    value1.Z -= value2.Z;
                    return value1.$clone();
                },
                op_Multiply: function (value1, value2) {
                    value1.X *= value2.X;
                    value1.Y *= value2.Y;
                    value1.Z *= value2.Z;
                    return value1.$clone();
                },
                op_Multiply$1: function (value, scaleFactor) {
                    value.X *= scaleFactor;
                    value.Y *= scaleFactor;
                    value.Z *= scaleFactor;
                    return value.$clone();
                },
                op_Multiply$2: function (scaleFactor, value) {
                    value.X *= scaleFactor;
                    value.Y *= scaleFactor;
                    value.Z *= scaleFactor;
                    return value.$clone();
                },
                op_Division: function (value1, value2) {
                    value1.X /= value2.X;
                    value1.Y /= value2.Y;
                    value1.Z /= value2.Z;
                    return value1.$clone();
                },
                op_Division$1: function (value, divider) {
                    var factor = 1 / divider;
                    value.X *= factor;
                    value.Y *= factor;
                    value.Z *= factor;
                    return value.$clone();
                },
                getDefaultValue: function () { return new Pidroh.BaseUtils.Vector3D(); }
            }
        },
        fields: {
            X: 0,
            Y: 0,
            Z: 0
        },
        props: {
            DebugDisplayString: {
                get: function () {
                    return System.String.concat([System.Single.format(this.X), "  ", System.Single.format(this.Y), "  ", System.Single.format(this.Z)]);
                }
            }
        },
        alias: ["equalsT", "System$IEquatable$1$Pidroh$BaseUtils$Vector3D$equalsT"],
        ctors: {
            $ctor3: function (x, y, z) {
                this.$initialize();
                this.X = x;
                this.Y = y;
                this.Z = z;
            },
            $ctor2: function (value) {
                this.$initialize();
                this.X = value;
                this.Y = value;
                this.Z = value;
            },
            $ctor1: function (value, z) {
                this.$initialize();
                this.X = value.X;
                this.Y = value.Y;
                this.Z = z;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            equals: function (obj) {
                if (!(Bridge.is(obj, Pidroh.BaseUtils.Vector3D))) {
                    return false;
                }

                var other = System.Nullable.getValue(Bridge.cast(Bridge.unbox(obj), Pidroh.BaseUtils.Vector3D));
                return this.X === other.X && this.Y === other.Y && this.Z === other.Z;
            },
            equalsT: function (other) {
                return this.X === other.X && this.Y === other.Y && this.Z === other.Z;
            },
            getHashCode: function () {
                return Bridge.Int.clip32(this.X + this.Y + this.Z);
            },
            Length: function () {
                var result = { };
                Pidroh.BaseUtils.Vector3D.DistanceSquared$1(Bridge.ref(this), Bridge.ref(Pidroh.BaseUtils.Vector3D, "zero"), result);
                return Math.sqrt(result.v);
            },
            LengthSquared: function () {
                var result = { };
                Pidroh.BaseUtils.Vector3D.DistanceSquared$1(Bridge.ref(this), Bridge.ref(Pidroh.BaseUtils.Vector3D, "zero"), result);
                return result.v;
            },
            Normalize: function () {
                Pidroh.BaseUtils.Vector3D.Normalize$1(Bridge.ref(this), Bridge.ref(this));
            },
            toString: function () {
                var sb = new System.Text.StringBuilder("", 32);
                sb.append("{X:");
                sb.append(this.X);
                sb.append(" Y:");
                sb.append(this.Y);
                sb.append(" Z:");
                sb.append(this.Z);
                sb.append("}");
                return sb.toString();
            },
            $clone: function (to) {
                var s = to || new Pidroh.BaseUtils.Vector3D();
                s.X = this.X;
                s.Y = this.Y;
                s.Z = this.Z;
                return s;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.Animation", {
        fields: {
            area: null,
            target: 0,
            element: 0,
            userRefOffset: null
        },
        ctors: {
            init: function () {
                this.userRefOffset = new Pidroh.BaseUtils.Vector2D();
                this.target = Pidroh.ConsoleApp.Turnbased.Target.None;
                this.element = Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Nothingness;
            },
            $ctor2: function (target) {
                this.$initialize();
                this.target = target;
            },
            $ctor3: function (target, element) {
                this.$initialize();
                this.element = element;
                this.target = target;
            },
            $ctor1: function (area, element, target) {
                this.$initialize();
                this.area = area;
                this.element = element;
                this.target = target;
            },
            ctor: function (area, element) {
                this.$initialize();
                this.area = area;
                this.element = element;
            },
            $ctor4: function (target, element, userRefOffset) {
                Pidroh.ConsoleApp.Turnbased.Animation.$ctor3.call(this, target, element);
                this.userRefOffset = userRefOffset.$clone();
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.Area", {
        fields: {
            target: 0,
            points: null
        },
        ctors: {
            init: function () {
                this.points = new (System.Collections.Generic.List$1(Pidroh.BaseUtils.Vector2D)).ctor();
            },
            ctor: function (target) {
                this.$initialize();
                this.target = target;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.AsyncTasks");

    Bridge.define("Pidroh.ConsoleApp.Turnbased.DelayedActions", {
        fields: {
            times: null,
            lists: null
        },
        ctors: {
            init: function () {
                this.times = new (System.Collections.Generic.List$1(System.Single)).ctor();
                this.lists = new (System.Collections.Generic.List$1(System.Collections.IList)).ctor();
            }
        },
        methods: {
            Update: function (delta) {
                for (var i = 0; i < this.times.Count; i = (i + 1) | 0) {
                    this.times.setItem(i, this.times.getItem(i) -delta);
                    if (this.times.getItem(i) <= 0) {
                        this.Execute(i);
                        this.EndTask(i);
                    }
                }
            },
            Add: function (time) {
                this.times.add(time);
            },
            IsDone: function () {
                return this.times.Count === 0;
            },
            EndTask: function (i) {
                var $t;
                this.times.removeAt(i);
                $t = Bridge.getEnumerator(this.lists);
                try {
                    while ($t.moveNext()) {
                        var l = $t.Current;
                        System.Array.removeAt(l, i, Object);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }}
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.AsyncTrack");

    Bridge.define("Pidroh.ConsoleApp.Turnbased.AttackInventory", {
        fields: {
            attackInventory: null,
            equippedAttacks: null
        },
        ctors: {
            init: function () {
                this.attackInventory = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.equippedAttacks = System.Array.init([-1, -1, -1, -1], System.Int32);
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.AttackPrize", {
        fields: {
            prizes: null
        },
        ctors: {
            $ctor1: function (attack) {
                this.$initialize();
                this.prizes = System.Array.init(1, 0, System.Int32);
                this.prizes[System.Array.index(0, this.prizes)] = attack;
            },
            ctor: function () {
                this.$initialize();
            }
        }
    });

    /** @namespace Pidroh.ConsoleApp.Turnbased */

    /**
     * data that will be a part of stagedata so each stage can have it's config
     It will also be contained in battlemain.
     Should be static, once created.
     *
     * @public
     * @class Pidroh.ConsoleApp.Turnbased.BattleConfig
     */
    Bridge.define("Pidroh.ConsoleApp.Turnbased.BattleConfig", {
        fields: {
            enemiesToSummon: null,
            needKillAllEnemies: false,
            attackDemonstrationMode: false,
            heroPresent: false,
            intermissionScreen: false
        },
        ctors: {
            init: function () {
                this.enemiesToSummon = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.needKillAllEnemies = true;
                this.attackDemonstrationMode = false;
                this.heroPresent = true;
                this.intermissionScreen = true;
            },
            ctor: function () {
                this.$initialize();
            },
            $ctor4: function (enemiesToSummon) {
                this.$initialize();
                this.enemiesToSummon.AddRange(enemiesToSummon);
            },
            $ctor1: function (needKillAllEnemies) {
                this.$initialize();
                this.needKillAllEnemies = needKillAllEnemies;
            },
            $ctor2: function (needKillAllEnemies, previewMode) {
                this.$initialize();
                this.needKillAllEnemies = needKillAllEnemies;
                this.attackDemonstrationMode = previewMode;
            },
            $ctor3: function (needKillAllEnemies, attackDemonstrationMode, heroPresent, intermission) {
                Pidroh.ConsoleApp.Turnbased.BattleConfig.$ctor2.call(this, needKillAllEnemies, attackDemonstrationMode);
                this.intermissionScreen = intermission;
                this.heroPresent = heroPresent;
            }
        },
        methods: {
            NoIntermission: function () {
                this.intermissionScreen = false;
                return this;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.BattleMain", {
        statics: {
            methods: {
                RandomPosition: function (e) {
                    e.pos.X = Pidroh.BaseUtils.RandomSupplier.Range(0, 5);
                    e.pos.Y = Pidroh.BaseUtils.RandomSupplier.Range(0, 2);
                }
            }
        },
        fields: {
            deckManager: null,
            entities: null,
            battleState: null,
            happManager: null,
            movementMoves: null,
            enemyMoves: null,
            inputs: null,
            playerHandFixed: null,
            playerHandUnfixed: null,
            playerHandPool: null,
            timeToChooseMax: 0,
            timeToChoose: 0,
            battleResult: null,
            MoveDataExecuter: null,
            timeStamp: null,
            pickupAccessor: null,
            ecsInteg: null,
            EnemyGenerateMoves: null,
            trackBattle: null,
            BattleConfig: null,
            BoardWidth: 0,
            BoardHeight: 0
        },
        ctors: {
            init: function () {
                this.entities = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.BattleMain.BattleEntity)).ctor();
                this.battleState = new Pidroh.ConsoleApp.Turnbased.BattleMain.BattleState();
                this.happManager = new Pidroh.ConsoleApp.Turnbased.Happs.HappManager();
                this.movementMoves = new (System.Collections.Generic.Dictionary$2(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType,Pidroh.BaseUtils.Vector2D))();
                this.inputs = new Pidroh.ConsoleApp.Turnbased.InputHolder();
                this.playerHandFixed = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)).ctor();
                this.playerHandUnfixed = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)).ctor();
                this.playerHandPool = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)).ctor();
                this.timeToChooseMax = 15.0;
                this.timeToChoose = -1;
                this.battleResult = new Pidroh.ConsoleApp.Turnbased.BattleResult();
                this.BoardWidth = 6;
                this.BoardHeight = 3;
            },
            ctor: function (mode, ecs, timeStamp) {
                this.$initialize();
                this.timeStamp = timeStamp;
                this.pickupAccessor = ecs.QuickAccessor2(Pidroh.ConsoleApp.Turnbased.BattleMain.BattleEntity, Pidroh.ConsoleApp.Turnbased.PickupInfo);
                this.movementMoves.add(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveUp, Pidroh.BaseUtils.Vector2D.UnitY.$clone());
                this.movementMoves.add(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveDown, Pidroh.BaseUtils.Vector2D.op_UnaryNegation(Pidroh.BaseUtils.Vector2D.UnitY.$clone()));
                this.movementMoves.add(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveLeft, Pidroh.BaseUtils.Vector2D.op_UnaryNegation(Pidroh.BaseUtils.Vector2D.UnitX.$clone()));
                this.movementMoves.add(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveRight, Pidroh.BaseUtils.Vector2D.UnitX.$clone());

                ecs.CreateEntityWithComponent(this.battleState);

                this.playerHandFixed.clear();
                this.playerHandFixed.add(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveRight);
                this.playerHandFixed.add(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveLeft);
                this.playerHandFixed.add(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveDown);
                this.playerHandFixed.add(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveUp);

                if (mode === 0) {
                    this.playerHandUnfixed.add(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.NormalShot);
                    this.enemyMoves = System.Array.init([Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveUp, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveLeft, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveDown, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveRight, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.NormalShot], Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType);
                } else {


                    this.enemyMoves = System.Array.init([Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveDown, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveLeft, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveUp, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveRight, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Ice, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Thunder], Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType);
                }


            }
        },
        methods: {
            BattleConfigure: function (battleConfig) {
                if (battleConfig == null) {
                    battleConfig = new Pidroh.ConsoleApp.Turnbased.BattleConfig.$ctor1(true);
                }
                this.BattleConfig = battleConfig;
                this.battleState.turnsPerPhase.Val = 3;

            },
            IsVictory: function () {
                return this.battleResult.result === 1;
            },
            Init: function () {
                if (this.BattleConfig.attackDemonstrationMode === false) {
                    var hero = new Pidroh.ConsoleApp.Turnbased.BattleMain.BattleEntity();

                    hero.pos.Set(1, 1);
                    hero.minPos.Set(0, 0);
                    hero.maxPos.Set(2, 2);
                    hero.Type = Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.hero;
                    hero.maxLife = 50;

                    for (var i = 0; i < hero.moves.length; i = (i + 1) | 0) {
                        hero.moves[System.Array.index(i, hero.moves)] = -1;
                    }


                    this.entities.add(hero);
                    this.ecsInteg.HeroCreated(hero);
                }


                this.ecsInteg.SpawnEnemies();

                {
                }


                this.Reset();
                this.ExecutePhase();
            },
            NewBattleEntity: function () {
                var battleEntity = new Pidroh.ConsoleApp.Turnbased.BattleMain.BattleEntity();
                this.entities.add(battleEntity);
                return battleEntity;
            },
            Reset: function () {
                for (var i = 0; i < this.entities.Count; i = (i + 1) | 0) {
                    this.entities.getItem(i).life = this.entities.getItem(i).maxLife;
                }
                this.ChangePhase(Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.EnemyMoveChoice);
                this.battleState.turn.Val = 0;
                this.battleState.totalTurns = 0;
                this.battleState.actingEntity = 0;
                this.battleState.moveTick_Now.Val = 0;
                this.battleState.moveTick_Total = 1;
                this.battleResult.result = 0;
            },
            IsOver: function () {
                return this.battleResult.result !== 0;
            },
            Tick: function () {
                var $t;
                this.FinishPreviousTick();
                var heroAlive = false;
                var enemyAlive = false;
                var pickupObligatoryExist = false;
                $t = Bridge.getEnumerator(this.entities);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        if (item.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                            if (item.life > 0) {
                                enemyAlive = true;
                            }
                        }
                        if (item.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.hero) {
                            if (item.life > 0) {
                                heroAlive = true;
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }for (var i = 0; i < this.pickupAccessor.Length; i = (i + 1) | 0) {
                    var pickup = this.pickupAccessor.Comp2(i);
                    if (pickup.necessaryForVictory && this.pickupAccessor.Comp1(i).Alive) {
                        pickupObligatoryExist = true;
                    }
                }
                if (this.battleState.BattleEndEnable && !this.BattleConfig.attackDemonstrationMode) {
                    if (!heroAlive) {
                        this.battleResult.result = 2;
                    } else if ((!enemyAlive || !this.BattleConfig.needKillAllEnemies) && !pickupObligatoryExist) {
                        this.battleResult.result = 1;
                        this.trackBattle.BattleEndVictory();
                    }
                }

                if (this.battleResult.result === 0) {
                    this.happManager.Tick();
                    this.timeStamp.Advance(1);
                    this.ExecutePhase();
                }

            },
            Update: function (delta) {
                if (this.timeToChoose > 0 && this.battleState.phase === Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.PickHands) {
                    this.timeToChoose -= delta;
                    if (this.timeToChoose <= 0) {
                        this.Tick();
                    }
                }


            },
            FinishPreviousTick: function () {
                var $t, $t1;
                var previousPhase = this.battleState.phase;
                switch (previousPhase) {
                    case Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.EnemyMoveChoice: 
                        this.ChangePhase(Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.HandRecharge);
                        break;
                    case Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.HandRecharge: 
                        this.ChangePhase(Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.PickHands);
                        break;
                    case Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.PickHands: 
                        this.ChangePhase(Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.ExecuteMove);
                        break;
                    case Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.ExecuteMove: 
                        if (Pidroh.ConsoleApp.Turnbased.Value.op_Implicit(this.battleState.moveTick_Now) >= ((this.battleState.moveTick_Total - 1) | 0)) {
                            this.battleState.moveTick_Now.Val = 0;
                            this.battleState.moveTick_Total = 1;
                            var noMoreUnitsToActThisTurn = true;
                            var i_initial = (this.battleState.actingEntity + 1) | 0;
                            if (i_initial < this.entities.Count) {
                                for (var i = i_initial; i < this.entities.Count; i = (i + 1) | 0) {
                                    if (this.entities.getItem(i).Alive) {
                                        this.battleState.actingEntity = i;
                                        noMoreUnitsToActThisTurn = false;
                                        break;
                                    }
                                }
                            }


                            if (noMoreUnitsToActThisTurn) {
                                if (Pidroh.ConsoleApp.Turnbased.Value.op_Implicit$1(this.battleState.turn) >= Pidroh.ConsoleApp.Turnbased.Value.op_Subtraction(this.battleState.turnsPerPhase, 1)) {
                                    this.ChangePhase(Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.EnemyMoveChoice);
                                    $t = Bridge.getEnumerator(this.entities);
                                    try {
                                        while ($t.moveNext()) {
                                            var e = $t.Current;
                                            if (e.randomPosition) {
                                                Pidroh.ConsoleApp.Turnbased.BattleMain.RandomPosition(e);
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t, System.IDisposable)) {
                                            $t.System$IDisposable$Dispose();
                                        }
                                    }} else {
                                    this.battleState.actingEntity = 0;
                                    this.battleState.turn = Pidroh.ConsoleApp.Turnbased.Value.op_Addition(this.battleState.turn, 1);
                                    this.battleState.totalTurns = (this.battleState.totalTurns + 1) | 0;
                                }
                            }
                        } else {
                            $t1 = this.battleState.moveTick_Now;
                            $t1.Val += 1;
                        }
                        break;
                    default: 
                        break;
                }
            },
            ChangePhase: function (phase) {
                var $t;
                var previousPhase = this.battleState.phase;
                if (phase === previousPhase) {
                    return;
                }

                if (phase === Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.PickHands) {
                    this.trackBattle.Round();
                    if (previousPhase !== Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.ConfirmInput) {
                        if (this.BattleConfig.heroPresent) {
                            this.deckManager.Refresh();
                            this.playerHandPool.clear();
                            var moves = this.deckManager.selection;
                            for (var i = 0; i < moves.Count; i = (i + 1) | 0) {
                                this.playerHandPool.add(moves.getItem(i));
                            }

                            this.playerHandUnfixed.clear();
                            var commandsToAdd = moves.Count;
                            if (commandsToAdd > this.playerHandPool.Count) {
                                commandsToAdd = this.playerHandPool.Count;
                            }
                            for (var i1 = 0; i1 < commandsToAdd; i1 = (i1 + 1) | 0) {
                                this.playerHandUnfixed.add(this.playerHandPool.getItem(i1));
                            }


                            this.timeToChoose = this.timeToChooseMax;
                        }

                    }

                }
                if (previousPhase === Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.ExecuteMove) {
                    this.battleState.turn.Val = 0;
                    this.battleState.actingEntity = 0;
                    this.battleState.moveTick_Now.Val = 0;
                    this.battleState.moveTick_Total = 1;
                    $t = Bridge.getEnumerator(this.entities);
                    try {
                        while ($t.moveNext()) {
                            var e = $t.Current;
                            for (var i2 = 0; i2 < e.moves.length; i2 = (i2 + 1) | 0) {
                                e.moves[System.Array.index(i2, e.moves)] = -1;
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }}
                this.battleState.phase = phase;
            },
            ConfirmInputStart: function () {
                this.ChangePhase(Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.ConfirmInput);
                this.inputs.Clear();
                this.inputs.Add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle, Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Confirm, Pidroh.ConsoleApp.Turnbased.MiscBattleInput, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscBattleInput))), Pidroh.ConsoleApp.Turnbased.InputTags.MISC);
                this.inputs.Add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle, Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Cancel, Pidroh.ConsoleApp.Turnbased.MiscBattleInput, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscBattleInput))), Pidroh.ConsoleApp.Turnbased.InputTags.MISC);
            },
            ExecutePhase: function () {
                var phase = this.battleState.phase;
                switch (phase) {
                    case Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.EnemyMoveChoice: 
                        this.ecsInteg.SpawnEnemies();
                        this.EnemyGenerateMoves();
                        break;
                    case Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.HandRecharge: 
                        break;
                    case Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.PickHands: 
                        this.PickHandInput();
                        break;
                    case Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.ExecuteMove: 
                        this.ecsInteg.SpawnEnemies();
                        this.ExecuteMoves();
                        break;
                    default: 
                        break;
                }
            },
            PickHandInput: function () {
                var $t, $t1, $t2;
                this.inputs.Clear();
                this.inputs.inputForConfirmation = new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor2(Pidroh.ConsoleApp.Turnbased.InputType.None, -1);

                if (!this.BattleConfig.attackDemonstrationMode) {
                    $t = Bridge.getEnumerator(this.playerHandFixed);
                    try {
                        while ($t.moveNext()) {
                            var hi = $t.Current;
                            this.inputs.Add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor2(Pidroh.ConsoleApp.Turnbased.InputType.Move, hi), Pidroh.ConsoleApp.Turnbased.InputTags.MOVEFIX);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }$t1 = Bridge.getEnumerator(this.playerHandUnfixed);
                    try {
                        while ($t1.moveNext()) {
                            var hi1 = $t1.Current;
                            if (hi1 !== Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.DoNothing) {
                                this.inputs.Add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor2(Pidroh.ConsoleApp.Turnbased.InputType.Move, hi1), Pidroh.ConsoleApp.Turnbased.InputTags.MOVEUNFIX);
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }this.inputs.Add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle, Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Redo, Pidroh.ConsoleApp.Turnbased.MiscBattleInput, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscBattleInput))), Pidroh.ConsoleApp.Turnbased.InputTags.MISC);
                    this.inputs.Add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle, Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Done, Pidroh.ConsoleApp.Turnbased.MiscBattleInput, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscBattleInput))), Pidroh.ConsoleApp.Turnbased.InputTags.MISC);
                    this.inputs.Add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle, Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Help, Pidroh.ConsoleApp.Turnbased.MiscBattleInput, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscBattleInput))), Pidroh.ConsoleApp.Turnbased.InputTags.MISC);
                } else {
                    this.inputs.Add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle, Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.LeaveAttackDemonstration, Pidroh.ConsoleApp.Turnbased.MiscBattleInput, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscBattleInput))), Pidroh.ConsoleApp.Turnbased.InputTags.MISC);
                }


                var enemyExist = false;
                $t2 = Bridge.getEnumerator(this.entities);
                try {
                    while ($t2.moveNext()) {
                        var item = $t2.Current;
                        if (item.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                            enemyExist = true;
                        }
                    }
                } finally {
                    if (Bridge.is($t2, System.IDisposable)) {
                        $t2.System$IDisposable$Dispose();
                    }
                }},
            InputDone: function (input) {



                if (this.battleState.phase === Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.ConfirmInput) {
                    this.ProcessInput(input);
                } else {
                    this.inputs.inputForConfirmation = input;
                }

            },
            InputConfirmed: function () {
                this.ChangePhase(Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.PickHands);
                var input = this.inputs.inputForConfirmation;
                this.inputs.inputForConfirmation = new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor2(Pidroh.ConsoleApp.Turnbased.InputType.None, -1);
                this.ProcessInput(input);
            },
            ProcessInput: function (input) {
                var $t;
                if (input.type === Pidroh.ConsoleApp.Turnbased.InputType.Move) {
                    var arg1 = input.arg1;
                    if (this.playerHandFixed.contains(arg1) || this.playerHandUnfixed.contains(arg1)) {
                        this.deckManager.InputUsed(arg1);
                        this.MoveChosen(arg1);
                    }

                }

                if (input.type === Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle) {
                    var misc = input.arg1;
                    if (misc === Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Redo) {
                        $t = Bridge.getEnumerator(this.entities);
                        try {
                            while ($t.moveNext()) {
                                var e = $t.Current;
                                if (e.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.hero) {
                                    for (var i = 0; i < e.moves.length; i = (i + 1) | 0) {
                                        if (e.moves[System.Array.index(i, e.moves)] == null) {
                                            e.moves[System.Array.index(i, e.moves)] = -1;
                                        }
                                        var value = e.moves[System.Array.index(i, e.moves)];

                                        if (value === -1 || i === Pidroh.ConsoleApp.Turnbased.Value.op_Implicit(this.battleState.turnsPerPhase)) {
                                            if (i > 0) {
                                                var lostMove = e.moves[System.Array.index(((i - 1) | 0), e.moves)];
                                                this.deckManager.Recover(lostMove);
                                                e.moves[System.Array.index(((i - 1) | 0), e.moves)] = -1;
                                            }
                                        }
                                    }
                                }
                            }
                        } finally {
                            if (Bridge.is($t, System.IDisposable)) {
                                $t.System$IDisposable$Dispose();
                            }
                        }}
                    if (misc === Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Done) {
                        this.Tick();
                    }
                    if (misc === Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Confirm) {
                        this.InputConfirmed();
                        this.PickHandInput();
                    }
                    if (misc === Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Cancel) {

                    }
                    if (misc === Pidroh.ConsoleApp.Turnbased.MiscBattleInput.LeaveAttackDemonstration) {
                        this.battleResult.result = 3;
                    }
                }
            },
            BattleDecided: function () {
                var $t;
                var heroes = 0;
                var enemies = 0;
                $t = Bridge.getEnumerator(this.entities);
                try {
                    while ($t.moveNext()) {
                        var e = $t.Current;
                        if (e.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.hero) {
                            if (e.Alive) {
                                heroes = (heroes + 1) | 0;
                            }
                        }
                        if (e.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                            if (e.Alive) {
                                enemies = (enemies + 1) | 0;
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }return heroes === 0 || enemies === 0;
            },
            MoveChosen: function (moveType) {
                var $t;
                $t = Bridge.getEnumerator(this.entities);
                try {
                    while ($t.moveNext()) {
                        var e = $t.Current;
                        if (e.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.hero) {
                            for (var i = 0; i < e.moves.length; i = (i + 1) | 0) {

                                var value = e.moves[System.Array.index(i, e.moves)];

                                if (value === -1) {

                                    e.moves[System.Array.index(i, e.moves)] = moveType;
                                    break;
                                }
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }},
            ExecuteMoves: function () {

                var attacker = this.entities.getItem(this.battleState.actingEntity);
                var turn = Pidroh.ConsoleApp.Turnbased.Value.op_Implicit(this.battleState.turn);
                this.ExecuteMove(attacker, turn);
            },
            ExecuteMove: function (actor, turn) {
                this.MoveDataExecuter.ExecuteMove(actor, turn);

            },
            CalculateAttackMultiplier: function (actor) {
                var $t;
                var baseD = actor.damageMultiplier;
                $t = Bridge.getEnumerator(this.entities);
                try {
                    while ($t.moveNext()) {
                        var e = $t.Current;
                        if (!Bridge.referenceEquals(e, actor)) {
                            if (Pidroh.BaseUtils.Vector2D.op_Equality(e.pos.$clone(), actor.pos.$clone())) {
                                if (e.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.paneleffect) {
                                    baseD *= 3;
                                }
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }return baseD;
            },
            CalculateDefenderMultiplier: function (actor) {
                var $t;
                var baseD = 1;
                $t = Bridge.getEnumerator(this.entities);
                try {
                    while ($t.moveNext()) {
                        var e = $t.Current;
                        if (!Bridge.referenceEquals(e, actor)) {
                            if (Pidroh.BaseUtils.Vector2D.op_Equality(e.pos.$clone(), actor.pos.$clone())) {
                                if (e.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.paneleffect) {
                                    baseD = Bridge.Int.mul(baseD, 3);
                                }
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }return baseD;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.BattleMain.BattleEntity", {
        $kind: "nested class",
        fields: {
            life: 0,
            pos: null,
            minPos: null,
            maxPos: null,
            moves: null,
            graphic: 0,
            graphicRepeatedIndex: 0,
            damageMultiplier: 0,
            drawLife: false,
            drawTurn: false,
            randomPosition: false,
            element: 0,
            maxLife: 0,
            Type: 0
        },
        props: {
            PositionV2D: {
                get: function () {
                    return new Pidroh.BaseUtils.Vector2D.$ctor2(this.pos.X, this.pos.Y);
                }
            },
            Dead: {
                get: function () {
                    return this.life <= 0;
                }
            },
            Alive: {
                get: function () {
                    return !this.Dead;
                }
            }
        },
        ctors: {
            init: function () {
                this.pos = new Pidroh.BaseUtils.Vector2D();
                this.minPos = new Pidroh.BaseUtils.Vector2D();
                this.maxPos = new Pidroh.BaseUtils.Vector2D();
                this.moves = System.Array.init(10, 0, System.Int32);
                this.damageMultiplier = 1;
                this.drawLife = true;
                this.drawTurn = true;
                this.randomPosition = false;
                this.element = Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Nothingness;
                this.maxLife = 3;
                this.Type = Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.hero;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase", {
        $kind: "nested enum",
        statics: {
            fields: {
                EnemyMoveChoice: 0,
                HandRecharge: 1,
                PickHands: 2,
                ConfirmInput: 3,
                ExecuteMove: 4
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.BattleMain.BattleState", {
        $kind: "nested class",
        fields: {
            turn: null,
            totalTurns: 0,
            turnsPerPhase: null,
            moveTick_Now: null,
            moveTick_Total: 0,
            actingEntity: 0,
            phase: 0,
            BattleEndEnable: false
        },
        ctors: {
            init: function () {
                this.turn = new Pidroh.ConsoleApp.Turnbased.Value();
                this.turnsPerPhase = new Pidroh.ConsoleApp.Turnbased.Value();
                this.moveTick_Now = new Pidroh.ConsoleApp.Turnbased.Value();
                this.moveTick_Total = 0;
                this.actingEntity = 0;
                this.BattleEndEnable = true;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.BattleMain.Element", {
        $kind: "nested enum",
        statics: {
            fields: {
                Fire: 0,
                Ice: 1,
                Thunder: 2,
                Nothingness: 3
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType", {
        $kind: "nested enum",
        statics: {
            fields: {
                hero: 0,
                enemy: 1,
                neutral: 2,
                pickup: 3,
                paneleffect: 4
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.BattleMain.HappTag", {
        $kind: "nested enum",
        statics: {
            fields: {
                AttackHit: 0,
                AttackMiss: 1,
                DamageTaken: 2,
                MovementFail: 3
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType", {
        $kind: "nested enum",
        statics: {
            fields: {
                DoNothing: 0,
                MoveUp: 1,
                MoveLeft: 2,
                MoveDown: 3,
                MoveRight: 4,
                NormalShot: 5,
                Fire: 6,
                Ice: 7,
                Thunder: 8,
                IceBomb: 9,
                ThunderBomb: 10,
                SummonEntity: 11,
                DownFire: 12,
                TripleFire: 13
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.ITextScreen_", {
        $kind: "interface"
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.BattleRender.Colors", {
        $kind: "nested class",
        statics: {
            fields: {
                GridHero: 0,
                GridEnemy: 0,
                Hero: 0,
                Enemy: 0,
                HeroTurn: 0,
                EnemyTurn: 0,
                inputKey: 0,
                Board: 0,
                WindowLabel: 0,
                FireAura: 0,
                IceAura: 0,
                ThunderAura: 0,
                FireShot: 0,
                IceShot: 0,
                ThunderShot: 0,
                BackgroundInput: 0,
                InputDescription: 0,
                BackBattle: 0,
                BackCommand: 0,
                BackStripe: 0
            },
            ctors: {
                init: function () {
                    this.GridHero = 1;
                    this.GridEnemy = 2;
                    this.Hero = 3;
                    this.Enemy = 4;
                    this.HeroTurn = 5;
                    this.EnemyTurn = 6;
                    this.inputKey = 7;
                    this.Board = 8;
                    this.WindowLabel = 9;
                    this.FireAura = 10;
                    this.IceAura = 11;
                    this.ThunderAura = 12;
                    this.FireShot = 13;
                    this.IceShot = 14;
                    this.ThunderShot = 15;
                    this.BackgroundInput = 16;
                    this.InputDescription = 17;
                    this.BackBattle = 18;
                    this.BackCommand = 19;
                    this.BackStripe = 20;
                }
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.BattleRender.InputKey", {
        $kind: "nested enum",
        statics: {
            fields: {
                NONE: 0,
                LEFT: 1,
                RIGHT: 2,
                DOWN: 3,
                UP: 4,
                FIRE: 5,
                REDO: 6,
                DONE: 7,
                ICE: 8,
                THUNDER: 9,
                NORMALSHOT: 10
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.BattleResult", {
        fields: {
            result: 0
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.BattleSetup", {
        fields: {
            ecs: null,
            battleMain: null,
            moveCreator: null,
            timeStamp: null
        },
        ctors: {
            ctor: function (mode, ecs, enemyDataCreator, mv) {
                this.$initialize();
                this.ecs = ecs;
                this.timeStamp = new Pidroh.BaseUtils.TimeStamp();
                ecs.CreateEntityWithComponent(this.timeStamp);
                this.battleMain = new Pidroh.ConsoleApp.Turnbased.BattleMain(mode, ecs, this.timeStamp);

                this.moveCreator = mv;

                this.battleMain.MoveDataExecuter = new Pidroh.ConsoleApp.Turnbased.MoveDataExecuter(this.battleMain, this.moveCreator.moveDatas, ecs, this.timeStamp);

                var enemyDatas = enemyDataCreator.enemyDatas;
                var enemyFactory = new Pidroh.ConsoleApp.Turnbased.SpawnEntityFactory(ecs, enemyDatas, this.battleMain);
                this.battleMain.ecsInteg = new Pidroh.ConsoleApp.Turnbased.ECSIntegration(enemyFactory, ecs);
                var battleState = this.battleMain.battleState;

                {
                    var enemyAis = ecs.QuickAccessor2(Pidroh.ConsoleApp.Turnbased.EnemyAI, Pidroh.ConsoleApp.Turnbased.BattleMain.BattleEntity);
                    var enemyAiStateless = ecs.CreateAccessor(System.Array.init([Pidroh.ConsoleApp.Turnbased.EnemyAI], Function), System.Array.init([Pidroh.ConsoleApp.Turnbased.EnemyAIState], Function));
                    var possibleMoves = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                    var moveDatas = this.moveCreator.moveDatas;

                    this.battleMain.EnemyGenerateMoves = Bridge.fn.bind(this, function () {
                        var $t, $t1, $t2, $t3;
                        while (enemyAiStateless.Length > 0) {
                            Pidroh.ECS.ExtensionMethods.AddComponent(Pidroh.ConsoleApp.Turnbased.EnemyAIState, enemyAiStateless.Get(0));

                        }

                        for (var i = 0; i < enemyAis.Length; i = (i + 1) | 0) {

                            var ai = enemyAis.Comp1(i);
                            var battler = enemyAis.Comp2(i);
                            var aiState = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.EnemyAIState, enemyAis.Entity(i));
                            var moves = ai.moves;
                            var posS = battler.pos.$clone();
                            for (var j = 0; j < Pidroh.ConsoleApp.Turnbased.Value.op_Implicit(battleState.turnsPerPhase); j = (j + 1) | 0) {
                                var aiPro = (((j + aiState.progress) | 0)) % moves.Count;
                                var move = moves.getItem(aiPro);
                                var moveId = -1;
                                if (Bridge.is(move, Pidroh.ConsoleApp.Turnbased.MoveUse)) {

                                    moveId = (Bridge.as(move, Pidroh.ConsoleApp.Turnbased.MoveUse)).move;
                                }

                                if (Bridge.is(move, Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves)) {

                                    var m = Bridge.cast(move, Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves);
                                    if (Bridge.referenceEquals(m, Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves.SmartMove)) {

                                        possibleMoves.clear();
                                        for (var i2 = 0; i2 < moveDatas.Count; i2 = (i2 + 1) | 0) {
                                            var tags = moveDatas.getItem(i2).tags;
                                            if (tags.contains(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Movement)) {
                                                var validMove = true;
                                                var us = moveDatas.getItem(i2).units;

                                                $t = Bridge.getEnumerator(us);
                                                try {
                                                    while ($t.moveNext()) {
                                                        var item = $t.Current;
                                                        var things = item.thingsToHappen;
                                                        $t1 = Bridge.getEnumerator(things);
                                                        try {
                                                            while ($t1.moveNext()) {
                                                                var thing = $t1.Current;
                                                                if (Bridge.is(thing, Pidroh.ConsoleApp.Turnbased.MoveAction)) {
                                                                    var ma = Bridge.as(thing, Pidroh.ConsoleApp.Turnbased.MoveAction);
                                                                    var dis = ma.distance.$clone();
                                                                    var testPos = Pidroh.BaseUtils.Vector2D.op_Addition(posS.$clone(), dis.$clone());
                                                                    if (testPos.X < 3) {
                                                                        validMove = false;
                                                                    }
                                                                    if (testPos.X > 5) {
                                                                        validMove = false;
                                                                    }
                                                                    if (testPos.Y < 0) {
                                                                        validMove = false;
                                                                    }
                                                                    if (testPos.Y > 2) {
                                                                        validMove = false;
                                                                    }
                                                                }
                                                            }
                                                        } finally {
                                                            if (Bridge.is($t1, System.IDisposable)) {
                                                                $t1.System$IDisposable$Dispose();
                                                            }
                                                        }
                                                    }
                                                } finally {
                                                    if (Bridge.is($t, System.IDisposable)) {
                                                        $t.System$IDisposable$Dispose();
                                                    }
                                                }if (validMove) {
                                                    possibleMoves.add(i2);
                                                }
                                            }
                                        }
                                        moveId = Pidroh.BaseUtils.Extensions.RandomElement(System.Int32, possibleMoves);


                                    }

                                }

                                if (moveId >= 0) {
                                    battler.moves[System.Array.index(j, battler.moves)] = moveId;
                                    var md = this.moveCreator.moveDatas.getItem(moveId);
                                    var us1 = md.units;
                                    $t2 = Bridge.getEnumerator(us1);
                                    try {
                                        while ($t2.moveNext()) {
                                            var item1 = $t2.Current;
                                            var things1 = item1.thingsToHappen;
                                            $t3 = Bridge.getEnumerator(things1);
                                            try {
                                                while ($t3.moveNext()) {
                                                    var thing1 = $t3.Current;
                                                    if (Bridge.is(thing1, Pidroh.ConsoleApp.Turnbased.MoveAction)) {
                                                        var ma1 = Bridge.as(thing1, Pidroh.ConsoleApp.Turnbased.MoveAction);
                                                        var dis1 = ma1.distance.$clone();
                                                        posS = Pidroh.BaseUtils.Vector2D.op_Addition(posS.$clone(), dis1.$clone());

                                                    }
                                                }
                                            } finally {
                                                if (Bridge.is($t3, System.IDisposable)) {
                                                    $t3.System$IDisposable$Dispose();
                                                }
                                            }
                                        }
                                    } finally {
                                        if (Bridge.is($t2, System.IDisposable)) {
                                            $t2.System$IDisposable$Dispose();
                                        }
                                    }}
                            }
                            aiState.progress = (aiState.progress + Pidroh.ConsoleApp.Turnbased.Value.op_Implicit(battleState.turnsPerPhase)) | 0;
                        }
                    });
                }

                var trackBattle = new Pidroh.ConsoleApp.Turnbased.TrackBattle();
                this.battleMain.MoveDataExecuter.trackBattle = trackBattle;
                this.battleMain.trackBattle = trackBattle;

            }
        },
        methods: {
            AttackPreviewInitialization: function (moveDataChosenPreview, enemyTutorialId, moveDataIndex) {
                this.battleMain.BattleConfigure(new Pidroh.ConsoleApp.Turnbased.BattleConfig.$ctor3(false, true, false, false));
                var testEnemySpawn = new Pidroh.ConsoleApp.Turnbased.SpawnData.$ctor1(((enemyTutorialId + moveDataIndex) | 0), new Pidroh.BaseUtils.Vector2D.$ctor2(4, 1), Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy);
                this.ecs.CreateEntityWithComponent(testEnemySpawn);


            },
            StageInitialization: function (stageEntity, ecs) {
                var $t, $t1, $t2;
                var fixedAttack = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.FixedAttackStage, stageEntity);
                var playerHandPool = this.battleMain.playerHandPool;
                if (fixedAttack != null) {

                    $t = Bridge.getEnumerator(fixedAttack.moves);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            playerHandPool.add(item);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }} else {
                    playerHandPool.add(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire);
                    playerHandPool.add(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Ice);
                    playerHandPool.add(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Thunder);
                }

                var deckManager = new Pidroh.ConsoleApp.Turnbased.DeckManager(5);
                this.battleMain.deckManager = deckManager;

                if (fixedAttack != null) {

                    $t1 = Bridge.getEnumerator(fixedAttack.moves);
                    try {
                        while ($t1.moveNext()) {
                            var item1 = $t1.Current;
                            var deckId = 0;
                            switch (this.moveCreator.moveRenders.getItem(item1).element) {
                                case Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire: 
                                    deckManager.SetDefaultAttack(0, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire);
                                    break;
                                case Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Ice: 
                                    deckManager.SetDefaultAttack(1, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Ice);
                                    deckId = 1;
                                    break;
                                case Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Thunder: 
                                    deckId = 2;
                                    deckManager.SetDefaultAttack(2, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Thunder);
                                    break;
                                case Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Nothingness: 
                                    break;
                                default: 
                                    break;
                            }
                            if (item1 !== Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire) {
                                if (item1 !== Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Ice) {
                                    if (item1 !== Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Thunder) {
                                        deckManager.Add(deckId, item1);
                                    }
                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t1, System.IDisposable)) {
                            $t1.System$IDisposable$Dispose();
                        }
                    }} else {
                    deckManager.SetDefaultAttack(0, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire);
                    deckManager.SetDefaultAttack(1, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Ice);
                    deckManager.SetDefaultAttack(2, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Thunder);





                }

                var stage = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.StageData, stageEntity);
                var enmys = stage.spawnDatas;

                $t2 = Bridge.getEnumerator(enmys);
                try {
                    while ($t2.moveNext()) {
                        var enemy = $t2.Current;
                        ecs.CreateEntityWithComponent(enemy);
                    }
                } finally {
                    if (Bridge.is($t2, System.IDisposable)) {
                        $t2.System$IDisposable$Dispose();
                    }
                }

                var trackInfo = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.TrackInfoStage, stageEntity);
                this.battleMain.trackBattle.stageInfo = trackInfo;

                this.battleMain.BattleConfigure(stage.battleConfig);
            },
            SetDefaultAttack: function (index, attack) {
                this.battleMain.deckManager.SetDefaultAttack(index, attack);
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.ColorStuff", {
        statics: {
            fields: {
                GoodMain: null,
                neutralDark: null,
                neutralStrong: null,
                GoodSub: null,
                EvilMain: null,
                colors: null
            },
            ctors: {
                init: function () {
                    this.neutralDark = "#19013b";
                    this.neutralStrong = "#2c3e43";
                    this.colors = System.Array.init(25, null, System.String);
                },
                ctor: function () {
                    for (var i = 0; i < Pidroh.ConsoleApp.Turnbased.ColorStuff.colors.length; i = (i + 1) | 0) {
                        Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(i, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#400020";
                    }

                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#8ad896";
                    var heroSub = "#4c6d50";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.HeroTurn, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = heroSub;
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Enemy, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#ff7694";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = heroSub;
                    var enemysub = "#a7464f";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridEnemy, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = enemysub;
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.EnemyTurn, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = enemysub;
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Board, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#1e486e";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.inputKey, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#688690";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#1e486e";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.FireAura, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#793100";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.IceAura, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#005590";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.ThunderAura, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#00583d";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.FireShot, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#f82b36";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.IceShot, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#007eff";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.ThunderShot, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#a37c00";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackgroundInput, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#080808";


                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.inputKey, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#9E8664";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#808080";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackBattle, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#000000";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackgroundInput, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#1A1A1A";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.HeroTurn, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#00B2B2";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.EnemyTurn, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#FF0040";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#00468C";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridEnemy, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#8C0023";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#66FFFF";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Enemy, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#D90036";

                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#BFBFBF";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Enemy, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)];
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.HeroTurn, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)];
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.EnemyTurn, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)];
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#666666";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackCommand, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#333333";

                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.FireAura, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#FF8C66";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.IceAura, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#66FFFF";
                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.ThunderAura, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#FFFF66";

                    Pidroh.ConsoleApp.Turnbased.ColorStuff.colors[System.Array.index(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackStripe, Pidroh.ConsoleApp.Turnbased.ColorStuff.colors)] = "#1A140D";
                }
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.Condition", {
        fields: {
            type: 0,
            target: 0,
            vector: null
        },
        ctors: {
            init: function () {
                this.vector = new Pidroh.BaseUtils.Vector2D();
            },
            ctor: function (type, target, vector) {
                this.$initialize();
                this.type = type;
                this.target = target;
                this.vector = vector.$clone();
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.ConditionType", {
        $kind: "enum",
        statics: {
            fields: {
                CanMove: 0
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.ContentCreator.StageDataProcedural_A", {
        fields: {
            stageDataCreator: null,
            enemyIds: null,
            bossIds: null,
            attackPrizeIds: null,
            positionPool: null
        },
        ctors: {
            init: function () {
                this.enemyIds = System.Array.init([0, 1, 2, 8, 5], System.Int32);
                this.bossIds = System.Array.init([3, 9, 10], System.Int32);
                this.attackPrizeIds = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.positionPool = new (System.Collections.Generic.List$1(Pidroh.BaseUtils.Point2D)).ctor();
            },
            ctor: function (sdc) {
                this.$initialize();

                this.stageDataCreator = sdc;
                for (var i = 14; i < 38; i = (i + 1) | 0) {
                    this.attackPrizeIds.add(i);
                }
                var master = new Pidroh.ConsoleApp.Turnbased.StageDataGroup();
                sdc.AddGroup(master);
                master.childIds.add(sdc.TutorialGroup());




                for (var i1 = 0; i1 < 2; i1 = (i1 + 1) | 0) {
                    var campaign = new Pidroh.ConsoleApp.Turnbased.StageDataGroup();
                    campaign.level = 1;
                    var eCamp = sdc.AddGroup(campaign);
                    master.childIds.add(eCamp.$clone());
                    for (var j = 0; j < 4; j = (j + 1) | 0) {

                        var group = new Pidroh.ConsoleApp.Turnbased.StageDataGroup();
                        group.level = 0;
                        var eGroup = sdc.AddGroup(group);
                        campaign.childIds.add(eGroup.$clone());
                        sdc.currentGroup = group;

                        var attackPrize = 0;
                        var normalStage = j < 3;
                        var numberOfStages = 3;
                        for (var l = 0; l < numberOfStages; l = (l + 1) | 0) {
                            for (var x = 0; x < 3; x = (x + 1) | 0) {
                                for (var y = 0; y < 3; y = (y + 1) | 0) {
                                    this.positionPool.add(new Pidroh.BaseUtils.Point2D.$ctor1(((x + 3) | 0), y));
                                }
                            }

                            var finalStage = l === ((numberOfStages - 1) | 0);
                            {
                                var attackIndex = Pidroh.BaseUtils.RandomSupplier.Range(0, ((this.attackPrizeIds.Count - 1) | 0));
                                attackPrize = this.attackPrizeIds.getItem(attackIndex);
                                this.attackPrizeIds.removeAt(attackIndex);
                            }
                            var sd = new Pidroh.ConsoleApp.Turnbased.StageData.ctor();
                            var nEnemies = Pidroh.BaseUtils.RandomSupplier.Range(1, 3);
                            var currency = 30;
                            var boss = finalStage && !normalStage;
                            if (boss) {
                                currency = 80;
                                nEnemies = 1;
                            }

                            for (var enemyI = 0; enemyI < nEnemies; enemyI = (enemyI + 1) | 0) {
                                var posI = Pidroh.BaseUtils.RandomSupplier.Range(0, ((this.positionPool.Count - 1) | 0));
                                var pos = this.positionPool.getItem(posI).$clone();
                                this.positionPool.removeAt(posI);
                                var enemyId = Pidroh.BaseUtils.RandomSupplier.RandomElement(System.Int32, this.enemyIds);
                                if (boss) {
                                    enemyId = Pidroh.BaseUtils.RandomSupplier.RandomElement(System.Int32, this.bossIds);
                                }
                                sd.spawnDatas.add(sdc.Enemy(enemyId, new Pidroh.BaseUtils.Vector2D.$ctor2(pos.X, pos.Y)));
                            }
                            sdc.AddStage([sd, new Pidroh.ConsoleApp.Turnbased.CurrencyPrize.$ctor1(currency)]);
                        }




                    }
                }



            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.CurrencyHolder", {
        fields: {
            currency: 0
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.CurrencyPrize", {
        fields: {
            currency: null
        },
        ctors: {
            $ctor1: function (attack) {
                this.$initialize();
                this.currency = System.Array.init(1, 0, System.Int32);
                this.currency[System.Array.index(0, this.currency)] = attack;
            },
            ctor: function () {
                this.$initialize();
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.DealDamageAction", {
        fields: {
            area: null,
            target: 0,
            damage: 0,
            element: 0,
            userRefOffset: null
        },
        ctors: {
            init: function () {
                this.userRefOffset = new Pidroh.BaseUtils.Vector2D();
                this.target = Pidroh.ConsoleApp.Turnbased.Target.None;
            },
            ctor: function (area, damage, element) {
                this.$initialize();
                this.area = area;
                this.damage = damage;
                this.element = element;
                this.target = Pidroh.ConsoleApp.Turnbased.Target.Area;
            },
            $ctor1: function (target, damage, element) {
                this.$initialize();
                this.target = target;
                this.damage = damage;
                this.element = element;
            },
            $ctor2: function (target, damage, element, userRefOffset) {
                Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor1.call(this, target, damage, element);
                this.userRefOffset = userRefOffset.$clone();
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.DebugExtra.DebugEx", {
        statics: {
            fields: {
                messages: null
            },
            ctors: {
                init: function () {
                    this.messages = new (System.Collections.Generic.List$1(System.String)).ctor();
                }
            },
            methods: {
                Log: function (v) {
                    Pidroh.ConsoleApp.Turnbased.DebugExtra.DebugEx.messages.add(v);
                },
                Show: function () {
                    var $t;
                    System.Console.Clear();
                    $t = Bridge.getEnumerator(Pidroh.ConsoleApp.Turnbased.DebugExtra.DebugEx.messages);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            System.Console.WriteLine(item);

                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }prompt();
                }
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.DeckManager", {
        fields: {
            decks: null,
            decksStatic: null,
            discards: null,
            decksOk: null,
            defaultAttack: null,
            selection: null,
            decksNotEmpty: null,
            defaultAttackAlwaysPresentAtStart: false,
            movesToRemove: null
        },
        ctors: {
            init: function () {
                this.decks = System.Array.init(3, null, System.Collections.Generic.List$1(System.Int32));
                this.decksStatic = System.Array.init(3, null, System.Collections.Generic.List$1(System.Int32));
                this.discards = System.Array.init(3, null, System.Collections.Generic.List$1(System.Int32));
                this.decksOk = System.Array.init(3, false, System.Boolean);
                this.defaultAttack = System.Array.init(4, 0, System.Int32);
                this.selection = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.decksNotEmpty = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.defaultAttackAlwaysPresentAtStart = true;
                this.movesToRemove = new (System.Collections.Generic.List$1(System.Int32)).ctor();
            },
            ctor: function (handSize) {
                this.$initialize();
                for (var i = 0; i < handSize; i = (i + 1) | 0) {
                    this.selection.add(0);
                }
                for (var i1 = 0; i1 < this.decks.length; i1 = (i1 + 1) | 0) {
                    this.decks[System.Array.index(i1, this.decks)] = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                    this.decksStatic[System.Array.index(i1, this.decksStatic)] = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                }
            }
        },
        methods: {
            Refresh: function () {
                var $t;
                $t = Bridge.getEnumerator(this.movesToRemove);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        var index = this.selection.indexOf(item);
                        if (index !== -1) {
                            this.selection.setItem(index, 0);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }this.movesToRemove.clear();
                if (this.defaultAttackAlwaysPresentAtStart) {
                    for (var i = 0; i < this.defaultAttack.length; i = (i + 1) | 0) {
                        this.selection.setItem(i, this.defaultAttack[System.Array.index(i, this.defaultAttack)]);
                    }
                }
                this.RefreshDeckEmptyStatus();
                for (var i1 = 0; i1 < this.decks.length; i1 = (i1 + 1) | 0) {
                    this.decksOk[System.Array.index(i1, this.decksOk)] = false;
                    if (this.selection.contains(this.defaultAttack[System.Array.index(i1, this.defaultAttack)])) {
                        this.decksOk[System.Array.index(i1, this.decksOk)] = true;
                    }
                    for (var j = 0; j < this.decksStatic[System.Array.index(i1, this.decksStatic)].Count; j = (j + 1) | 0) {

                        if (this.selection.contains(this.decksStatic[System.Array.index(i1, this.decksStatic)].getItem(j))) {
                            this.decksOk[System.Array.index(i1, this.decksOk)] = true;
                            break;
                        }
                    }



                }
                for (var i2 = 0; i2 < this.selection.Count; i2 = (i2 + 1) | 0) {
                    if (this.selection.getItem(i2) > 0) {
                        continue;
                    }
                    var added = false;
                    for (var j1 = 0; j1 < this.decksOk.length; j1 = (j1 + 1) | 0) {
                        if (!this.decksOk[System.Array.index(j1, this.decksOk)]) {
                            this.decksOk[System.Array.index(j1, this.decksOk)] = true;
                            added = true;
                            var move = this.defaultAttack[System.Array.index(j1, this.defaultAttack)];
                            if (this.decks[System.Array.index(j1, this.decks)].Count !== 0) {
                                move = this.Draw(j1);
                            }

                            this.selection.setItem(i2, move);
                            this.RefreshDeckEmptyStatus();
                            break;
                        }
                    }
                    if (!added) {
                        if (this.decksNotEmpty.Count > 0) {
                            var deck = Pidroh.BaseUtils.Extensions.RandomElement(System.Int32, this.decksNotEmpty);
                            var move1 = this.Draw(deck);
                            this.selection.setItem(i2, move1);
                            this.RefreshDeckEmptyStatus();
                        }
                    }
                }
            },
            SetDefaultAttack: function (deckId, move) {
                this.defaultAttack[System.Array.index(deckId, this.defaultAttack)] = move;
            },
            Draw: function (deckId) {
                var move = Pidroh.BaseUtils.Extensions.RandomElement(System.Int32, this.decks[System.Array.index(deckId, this.decks)]);
                this.decks[System.Array.index(deckId, this.decks)].remove(move);
                return move;
            },
            Add: function (deckId, item) {
                this.decks[System.Array.index(deckId, this.decks)].add(item);
                this.decksStatic[System.Array.index(deckId, this.decksStatic)].add(item);
            },
            RefreshDeckEmptyStatus: function () {
                this.decksNotEmpty.clear();
                for (var i = 0; i < this.decks.length; i = (i + 1) | 0) {
                    if (this.decks[System.Array.index(i, this.decks)].Count > 0) {
                        this.decksNotEmpty.add(i);
                    }
                }
            },
            InputUsed: function (move) {
                this.movesToRemove.add(move);

            },
            Recover: function (lostMove) {
                this.movesToRemove.remove(lostMove);
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.ECSIntegration", {
        fields: {
            enemyFactory: null,
            ecs: null
        },
        ctors: {
            ctor: function (enemyFactory, ecs) {
                this.$initialize();
                this.enemyFactory = enemyFactory;
                this.ecs = ecs;
            }
        },
        methods: {
            HeroCreated: function (hero) {
                this.ecs.CreateEntityWithComponent(hero);
            },
            SpawnEnemies: function () {
                this.enemyFactory.Spawn();
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.EnemyAI", {
        fields: {
            moves: null
        },
        ctors: {
            init: function () {
                this.moves = new (System.Collections.Generic.List$1(System.Object)).ctor();
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.EnemyAIState", {
        fields: {
            progress: 0
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.EnemyData", {
        fields: {
            enemyAI: null,
            hp: 0,
            render: 0
        },
        ctors: {
            ctor: function (enemyAI, hp, render) {
                this.$initialize();
                this.enemyAI = enemyAI;
                this.hp = hp;
                this.render = render;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.EnemyDataCreator", {
        fields: {
            renderTexts: null,
            enemyDatas: null,
            moveCreatorProg: null,
            startOfTutorialEnemy: 0
        },
        ctors: {
            init: function () {
                this.enemyDatas = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.EnemyData)).ctor();
            },
            ctor: function (renderTexts, moveCreatorProg) {
                this.$initialize();
                renderTexts.add("@");
                this.renderTexts = renderTexts;
                this.moveCreatorProg = moveCreatorProg;


                this.AddEnemy(this.Actions([this.Moves([Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveLeft, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveDown, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveRight, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveUp, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Thunder])]), 12, "%");
                this.AddEnemy(this.Actions([this.Moves([Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.IceBomb, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.DoNothing, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.DoNothing])]), 15, "#");
                this.AddEnemy(this.Actions([this.Moves([Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.IceBomb, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveLeft, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.ThunderBomb, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveRight])]), 17, "&");
                this.AddEnemy(this.Actions([Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.IceBomb, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), "Summon", Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveLeft, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.ThunderBomb, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveRight, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))]), 450, "$");
                this.AddEnemy(this.Actions([Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveUp, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveLeft, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveRight, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveDown, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveLeft, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveDown, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveUp, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))]), 28, "H");
                this.AddEnemy(this.Actions([Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Ice, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.DoNothing, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.DoNothing, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))]), 30, "J");
                this.AddEnemy(this.Actions([Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.DoNothing, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.DoNothing, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))]), 30, "L");
                this.AddEnemy(this.Actions([Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.DoNothing, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.DoNothing, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))]), 30, "K");
                this.AddEnemy(this.Actions([Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.DownFire, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves.SmartMove, Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves.SmartMove, Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves.SmartMove]), 30, "K");
                this.AddEnemy(this.Actions([Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.IceBomb, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves.SmartMove, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.ThunderBomb, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves.SmartMove, Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves.SmartMove, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.ThunderBomb, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves.SmartMove]), 250, "$");
                this.AddEnemy(this.Actions([Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves.SmartMove, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Thunder, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves.SmartMove, Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves.SmartMove, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Thunder, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves.SmartMove, Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves.SmartMove, Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves.SmartMove, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.TripleFire, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Thunder, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))]), 250, "$");

                this.startOfTutorialEnemy = this.enemyDatas.Count;
                var moves = Bridge.cast(System.Enum.getValues(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType), System.Array.type(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType));
                for (var i = 0; i < moves.length; i = (i + 1) | 0) {
                    this.AddEnemy(this.Actions([Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.DoNothing, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(moves[System.Array.index(i, moves)], Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)), Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.DoNothing, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))]), 5, "@");
                }

            }
        },
        methods: {
            Actions: function (obs) {
                var $t, $t1;
                if (obs === void 0) { obs = []; }
                var ai = new Pidroh.ConsoleApp.Turnbased.EnemyAI();

                $t = Bridge.getEnumerator(obs);
                try {
                    while ($t.moveNext()) {
                        var o = $t.Current;
                        if (Bridge.is(o, System.Int32)) {
                            ai.moves.add(new Pidroh.ConsoleApp.Turnbased.MoveUse.$ctor1(System.Nullable.getValue(Bridge.cast(Bridge.unbox(o), System.Int32))));
                            continue;
                        }
                        if (Bridge.is(o, System.String)) {
                            ai.moves.add(new Pidroh.ConsoleApp.Turnbased.MoveUse.$ctor1(this.moveCreatorProg.GetMoveId(Bridge.as(o, System.String))));
                            continue;
                        }
                        if (Bridge.is(o, System.Array.type(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))) {
                            $t1 = Bridge.getEnumerator(Bridge.as(o, System.Array.type(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType)));
                            try {
                                while ($t1.moveNext()) {
                                    var item = $t1.Current;
                                    ai.moves.add(new Pidroh.ConsoleApp.Turnbased.MoveUse.$ctor1(item));
                                }
                            } finally {
                                if (Bridge.is($t1, System.IDisposable)) {
                                    $t1.System$IDisposable$Dispose();
                                }
                            }continue;
                        }
                        ai.moves.add(o);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }return ai;
            },
            Moves: function (moves) {
                if (moves === void 0) { moves = []; }
                return moves;
            },
            AddEnemy: function (ai, hp, renderText) {
                var render = this.renderTexts.Count;
                this.renderTexts.add(renderText);
                this.enemyDatas.add(new Pidroh.ConsoleApp.Turnbased.EnemyData(ai, hp, render));
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.FixedAttackStage", {
        fields: {
            moves: null
        },
        ctors: {
            init: function () {
                this.moves = new (System.Collections.Generic.List$1(System.Int32)).ctor();
            },
            $ctor1: function (move) {
                this.$initialize();
                this.moves.add(move);
            },
            $ctor2: function (move) {
                if (move === void 0) { move = []; }

                this.$initialize();
                this.moves.AddRange(move);
            },
            ctor: function () {
                this.$initialize();
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.HappArea", {
        fields: {
            area: null,
            offset: null,
            mirroringX: 0
        },
        ctors: {
            init: function () {
                this.offset = new Pidroh.BaseUtils.Vector2D();
            },
            $ctor1: function (area) {
                this.$initialize();
                this.area = area;
            },
            ctor: function () {
                this.$initialize();
            },
            $ctor2: function (area, offset, mirroringX) {
                this.$initialize();
                this.area = area;
                this.offset = offset.$clone();
                this.mirroringX = mirroringX;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.HappDamageData", {
        fields: {
            targetE: 0,
            damageE: 0,
            target: 0,
            amount: 0,
            superEffective: false,
            elementalBlock: false
        },
        ctors: {
            ctor: function () {
                this.$initialize();
            },
            $ctor1: function (targetE, damageE, target, amount, superEffective, elementalBlock) {
                this.$initialize();
                this.targetE = targetE;
                this.damageE = damageE;
                this.target = target;
                this.amount = amount;
                this.superEffective = superEffective;
                this.elementalBlock = elementalBlock;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.HappMoveData", {
        fields: {
            user: 0,
            target: 0,
            element: 0
        },
        ctors: {
            init: function () {
                this.target = -1;
                this.element = Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Nothingness;
            },
            ctor: function () {
                this.$initialize();
            },
            $ctor1: function (user) {
                this.$initialize();
                this.user = user;
            },
            $ctor2: function (user, target, element) {
                this.$initialize();
                this.user = user;
                this.target = target;
                this.element = element;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.HappMovement", {
        fields: {
            moveFrom: null,
            moveTo: null,
            success: false
        },
        ctors: {
            init: function () {
                this.moveFrom = new Pidroh.BaseUtils.Vector2D();
                this.moveTo = new Pidroh.BaseUtils.Vector2D();
            },
            ctor: function () {
                this.$initialize();
            },
            $ctor1: function (moveFrom, moveTo, success) {
                this.$initialize();
                this.moveFrom = moveFrom.$clone();
                this.moveTo = moveTo.$clone();
                this.success = success;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.Happs.Happ", {
        fields: {
            tags: null,
            TimeStamp: 0,
            attrs: null
        },
        ctors: {
            init: function () {
                this.tags = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.attrs = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.Happs.Happ.Attribute)).ctor();
            },
            ctor: function (mainTag) {
                this.$initialize();
                this.tags.add(System.Convert.toInt32(mainTag));
            }
        },
        methods: {
            AddAttribute: function (a) {
                this.attrs.add(a);
                return this;
            },
            GetAttribute_Int: function (index) {
                return Bridge.Int.clip32(this.attrs.getItem(index).Value);
            },
            HasTag: function (tagsNeeded) {
                return this.tags.contains(tagsNeeded);
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.Happs.Happ.Attribute", {
        $kind: "nested class",
        fields: {
            Value: 0,
            tags: null
        },
        ctors: {
            init: function () {
                this.tags = new Pidroh.ConsoleApp.Turnbased.Happs.TagHolder();
            }
        },
        methods: {
            SetValue: function (f) {
                this.Value = f;
                return this;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.Happs.HappHandler", {
        fields: {
            necessaryTags: null,
            Handle: null
        },
        ctors: {
            init: function () {
                this.necessaryTags = new (System.Collections.Generic.List$1(System.Int32)).ctor();
            },
            ctor: function (mainTag, handle) {
                this.$initialize();
                this.necessaryTags.add(System.Convert.toInt32(mainTag));
                this.Handle = handle;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.Happs.HappManager", {
        fields: {
            CurrentTime: 0,
            Happs: null,
            handlers: null,
            latestHandled: 0
        },
        ctors: {
            init: function () {
                this.Happs = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.Happs.Happ)).ctor();
                this.handlers = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.Happs.HappHandler)).ctor();
                this.latestHandled = -1;
            }
        },
        methods: {
            AddHandler: function (hh) {
                this.handlers.add(hh);
            },
            TryHandle: function () {
                if (this.latestHandled !== this.CurrentTime) {
                    this.Handle();
                }
            },
            Handle: function () {
                var $t, $t1;
                this.latestHandled = this.CurrentTime;
                $t = Bridge.getEnumerator(this.handlers);
                try {
                    while ($t.moveNext()) {
                        var h = $t.Current;
                        for (var i = (this.Happs.Count - 1) | 0; i >= 0; i = (i - 1) | 0) {
                            if (this.Happs.getItem(i).TimeStamp !== this.CurrentTime) {
                                Pidroh.ConsoleApp.Turnbased.DebugExtra.DebugEx.Log("Happening not equal to current time");
                                break;
                            }
                            var hasTags = true;
                            $t1 = Bridge.getEnumerator(h.necessaryTags);
                            try {
                                while ($t1.moveNext()) {
                                    var tagsNeeded = $t1.Current;
                                    if (!this.Happs.getItem(i).HasTag(tagsNeeded)) {
                                        hasTags = false;
                                        break;
                                    }
                                }
                            } finally {
                                if (Bridge.is($t1, System.IDisposable)) {
                                    $t1.System$IDisposable$Dispose();
                                }
                            }if (hasTags) {
                                Pidroh.ConsoleApp.Turnbased.DebugExtra.DebugEx.Log("Happening handled");
                                h.Handle(this.Happs.getItem(i));
                            } else {
                                Pidroh.ConsoleApp.Turnbased.DebugExtra.DebugEx.Log("Happening tag is different");
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }},
            Add: function (h) {
                h.TimeStamp = this.CurrentTime;
                this.Happs.add(h);
                return h;
            },
            Tick: function () {
                this.CurrentTime = (this.CurrentTime + 1) | 0;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.Happs.TagHolder", {
        fields: {
            Tags: null
        },
        ctors: {
            init: function () {
                this.Tags = new (System.Collections.Generic.List$1(System.Object)).ctor();
            }
        },
        methods: {
            HasTag: function (t) {
                return this.Tags.contains(t);
            },
            Add: function (v) {
                this.Tags.add(v);
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.HappShoot", {
        fields: {
            start: null,
            end: null
        },
        ctors: {
            init: function () {
                this.start = new Pidroh.BaseUtils.Vector2D();
                this.end = new Pidroh.BaseUtils.Vector2D();
            },
            ctor: function () {
                this.$initialize();
            },
            $ctor1: function (start, end) {
                this.$initialize();
                this.start = start.$clone();
                this.end = end.$clone();
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.HappTags", {
        fields: {
            tags: null
        },
        ctors: {
            init: function () {
                this.tags = new (System.Collections.Generic.List$1(System.Int32)).ctor();
            },
            $ctor1: function (tags) {
                this.$initialize();
                this.tags.AddRange(tags);
            },
            $ctor2: function (i) {
                this.$initialize();
                this.tags.add(i);
            },
            ctor: function () {
                this.$initialize();

            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.InputHolder", {
        fields: {
            inputs: null,
            tags: null,
            inputForConfirmation: null
        },
        ctors: {
            init: function () {
                this.inputForConfirmation = new Pidroh.ConsoleApp.Turnbased.InputUnit();
                this.inputs = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.InputUnit)).ctor();
                this.tags = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.InputTags)).ctor();
            }
        },
        methods: {
            Clear: function () {
                this.inputs.clear();
                this.tags.clear();
            },
            Add: function (input, tag) {
                this.inputs.add(input);
                this.tags.add(tag);

            },
            TagIs: function (i2, tag) {
                if (this.tags.Count <= i2) {
                    return false;
                }
                return this.tags.getItem(i2) === tag;
            },
            Contains: function (key) {
                var $t;
                $t = Bridge.getEnumerator(this.inputs);
                try {
                    while ($t.moveNext()) {
                        var i = $t.Current;
                        if (i.arg1 === key.arg1 && i.type === key.type) {
                            return true;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }return false;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.InputTags", {
        $kind: "enum",
        statics: {
            fields: {
                NONE: 0,
                MOVEFIX: 1,
                MOVEUNFIX: 2,
                MISC: 3
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.InputType", {
        $kind: "enum",
        statics: {
            fields: {
                None: 0,
                Move: 1,
                MiscBattle: 2
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.InputUnit", {
        $kind: "struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new Pidroh.ConsoleApp.Turnbased.InputUnit(); }
            }
        },
        fields: {
            type: 0,
            arg1: 0
        },
        ctors: {
            $ctor2: function (type, arg1) {
                this.$initialize();
                this.type = type;
                this.arg1 = arg1;
            },
            $ctor1: function (type, arg1) {
                this.$initialize();
                this.type = type;
                this.arg1 = System.Convert.toInt32(arg1);
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            getHashCode: function () {
                var h = Bridge.addHash([3739141169, this.type, this.arg1]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, Pidroh.ConsoleApp.Turnbased.InputUnit)) {
                    return false;
                }
                return Bridge.equals(this.type, o.type) && Bridge.equals(this.arg1, o.arg1);
            },
            $clone: function (to) {
                var s = to || new Pidroh.ConsoleApp.Turnbased.InputUnit();
                s.type = this.type;
                s.arg1 = this.arg1;
                return s;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.MiscBattleInput", {
        $kind: "enum",
        statics: {
            fields: {
                Done: 0,
                Redo: 1,
                Preview: 2,
                Confirm: 3,
                Cancel: 4,
                Help: 5,
                LeaveAttackDemonstration: 6
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.MiscHappTags", {
        $kind: "enum",
        statics: {
            fields: {
                ChangeElement: 500,
                Damage: 501,
                Death: 502
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.MoveAction", {
        fields: {
            target: 0,
            distance: null
        },
        ctors: {
            init: function () {
                this.distance = new Pidroh.BaseUtils.Vector2D();
            },
            ctor: function (target, amount) {
                this.$initialize();
                this.target = target;
                this.distance = amount.$clone();
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.MoveCreatorProg", {
        fields: {
            moveDatas: null,
            moveRenders: null,
            areaUtils: null,
            ecs: null,
            elements: null,
            elementLabels: null,
            elementLetter: null
        },
        ctors: {
            init: function () {
                this.moveDatas = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.MoveData)).ctor();
                this.moveRenders = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.MoveMetaData)).ctor();
                this.areaUtils = new Pidroh.ConsoleApp.Turnbased.MoveCreatorProg.AreaCreationUtils();
                this.elements = System.Array.init([Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Ice, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Thunder], Pidroh.ConsoleApp.Turnbased.BattleMain.Element);
                this.elementLabels = System.Array.init(["Fire", "Ice", "Bolt"], System.String);
                this.elementLetter = System.Array.init(["F", "I", "B"], System.String);
            },
            ctor: function (ecs) {
                this.$initialize();
                this.ecs = ecs;
                var item = new Pidroh.ConsoleApp.Turnbased.MoveData.$ctor1("");
                this.moveDatas.add(item);
                this.moveRenders.add(new Pidroh.ConsoleApp.Turnbased.MoveMetaData("", "", Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Nothingness));
                ecs.CreateEntityWithComponent(item);
                var directions = System.Array.init([new Pidroh.BaseUtils.Vector2D.$ctor2(0, 1), new Pidroh.BaseUtils.Vector2D.$ctor2(-1, 0), new Pidroh.BaseUtils.Vector2D.$ctor2(0, -1), new Pidroh.BaseUtils.Vector2D.$ctor2(1, 0)], Pidroh.BaseUtils.Vector2D);
                var moveLabels = System.Array.init(["Move Up", "Move Left", "Move Down", "Move Right"], System.String);
                var moveAbrev = System.Array.init(["^", "<", "v", ">"], System.String);
                for (var i = 0; i < directions.length; i = (i + 1) | 0) {
                    this.NewMoveData(moveLabels[System.Array.index(i, moveLabels)], new Pidroh.ConsoleApp.Turnbased.Condition(Pidroh.ConsoleApp.Turnbased.ConditionType.CanMove, Pidroh.ConsoleApp.Turnbased.Target.Self, directions[System.Array.index(i, directions)].$clone()), new Pidroh.ConsoleApp.Turnbased.MoveAction(Pidroh.ConsoleApp.Turnbased.Target.Self, directions[System.Array.index(i, directions)].$clone()), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Movement, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags)), Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.HeroInitial, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                    this.NewMoveTextRenderData(moveLabels[System.Array.index(i, moveLabels)], moveAbrev[System.Array.index(i, moveAbrev)], moveLabels[System.Array.index(i, moveLabels)], 0, 3);
                }

                var baseDamage = 10;

                this.NewMoveData$1("Gun", this.OneTickPerAction([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor2(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX), new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor1(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, baseDamage, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Nothingness)]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Shoot, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                this.NewMoveTextRenderData("Gun", "G", "Shoots forward", baseDamage);


                this.NewMoveData$1("Firegun", this.OneTickPerAction([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor3(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire), new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor1(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, baseDamage, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire)]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Shoot, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                this.NewMoveTextRenderData("Firegun", "FG", "Shoots forward", baseDamage, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire);

                this.NewMoveData$1("Icegun", this.OneTickPerAction([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor3(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Ice), new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor1(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, baseDamage, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Ice)]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Shoot, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                this.NewMoveTextRenderData("Icegun", "IG", "Shoots forward", baseDamage, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Ice);

                this.NewMoveData$1("Boltgun", this.OneTickPerAction([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor3(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Thunder), new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor1(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, baseDamage, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Thunder)]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Shoot, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                this.NewMoveTextRenderData("Boltgun", "BG", "Shoots forward", baseDamage, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Thunder);

                var areaBomb = this.AreaUser().RowForward(1, 3);
                this.NewMoveData$1("Icebomb", this.OneTickPerAction([new Pidroh.ConsoleApp.Turnbased.Animation.ctor(areaBomb, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Ice), new Pidroh.ConsoleApp.Turnbased.DealDamageAction.ctor(areaBomb, baseDamage, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Ice)]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Bomb, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                this.NewMoveTextRenderData("Icebomb", "IB", "Attacks row three squares forward", baseDamage, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Ice);

                this.NewMoveData$1("Boltbomb", this.OneTickPerAction([new Pidroh.ConsoleApp.Turnbased.Animation.ctor(areaBomb, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Thunder), new Pidroh.ConsoleApp.Turnbased.DealDamageAction.ctor(areaBomb, baseDamage, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Thunder)]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Bomb, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                this.NewMoveTextRenderData("Boltbomb", "BB", "Attacks row three squares forward", baseDamage, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Thunder);

                this.NewMoveData$1("Summon", this.OneTickPerAction([Pidroh.ConsoleApp.Turnbased.SummonEntity.Enemy(0, new Pidroh.BaseUtils.Vector2D.$ctor2(5, 0))]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Summon, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                this.NewMoveTextRenderData("Summon", "SU", "Summons an enemy", 0);

                var directionMove = new Pidroh.BaseUtils.Vector2D.$ctor2(0, -1);
                var damageLow2 = Bridge.Int.clip32(baseDamage * 0.75);
                var damageHigh = Bridge.Int.clip32(baseDamage * 3.0);
                this.NewMoveData$1("Downfire", this.TickArray([this.TickUnit([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor3(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire)]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor1(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, damageLow2, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire)]), this.TickUnitCondition(new Pidroh.ConsoleApp.Turnbased.Condition(Pidroh.ConsoleApp.Turnbased.ConditionType.CanMove, Pidroh.ConsoleApp.Turnbased.Target.Self, directionMove.$clone()), [new Pidroh.ConsoleApp.Turnbased.MoveAction(Pidroh.ConsoleApp.Turnbased.Target.Self, directionMove.$clone())]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor3(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire)]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor1(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, 1, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire)])]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Shoot, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                this.NewMoveTextRenderData("Downfire", "DF", "Shoot, down, shoot", baseDamage, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire);

                this.NewMoveData$1("TripleFire", this.TickArray([this.TickUnit([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor4(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire, new Pidroh.BaseUtils.Vector2D.$ctor2(0, -1)), new Pidroh.ConsoleApp.Turnbased.Animation.$ctor3(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire), new Pidroh.ConsoleApp.Turnbased.Animation.$ctor4(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire, new Pidroh.BaseUtils.Vector2D.$ctor2(0, 1))]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor2(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, 1, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire, new Pidroh.BaseUtils.Vector2D.$ctor2(0, -1)), new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor1(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, 1, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire), new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor2(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, 1, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire, new Pidroh.BaseUtils.Vector2D.$ctor2(0, 1))])]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Shoot, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                this.NewMoveTextRenderData("TripleFire", "TF", "Shoots in the three rows", baseDamage, Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire);


                var areaPunch = this.AreaUser().SquareForward(1);
                var areaSlash = this.AreaUser().RowForward(1, 1);

                for (var i1 = 0; i1 < this.elements.length; i1 = (i1 + 1) | 0) {

                    this.NewMoveData$1((this.elementLabels[System.Array.index(i1, this.elementLabels)] || "") + "bomb", this.OneTickPerAction([new Pidroh.ConsoleApp.Turnbased.Animation.ctor(areaBomb, this.elements[System.Array.index(i1, this.elements)]), new Pidroh.ConsoleApp.Turnbased.DealDamageAction.ctor(areaBomb, Bridge.Int.clip32(baseDamage * 1.0), this.elements[System.Array.index(i1, this.elements)])]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Bomb, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                    this.NewMoveTextRenderData((this.elementLabels[System.Array.index(i1, this.elementLabels)] || "") + "bomb", (this.elementLetter[System.Array.index(i1, this.elementLetter)] || "") + "B", "Attacks row three squares forward", baseDamage, this.elements[System.Array.index(i1, this.elements)]);
                }

                for (var i2 = 0; i2 < this.elements.length; i2 = (i2 + 1) | 0) {


                    this.NewMoveData$1((this.elementLabels[System.Array.index(i2, this.elementLabels)] || "") + "punch", this.OneTickPerAction([new Pidroh.ConsoleApp.Turnbased.Animation.ctor(areaPunch, this.elements[System.Array.index(i2, this.elements)]), new Pidroh.ConsoleApp.Turnbased.DealDamageAction.ctor(areaPunch, damageHigh, this.elements[System.Array.index(i2, this.elements)])]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Bomb, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                    this.NewMoveTextRenderData((this.elementLabels[System.Array.index(i2, this.elementLabels)] || "") + "punch", (this.elementLetter[System.Array.index(i2, this.elementLetter)] || "") + "P", "Attacks enemy forward", damageHigh, this.elements[System.Array.index(i2, this.elements)]);
                }
                for (var i3 = 0; i3 < this.elements.length; i3 = (i3 + 1) | 0) {

                    var damageHigh2 = Bridge.Int.clip32(baseDamage * 2.0);
                    this.NewMoveData$1((this.elementLabels[System.Array.index(i3, this.elementLabels)] || "") + "slash", this.OneTickPerAction([new Pidroh.ConsoleApp.Turnbased.Animation.ctor(areaSlash, this.elements[System.Array.index(i3, this.elements)]), new Pidroh.ConsoleApp.Turnbased.DealDamageAction.ctor(areaSlash, damageHigh2, this.elements[System.Array.index(i3, this.elements)])]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Bomb, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                    this.NewMoveTextRenderData((this.elementLabels[System.Array.index(i3, this.elementLabels)] || "") + "slash", (this.elementLetter[System.Array.index(i3, this.elementLetter)] || "") + "S", "Attacks a row forward", damageHigh2, this.elements[System.Array.index(i3, this.elements)]);
                }
                for (var i4 = 0; i4 < this.elements.length; i4 = (i4 + 1) | 0) {

                    var userRefOffset = new Pidroh.BaseUtils.Vector2D.$ctor2(0, 1);
                    this.NewMoveData$1("Upside" + (this.elementLabels[System.Array.index(i4, this.elementLabels)] || ""), this.TickArray([this.TickUnit([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor4(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, this.elements[System.Array.index(i4, this.elements)], userRefOffset.$clone())]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor2(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, Bridge.Int.clip32(baseDamage * 1.0), this.elements[System.Array.index(i4, this.elements)], userRefOffset.$clone())])]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Shoot, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                    this.NewMoveTextRenderData("Upside" + (this.elementLabels[System.Array.index(i4, this.elementLabels)] || ""), "U" + (this.elementLetter[System.Array.index(i4, this.elementLetter)] || ""), "Shoots from Above", baseDamage, this.elements[System.Array.index(i4, this.elements)]);
                }
                for (var i5 = 0; i5 < this.elements.length; i5 = (i5 + 1) | 0) {

                    var userRefOffset1 = new Pidroh.BaseUtils.Vector2D.$ctor2(0, -1);
                    this.NewMoveData$1("Downside" + (this.elementLabels[System.Array.index(i5, this.elementLabels)] || ""), this.TickArray([this.TickUnit([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor4(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, this.elements[System.Array.index(i5, this.elements)], userRefOffset1.$clone())]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor2(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, Bridge.Int.clip32(baseDamage * 1.0), this.elements[System.Array.index(i5, this.elements)], userRefOffset1.$clone())])]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Shoot, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                    this.NewMoveTextRenderData("Downside" + (this.elementLabels[System.Array.index(i5, this.elementLabels)] || ""), "D" + (this.elementLetter[System.Array.index(i5, this.elementLetter)] || ""), "Shoots from below", baseDamage, this.elements[System.Array.index(i5, this.elements)]);
                }
                for (var i6 = 0; i6 < this.elements.length; i6 = (i6 + 1) | 0) {

                    var userRefOffset2 = new Pidroh.BaseUtils.Vector2D.$ctor2(0, -1);
                    var userRefOffset21 = new Pidroh.BaseUtils.Vector2D.$ctor2(0, 1);
                    this.NewMoveData$1("Sides" + (this.elementLabels[System.Array.index(i6, this.elementLabels)] || ""), this.TickArray([this.TickUnit([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor4(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, this.elements[System.Array.index(i6, this.elements)], userRefOffset2.$clone()), new Pidroh.ConsoleApp.Turnbased.Animation.$ctor4(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, this.elements[System.Array.index(i6, this.elements)], userRefOffset21.$clone())]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor2(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, damageLow2, this.elements[System.Array.index(i6, this.elements)], userRefOffset2.$clone()), new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor2(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, damageLow2, this.elements[System.Array.index(i6, this.elements)], userRefOffset21.$clone())])]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Shoot, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                    this.NewMoveTextRenderData("Sides" + (this.elementLabels[System.Array.index(i6, this.elementLabels)] || ""), "S" + (this.elementLetter[System.Array.index(i6, this.elementLetter)] || ""), "Attacks from the sides", damageLow2, this.elements[System.Array.index(i6, this.elements)]);
                }
                for (var i7 = 0; i7 < this.elements.length; i7 = (i7 + 1) | 0) {
                    var damageLow3 = Bridge.Int.clip32(baseDamage * 0.4);
                    this.NewMoveData$1("Double" + (this.elementLabels[System.Array.index(i7, this.elementLabels)] || ""), this.TickArray([this.TickUnit([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor3(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, this.elements[System.Array.index(i7, this.elements)])]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor1(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, damageLow3, this.elements[System.Array.index(i7, this.elements)])]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor3(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, this.elements[System.Array.index(i7, this.elements)])]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor1(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, damageLow3, this.elements[System.Array.index(i7, this.elements)])])]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Shoot, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                    this.NewMoveTextRenderData("Double" + (this.elementLabels[System.Array.index(i7, this.elementLabels)] || ""), "D" + (this.elementLetter[System.Array.index(i7, this.elementLetter)] || ""), "Shoots two times", damageLow3, this.elements[System.Array.index(i7, this.elements)]);
                }
                for (var i8 = 0; i8 < this.elements.length; i8 = (i8 + 1) | 0) {
                    var damageLow4 = Bridge.Int.clip32(baseDamage * 0.2);
                    this.NewMoveData$1("Triple" + (this.elementLabels[System.Array.index(i8, this.elementLabels)] || ""), this.TickArray([this.TickUnit([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor3(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, this.elements[System.Array.index(i8, this.elements)])]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor1(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, damageLow4, this.elements[System.Array.index(i8, this.elements)])]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor3(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, this.elements[System.Array.index(i8, this.elements)])]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor1(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, damageLow4, this.elements[System.Array.index(i8, this.elements)])]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.Animation.$ctor3(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, this.elements[System.Array.index(i8, this.elements)])]), this.TickUnit([new Pidroh.ConsoleApp.Turnbased.DealDamageAction.$ctor1(Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX, damageLow4, this.elements[System.Array.index(i8, this.elements)])])]), this.TagArray([Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Shoot, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                    this.NewMoveTextRenderData("Triple" + (this.elementLabels[System.Array.index(i8, this.elementLabels)] || ""), "T" + (this.elementLetter[System.Array.index(i8, this.elementLetter)] || ""), "Shoots three times", damageLow4, this.elements[System.Array.index(i8, this.elements)]);
                }

            }
        },
        methods: {
            GetMoveId: function (v) {
                return Pidroh.ConsoleApp.Turnbased.MoveData.FindByLabel(this.moveDatas, v);
            },
            AreaUser: function () {
                this.areaUtils.target = Pidroh.ConsoleApp.Turnbased.Target.Self;
                return this.areaUtils;
            },
            NewMoveTextRenderData: function (name, abrev, description, damage, e) {
                if (e === void 0) { e = 3; }
                var item = new Pidroh.ConsoleApp.Turnbased.MoveMetaData(name, abrev, e);
                item.Description = description;
                item.damage = damage;
                this.moveRenders.add(item);
            },
            NewMoveData$1: function (label, ticks, tags) {
                var $t;
                var mv = new Pidroh.ConsoleApp.Turnbased.MoveData.$ctor1(label);
                mv.units.AddRange(ticks);
                $t = Bridge.getEnumerator(tags);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        mv.tags.add(System.Convert.toInt32(item));
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }this.ecs.CreateEntityWithComponent(mv);
                this.moveDatas.add(mv);
                return mv;
            },
            NewMoveData: function (label, condition, action, tags) {
                var $t;
                var mv = new Pidroh.ConsoleApp.Turnbased.MoveData.$ctor1(label);
                var tick = new Pidroh.ConsoleApp.Turnbased.Tick.ctor();
                tick.condition = condition;
                tick.thingsToHappen.add(action);
                mv.units.add(tick);
                $t = Bridge.getEnumerator(tags);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        mv.tags.add(System.Convert.toInt32(item));
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }this.ecs.CreateEntityWithComponent(mv);
                this.moveDatas.add(mv);
                return mv;
            },
            OneTickPerAction: function (actions) {
                if (actions === void 0) { actions = []; }
                var ticks = System.Array.init(actions.length, null, Pidroh.ConsoleApp.Turnbased.Tick);
                for (var i = 0; i < ticks.length; i = (i + 1) | 0) {
                    ticks[System.Array.index(i, ticks)] = new Pidroh.ConsoleApp.Turnbased.Tick.$ctor1(actions[System.Array.index(i, actions)]);
                }
                return ticks;
            },
            TickUnitCondition: function (condition, actions) {
                if (actions === void 0) { actions = []; }
                var tick = new Pidroh.ConsoleApp.Turnbased.Tick.$ctor2(actions);
                tick.condition = condition;
                return tick;
            },
            TickUnit: function (actions) {
                if (actions === void 0) { actions = []; }
                return new Pidroh.ConsoleApp.Turnbased.Tick.$ctor2(actions);
            },
            TickArray: function (ticks) {
                if (ticks === void 0) { ticks = []; }
                return ticks;
            },
            TagArray: function (args) {
                if (args === void 0) { args = []; }
                return args;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.MoveCreatorProg.AreaCreationUtils", {
        $kind: "nested class",
        fields: {
            target: 0,
            height: 0
        },
        ctors: {
            init: function () {
                this.height = 3;
            }
        },
        methods: {
            RowForward: function (width, XDis) {
                var ra = new Pidroh.ConsoleApp.Turnbased.Area(this.target);
                var offsetY = Bridge.Int.clip32(Math.floor(this.height / 2.0));
                for (var i = 0; i < width; i = (i + 1) | 0) {
                    for (var j = 0; j < this.height; j = (j + 1) | 0) {

                        ra.points.add(new Pidroh.BaseUtils.Vector2D.$ctor2(((i + XDis) | 0), ((j - offsetY) | 0)));
                    }
                }
                return ra;
            },
            SquareForward: function (XDis) {
                var ra = new Pidroh.ConsoleApp.Turnbased.Area(this.target);
                ra.points.add(new Pidroh.BaseUtils.Vector2D.$ctor2(XDis, 0));
                return ra;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.MoveData", {
        statics: {
            methods: {
                FindByLabel: function (moveDatas, label) {
                    for (var i = 0; i < moveDatas.Count; i = (i + 1) | 0) {
                        if (moveDatas.getItem(i) != null) {
                            if (Bridge.referenceEquals(moveDatas.getItem(i).label, label)) {
                                return i;
                            }
                        }
                    }
                    return -1;
                }
            }
        },
        fields: {
            label: null,
            units: null,
            tags: null
        },
        ctors: {
            init: function () {
                this.units = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.Tick)).ctor();
                this.tags = new (System.Collections.Generic.List$1(System.Int32)).ctor();
            },
            $ctor1: function (label) {
                this.$initialize();
                this.label = label;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            HasTag: function (tag) {
                return this.tags.contains(tag);
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.MoveDataExecuter", {
        statics: {
            methods: {
                ResolveTarget: function (actor, entities, targetType, offsetReferenceUserPosition) {
                    var $t;
                    if (targetType === Pidroh.ConsoleApp.Turnbased.Target.Self) {
                        return actor;
                    }
                    var target = null;
                    var minDis = 10;
                    var referenceUserPosition = actor.pos.$clone();
                    referenceUserPosition = Pidroh.BaseUtils.Vector2D.op_Addition(referenceUserPosition.$clone(), offsetReferenceUserPosition.$clone());
                    $t = Bridge.getEnumerator(entities);
                    try {
                        while ($t.moveNext()) {
                            var e2 = $t.Current;

                            if (e2.Dead) {
                                continue;
                            }
                            if (actor.Type !== e2.Type && e2.Type !== Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.paneleffect && e2.Type !== Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.pickup) {

                                var sameHeight = referenceUserPosition.Y === e2.pos.Y;

                                if (sameHeight) {
                                    var dis = referenceUserPosition.X - e2.pos.X;
                                    if (dis < 0) {
                                        dis *= -1;
                                    }
                                    if (dis < minDis) {
                                        minDis = dis;
                                        target = e2;
                                    }

                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    return target;
                }
            }
        },
        fields: {
            battleMain: null,
            moveDatas: null,
            happManager: null,
            entities: null,
            ecs: null,
            timeStamp: null,
            aux: null,
            trackBattle: null
        },
        ctors: {
            init: function () {
                this.aux = new (System.Collections.Generic.List$1(Pidroh.BaseUtils.Vector2D)).ctor();
            },
            ctor: function (turnBase, moveDatas, ecs, timeStamp) {
                this.$initialize();
                this.battleMain = turnBase;
                this.moveDatas = moveDatas;
                this.ecs = ecs;
                this.timeStamp = timeStamp;
            }
        },
        methods: {
            ExecuteMove: function (actor, turn) {
                var $t, $t1, $t2, $t3, $t4, $t5;


                var battleState = this.battleMain.battleState;
                this.entities = this.battleMain.entities;
                var userId = this.entities.indexOf(actor);

                var moveId = actor.moves[System.Array.index(turn, actor.moves)];
                if (moveId < 0) {
                    return;
                }
                var md = this.moveDatas.getItem(moveId);
                if (md == null) {
                    return;
                }
                if (md.units.Count === 0) {
                    return;
                }
                battleState.moveTick_Total = md.units.Count;
                var moveTick = Pidroh.ConsoleApp.Turnbased.Value.op_Implicit(battleState.moveTick_Now);
                var actions = md.units.getItem(moveTick).thingsToHappen;
                this.happManager = this.battleMain.happManager;



                $t = Bridge.getEnumerator(actions);
                try {
                    while ($t.moveNext()) {
                        var a = $t.Current;

                        if (Bridge.is(a, Pidroh.ConsoleApp.Turnbased.MoveAction)) {
                            var ma = Bridge.as(a, Pidroh.ConsoleApp.Turnbased.MoveAction);
                            var p = ma.distance.$clone();
                            actor.pos = Pidroh.BaseUtils.Vector2D.op_Addition(actor.pos.$clone(), p.$clone());
                            var invalidMove = actor.pos.X < actor.minPos.X || actor.pos.Y < actor.minPos.Y || actor.pos.Y > actor.maxPos.Y || actor.pos.X > actor.maxPos.X;
                            $t1 = Bridge.getEnumerator(this.entities);
                            try {
                                while ($t1.moveNext()) {
                                    var e = $t1.Current;
                                    if (!Bridge.referenceEquals(e, actor) && e.Alive) {
                                        if (Pidroh.BaseUtils.Vector2D.op_Equality(actor.pos.$clone(), e.pos.$clone())) {
                                            invalidMove = true;
                                            if (e.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.pickup) {
                                                e.life = 0;
                                                actor.damageMultiplier = 2;
                                                invalidMove = false;
                                            }
                                            if (e.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.paneleffect) {
                                                invalidMove = false;
                                            }
                                            if (invalidMove) {
                                                break;
                                            }


                                        }
                                    }
                                }
                            } finally {
                                if (Bridge.is($t1, System.IDisposable)) {
                                    $t1.System$IDisposable$Dispose();
                                }
                            }if (invalidMove) {

                                var actorId = this.entities.indexOf(actor);
                                var moveTo = actor.pos.$clone();
                                var moveFrom = Pidroh.BaseUtils.Vector2D.op_Subtraction(actor.pos.$clone(), p.$clone());
                                this.CreateHapp$1(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Movement, new Pidroh.ConsoleApp.Turnbased.HappMoveData.$ctor1(actorId), new Pidroh.ConsoleApp.Turnbased.HappMovement.$ctor1(moveFrom.$clone(), moveTo.$clone(), false));



                                actor.pos = Pidroh.BaseUtils.Vector2D.op_Subtraction(actor.pos.$clone(), p.$clone());
                            } else {
                                var actorId1 = this.entities.indexOf(actor);
                                var moveTo1 = actor.pos.$clone();
                                var moveFrom1 = Pidroh.BaseUtils.Vector2D.op_Subtraction(actor.pos.$clone(), p.$clone());
                                this.CreateHapp$1(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Movement, new Pidroh.ConsoleApp.Turnbased.HappMoveData.$ctor1(actorId1), new Pidroh.ConsoleApp.Turnbased.HappMovement.$ctor1(moveFrom1.$clone(), moveTo1.$clone(), true));
                            }
                        }
                        if (Bridge.is(a, Pidroh.ConsoleApp.Turnbased.DealDamageAction)) {
                            var dda = Bridge.as(a, Pidroh.ConsoleApp.Turnbased.DealDamageAction);
                            var attackElement = dda.element;

                            if (dda.target === Pidroh.ConsoleApp.Turnbased.Target.Area) {
                                var area = dda.area;
                                var referenceUserOfArea = Pidroh.ConsoleApp.Turnbased.MoveDataExecuter.ResolveTarget(actor, this.entities, area.target, new Pidroh.BaseUtils.Vector2D.$ctor2(0, 0));
                                var mirroringX = 1;
                                if (actor.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                                    mirroringX = -1;
                                }
                                $t2 = Bridge.getEnumerator(area.points);
                                try {
                                    while ($t2.moveNext()) {
                                        var point = $t2.Current.$clone();
                                        var searchPos = Pidroh.BaseUtils.Vector2D.op_Addition(Pidroh.BaseUtils.Vector2D.op_Multiply(point.$clone(), new Pidroh.BaseUtils.Vector2D.$ctor2(mirroringX, 1)), referenceUserOfArea.pos.$clone());
                                        for (var i = 0; i < this.entities.Count; i = (i + 1) | 0) {
                                            if (Pidroh.BaseUtils.Vector2D.op_Equality(this.entities.getItem(i).pos.$clone(), searchPos.$clone()) && this.entities.getItem(i).Alive) {

                                                this.DealDamage(actor, dda, this.entities.getItem(i));
                                            }
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t2, System.IDisposable)) {
                                        $t2.System$IDisposable$Dispose();
                                    }
                                }
                            } else {
                                var target = Pidroh.ConsoleApp.Turnbased.MoveDataExecuter.ResolveTarget(actor, this.entities, dda.target, dda.userRefOffset.$clone());
                                if (target != null) {
                                    this.DealDamage(actor, dda, target);

                                }
                            }
                        }
                        if (Bridge.is(a, Pidroh.ConsoleApp.Turnbased.SummonEntity)) {
                            var entities = this.battleMain.entities;
                            var battlers = 0;
                            $t3 = Bridge.getEnumerator(entities);
                            try {
                                while ($t3.moveNext()) {
                                    var item = $t3.Current;
                                    if (item.drawLife && item.life > 0) {
                                        battlers = (battlers + 1) | 0;
                                    }
                                }
                            } finally {
                                if (Bridge.is($t3, System.IDisposable)) {
                                    $t3.System$IDisposable$Dispose();
                                }
                            }if (battlers < 4) {
                                var se = Bridge.as(a, Pidroh.ConsoleApp.Turnbased.SummonEntity);
                                var enemyWhich = se.enemyWhich;
                                var enemyId = this.battleMain.BattleConfig.enemiesToSummon.getItem(enemyWhich);

                                var positions = this.GetEmptySpots(1);
                                if (positions.Count === 0) {
                                    return;
                                }

                                var summonPos = se.preferentialRowColumn.$clone();
                                if (!positions.contains(summonPos.$clone())) {
                                    summonPos = positions.getItem(0).$clone();
                                }
                                this.ecs.CreateEntityWithComponent(new Pidroh.ConsoleApp.Turnbased.SpawnData.$ctor1(enemyId, summonPos.$clone(), Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy));
                            }


                        }
                        if (Bridge.is(a, Pidroh.ConsoleApp.Turnbased.Animation)) {
                            var anim = Bridge.as(a, Pidroh.ConsoleApp.Turnbased.Animation);
                            var target1 = Pidroh.ConsoleApp.Turnbased.MoveDataExecuter.ResolveTarget(actor, this.entities, anim.target, anim.userRefOffset.$clone());
                            var area1 = anim.area;
                            var happArea = null;
                            if (area1 != null) {
                                var referenceUserOfArea1 = Pidroh.ConsoleApp.Turnbased.MoveDataExecuter.ResolveTarget(actor, this.entities, area1.target, Pidroh.BaseUtils.Vector2D.Zero.$clone());

                                var mirroringX1 = 1;
                                if (actor.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                                    mirroringX1 = -1;
                                }
                                happArea = new Pidroh.ConsoleApp.Turnbased.HappArea.$ctor2(area1, referenceUserOfArea1.pos.$clone(), mirroringX1);
                            }
                            var targetId = -1;
                            if (target1 != null) {
                                targetId = this.entities.indexOf(target1);
                            }
                            this.CreateHapp(md, happArea, new Pidroh.ConsoleApp.Turnbased.HappMoveData.$ctor2(userId, targetId, anim.element));
                            if (anim.target !== Pidroh.ConsoleApp.Turnbased.Target.None) {
                                var initialPos = Pidroh.BaseUtils.Vector2D.op_Addition(actor.pos.$clone(), anim.userRefOffset.$clone());
                                var finalPos = new Pidroh.BaseUtils.Vector2D();
                                if (target1 != null) {
                                    finalPos = target1.pos.$clone();
                                } else {
                                    finalPos = initialPos.$clone();
                                    finalPos.X = 7;
                                    if (actor.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                                        finalPos.X = -1;
                                    }
                                }
                                this.CreateHapp$1(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Shoot, new Pidroh.ConsoleApp.Turnbased.HappShoot.$ctor1(initialPos.$clone(), finalPos.$clone()), new Pidroh.ConsoleApp.Turnbased.HappMoveData.$ctor2(userId, targetId, anim.element));
                            }





                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                if (moveTick === ((md.units.Count - 1) | 0)) {
                    $t4 = Bridge.getEnumerator(md.units);
                    try {
                        while ($t4.moveNext()) {
                            var item1 = $t4.Current;
                            $t5 = Bridge.getEnumerator(item1.thingsToHappen);
                            try {
                                while ($t5.moveNext()) {
                                    var act = $t5.Current;
                                    if (Bridge.is(act, Pidroh.ConsoleApp.Turnbased.DealDamageAction)) {
                                        this.ChangeElement(actor, (Bridge.as(act, Pidroh.ConsoleApp.Turnbased.DealDamageAction)).element);
                                    }
                                }
                            } finally {
                                if (Bridge.is($t5, System.IDisposable)) {
                                    $t5.System$IDisposable$Dispose();
                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t4, System.IDisposable)) {
                            $t4.System$IDisposable$Dispose();
                        }
                    }
                }
            },
            GetEmptySpots: function (side) {
                var $t;
                if (side === void 0) { side = -1; }
                this.aux.clear();
                var offX = 0;
                if (side === 1) {
                    offX = 3;
                }
                var width = (Bridge.Int.div(this.battleMain.BoardWidth, 2)) | 0;
                if (side === -1) {
                    width = this.battleMain.BoardWidth;
                }
                for (var i = 0; i < width; i = (i + 1) | 0) {
                    for (var j = 0; j < this.battleMain.BoardHeight; j = (j + 1) | 0) {

                        this.aux.add(new Pidroh.BaseUtils.Vector2D.$ctor2(((i + offX) | 0), j));
                    }
                }
                var entities = this.battleMain.entities;
                $t = Bridge.getEnumerator(entities);
                try {
                    while ($t.moveNext()) {
                        var e = $t.Current;
                        if (e.Alive && this.aux.contains(e.pos.$clone())) {
                            this.aux.remove(e.pos.$clone());
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }return this.aux;

            },
            ChangeElement: function (actor, element) {
                if (actor.element === element) {
                    return;
                }
                actor.element = element;
                var th = new Pidroh.ConsoleApp.Turnbased.HappTags.$ctor2(Pidroh.ConsoleApp.Turnbased.MiscHappTags.ChangeElement);
                Pidroh.ECS.ExtensionMethods.AddComponent$1(this.ecs.CreateEntityWithComponent$1(th, new Pidroh.ConsoleApp.Turnbased.HappMoveData.$ctor2(this.entities.indexOf(actor), -1, element)), this.timeStamp.GetSnap());
            },
            CreateHapp: function (md, comp1, comp2) {
                var th = new Pidroh.ConsoleApp.Turnbased.HappTags.$ctor1(md.tags);
                var e = this.ecs.CreateEntityWithComponent$1(th, this.timeStamp.GetSnap());
                if (comp1 != null) {
                    Pidroh.ECS.ExtensionMethods.AddComponent$1(e, comp1);
                }
                if (comp2 != null) {
                    Pidroh.ECS.ExtensionMethods.AddComponent$1(e, comp2);
                }
            },
            CreateHapp$1: function (tag, comp1, comp2) {
                var th = new Pidroh.ConsoleApp.Turnbased.HappTags.$ctor2(tag);
                var e = this.ecs.CreateEntityWithComponent$1(th, this.timeStamp.GetSnap());
                if (comp1 != null) {
                    Pidroh.ECS.ExtensionMethods.AddComponent$1(e, comp1);
                }
                if (comp2 != null) {
                    Pidroh.ECS.ExtensionMethods.AddComponent$1(e, comp2);
                }
            },
            DealDamage: function (actor, dda, target) {
                var attackElement = dda.element;
                var elementalBlock = attackElement === target.element && attackElement !== Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Nothingness;
                var superEffective = false;
                var damage = 0;
                var targetId = this.entities.indexOf(target);
                if (elementalBlock) {
                }
                {
                    if (!elementalBlock) {
                        var mul = this.battleMain.CalculateAttackMultiplier(actor);
                        mul *= this.battleMain.CalculateDefenderMultiplier(target);
                        if (attackElement === Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire && target.element === Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Ice || attackElement === Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Thunder && target.element === Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire || attackElement === Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Ice && target.element === Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Thunder) {
                            mul *= 3;
                            superEffective = true;
                        }



                        damage = Bridge.Int.mul(dda.damage, Bridge.Int.clip32(mul));
                        target.life = (target.life - damage) | 0;
                        if (target.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.hero) {
                            this.trackBattle.HeroDamage(damage);
                        }

                        actor.damageMultiplier = 1;

                        this.happManager.Add(new Pidroh.ConsoleApp.Turnbased.Happs.Happ(Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.HappTag.DamageTaken, Pidroh.ConsoleApp.Turnbased.BattleMain.HappTag, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.HappTag)))).AddAttribute(new Pidroh.ConsoleApp.Turnbased.Happs.Happ.Attribute().SetValue(targetId));
                    }
                }
                this.CreateHapp$1(Pidroh.ConsoleApp.Turnbased.MiscHappTags.Damage, new Pidroh.ConsoleApp.Turnbased.HappDamageData.$ctor1(target.element, dda.element, this.entities.indexOf(target), damage, superEffective, elementalBlock), null);
                if (target.life <= 0 && !superEffective) {
                    this.CreateHapp$1(Pidroh.ConsoleApp.Turnbased.MiscHappTags.Death, new Pidroh.ConsoleApp.Turnbased.HappMoveData.$ctor1(targetId), null);
                }
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.MoveDataTags", {
        $kind: "enum",
        statics: {
            fields: {
                HeroInitial: 0,
                Movement: 1,
                Shoot: 2,
                Bomb: 3,
                Summon: 4
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.MoveMetaData", {
        fields: {
            Label: null,
            Abrev: null,
            element: 0,
            damage: 0,
            Description: null
        },
        ctors: {
            ctor: function (label, abrev, element) {
                this.$initialize();
                this.Label = label;
                this.Abrev = abrev;
                this.element = element;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.MoveUse", {
        fields: {
            move: 0
        },
        ctors: {
            ctor: function () {
                this.$initialize();
            },
            $ctor1: function (move) {
                this.$initialize();
                this.move = move;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.PickupInfo", {
        fields: {
            necessaryForVictory: false
        },
        ctors: {
            $ctor1: function (necessaryForVictory) {
                this.$initialize();
                this.necessaryForVictory = necessaryForVictory;
            },
            ctor: function () {
                this.$initialize();
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.SpawnData", {
        fields: {
            id: 0,
            entityType: 0,
            position: null
        },
        ctors: {
            init: function () {
                this.position = new Pidroh.BaseUtils.Vector2D();
            },
            ctor: function () {
                this.$initialize();
            },
            $ctor1: function (id, position, type) {
                this.$initialize();
                this.id = id;
                this.position = position.$clone();
                this.entityType = type;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.SpawnEntityFactory", {
        fields: {
            ecs: null,
            enemyDatas: null,
            battleMain: null,
            spawns: null
        },
        ctors: {
            ctor: function (ecs, enemyDatas, battleMain) {
                this.$initialize();
                this.ecs = ecs;
                this.spawns = ecs.QuickAccessor1(Pidroh.ConsoleApp.Turnbased.SpawnData);
                this.enemyDatas = enemyDatas;
                this.battleMain = battleMain;
            }
        },
        methods: {
            Spawn: function () {
                var $t;
                var spawned = 0;
                while (this.spawns.Count > 0) {
                    var spawn = this.spawns.Comp1(0);
                    Pidroh.ECS.ExtensionMethods.RemoveComponent(this.spawns.Entity(0), spawn);
                    var id = spawn.id;
                    var entType = spawn.entityType;
                    if (entType === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.pickup) {
                        var be = this.battleMain.NewBattleEntity();
                        be.Type = entType;
                        var pickup = new Pidroh.ConsoleApp.Turnbased.PickupInfo.$ctor1(true);
                        var pickupE = this.ecs.CreateEntityWithComponent(pickup);
                        Pidroh.ECS.ExtensionMethods.AddComponent$1(pickupE, be);
                        be.pos = spawn.position.$clone();
                        be.life = 1;
                        be.maxLife = 1;
                        be.drawLife = false;
                        be.drawTurn = false;
                        be.graphic = 4;

                    }
                    if (entType === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.neutral) {
                        var be1 = this.battleMain.NewBattleEntity();
                        be1.Type = entType;

                        be1.pos = spawn.position.$clone();
                        be1.life = 30;
                        be1.maxLife = 30;
                        be1.drawLife = false;
                        be1.drawTurn = false;
                        be1.graphic = 5;

                    }
                    if (entType === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                        var enemyAI = this.enemyDatas.getItem(id).enemyAI;
                        var enemy = this.ecs.CreateEntityWithComponent(enemyAI);
                        var be2 = this.battleMain.NewBattleEntity();
                        be2.pos = spawn.position.$clone();
                        be2.life = this.enemyDatas.getItem(id).hp;
                        be2.maxLife = be2.life;
                        be2.graphic = this.enemyDatas.getItem(id).render;
                        var entities = this.battleMain.entities;
                        $t = Bridge.getEnumerator(entities);
                        try {
                            while ($t.moveNext()) {
                                var item = $t.Current;
                                if (!Bridge.referenceEquals(item, be2) && item.graphic === be2.graphic) {
                                    be2.graphicRepeatedIndex = (be2.graphicRepeatedIndex + 1) | 0;
                                }
                            }
                        } finally {
                            if (Bridge.is($t, System.IDisposable)) {
                                $t.System$IDisposable$Dispose();
                            }
                        }be2.minPos = new Pidroh.BaseUtils.Vector2D.$ctor2(3, 0);
                        be2.maxPos = new Pidroh.BaseUtils.Vector2D.$ctor2(5, 2);
                        be2.Type = Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy;
                        Pidroh.ECS.ExtensionMethods.AddComponent$1(enemy, be2);
                        var enemyAiState = new Pidroh.ConsoleApp.Turnbased.EnemyAIState();
                        enemyAiState.progress = spawned;
                        Pidroh.ECS.ExtensionMethods.AddComponent$1(enemy, enemyAiState);
                        spawned = (spawned + 1) | 0;
                    }

                }

            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves", {
        statics: {
            fields: {
                SmartMove: null
            },
            ctors: {
                init: function () {
                    this.SmartMove = new Pidroh.ConsoleApp.Turnbased.SpecialEnemyMoves(0);
                }
            }
        },
        fields: {
            number: 0
        },
        ctors: {
            ctor: function (v) {
                this.$initialize();
                this.number = v;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.StageBattleMetrics", {
        fields: {
            damage: 0,
            damageTimes: 0,
            previewTimes: 0,
            round: 0,
            rank: 0
        },
        ctors: {
            init: function () {
                this.damage = -1;
                this.damageTimes = -1;
                this.previewTimes = -1;
                this.round = -1;
                this.rank = -1;
            },
            ctor: function () {
                this.$initialize();

            },
            $ctor1: function (initValues) {
                this.$initialize();
                this.damage = 0;
                this.damageTimes = 0;
                this.previewTimes = 0;
                this.rank = 0;
                this.round = 0;
            }
        },
        methods: {
            CopyValues: function (metrics) {
                this.damage = metrics.damage;
                this.damageTimes = metrics.damageTimes;
                this.previewTimes = metrics.previewTimes;
                this.round = metrics.round;
                this.rank = metrics.rank;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.StageData", {
        statics: {
            fields: {
                staticIdHelper: 0
            },
            ctors: {
                init: function () {
                    this.staticIdHelper = -1;
                }
            },
            methods: {
                ResetIdCreation: function () {
                    Pidroh.ConsoleApp.Turnbased.StageData.staticIdHelper = -1;
                }
            }
        },
        fields: {
            spawnDatas: null,
            battleConfig: null,
            hideLifeUI: false,
            id: 0
        },
        ctors: {
            init: function () {
                this.spawnDatas = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.SpawnData)).ctor();
                this.hideLifeUI = false;
                this.id = -1;
            },
            ctor: function () {
                this.$initialize();
                Pidroh.ConsoleApp.Turnbased.StageData.staticIdHelper = (Pidroh.ConsoleApp.Turnbased.StageData.staticIdHelper + 1) | 0;
                this.id = Pidroh.ConsoleApp.Turnbased.StageData.staticIdHelper;
            },
            $ctor2: function (spawns) {
                if (spawns === void 0) { spawns = []; }

                Pidroh.ConsoleApp.Turnbased.StageData.ctor.call(this);
                this.spawnDatas.AddRange(spawns);
            },
            $ctor1: function (battleConfig, spawns) {
                if (spawns === void 0) { spawns = []; }

                Pidroh.ConsoleApp.Turnbased.StageData.ctor.call(this);
                this.spawnDatas.AddRange(spawns);
                this.battleConfig = battleConfig;
            }
        },
        methods: {
            HideLifeUI: function () {
                this.hideLifeUI = true;
                return this;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.StageDataCreator", {
        fields: {
            ecs: null,
            currentGroup: null
        },
        ctors: {
            ctor: function (ecs) {
                this.$initialize();
                this.ecs = ecs;

                Pidroh.ConsoleApp.Turnbased.StageData.ResetIdCreation();

            }
        },
        methods: {
            CreateDefaultStageData: function () {
                this.TutorialGroup();

                this.currentGroup = new Pidroh.ConsoleApp.Turnbased.StageDataGroup();
                this.AddGroup(this.currentGroup);

                this.Add([new Pidroh.ConsoleApp.Turnbased.StageData.$ctor2([this.Enemy(1, new Pidroh.BaseUtils.Vector2D.$ctor2(3, 2)), this.Enemy(2, new Pidroh.BaseUtils.Vector2D.$ctor2(5, 1))]), new Pidroh.ConsoleApp.Turnbased.StageData.$ctor2([this.Enemy(0, new Pidroh.BaseUtils.Vector2D.$ctor2(4, 1)), this.Enemy(1, new Pidroh.BaseUtils.Vector2D.$ctor2(5, 1))]), new Pidroh.ConsoleApp.Turnbased.StageData.$ctor2([this.Enemy(0, new Pidroh.BaseUtils.Vector2D.$ctor2(3, 2)), this.Enemy(2, new Pidroh.BaseUtils.Vector2D.$ctor2(3, 1)), this.Enemy(2, new Pidroh.BaseUtils.Vector2D.$ctor2(5, 1))]), new Pidroh.ConsoleApp.Turnbased.StageData.$ctor1(new Pidroh.ConsoleApp.Turnbased.BattleConfig.$ctor4(System.Array.init([1], System.Int32)), [this.Enemy(3, new Pidroh.BaseUtils.Vector2D.$ctor2(4, 1))])]);

                this.currentGroup = new Pidroh.ConsoleApp.Turnbased.StageDataGroup();
                this.AddGroup(this.currentGroup);

                this.Add([new Pidroh.ConsoleApp.Turnbased.StageData.$ctor2([this.Enemy(8, new Pidroh.BaseUtils.Vector2D.$ctor2(3, 1))]), new Pidroh.ConsoleApp.Turnbased.StageData.$ctor2([this.Enemy(8, new Pidroh.BaseUtils.Vector2D.$ctor2(4, 1)), this.Enemy(5, new Pidroh.BaseUtils.Vector2D.$ctor2(5, 1))]), new Pidroh.ConsoleApp.Turnbased.StageData.$ctor2([this.Enemy(8, new Pidroh.BaseUtils.Vector2D.$ctor2(4, 2)), this.Enemy(2, new Pidroh.BaseUtils.Vector2D.$ctor2(3, 0))]), new Pidroh.ConsoleApp.Turnbased.StageData.$ctor2([this.Enemy(8, new Pidroh.BaseUtils.Vector2D.$ctor2(3, 0)), this.Enemy(1, new Pidroh.BaseUtils.Vector2D.$ctor2(4, 2)), this.Enemy(1, new Pidroh.BaseUtils.Vector2D.$ctor2(5, 1))]), new Pidroh.ConsoleApp.Turnbased.StageData.$ctor2([this.Neutral(0, new Pidroh.BaseUtils.Vector2D.$ctor2(1, 2)), this.Enemy(9, new Pidroh.BaseUtils.Vector2D.$ctor2(3, 0)), this.Enemy(10, new Pidroh.BaseUtils.Vector2D.$ctor2(5, 2))])]);
            },
            TutorialGroup: function () {
                var trainingGroup = new Pidroh.ConsoleApp.Turnbased.StageDataGroup();
                this.currentGroup = trainingGroup;
                var eTuto = this.AddGroup(trainingGroup);
                Pidroh.ECS.ExtensionMethods.AddComponent$1(eTuto, new Pidroh.ConsoleApp.Turnbased.TagComponent.$ctor1("tutorial"));

                this.AddStage([new Pidroh.ConsoleApp.Turnbased.StageData.$ctor1(new Pidroh.ConsoleApp.Turnbased.BattleConfig.$ctor1(false).NoIntermission(), [this.Pickup(0, new Pidroh.BaseUtils.Vector2D.$ctor2(0, 0)), this.Pickup(0, new Pidroh.BaseUtils.Vector2D.$ctor2(2, 2))]).HideLifeUI(), new Pidroh.ConsoleApp.Turnbased.FixedAttackStage.ctor()]);

                this.AddStage([new Pidroh.ConsoleApp.Turnbased.StageData.$ctor1(new Pidroh.ConsoleApp.Turnbased.BattleConfig.$ctor1(false).NoIntermission(), [this.Pickup(0, new Pidroh.BaseUtils.Vector2D.$ctor2(2, 1)), this.Pickup(0, new Pidroh.BaseUtils.Vector2D.$ctor2(0, 2)), this.Enemy(4, new Pidroh.BaseUtils.Vector2D.$ctor2(5, 1))]).HideLifeUI(), new Pidroh.ConsoleApp.Turnbased.FixedAttackStage.ctor()]);
                this.AddStage([new Pidroh.ConsoleApp.Turnbased.StageData.$ctor1(new Pidroh.ConsoleApp.Turnbased.BattleConfig.$ctor1(false).NoIntermission(), [this.Pickup(0, new Pidroh.BaseUtils.Vector2D.$ctor2(2, 2)), this.Pickup(0, new Pidroh.BaseUtils.Vector2D.$ctor2(1, 2)), this.Pickup(0, new Pidroh.BaseUtils.Vector2D.$ctor2(0, 2)), this.Enemy(5, new Pidroh.BaseUtils.Vector2D.$ctor2(5, 2))]), new Pidroh.ConsoleApp.Turnbased.FixedAttackStage.ctor()]);
                this.AddStage([new Pidroh.ConsoleApp.Turnbased.StageData.$ctor1(new Pidroh.ConsoleApp.Turnbased.BattleConfig.$ctor1(true).NoIntermission(), [this.Enemy(6, new Pidroh.BaseUtils.Vector2D.$ctor2(5, 0))]), new Pidroh.ConsoleApp.Turnbased.FixedAttackStage.$ctor1(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire), new Pidroh.ConsoleApp.Turnbased.TrackInfoStage.$ctor1(2)]);
                this.AddStage([new Pidroh.ConsoleApp.Turnbased.StageData.$ctor1(new Pidroh.ConsoleApp.Turnbased.BattleConfig.$ctor1(true).NoIntermission(), [this.Enemy(4, new Pidroh.BaseUtils.Vector2D.$ctor2(4, 1))]), new Pidroh.ConsoleApp.Turnbased.FixedAttackStage.$ctor1(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire), new Pidroh.ConsoleApp.Turnbased.TrackInfoStage.$ctor1(2)]);
                this.AddStage([new Pidroh.ConsoleApp.Turnbased.StageData.$ctor1(new Pidroh.ConsoleApp.Turnbased.BattleConfig.$ctor1(true).NoIntermission(), [this.Enemy(5, new Pidroh.BaseUtils.Vector2D.$ctor2(4, 1))]), new Pidroh.ConsoleApp.Turnbased.FixedAttackStage.$ctor1(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire)]);
                this.AddStage([new Pidroh.ConsoleApp.Turnbased.StageData.$ctor1(new Pidroh.ConsoleApp.Turnbased.BattleConfig.$ctor1(true).NoIntermission(), [this.Enemy(5, new Pidroh.BaseUtils.Vector2D.$ctor2(4, 1)), this.Enemy(7, new Pidroh.BaseUtils.Vector2D.$ctor2(3, 0))]), new Pidroh.ConsoleApp.Turnbased.FixedAttackStage.$ctor2([Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Thunder])]);

                this.Add([new Pidroh.ConsoleApp.Turnbased.StageData.$ctor1(new Pidroh.ConsoleApp.Turnbased.BattleConfig.$ctor1(true).NoIntermission(), [this.Enemy(0, new Pidroh.BaseUtils.Vector2D.$ctor2(3, 0)), this.Enemy(0, new Pidroh.BaseUtils.Vector2D.$ctor2(5, 2))])]);
                return eTuto.$clone();
            },
            InitializeProgress: function (persistentList) {
                var $t;
                var stageDatas = this.ecs.QuickAccessor1(Pidroh.ConsoleApp.Turnbased.StageData);
                var stageGroups = this.ecs.QuickAccessor1(Pidroh.ConsoleApp.Turnbased.StageDataGroup);

                for (var i = 0; i < stageDatas.Count; i = (i + 1) | 0) {
                    var locked = true;
                    for (var j = 0; j < stageGroups.Count; j = (j + 1) | 0) {
                        if (stageGroups.Comp1(j).childIds.getItem(0).$clone().equalsT(stageDatas.Entity(i))) {
                            locked = false;
                            break;
                        }

                    }

                    var comp = null;
                    var id = stageDatas.Comp1(i).id;
                    $t = Bridge.getEnumerator(persistentList);
                    try {
                        while ($t.moveNext()) {
                            var per = $t.Current;
                            if (per.stageId === id) {
                                comp = per;
                                break;
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }
                    if (comp == null) {
                        comp = new Pidroh.ConsoleApp.Turnbased.StageProgressPersistence.$ctor1(id);
                        comp.available = !locked;
                        persistentList.add(comp);
                    } else {
                    }
                    Pidroh.ECS.ExtensionMethods.AddComponent$1(stageDatas.Entity(i), comp);
                }
            },
            CalculateTrackInfo: function (enemies) {
                var $t;
                var stageDatas = this.ecs.QuickAccessor1(Pidroh.ConsoleApp.Turnbased.StageData);
                for (var i = 0; i < stageDatas.Count; i = (i + 1) | 0) {
                    var sd = stageDatas.Comp1(i);

                    var spawns = sd.spawnDatas;
                    var totalHP = 0;
                    $t = Bridge.getEnumerator(spawns);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            if (item.entityType === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                                var enemyId = item.id;
                                var hp = enemies.getItem(enemyId).hp;
                                totalHP = (totalHP + hp) | 0;
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }var target = 1;
                    if (totalHP === 0) {
                        target = 2;
                    }
                    if (totalHP > 3) {
                        target = Bridge.Int.clip32(Math.ceil(totalHP / 3.0));
                    }

                    if (sd.battleConfig != null && !sd.battleConfig.needKillAllEnemies) {
                        target = 2;
                    }

                    var entity = stageDatas.Entity(i);
                    var trackInfoStae = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.TrackInfoStage, entity);
                    if (trackInfoStae == null) {
                        Pidroh.ECS.ExtensionMethods.AddComponent$1(entity, new Pidroh.ConsoleApp.Turnbased.TrackInfoStage.$ctor1(target));
                    }
                }
            },
            AddStage: function (comps) {
                var $t;
                if (comps === void 0) { comps = []; }

                var e = this.ecs.CreateEntity();
                $t = Bridge.getEnumerator(comps);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        Pidroh.ECS.ExtensionMethods.AddComponent$1(e, item);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }
                this.currentGroup.childIds.add(e.$clone());
            },
            AddGroup: function (group) {

                var e = this.ecs.CreateEntity();
                Pidroh.ECS.ExtensionMethods.AddComponent$1(e, group);
                return e.$clone();
            },
            Pickup: function (v, vector2D) {
                return new Pidroh.ConsoleApp.Turnbased.SpawnData.$ctor1(v, vector2D.$clone(), Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.pickup);
            },
            Neutral: function (v, vector2D) {
                return new Pidroh.ConsoleApp.Turnbased.SpawnData.$ctor1(v, vector2D.$clone(), Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.neutral);
            },
            Enemy: function (v, vector2D) {
                return new Pidroh.ConsoleApp.Turnbased.SpawnData.$ctor1(v, vector2D.$clone(), Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy);
            },
            Add: function (stageData1) {
                var $t;
                if (stageData1 === void 0) { stageData1 = []; }
                $t = Bridge.getEnumerator(stageData1);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;

                        this.currentGroup.childIds.add(this.ecs.CreateEntityWithComponent(item));
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }}
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.StageDataGroup", {
        fields: {
            childIds: null,
            level: 0
        },
        ctors: {
            init: function () {
                this.childIds = new (System.Collections.Generic.List$1(Pidroh.ECS.Entity)).ctor();
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.StageGroupNavigator", {
        fields: {
            backTrackPile: null,
            currentGroupE: null,
            currentSDG: null
        },
        ctors: {
            init: function () {
                this.currentGroupE = new Pidroh.ECS.Entity();
                this.backTrackPile = new (System.Collections.Generic.List$1(Pidroh.ECS.Entity)).ctor();
            },
            ctor: function (ecs) {
                this.$initialize();
                var sdgs = ecs.QuickAccessor1(Pidroh.ConsoleApp.Turnbased.StageDataGroup);
                var firstGroup = sdgs.Comp1(0);
                var newCurrent = sdgs.Entity(0);
                this.ChangeCurrent(newCurrent.$clone());
            }
        },
        methods: {
            ChangeCurrent: function (newCurrent) {
                this.currentGroupE = newCurrent.$clone();
                this.currentSDG = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.StageDataGroup, this.currentGroupE);

            },
            Enter: function (childId) {
                this.backTrackPile.add(this.currentGroupE.$clone());
                this.ChangeCurrent(Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.StageDataGroup, this.currentGroupE).childIds.getItem(childId).$clone());
            },
            Backtrack: function () {
                var lastElement = (this.backTrackPile.Count - 1) | 0;
                if (lastElement < 0) {
                    return;
                }
                this.ChangeCurrent(this.backTrackPile.getItem(lastElement).$clone());
                this.backTrackPile.removeAt(lastElement);
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.StageProgressPersistence", {
        fields: {
            stageId: 0,
            bestBattleMetrics: null,
            available: false
        },
        ctors: {
            init: function () {
                this.bestBattleMetrics = new Pidroh.ConsoleApp.Turnbased.StageBattleMetrics.ctor();
                this.available = false;
            },
            ctor: function () {
                this.$initialize();
            },
            $ctor1: function (id) {
                this.$initialize();
                this.stageId = id;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.StageToBattle", {
        fields: {
            stageToUnlock: null,
            CurrentStage: null
        },
        ctors: {
            init: function () {
                this.stageToUnlock = new Pidroh.ECS.Entity();
                this.CurrentStage = new Pidroh.ECS.Entity();
            }
        },
        methods: {
            Victory: function () {
                if (this.stageToUnlock.Exist()) {
                    Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.StageProgressPersistence, this.stageToUnlock).available = true;
                }
            },
            BattleMetricsUpdate: function (metrics) {
                var stageProgressPersistence = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.StageProgressPersistence, this.CurrentStage);
                stageProgressPersistence.bestBattleMetrics.CopyValues(metrics);
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.SummonEntity", {
        statics: {
            methods: {
                Enemy: function (v, vector2D) {
                    return new Pidroh.ConsoleApp.Turnbased.SummonEntity(v, vector2D.$clone());
                }
            }
        },
        fields: {
            enemyWhich: 0,
            preferentialRowColumn: null
        },
        ctors: {
            init: function () {
                this.preferentialRowColumn = new Pidroh.BaseUtils.Vector2D();
            },
            ctor: function (enemyWhich, preferentialRowColumn) {
                this.$initialize();
                this.enemyWhich = enemyWhich;
                this.preferentialRowColumn = preferentialRowColumn.$clone();
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.TagComponent", {
        fields: {
            tags: null
        },
        ctors: {
            init: function () {
                this.tags = new (System.Collections.Generic.List$1(System.String)).ctor();
            },
            ctor: function () {
                this.$initialize();
            },
            $ctor1: function (v) {
                this.$initialize();
                this.tags.add(v);
            }
        },
        methods: {
            Contains: function (v) {
                return this.tags.contains(v);
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.Target", {
        $kind: "enum",
        statics: {
            fields: {
                None: 0,
                Self: 1,
                ClosestTarget: 2,
                ClosestTargetX: 3,
                Area: 4
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.Tick", {
        fields: {
            condition: null,
            thingsToHappen: null
        },
        ctors: {
            init: function () {
                this.thingsToHappen = new (System.Collections.Generic.List$1(System.Object)).ctor();
            },
            $ctor1: function (action) {
                this.$initialize();
                this.thingsToHappen.add(action);
            },
            $ctor2: function (actions) {
                this.$initialize();
                this.thingsToHappen.AddRange(actions);
            },
            ctor: function () {
                this.$initialize();
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.TrackBattle", {
        fields: {
            stageInfo: null,
            metrics: null
        },
        ctors: {
            init: function () {
                this.metrics = new Pidroh.ConsoleApp.Turnbased.StageBattleMetrics.$ctor1(true);
            }
        },
        methods: {
            HeroDamage: function (damage) {
                if (damage > 0) {
                    this.metrics.damage = (this.metrics.damage + damage) | 0;
                    this.metrics.damageTimes = (this.metrics.damageTimes + 1) | 0;
                }
            },
            Preview: function () {
                this.metrics.previewTimes = (this.metrics.previewTimes + 1) | 0;
            },
            Round: function () {
                this.metrics.round = (this.metrics.round + 1) | 0;
            },
            BattleEndVictory: function () {
                this.metrics.rank = this.CalculateRank();

            },
            CalculateRank: function () {
                if (this.stageInfo == null) {
                    return -1;
                }
                var rank = 100;
                var diff = (this.stageInfo.targetRounds - this.metrics.round) | 0;
                if (diff > 0) {
                    rank = (rank + (Bridge.Int.mul(Bridge.Int.mul(diff, (diff)), 3))) | 0;
                } else {
                    rank = (rank - (Bridge.Int.mul(Bridge.Int.mul(diff, (diff)), 3))) | 0;
                }

                if (this.metrics.damageTimes > 3) {
                    rank = (rank - 10) | 0;
                }
                if (this.metrics.damageTimes > 0) {
                    rank = (rank - 10) | 0;
                }
                return rank;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.TrackInfoStage", {
        fields: {
            targetRounds: 0
        },
        ctors: {
            init: function () {
                this.targetRounds = 0;
            },
            ctor: function () {
                this.$initialize();

            },
            $ctor1: function (targetTurns) {
                this.$initialize();
                this.targetRounds = targetTurns;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.Value", {
        statics: {
            methods: {
                op_Addition: function (c1, c2) {
                    c1.Val += c2;
                    return c1;
                },
                op_Subtraction: function (c1, c2) {
                    return c1.Val - c2;
                },
                op_Equality: function (c1, c2) {
                    var c2null = Bridge.referenceEquals(c2, null);
                    var c1null = Bridge.referenceEquals(c1, null);
                    if (c2null && c1null) {
                        return true;
                    }
                    if (c1null || c2null) {
                        return false;
                    }
                    return c1.Val === c2.Val;
                },
                op_Inequality: function (c1, c2) {
                    var c2null = Bridge.referenceEquals(c2, null);
                    var c1null = Bridge.referenceEquals(c1, null);
                    if (c2null && c1null) {
                        return false;
                    }
                    if (c1null || c2null) {
                        return true;
                    }
                    return c1.Val !== c2.Val;
                },
                op_Implicit$1: function (d) {
                    return d.Val;
                },
                op_Implicit: function (d) {
                    return Bridge.Int.clip32(d.Val);
                }
            }
        },
        fields: {
            Val: 0
        },
        props: {
            valAsEnum: {
                set: function (value) {
                    this.Val = System.Convert.toSingle(value);
                }
            }
        },
        methods: {
            Set: function (v) {
                this.Val = v;
            }
        }
    });

    Bridge.define("Pidroh.ECS.Accessor", {
        fields: {
            TypesProhibited: null,
            TypesNecessary: null,
            SelectedEntities: null
        },
        props: {
            Length: {
                get: function () {
                    return this.SelectedEntities.Count;
                }
            }
        },
        ctors: {
            init: function () {
                this.SelectedEntities = new (System.Collections.Generic.List$1(Pidroh.ECS.Entity)).ctor();
            },
            ctor: function (s) {
                if (s === void 0) { s = []; }

                this.$initialize();
                this.TypesNecessary = s;
            }
        },
        methods: {
            EntityAdded: function (e) {
                return this.SelectedEntities.contains(e.$clone());
            },
            Get: function (i) {
                return this.SelectedEntities.getItem(i).$clone();
            }
        }
    });

    Bridge.define("Pidroh.ECS.ClonedState", {
        fields: {
            comps: null
        },
        ctors: {
            init: function () {
                this.comps = new (System.Collections.Generic.Dictionary$2(Function,System.Array.type(System.Object)))();
            }
        }
    });

    Bridge.define("Pidroh.ECS.ECSManager", {
        statics: {
            fields: {
                managers: null
            },
            ctors: {
                init: function () {
                    this.managers = System.Array.init(8000, null, Pidroh.ECS.ECSManager);
                }
            },
            methods: {
                GetInstance: function (e) {
                    return Pidroh.ECS.ECSManager.managers[System.Array.index(e.ecs, Pidroh.ECS.ECSManager.managers)];
                },
                Create: function () {

                    for (var i = 0; i < Pidroh.ECS.ECSManager.managers.length; i = (i + 1) | 0) {
                        if (Pidroh.ECS.ECSManager.managers[System.Array.index(i, Pidroh.ECS.ECSManager.managers)] == null) {
                            Pidroh.ECS.ECSManager.managers[System.Array.index(i, Pidroh.ECS.ECSManager.managers)] = new Pidroh.ECS.ECSManager();
                            Pidroh.ECS.ECSManager.managers[System.Array.index(i, Pidroh.ECS.ECSManager.managers)].ECSId = i;
                            return Pidroh.ECS.ECSManager.managers[System.Array.index(i, Pidroh.ECS.ECSManager.managers)];
                        }

                    }
                    return null;
                }
            }
        },
        fields: {
            comps: null,
            ECSId: 0,
            entityIdMax: 0,
            accessors: null,
            CopyMethods: null,
            aux: null
        },
        ctors: {
            init: function () {
                this.comps = new (System.Collections.Generic.Dictionary$2(Function,System.Array.type(System.Object)))();
                this.entityIdMax = -1;
                this.accessors = new (System.Collections.Generic.List$1(Pidroh.ECS.Accessor)).ctor();
                this.CopyMethods = new (System.Collections.Generic.Dictionary$2(Function,Function))();
                this.aux = new (System.Collections.Generic.List$1(Function)).ctor();
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            CreateProcessor: function (accessor, action) {

                return new Pidroh.ECS.ProcessorAccessor(action, accessor);
            },
            AddCopyMethod: function (type, copyMetho) {
                this.CopyMethods.add(type, copyMetho);
            },
            CreateAccessor: function (necessary, not) {
                var acc = new Pidroh.ECS.Accessor(necessary);
                acc.TypesProhibited = not;
                this.AddAccessor(acc);
                return acc;

            },
            QuickAccessor2: function (T1, T2) {
                var accessor = new (Pidroh.ECS.QuickAccessorTwo$2(T1,T2))();
                this.AddAccessor(accessor.accessor);
                return accessor;
            },
            QuickAccessor1: function (T1) {
                var accessor = new (Pidroh.ECS.QuickAccessorOne$1(T1))();
                this.AddAccessor(accessor.accessor);
                return accessor;
            },
            CreateEntityWithComponent: function (v) {
                var e = { v : new Pidroh.ECS.Entity() };
                this.CreateEntity$1(e);
                this.AddComponent(e.v.$clone(), v);
                return e.v.$clone();
            },
            CreateEntityWithComponent$1: function (v, v2) {
                var e = { v : new Pidroh.ECS.Entity() };
                this.CreateEntity$1(e);
                this.AddComponent(e.v.$clone(), v);
                this.AddComponent(e.v.$clone(), v2);
                return e.v.$clone();
            },
            DeleteAllEntitiesThatDoNotHave: function (componentTypes) {
                var acs = new Pidroh.ECS.Accessor();

            },
            CreateEntity$1: function (e) {
                this.entityIdMax = (this.entityIdMax + 1) | 0;
                var entity = new Pidroh.ECS.Entity.$ctor1(this.ECSId, this.entityIdMax);
                e.v = entity.$clone();
                return entity.$clone();
            },
            CreateEntity: function () {
                this.entityIdMax = (this.entityIdMax + 1) | 0;
                var entity = new Pidroh.ECS.Entity.$ctor1(this.ECSId, this.entityIdMax);
                return entity.$clone();
            },
            QuickProcessorFlex: function (T1, T2, p) {
                var processorFlex = new (Pidroh.ECS.ProcessorFlex$2(T1,T2))(p);
                var accessor = processorFlex.accessor;
                var accessor1 = accessor.accessor;
                this.AddAccessor(accessor1);
                return processorFlex;
            },
            AddAccessor: function (accessor1) {
                this.accessors.add(accessor1);
                for (var i = 0; i <= this.entityIdMax; i = (i + 1) | 0) {
                    this.UpdateAccessorEntity(accessor1, i);
                }

            },
            UpdateAccessorEntity: function (accessor, entityId) {
                var entity = new Pidroh.ECS.Entity.$ctor1(this.ECSId, entityId);
                var belong = this.HasAllComps(accessor.TypesNecessary, entityId) && this.HasNoneOfTheseComps(accessor.TypesProhibited, entityId);
                var member = accessor.EntityAdded(entity.$clone());

                if (belong !== member) {
                    if (belong) {
                        accessor.SelectedEntities.add(entity.$clone());
                    } else {
                        accessor.SelectedEntities.remove(entity.$clone());
                    }
                }

            },
            CloneState: function (cs) {
                var comps = this.comps;
                var comps2 = cs.comps;
                this.Copy(comps, comps2);
            },
            RestoreState: function (cs) {
                var $t;
                var comps = this.comps;
                var comps2 = cs.comps;
                this.Copy(comps2, comps);

                for (var i = 0; i <= this.entityIdMax; i = (i + 1) | 0) {
                    $t = Bridge.getEnumerator(this.accessors);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current;
                            this.UpdateAccessorEntity(item, i);
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }}

            },
            Copy: function (from, to) {
                var $t, $t1;
                this.aux.clear();

                $t = Bridge.getEnumerator(from);
                try {
                    while ($t.moveNext()) {
                        var c = $t.Current;
                        var type = c.key;



                        this.aux.add(type);
                        if (!to.containsKey(type)) {
                            to.add(type, System.Array.init(300, null, System.Object));
                        }
                        var toArray = to.get(type);
                        var origin = c.value;
                        this.Copy$1(to, type, toArray, origin);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }$t1 = Bridge.getEnumerator(to);
                try {
                    while ($t1.moveNext()) {
                        var c1 = $t1.Current;
                        var type1 = c1.key;
                        if (!this.aux.contains(type1)) {
                            this.aux.add(type1);
                            var toArray1 = c1.value;
                            for (var i = 0; i < toArray1.length; i = (i + 1) | 0) {
                                toArray1[System.Array.index(i, toArray1)] = null;
                            }
                        }

                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }},
            Copy$1: function (to, type, toArray, origin) {
                var copyMethod = { v : null };
                this.CopyMethods.tryGetValue(type, copyMethod);

                for (var i = 0; i < origin.length; i = (i + 1) | 0) {
                    if (origin[System.Array.index(i, origin)] == null) {
                        if (toArray[System.Array.index(i, toArray)] != null) {
                            toArray[System.Array.index(i, toArray)] = null;
                        }

                    } else {
                        if (toArray[System.Array.index(i, toArray)] == null) {
                            toArray[System.Array.index(i, toArray)] = Bridge.createInstance(type);
                        }
                        if (!Bridge.staticEquals(copyMethod.v, null)) {
                            copyMethod.v(origin[System.Array.index(i, origin)], toArray[System.Array.index(i, toArray)]);
                        }

                    }
                }
            },
            AddComponent$1: function (T, e) {
                var t = Bridge.createInstance(T);
                this.AddComponent(e.$clone(), t);

                return t;
            },
            AddComponent: function (e, t) {
                var $t, $t1;
                var type = Bridge.getType(t);
                if (!this.comps.containsKey(type)) {
                    this.comps.add(type, System.Array.init(300, null, System.Object));
                }
                ($t = this.comps.get(type))[System.Array.index(e.id, $t)] = t;
                $t1 = Bridge.getEnumerator(this.accessors);
                try {
                    while ($t1.moveNext()) {
                        var item = $t1.Current;
                        this.UpdateAccessorEntity(item, e.id);

                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }},
            RemoveComponent: function (e, t) {
                var $t, $t1;
                var type = Bridge.getType(t);
                if (!this.comps.containsKey(type)) {
                    this.comps.add(type, System.Array.init(300, null, System.Object));
                }
                ($t = this.comps.get(type))[System.Array.index(e.id, $t)] = null;
                $t1 = Bridge.getEnumerator(this.accessors);
                try {
                    while ($t1.moveNext()) {
                        var item = $t1.Current;
                        this.UpdateAccessorEntity(item, e.id);

                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }},
            HasAllComponents: function (e, typesNecessary) {
                var id = e.id;
                return this.HasAllComps(typesNecessary, id);
            },
            HasAllComps: function (typesNecessary, id) {
                var $t, $t1;
                $t = Bridge.getEnumerator(typesNecessary);
                try {
                    while ($t.moveNext()) {
                        var type = $t.Current;
                        if (!this.comps.containsKey(type)) {
                            return false;
                        }

                        if (($t1 = this.comps.get(type))[System.Array.index(id, $t1)] == null) {
                            return false;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }return true;
            },
            HasNoneOfTheseComps: function (typesProhibited, id) {
                var $t, $t1;
                if (typesProhibited == null) {
                    return true;
                }
                $t = Bridge.getEnumerator(typesProhibited);
                try {
                    while ($t.moveNext()) {
                        var type = $t.Current;
                        if (this.comps.containsKey(type)) {
                            if (($t1 = this.comps.get(type))[System.Array.index(id, $t1)] != null) {
                                return false;
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }return true;
            },
            GetComponent: function (T, e) {
                var $t;
                var type = T;
                if (!this.comps.containsKey(type)) {
                    return Bridge.getDefaultValue(T);
                }
                return Bridge.cast(Bridge.unbox(($t = this.comps.get(type))[System.Array.index(e.id, $t)]), T);
            }
        }
    });

    Bridge.define("Pidroh.ECS.Entity", {
        inherits: function () { return [System.IEquatable$1(Pidroh.ECS.Entity)]; },
        $kind: "struct",
        statics: {
            fields: {
                None: null
            },
            ctors: {
                init: function () {
                    this.None = new Pidroh.ECS.Entity();
                    this.None = new Pidroh.ECS.Entity.$ctor1(-1, -1);
                }
            },
            methods: {
                getDefaultValue: function () { return new Pidroh.ECS.Entity(); }
            }
        },
        fields: {
            ecs: 0,
            id: 0
        },
        alias: ["equalsT", "System$IEquatable$1$Pidroh$ECS$Entity$equalsT"],
        ctors: {
            $ctor1: function (ecs, id) {
                this.$initialize();
                this.ecs = ecs;
                this.id = id;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            Exist: function () {
                return this.id !== -1;
            },
            equalsT: function (other) {
                return other.id === this.id && other.ecs === this.ecs;
            },
            getHashCode: function () {
                var h = Bridge.addHash([1769269177, this.ecs, this.id]);
                return h;
            },
            $clone: function (to) {
                var s = to || new Pidroh.ECS.Entity();
                s.ecs = this.ecs;
                s.id = this.id;
                return s;
            }
        }
    });

    Bridge.define("Pidroh.ECS.ExtensionMethods", {
        statics: {
            methods: {
                RemoveComponent: function (e, comp) {
                    Pidroh.ECS.ECSManager.GetInstance(e.$clone()).RemoveComponent(e.$clone(), comp);
                },
                AddComponent: function (T, e) {
                    return Pidroh.ECS.ECSManager.GetInstance(e.$clone()).AddComponent$1(T, e.$clone());
                },
                AddComponent$1: function (e, comp) {
                    Pidroh.ECS.ECSManager.GetInstance(e.$clone()).AddComponent(e.$clone(), comp);
                },
                GetComponent: function (T, e) {
                    return Pidroh.ECS.ECSManager.GetInstance(e.$clone()).GetComponent(T, e.$clone());
                }
            }
        }
    });

    Bridge.define("Pidroh.ECS.ProcessorAccessor", {
        fields: {
            p: null,
            a: null
        },
        ctors: {
            ctor: function (p, a) {
                this.$initialize();
                this.p = p;
                this.a = a;
            }
        },
        methods: {
            Run: function () {
                this.p(this.a);
            }
        }
    });

    Bridge.define("Pidroh.ECS.ProcessorFlex$2", function (T1, T2) { return {
        fields: {
            p: null,
            accessor: null
        },
        ctors: {
            ctor: function (p) {
                this.$initialize();
                this.p = p;
                this.accessor = new (Pidroh.ECS.QuickAccessorTwo$2(T1,T2))();
            }
        },
        methods: {
            Run: function () {
                this.p(this.accessor);
            }
        }
    }; });

    Bridge.define("Pidroh.ECS.QuickAccessorOne$1", function (T1) { return {
        fields: {
            accessor: null
        },
        props: {
            Count: {
                get: function () {
                    return this.accessor.Length;
                }
            }
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                this.accessor = new Pidroh.ECS.Accessor([T1]);
            }
        },
        methods: {
            Comp1: function (i) {
                return Pidroh.ECS.ExtensionMethods.GetComponent(T1, this.accessor.SelectedEntities.getItem(i).$clone());
            },
            Entity: function (i) {
                return this.accessor.SelectedEntities.getItem(i).$clone();
            }
        }
    }; });

    Bridge.define("Pidroh.ECS.QuickAccessorTwo$2", function (T1, T2) { return {
        fields: {
            accessor: null
        },
        props: {
            Length: {
                get: function () {
                    return this.accessor.Length;
                }
            }
        },
        ctors: {
            ctor: function () {
                this.$initialize();
                this.accessor = new Pidroh.ECS.Accessor([T1, T2]);
            }
        },
        methods: {
            Comp1: function (i) {
                return Pidroh.ECS.ExtensionMethods.GetComponent(T1, this.accessor.SelectedEntities.getItem(i).$clone());
            },
            Entity: function (i) {
                return this.accessor.SelectedEntities.getItem(i).$clone();
            },
            Comp2: function (i) {
                return Pidroh.ECS.ExtensionMethods.GetComponent(T2, this.accessor.SelectedEntities.getItem(i).$clone());
            }
        }
    }; });

    Bridge.define("Pidroh.TextRendering.TextAnimation", {
        fields: {
            length: null,
            progress: null,
            targets: null,
            lists: null
        },
        ctors: {
            init: function () {
                this.length = new (System.Collections.Generic.List$1(System.Single)).ctor();
                this.progress = new (System.Collections.Generic.List$1(System.Single)).ctor();
                this.targets = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.lists = new (System.Collections.Generic.List$1(System.Collections.IList)).ctor();
            }
        },
        methods: {
            RegisterLists: function () {
                this.lists.add(this.length);
                this.lists.add(this.progress);
                this.lists.add(this.targets);
                this.RequestRegisterLists();
            },
            Update: function (delta) {
                for (var i = 0; i < this.progress.Count; i = (i + 1) | 0) {
                    this.progress.setItem(i, this.progress.getItem(i) +delta);
                    if (this.progress.getItem(i) >= this.length.getItem(i)) {
                        this.progress.setItem(i, this.length.getItem(i));
                    } else {
                    }
                }
            },
            Add: function (bd) {
                this.progress.add(bd.progress);
                this.targets.add(bd.target);
                this.length.add(bd.length);
            },
            IsDone: function () {
                var $t;
                $t = Bridge.getEnumerator(this.lists);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        if (System.Array.getCount(item) !== this.progress.Count) {
                            var s = null;
                            s.trim();
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }return this.progress.Count === 0;
            },
            EndTask: function (i) {
                var $t;
                $t = Bridge.getEnumerator(this.lists);
                try {
                    while ($t.moveNext()) {
                        var l = $t.Current;

                        System.Array.removeAt(l, i, Object);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }},
            RegisterList: function (mainData) {
                this.lists.add(mainData);
            },
            Modify$1: function (a) {
                for (var i = 0; i < this.progress.Count; i = (i + 1) | 0) {
                    if (a.id === this.targets.getItem(i)) {
                        this.Modify(a, i, this.progress.getItem(i), this.length.getItem(i));
                        a.animating = true;
                    }
                }
            },
            Modify: function (entity, index, progress, length) { },
            TryEnd: function () {
                for (var i = 0; i < this.progress.Count; i = (i + 1) | 0) {
                    if (this.progress.getItem(i) >= this.length.getItem(i)) {
                        this.EndTask(i);
                    }
                }

            }
        }
    });

    Bridge.define("Pidroh.TextRendering.DefaultPalettes", {
        statics: {
            fields: {
                C4KiroKaze: null,
                C4Reader: null,
                C4Novel: null,
                C4Black: 0,
                C4BlackNeutral: 0,
                C4WhiteNeutral: 0,
                C4White: 0
            },
            ctors: {
                init: function () {
                    this.C4KiroKaze = new Pidroh.TextRendering.Palette(["#332c50", "#46878f", "#94e344", "#e2f3e4"]);
                    this.C4Reader = new Pidroh.TextRendering.Palette(["#262626", "#8b8cba", "#8bba91", "#649f8d"]);
                    this.C4Novel = new Pidroh.TextRendering.Palette(["#262626", "#342d41", "#b8b8b8", "#8b8cba"]);
                    this.C4Black = 0;
                    this.C4BlackNeutral = 1;
                    this.C4WhiteNeutral = 2;
                    this.C4White = 3;
                }
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.GameScreen.KeyboardIO", {
        fields: {
            downUnicodes: null
        },
        ctors: {
            init: function () {
                this.downUnicodes = new (System.Collections.Generic.List$1(System.Int32)).ctor();
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.GameScreen.MouseHover", {
        $kind: "struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new Pidroh.TextRendering.GameScreen.MouseHover(); }
            }
        },
        fields: {
            rect: null,
            type: 0,
            id: 0
        },
        ctors: {
            init: function () {
                this.rect = new Pidroh.BaseUtils.Rect();
            },
            $ctor1: function (rect, type, id) {
                this.$initialize();
                this.rect = rect.$clone();
                this.type = type;
                this.id = id;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            getHashCode: function () {
                var h = Bridge.addHash([3924109847, this.rect, this.type, this.id]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, Pidroh.TextRendering.GameScreen.MouseHover)) {
                    return false;
                }
                return Bridge.equals(this.rect, o.rect) && Bridge.equals(this.type, o.type) && Bridge.equals(this.id, o.id);
            },
            $clone: function (to) {
                var s = to || new Pidroh.TextRendering.GameScreen.MouseHover();
                s.rect = this.rect.$clone();
                s.type = this.type;
                s.id = this.id;
                return s;
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.GameScreen.MouseHoverManager", {
        fields: {
            mouseHovers: null,
            mouseHoversActive: null,
            mouseHoversClickDown: null,
            mouseIO: null
        },
        ctors: {
            init: function () {
                this.mouseHovers = new (System.Collections.Generic.List$1(Pidroh.TextRendering.GameScreen.MouseHover)).ctor();
                this.mouseHoversActive = new (System.Collections.Generic.List$1(Pidroh.TextRendering.GameScreen.MouseHover)).ctor();
                this.mouseHoversClickDown = new (System.Collections.Generic.List$1(Pidroh.TextRendering.GameScreen.MouseHover)).ctor();
            },
            ctor: function (mouseIO) {
                this.$initialize();
                this.mouseIO = mouseIO;
            }
        },
        methods: {
            Update: function () {
                var $t;
                this.mouseHoversActive.clear();
                this.mouseHoversClickDown.clear();
                $t = Bridge.getEnumerator(this.mouseHovers);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current.$clone();
                        if (item.rect.Contains(this.mouseIO.pos.$clone())) {
                            this.mouseHoversActive.add(item.$clone());
                            if (this.mouseIO.mouseClickHappen) {
                                this.mouseHoversClickDown.add(item.$clone());
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }}
        }
    });

    Bridge.define("Pidroh.TextRendering.GameScreen.MouseIO", {
        fields: {
            pos: null,
            mouseClickHappen: false
        },
        ctors: {
            init: function () {
                this.pos = new Pidroh.BaseUtils.Point2D();
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.GameScreen.UnicodeRemap", {
        fields: {
            remaps: null
        },
        ctors: {
            init: function () {
                this.remaps = new (System.Collections.Generic.Dictionary$2(System.Int32,System.Int32))();
            },
            ctor: function () {
                this.$initialize();
                this.remaps.add(Pidroh.BaseUtils.Unicode.keyUp, 119);
                this.remaps.add(Pidroh.BaseUtils.Unicode.keyDown, 115);
                this.remaps.add(Pidroh.BaseUtils.Unicode.keyLeft, 97);
                this.remaps.add(Pidroh.BaseUtils.Unicode.keyRight, 100);

                this.remaps.add(Pidroh.BaseUtils.Unicode.Enter, Pidroh.BaseUtils.Unicode.Space);

                this.remaps.add(105, 49);

            }
        },
        methods: {
            Remap: function (unicode) {
                var result = { };
                if (this.remaps.tryGetValue(unicode, result)) {
                    return result.v;
                }
                return unicode;
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.IKeyboardInput", {
        $kind: "interface"
    });

    Bridge.define("Pidroh.TextRendering.IMouseInput", {
        $kind: "interface"
    });

    Bridge.define("Pidroh.TextRendering.ITextGame", {
        $kind: "interface"
    });

    Bridge.define("Pidroh.TextRendering.ITextScreen", {
        $kind: "interface"
    });

    Bridge.define("Pidroh.TextRendering.MouseEvents", {
        $kind: "enum",
        statics: {
            fields: {
                MouseDown: 0,
                None: 1
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.Palette", {
        fields: {
            HtmlColors: null
        },
        ctors: {
            ctor: function (colors) {
                if (colors === void 0) { colors = []; }

                this.$initialize();
                this.HtmlColors = colors;
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.TextAnimation.BaseData", {
        $kind: "nested struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new Pidroh.TextRendering.TextAnimation.BaseData(); }
            }
        },
        fields: {
            length: 0,
            progress: 0,
            target: 0
        },
        ctors: {
            $ctor1: function (length, progress, target) {
                this.$initialize();
                this.length = length;
                this.progress = progress;
                this.target = target;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            getHashCode: function () {
                var h = Bridge.addHash([3337077382, this.length, this.progress, this.target]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, Pidroh.TextRendering.TextAnimation.BaseData)) {
                    return false;
                }
                return Bridge.equals(this.length, o.length) && Bridge.equals(this.progress, o.progress) && Bridge.equals(this.target, o.target);
            },
            $clone: function (to) {
                var s = to || new Pidroh.TextRendering.TextAnimation.BaseData();
                s.length = this.length;
                s.progress = this.progress;
                s.target = this.target;
                return s;
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.TextBoard", {
        statics: {
            fields: {
                NOCHANGECHAR: 0,
                INVISIBLECHAR: 0,
                NOCHANGECOLOR: 0,
                INVISIBLECOLOR: 0
            },
            ctors: {
                init: function () {
                    this.NOCHANGECHAR = 1;
                    this.INVISIBLECHAR = 2;
                    this.NOCHANGECOLOR = -2;
                    this.INVISIBLECOLOR = -1;
                }
            }
        },
        fields: {
            chars: null,
            TextColor: null,
            BackColor: null,
            cursorX: 0,
            cursorY: 0,
            Position: null,
            Width: 0,
            Height: 0
        },
        props: {
            CursorX: {
                get: function () {
                    return this.cursorX;
                },
                set: function (value) {
                    this.cursorX = value;
                }
            },
            CursorY: {
                get: function () {
                    return this.cursorY;
                },
                set: function (value) {
                    this.cursorY = value;
                }
            }
        },
        ctors: {
            init: function () {
                this.Position = new Pidroh.BaseUtils.Vector2D();
                this.cursorX = 0;
                this.cursorY = 0;
            },
            ctor: function (width, height) {
                this.$initialize();
                this.Resize(width, height);
            }
        },
        methods: {
            DrawOnCenter: function (message, color, xOff, yOff, alignString) {
                if (xOff === void 0) { xOff = 0; }
                if (yOff === void 0) { yOff = 0; }
                if (alignString === void 0) { alignString = true; }
                var x = (Bridge.Int.div((this.Width), 2)) | 0;
                if (alignString) {
                    x = (x - (((Bridge.Int.div(message.length, 2)) | 0))) | 0;
                }
                var y = (Bridge.Int.div(this.Height, 2)) | 0;
                this.Draw$1(message, ((x + xOff) | 0), ((y + yOff) | 0), color);
            },
            DrawOnCenterHorizontal: function (message, color, xOff, y, alignString) {
                if (xOff === void 0) { xOff = 0; }
                if (y === void 0) { y = 0; }
                if (alignString === void 0) { alignString = true; }
                var x = (Bridge.Int.div((this.Width), 2)) | 0;
                if (alignString) {
                    x = (x - (((Bridge.Int.div(message.length, 2)) | 0))) | 0;
                }
                this.Draw$1(message, ((x + xOff) | 0), y, color);
            },
            SetMaxSize: function (width, height) {
                this.chars = System.Array.create(0, null, System.Char, width, height);
                this.TextColor = System.Array.create(0, null, System.Int32, width, height);
                this.BackColor = System.Array.create(0, null, System.Int32, width, height);
            },
            Reset: function () {
                this.DrawRepeated(32, 0, 0, this.Width, this.Height, 0, 0);
            },
            ResetInvisible: function () {
                this.DrawRepeated(Pidroh.TextRendering.TextBoard.INVISIBLECHAR, 0, 0, this.Width, this.Height, Pidroh.TextRendering.TextBoard.INVISIBLECOLOR, Pidroh.TextRendering.TextBoard.INVISIBLECOLOR);
            },
            Insert: function (secondBoard) {
                for (var i = 0; i < secondBoard.Width; i = (i + 1) | 0) {
                    for (var j = 0; j < secondBoard.Height; j = (j + 1) | 0) {
                        var x = (Bridge.Int.clip32(secondBoard.Position.X) + i) | 0;
                        var y = (Bridge.Int.clip32(secondBoard.Position.Y) + j) | 0;
                        if (x < 0 || y < 0) {
                            continue;
                        }
                        if (x >= this.Width || y >= this.Height) {
                            continue;
                        }
                        if (secondBoard.chars.get([i, j]) !== Pidroh.TextRendering.TextBoard.INVISIBLECHAR) {
                            this.chars.set([x, y], secondBoard.chars.get([i, j]));
                        }
                        if (secondBoard.TextColor.get([i, j]) !== Pidroh.TextRendering.TextBoard.INVISIBLECOLOR) {
                            this.TextColor.set([x, y], secondBoard.TextColor.get([i, j]));
                        }
                        if (secondBoard.BackColor.get([i, j]) !== Pidroh.TextRendering.TextBoard.INVISIBLECOLOR) {
                            this.BackColor.set([x, y], secondBoard.BackColor.get([i, j]));
                        }
                    }
                }
            },
            DrawHorizontalLine: function (c, y, color) {
                this.DrawRepeated(c, 0, y, this.Width, 1, color);
            },
            DrawRect: function (c, x, y, w, h, textColor, backColor) {
                this.DrawRepeated(c, x, y, 1, h, textColor, backColor);
                this.DrawRepeated(c, ((((x + w) | 0) - 1) | 0), y, 1, h, textColor, backColor);
                this.DrawRepeated(c, x, y, w, 1, textColor, backColor);
                this.DrawRepeated(c, x, ((((y + h) | 0) - 1) | 0), w, 1, textColor, backColor);
            },
            DrawOneDigit: function (i, x, y, color, background) {
                if (color === void 0) { color = -2; }
                if (background === void 0) { background = -2; }
                var c = (((i + 48) | 0)) & 65535;
                this.DrawChar$1(c, x, y, color, background);
            },
            DrawTwoDigits: function (i, x, y, color, background) {
                if (color === void 0) { color = -2; }
                if (background === void 0) { background = -2; }
                this.DrawOneDigit(((Bridge.Int.div(i, 10)) | 0), x, y, color, background);
                this.DrawOneDigit(i % 10, ((x + 1) | 0), y, color, background);
            },
            SameAs: function (textBoard, x, y) {
                return this.chars.get([x, y]) === textBoard.chars.get([x, y]) && this.BackColor.get([x, y]) === textBoard.BackColor.get([x, y]) && this.TextColor.get([x, y]) === textBoard.TextColor.get([x, y]);
            },
            Copy: function (textBoard, x, y) {
                this.chars.set([x, y], textBoard.chars.get([x, y]));
                this.TextColor.set([x, y], textBoard.TextColor.get([x, y]));
                this.BackColor.set([x, y], textBoard.BackColor.get([x, y]));
            },
            Draw_Cursor_UnicodeLabel: function (v, color) {
                var len = this.DrawUnicodeLabel(v, this.cursorX, this.cursorY, color);
                for (var i = 0; i < len; i = (i + 1) | 0) {
                    this.AdvanceCursor();
                }

            },
            DrawUnicodeLabel: function (unicode, x, y, color) {
                if (unicode >= 97 && unicode <= 122) {
                    this.DrawChar$1(((((((unicode + 65) | 0) - 97) | 0)) & 65535), x, y, color);
                    return 1;
                }
                if (unicode >= 48 && unicode <= 57) {
                    this.DrawChar$1((unicode & 65535), x, y, color);
                    return 1;
                }
                var label = "";
                if (unicode === 32) {
                    label = "SPACE";
                }
                if (unicode === Pidroh.BaseUtils.Unicode.Escape) {
                    label = "ESCAPE";
                }
                this.Draw$1(label, x, y, color);
                return label.length;
            },
            Set: function (origin) {
                this.Position = origin.Position.$clone();
                for (var i = 0; i < this.Width; i = (i + 1) | 0) {
                    for (var j = 0; j < this.Height; j = (j + 1) | 0) {
                        this.chars.set([i, j], origin.chars.get([i, j]));
                        this.BackColor.set([i, j], origin.BackColor.get([i, j]));
                        this.TextColor.set([i, j], origin.TextColor.get([i, j]));
                    }
                }
            },
            Resize: function (w, h) {
                if (this.chars == null || w > System.Array.getLength(this.chars, 0) || h > System.Array.getLength(this.chars, 1)) {
                    this.SetMaxSize(w, h);
                }
                this.Width = w;
                this.Height = h;

            },
            CharAt: function (i, j) {
                return this.chars.get([i, j]);
            },
            SetCursorAt: function (x, y) {
                this.cursorX = x;
                this.cursorY = y;
            },
            Draw_Cursor$2: function (v) {
                var $t;
                $t = Bridge.getEnumerator(v);
                try {
                    while ($t.moveNext()) {
                        var c = $t.Current;
                        this.Draw_Cursor(c);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }},
            Draw_Cursor$3: function (v, color, backColor) {
                var $t;
                if (backColor === void 0) { backColor = -2; }
                $t = Bridge.getEnumerator(v);
                try {
                    while ($t.moveNext()) {
                        var c = $t.Current;
                        this.Draw_Cursor$1(c, color, backColor);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }},
            Draw_Cursor: function (c) {

                this.DrawChar(c, this.cursorX, this.cursorY);
                this.AdvanceCursor();
            },
            Draw_Cursor$1: function (c, color, backColor) {
                if (backColor === void 0) { backColor = -2; }

                this.DrawChar$1(c, this.cursorX, this.cursorY, color, backColor);
                this.AdvanceCursor();
            },
            CanDraw_Cursor_SmartLineBreak: function (v) {
                var currentX = this.cursorX;
                var currentY = this.cursorY;

                for (var i = 0; i < v.length; i = (i + 1) | 0) {
                    var lineBreak = false;
                    var shouldCheckForLineBreaks = (i === 0 || v.charCodeAt(i) === 32) && i !== ((v.length - 1) | 0);
                    if (shouldCheckForLineBreaks) {
                        for (var j = 1; j < ((v.length - i) | 0); j = (j + 1) | 0) {
                            if (((j + currentX) | 0) >= this.Width) {
                                if (v.charCodeAt(i) === 32) {
                                    i = (i + 1) | 0;
                                }
                                lineBreak = true;
                                break;
                            }
                            if (v.charCodeAt(((i + j) | 0)) === 32) {
                                break;
                            }
                        }
                    }
                    if (lineBreak) {
                        currentY = (currentY + 1) | 0;
                        currentX = 0;
                    }
                    currentX = (currentX + 1) | 0;
                    if (currentX >= this.Width) {
                        currentY = (currentY + 1) | 0;
                        currentX = 0;
                    }
                    if (currentX >= this.Width || currentY >= this.Height) {
                        return false;
                    }


                }
                return true;
            },
            Draw_Cursor_SmartLineBreak: function (v, color) {
                var offStart = 0;
                var offEnd = (v.length - 1) | 0;
                return this.Draw_Cursor_SmartLineBreak$1(v, color, offStart, offEnd);
            },
            Draw_Cursor_SmartLineBreak$1: function (v, color, offStart, offEnd, xNewline) {
                if (xNewline === void 0) { xNewline = 0; }

                var start = new Pidroh.BaseUtils.Vector2D.$ctor2(this.CursorX, this.CursorY);
                var endIndex = (offEnd + 1) | 0;
                for (var i = offStart; i < endIndex; i = (i + 1) | 0) {
                    var originX = this.cursorX;
                    var lineBreak = false;
                    var shouldCheckForLineBreaks = (i === 0 || v.charCodeAt(i) === 32) && i !== ((endIndex - 1) | 0);
                    if (shouldCheckForLineBreaks) {
                        for (var j = 1; j < ((endIndex - i) | 0); j = (j + 1) | 0) {
                            if (((j + originX) | 0) >= this.Width) {
                                if (v.charCodeAt(i) === 32) {
                                    i = (i + 1) | 0;
                                }
                                lineBreak = true;
                                break;
                            }
                            if (v.charCodeAt(((i + j) | 0)) === 32) {
                                break;
                            }
                        }
                    }
                    if (lineBreak) {
                        this.CursorNewLine(xNewline);
                    }
                    this.Draw_Cursor$1(v.charCodeAt(i), color);
                }
                var end = new Pidroh.BaseUtils.Vector2D.$ctor2(this.CursorX, this.CursorY);
                return new Pidroh.TextRendering.TextBoard.DrawCursorResult.$ctor1(this.PositionToIndex(start.$clone()), this.PositionToIndex(end.$clone()), start.$clone(), end.$clone());
            },
            AutoFixGridding: function () {
                for (var i = 0; i < this.Width; i = (i + 1) | 0) {
                    for (var j = 0; j < this.Height; j = (j + 1) | 0) {
                        if (this.IsGrid(i, j)) {
                            var mask = 0;
                            if (this.IsGrid(((i - 1) | 0), j)) {
                                mask = (mask + 1) | 0;
                            }
                            if (this.IsGrid(((i + 1) | 0), j)) {
                                mask = (mask + 2) | 0;
                            }
                            if (this.IsGrid(i, ((j - 1) | 0))) {
                                mask = (mask + 4) | 0;
                            }
                            if (this.IsGrid(i, ((j + 1) | 0))) {
                                mask = (mask + 8) | 0;
                            }
                            switch (mask) {
                                case 1: 
                                case 2: 
                                case 3: 
                                    this.chars.set([i, j], Pidroh.BaseUtils.Unicode.AsciiGridHor);
                                    break;
                                case 4: 
                                case 8: 
                                case 12: 
                                    this.chars.set([i, j], Pidroh.BaseUtils.Unicode.AsciiGridVer);
                                    break;
                                case 5: 
                                    this.chars.set([i, j], Pidroh.BaseUtils.Unicode.AsciiGridUpLeft);
                                    break;
                                case 6: 
                                    this.chars.set([i, j], Pidroh.BaseUtils.Unicode.AsciiGridUpRight);
                                    break;
                                case 7: 
                                    this.chars.set([i, j], Pidroh.BaseUtils.Unicode.AsciiGridUpRightLeft);
                                    break;
                                case 9: 
                                    this.chars.set([i, j], Pidroh.BaseUtils.Unicode.AsciiGridDownLeft);
                                    break;
                                case 10: 
                                    this.chars.set([i, j], Pidroh.BaseUtils.Unicode.AsciiGridDownRight);
                                    break;
                                case 11: 
                                    this.chars.set([i, j], Pidroh.BaseUtils.Unicode.AsciiGridDownRightLeft);
                                    break;
                                default: 
                                    break;
                            }
                        }


                    }
                }
            },
            IsGrid: function (x, y) {
                var $t;
                if (x < 0 || y < 0 || x >= this.Width || y >= this.Height) {
                    return false;
                }
                var c = this.chars.get([x, y]);
                $t = Bridge.getEnumerator(Pidroh.BaseUtils.Unicode.grids);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        if (c === item) {
                            return true;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }return false;
            },
            DrawLines: function (hero, points) {
                if (points === void 0) { points = []; }
                for (var i = 0; i < ((points.length - 1) | 0); i = (i + 1) | 0) {
                    this.DrawLine(points[System.Array.index(i, points)].$clone(), points[System.Array.index(((i + 1) | 0), points)].$clone(), hero);
                }

            },
            DrawLine: function (pos1, pos2, color) {
                var c = Pidroh.BaseUtils.Unicode.AsciiGridHor;
                if (pos1.Y !== pos2.Y) {
                    c = Pidroh.BaseUtils.Unicode.AsciiGridVer;
                }
                var height = (pos2.YInt - pos1.YInt) | 0;
                var width = (pos2.XInt - pos1.XInt) | 0;
                this.DrawRepeated(c, pos1.XInt, pos1.YInt, ((width + 1) | 0), ((height + 1) | 0), color);
            },
            PositionToIndex: function (start) {
                return Bridge.Int.clip32(start.X + start.Y * this.Width);
            },
            DrawOneDigit_Cursor: function (i) {
                this.Draw_Cursor(((((i + 48) | 0)) & 65535));
            },
            AdvanceCursor: function () {
                this.cursorX = (this.cursorX + 1) | 0;
                if (this.cursorX >= this.Width) {
                    this.cursorX = 0;
                    this.cursorY = (this.cursorY + 1) | 0;
                }
            },
            CursorNewLine: function (x) {
                this.cursorY = (this.cursorY + 1) | 0;
                this.cursorX = x;
            },
            DrawChar: function (v, x, y) {

                if (v !== Pidroh.TextRendering.TextBoard.NOCHANGECHAR) {
                    this.chars.set([x, y], v);

                }

            },
            DrawChar$1: function (v, x, y, color, backColor) {
                if (backColor === void 0) { backColor = -2; }

                this.DrawChar(v, x, y);
                this.SetColor(color, x, y);
                this.SetBackColor(backColor, x, y);
            },
            SetAll: function (text, textColor, backColor) {
                if (textColor === void 0) { textColor = -2; }
                if (backColor === void 0) { backColor = -2; }
                this.DrawRepeated(text, 0, 0, this.Width, this.Height, textColor, backColor);
            },
            SetAllIfVisible: function (text, textColor, backColor) {
                if (textColor === void 0) { textColor = -2; }
                if (backColor === void 0) { backColor = -2; }
                this.DrawRepeatedIfVisible(text, 0, 0, this.Width, this.Height, textColor, backColor);
            },
            DrawWithGrid: function (text, x, y, gridColor, textColor) {
                var width = text.length;
                this.DrawGrid(x, y, ((width + 2) | 0), 3, gridColor);
                this.Draw$1(text, ((x + 1) | 0), ((y + 1) | 0), textColor);
            },
            Draw$1: function (v, x, y, color, backColor) {
                if (backColor === void 0) { backColor = -2; }
                for (var i = 0; i < v.length; i = (i + 1) | 0) {
                    var x2 = (x + i) | 0;
                    var y2 = y;
                    if (x2 >= this.Width) {
                        x2 = (x2 - this.Width) | 0;
                        y2 = (y2 + 1) | 0;
                    }
                    this.DrawChar$1(v.charCodeAt(i), x2, y2, color, backColor);
                }
            },
            Draw: function (v, x, y, color, backColor) {
                if (backColor === void 0) { backColor = -2; }
                for (var i = 0; i < System.Linq.Enumerable.from(v).count(); i = (i + 1) | 0) {
                    this.DrawChar$1(System.Linq.Enumerable.from(v).elementAt(i), ((x + i) | 0), y, color, backColor);
                }
            },
            Draw$2: function (v, x2, y2, input) {
                throw new System.NotImplementedException.ctor();
            },
            DrawWithLinebreaks: function (v, x, y, newlineX, color, backColor) {
                if (backColor === void 0) { backColor = -2; }
                var linebreaks = 0;
                var xOffsetnewlines = 0;
                for (var i = 0; i < v.length; i = (i + 1) | 0) {
                    var x2 = (((x + i) | 0) + xOffsetnewlines) | 0;
                    var y2 = y;

                    while (x2 >= this.Width) {
                        x2 = (((x2 - this.Width) | 0) + newlineX) | 0;
                        y2 = (y2 + 1) | 0;
                    }

                    if (v.charCodeAt(i) === 10) {
                        linebreaks = (linebreaks + 1) | 0;
                        xOffsetnewlines = (xOffsetnewlines + (((((newlineX - x2) | 0) - 1) | 0))) | 0;
                    } else {
                        this.DrawChar$1(v.charCodeAt(i), x2, ((y2 + linebreaks) | 0), color, backColor);
                    }
                }
            },
            DrawGrid: function (x, y, width, height, color) {

                this.DrawRepeated(Pidroh.BaseUtils.Unicode.AsciiGridVer, x, y, 1, height, color);
                this.DrawRepeated(Pidroh.BaseUtils.Unicode.AsciiGridVer, ((((x + width) | 0) - 1) | 0), y, 1, height, color);
                this.DrawRepeated(Pidroh.BaseUtils.Unicode.AsciiGridHor, x, y, width, 1, color);
                this.DrawRepeated(Pidroh.BaseUtils.Unicode.AsciiGridHor, x, ((((y + height) | 0) - 1) | 0), width, 1, color);

                this.DrawRepeated(218, x, y, 1, 1, color);
                this.DrawRepeated(192, x, ((((y + height) | 0) - 1) | 0), 1, 1, color);
                this.DrawRepeated(217, ((((x + width) | 0) - 1) | 0), ((((y + height) | 0) - 1) | 0), 1, 1, color);
                this.DrawRepeated(191, ((((x + width) | 0) - 1) | 0), y, 1, 1, color);
            },
            DrawGrid$1: function (v1, v2, v3, v4, board) {
                throw new System.NotImplementedException.ctor();
            },
            DrawRepeated: function (c, x, y, width, height, color, backColor) {
                if (backColor === void 0) { backColor = -2; }
                for (var i = x; i < ((x + width) | 0); i = (i + 1) | 0) {
                    for (var j = y; j < ((y + height) | 0); j = (j + 1) | 0) {
                        this.DrawChar$1(c, i, j, color);

                        this.SetBackColor(backColor, i, j);
                    }
                }
            },
            DrawRepeatedIfVisible: function (c, x, y, width, height, color, backColor) {
                if (backColor === void 0) { backColor = -2; }
                for (var i = x; i < ((x + width) | 0); i = (i + 1) | 0) {
                    for (var j = y; j < ((y + height) | 0); j = (j + 1) | 0) {
                        if (this.chars.get([i, j]) !== Pidroh.TextRendering.TextBoard.INVISIBLECHAR || this.TextColor.get([i, j]) !== Pidroh.TextRendering.TextBoard.INVISIBLECOLOR) {
                            this.DrawChar$1(c, i, j, color);
                        }
                        if (this.BackColor.get([i, j]) !== Pidroh.TextRendering.TextBoard.INVISIBLECOLOR) {
                            this.SetBackColor(backColor, i, j);
                        }
                    }
                }
            },
            SetColor: function (color, x, y) {
                if (color !== Pidroh.TextRendering.TextBoard.NOCHANGECOLOR) {
                    this.TextColor.set([x, y], color);
                }
            },
            SetBackColor: function (color, x, y) {
                if (color !== Pidroh.TextRendering.TextBoard.NOCHANGECOLOR) {
                    this.BackColor.set([x, y], color);
                }
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.TextBoard.DrawCursorResult", {
        $kind: "nested struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new Pidroh.TextRendering.TextBoard.DrawCursorResult(); }
            }
        },
        fields: {
            StartIndex: 0,
            EndIndex: 0,
            StartPosition: null,
            EndPosition: null
        },
        ctors: {
            init: function () {
                this.StartPosition = new Pidroh.BaseUtils.Vector2D();
                this.EndPosition = new Pidroh.BaseUtils.Vector2D();
            },
            $ctor1: function (startIndex, endIndex, startPosition, endPosition) {
                this.$initialize();
                this.StartIndex = startIndex;
                this.EndIndex = endIndex;
                this.StartPosition = startPosition.$clone();
                this.EndPosition = endPosition.$clone();
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            getHashCode: function () {
                var h = Bridge.addHash([7592922985, this.StartIndex, this.EndIndex, this.StartPosition, this.EndPosition]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, Pidroh.TextRendering.TextBoard.DrawCursorResult)) {
                    return false;
                }
                return Bridge.equals(this.StartIndex, o.StartIndex) && Bridge.equals(this.EndIndex, o.EndIndex) && Bridge.equals(this.StartPosition, o.StartPosition) && Bridge.equals(this.EndPosition, o.EndPosition);
            },
            $clone: function (to) {
                var s = to || new Pidroh.TextRendering.TextBoard.DrawCursorResult();
                s.StartIndex = this.StartIndex;
                s.EndIndex = this.EndIndex;
                s.StartPosition = this.StartPosition.$clone();
                s.EndPosition = this.EndPosition.$clone();
                return s;
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.TextEntity", {
        fields: {
            id: 0,
            Origin: null,
            Animation: null,
            freeIfIdle: false,
            animating: false
        },
        props: {
            Height: {
                get: function () {
                    return this.Origin.Height;
                }
            },
            Width: {
                get: function () {
                    return this.Origin.Width;
                }
            }
        },
        ctors: {
            init: function () {
                this.freeIfIdle = false;
            }
        },
        methods: {
            AnimBase: function (length) {
                return new Pidroh.TextRendering.TextAnimation.BaseData.$ctor1(length, 0, this.id);
            },
            GetPosition: function () {
                return this.Origin.Position.$clone();
            },
            ResetAnimation: function () {
                this.animating = false;
                this.Animation.Set(this.Origin);
            },
            ResetFull: function () {
                this.Origin.ResetInvisible();
            },
            SetPosition$2: function (x, y) {
                this.Origin.Position = new Pidroh.BaseUtils.Vector2D.$ctor2(x, y);
            },
            SetPosition$1: function (vector2D) {
                this.Origin.Position = vector2D.$clone();
            },
            SetPosition: function (point) {
                this.Origin.Position = new Pidroh.BaseUtils.Vector2D.$ctor2(point.X, point.Y);
            },
            SetSize: function (w, h) {
                if (this.Origin == null) {
                    this.Origin = new Pidroh.TextRendering.TextBoard(w, h);
                    this.Animation = new Pidroh.TextRendering.TextBoard(w, h);
                }
                this.Origin.Resize(w, h);
                this.Animation.Resize(w, h);

            }
        }
    });

    Bridge.define("Pidroh.TextRendering.TextScreenHolder", {
        fields: {
            Screen: null,
            Mouse: null,
            Key: null
        },
        methods: {
            SetAll: function (dns) {
                this.Screen = Bridge.as(dns, Pidroh.TextRendering.ITextScreen);
                this.Mouse = Bridge.as(dns, Pidroh.TextRendering.IMouseInput);
                this.Key = Bridge.as(dns, Pidroh.TextRendering.IKeyboardInput);
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.TextWorld", {
        fields: {
            palette: null,
            activeAgents: null,
            freeBoards: null,
            animations: null,
            mainBoard: null,
            latestId: 0
        },
        ctors: {
            init: function () {
                this.palette = Pidroh.TextRendering.DefaultPalettes.C4KiroKaze;
                this.activeAgents = new (System.Collections.Generic.List$1(Pidroh.TextRendering.TextEntity)).ctor();
                this.freeBoards = new (System.Collections.Generic.List$1(Pidroh.TextRendering.TextEntity)).ctor();
                this.animations = new (System.Collections.Generic.List$1(Pidroh.TextRendering.TextAnimation)).ctor();
                this.latestId = -1;
            }
        },
        methods: {
            AddAnimation: function (T, ta) {
                this.animations.add(ta);
                ta.RegisterLists();
                return ta;
            },
            Init: function (width, height) {
                this.mainBoard = new Pidroh.TextRendering.TextBoard(width, height);

            },
            Draw: function () {
                this.mainBoard.Reset();
                this.DrawChildren();
            },
            DrawChildren: function () {
                var $t;
                for (var i = 0; i < this.activeAgents.Count; i = (i + 1) | 0) {
                    this.activeAgents.getItem(i).ResetAnimation();
                    $t = Bridge.getEnumerator(this.animations);
                    try {
                        while ($t.moveNext()) {
                            var anim = $t.Current;
                            anim.Modify$1(this.activeAgents.getItem(i));
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }if (this.activeAgents.getItem(i).freeIfIdle && !this.activeAgents.getItem(i).animating) {
                        this.freeBoards.add(this.activeAgents.getItem(i));
                        this.activeAgents.remove(this.activeAgents.getItem(i));
                        i = (i - 1) | 0;
                    } else {
                        this.mainBoard.Insert(this.activeAgents.getItem(i).Animation);
                    }

                }
            },
            GetFreeEntity: function (w, h) {
                var te;
                if (this.freeBoards.Count > 0) {
                    te = this.freeBoards.getItem(((this.freeBoards.Count - 1) | 0));
                    this.freeBoards.removeAt(((this.freeBoards.Count - 1) | 0));
                } else {
                    te = new Pidroh.TextRendering.TextEntity();
                    te.id = ((this.latestId = (this.latestId + 1) | 0));

                }

                this.activeAgents.add(te);
                te.freeIfIdle = false;
                te.SetSize(w, h);
                te.ResetFull();
                return te;
            },
            GetTempEntity: function (w, h) {
                var te = this.GetFreeEntity(w, h);
                te.freeIfIdle = true;
                return te;
            },
            AdvanceTime: function (v) {
                var $t;
                $t = Bridge.getEnumerator(this.animations);
                try {
                    while ($t.moveNext()) {
                        var anim = $t.Current;
                        anim.Update(v);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }},
            TryEndAnimations: function () {
                var $t;
                $t = Bridge.getEnumerator(this.animations);
                try {
                    while ($t.moveNext()) {
                        var anim = $t.Current;
                        anim.TryEnd();
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }},
            Free: function (entities) {
                var $t;

                this.freeBoards.AddRange(entities);
                $t = Bridge.getEnumerator(entities);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        this.activeAgents.remove(item);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }},
            IsDone: function () {
                var $t;
                $t = Bridge.getEnumerator(this.animations);
                try {
                    while ($t.moveNext()) {
                        var anim = $t.Current;
                        if (!anim.IsDone()) {
                            return false;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }return true;
            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.AttackPreview", {
        fields: {
            ecs: null,
            render: null,
            moveDatas: null,
            entities: null,
            currentMoveId: 0
        },
        ctors: {
            init: function () {
                this.entities = new (System.Collections.Generic.List$1(Pidroh.TextRendering.TextEntity)).ctor();
            },
            ctor: function (ecs, render) {
                this.$initialize();
                this.ecs = ecs;
                this.render = render;
                this.render.attackPreview = this;
                this.moveDatas = ecs.QuickAccessor1(Pidroh.ConsoleApp.Turnbased.MoveData);

            }
        },
        methods: {
            ShowPreview: function (user, moveId) {
                var $t, $t1;
                if (moveId === this.currentMoveId) {
                    return;
                }
                this.End();
                this.currentMoveId = moveId;

                var moveData = this.moveDatas.Comp1(moveId);
                var pos = this.render.EntityScreenPosition(user);
                var gridRect = this.render.GetGridRect();

                $t = Bridge.getEnumerator(moveData.units);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        var items = item.thingsToHappen;
                        $t1 = Bridge.getEnumerator(items);
                        try {
                            while ($t1.moveNext()) {
                                var thing = $t1.Current;
                                if (Bridge.is(thing, Pidroh.ConsoleApp.Turnbased.DealDamageAction)) {
                                    var da = Bridge.as(thing, Pidroh.ConsoleApp.Turnbased.DealDamageAction);
                                    var target = da.target;
                                    switch (target) {
                                        case Pidroh.ConsoleApp.Turnbased.Target.None: 
                                            break;
                                        case Pidroh.ConsoleApp.Turnbased.Target.Self: 
                                            break;
                                        case Pidroh.ConsoleApp.Turnbased.Target.ClosestTarget: 
                                            break;
                                        case Pidroh.ConsoleApp.Turnbased.Target.ClosestTargetX: 
                                            var freeEntity = this.render.textWorld.GetFreeEntity(((((gridRect.X + gridRect.Width) | 0) - pos.XInt) | 0), 1);
                                            this.entities.add(freeEntity);
                                            freeEntity.SetPosition$1(pos.$clone());
                                            freeEntity.Origin.SetAll(Pidroh.TextRendering.TextBoard.INVISIBLECHAR, Pidroh.TextRendering.TextBoard.INVISIBLECOLOR, 1);
                                            break;
                                        case Pidroh.ConsoleApp.Turnbased.Target.Area: 
                                            break;
                                        default: 
                                            break;
                                    }
                                }
                            }
                        } finally {
                            if (Bridge.is($t1, System.IDisposable)) {
                                $t1.System$IDisposable$Dispose();
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }},
            End: function () {

                if (this.currentMoveId >= 0) {
                    this.currentMoveId = -1;
                    this.render.textWorld.Free(this.entities);
                }
            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.HappHandling", {
        fields: {
            battleRender: null,
            ecs: null,
            Handle: null,
            handlers: null,
            happs: null,
            handleState: null
        },
        props: {
            highestHandled: {
                get: function () {
                    return this.handleState.highestHandled;
                },
                set: function (value) {
                    this.handleState.highestHandled = value;
                }
            }
        },
        ctors: {
            init: function () {
                this.handlers = new (System.Collections.Generic.List$1(Pidroh.TurnBased.TextRendering.HappHandling.HappHandler)).ctor();
                this.handleState = new Pidroh.TurnBased.TextRendering.HappHandling.HappHandleState();
            },
            ctor: function (battleRender, battleSetup) {
                this.$initialize();
                this.battleRender = battleRender;
                var world = battleRender.textWorld;
                var posAnim = world.AddAnimation(Bridge.global.Pidroh.TextRendering.PositionAnimation, new Pidroh.TextRendering.PositionAnimation());
                var blinkAnim = world.AddAnimation(Bridge.global.Pidroh.TextRendering.BlinkAnim, new Pidroh.TextRendering.BlinkAnim());
                var delayAnim = world.AddAnimation(Bridge.global.Pidroh.TextRendering.DelaysAnimation, new Pidroh.TextRendering.DelaysAnimation());
                this.ecs = battleSetup.ecs;
                this.ecs.CreateEntityWithComponent(this.handleState);
                var battleMain = battleSetup.battleMain;
                var time = battleSetup.timeStamp;
                battleRender.HappHandling = this;
                this.happs = this.ecs.QuickAccessor2(Pidroh.ConsoleApp.Turnbased.HappTags, Pidroh.BaseUtils.TimeStampSnap);
                this.highestHandled = -1;


                this.handlers.add(new Pidroh.TurnBased.TextRendering.HappHandling.HappHandler(function (e) {



                    var damage = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.HappDamageData, e);

                    var amount = damage.amount;





                    var message;
                    if (damage.elementalBlock) {

                        {
                            var text = (System.Enum.toString(Pidroh.ConsoleApp.Turnbased.BattleMain.Element, damage.damageE).toUpperCase() || "") + " BLOCK " + (System.Enum.toString(Pidroh.ConsoleApp.Turnbased.BattleMain.Element, damage.targetE).toUpperCase() || "");
                            var message2 = battleRender.textWorld.GetTempEntity(text.length, 1);
                            var colorE = Pidroh.ConsoleApp.Turnbased.BattleRender.ElementToProjColor(damage.damageE);
                            message2.Origin.Draw$1(text, 0, 0, colorE);

                            blinkAnim.Add$1(message2.AnimBase(0.6), Pidroh.TextRendering.BlinkAnim.BlinkData.FrontColor(colorE, 0.2));
                            var offset = Bridge.Int.clip32(Math.floor(((-text.length) | 0) / 2.0));
                            message2.SetPosition$1(Pidroh.BaseUtils.Vector2D.op_Addition(battleRender.battlerRenders.getItem(damage.target).GetPosition(), new Pidroh.BaseUtils.Vector2D.$ctor2(((1 + offset) | 0), -3)));
                            delayAnim.Delay(0.65);
                        }
                        {
                            var pos = battleRender.BattleEntityToScreenPosition(battleMain.entities.getItem(damage.target).pos.$clone());
                            var blast = battleRender.textWorld.GetTempEntity(5, 5);
                            blast.SetPosition$1(Pidroh.BaseUtils.Vector2D.op_Addition(pos.$clone(), new Pidroh.BaseUtils.Vector2D.$ctor2(-2, -2)));

                            blast.Origin.DrawRect(32, 0, 0, 5, 5, Pidroh.TextRendering.TextBoard.INVISIBLECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.ElementToProjColor(damage.damageE));
                            blinkAnim.Add$1(blast.AnimBase(0.2), Pidroh.TextRendering.BlinkAnim.BlinkData.BackColor(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.inputKey, 0.05, false));
                        }
                        message = System.Enum.toString(Pidroh.ConsoleApp.Turnbased.BattleMain.Element, damage.damageE) + " absorbs " + System.Enum.toString(Pidroh.ConsoleApp.Turnbased.BattleMain.Element, damage.targetE) + "\n";
                        message = (message || "") + (((battleRender.GetEntityName(damage.target) || "") + " is unafectted.") || "");
                    } else {

                        if (damage.superEffective) {

                            {
                                var text1 = (System.Enum.toString(Pidroh.ConsoleApp.Turnbased.BattleMain.Element, damage.damageE).toUpperCase() || "") + " BREAK " + (System.Enum.toString(Pidroh.ConsoleApp.Turnbased.BattleMain.Element, damage.targetE).toUpperCase() || "");
                                var message21 = battleRender.textWorld.GetTempEntity(text1.length, 1);
                                var colorE1 = Pidroh.ConsoleApp.Turnbased.BattleRender.ElementToProjColor(damage.damageE);
                                message21.Origin.Draw$1(text1, 0, 0, colorE1);

                                blinkAnim.Add$1(message21.AnimBase(0.45), Pidroh.TextRendering.BlinkAnim.BlinkData.FrontColor(colorE1, 0.2));
                                var offset1 = Bridge.Int.clip32(Math.floor(((-text1.length) | 0) / 2.0));
                                message21.SetPosition$1(Pidroh.BaseUtils.Vector2D.op_Addition(battleRender.battlerRenders.getItem(damage.target).GetPosition(), new Pidroh.BaseUtils.Vector2D.$ctor2(((1 + offset1) | 0), -2)));
                                delayAnim.Delay(0.65);
                            }

                            message = null;
                            {
                                var pos1 = battleRender.BattleEntityToScreenPosition(battleMain.entities.getItem(damage.target).pos.$clone());
                                var blast1 = battleRender.textWorld.GetTempEntity(5, 5);
                                blast1.SetPosition$1(Pidroh.BaseUtils.Vector2D.op_Addition(pos1.$clone(), new Pidroh.BaseUtils.Vector2D.$ctor2(-2, -2)));

                                blast1.Origin.DrawRepeated(32, 1, 1, 3, 3, Pidroh.TextRendering.TextBoard.INVISIBLECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Enemy);
                                blinkAnim.Add$1(blast1.AnimBase(0.2), Pidroh.TextRendering.BlinkAnim.BlinkData.BackColor(Pidroh.ConsoleApp.Turnbased.BattleRender.ElementToProjColor(damage.damageE), 0.05));
                            }
                        } else {
                            message = null;
                        }
                    }

                    {
                        var pos2 = battleRender.BattleEntityToScreenPosition(battleMain.entities.getItem(damage.target).pos.$clone());
                        var number = battleRender.textWorld.GetTempEntity(2, 1);

                        var initialPos = Pidroh.BaseUtils.Vector2D.op_Addition(pos2.$clone(), new Pidroh.BaseUtils.Vector2D.$ctor2(0, 0));
                        number.SetPosition$1(initialPos.$clone());

                        if (amount >= 10) {
                            number.Origin.DrawTwoDigits(amount, 0, 0, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero);
                        } else {
                            number.Origin.DrawOneDigit(amount, 0, 0, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero);
                        }
                        posAnim.Add$1(number.AnimBase(0.6), new Pidroh.TextRendering.PositionAnimation.PositionData.$ctor1(initialPos.$clone(), Pidroh.BaseUtils.Vector2D.op_Addition(initialPos.$clone(), new Pidroh.BaseUtils.Vector2D.$ctor2(0, -3))));
                    }

                    if (message != null) {
                        battleRender.ShowMessage(message);
                    }

                    var defender = battleRender.battlerRenders.getItem(damage.target);

                    if (!damage.superEffective && !damage.elementalBlock) {
                        var fe = battleRender.textWorld.GetTempEntity(3, 3);
                        var backColor = Pidroh.ConsoleApp.Turnbased.BattleRender.ElementToProjColor(damage.damageE);
                        backColor = 0;
                        var xColor = Pidroh.ConsoleApp.Turnbased.BattleRender.ElementToProjColor(damage.damageE);
                        var damageChar = 88;
                        fe.Origin.DrawChar$1(damageChar, 1, 0, xColor, backColor);
                        fe.Origin.DrawChar$1(damageChar, 1, 1, xColor, backColor);
                        fe.Origin.DrawChar$1(damageChar, 1, 2, xColor, backColor);
                        fe.Origin.DrawChar$1(damageChar, 0, 1, xColor, backColor);
                        fe.Origin.DrawChar$1(damageChar, 2, 1, xColor, backColor);
                        fe.Origin.Position = Pidroh.BaseUtils.Vector2D.op_Addition(defender.GetPosition(), new Pidroh.BaseUtils.Vector2D.$ctor2(-1, -1));

                        blinkAnim.Add$1(fe.AnimBase(0.35), Pidroh.TextRendering.BlinkAnim.BlinkData.Char(90, 0.05));
                    }


                }, [Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscHappTags.Damage, Pidroh.ConsoleApp.Turnbased.MiscHappTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscHappTags))]));
                this.handlers.add(new Pidroh.TurnBased.TextRendering.HappHandling.HappHandler(function (e) {
                    var hmd = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.HappMoveData, e);


                    var text = System.Enum.toString(Pidroh.ConsoleApp.Turnbased.BattleMain.Element, hmd.element);
                    var message = battleRender.textWorld.GetTempEntity(text.length, 1);
                    message.Origin.Draw$1(text, 0, 0, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero);
                    blinkAnim.Add$1(message.AnimBase(0.5), Pidroh.TextRendering.BlinkAnim.BlinkData.FrontColor(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription, 0.15));
                    var offset = Bridge.Int.clip32(Math.floor(((-text.length) | 0) / 2.0));
                    message.SetPosition$1(Pidroh.BaseUtils.Vector2D.op_Addition(battleRender.battlerRenders.getItem(hmd.user).GetPosition(), new Pidroh.BaseUtils.Vector2D.$ctor2(((1 + offset) | 0), -1)));

                }, [Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscHappTags.ChangeElement, Pidroh.ConsoleApp.Turnbased.MiscHappTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscHappTags))]));
                this.handlers.add(new Pidroh.TurnBased.TextRendering.HappHandling.HappHandler(function (e) {
                    var hmd = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.HappMoveData, e);
                    var pos = battleRender.BattleEntityToScreenPosition(battleMain.entities.getItem(hmd.user).pos.$clone());
                    var blast = battleRender.textWorld.GetTempEntity(3, 3);
                    blast.SetPosition$1(Pidroh.BaseUtils.Vector2D.op_Addition(pos.$clone(), new Pidroh.BaseUtils.Vector2D.$ctor2(-1, -1)));

                    blast.Origin.DrawRepeated(32, 1, 1, 1, 1, Pidroh.TextRendering.TextBoard.INVISIBLECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Enemy);
                    blinkAnim.Add$1(blast.AnimBase(0.2), Pidroh.TextRendering.BlinkAnim.BlinkData.BackColor(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero, 0.05));

                }, [Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscHappTags.Death, Pidroh.ConsoleApp.Turnbased.MiscHappTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscHappTags))]));
                var moveHandle = function (e) {
                    var hmd = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.HappMoveData, e);
                    var hmf = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.HappMovement, e);
                    var eId = hmd.user;
                    var mover = battleMain.entities.getItem(eId);

                    var pos = mover.PositionV2D.$clone();
                    var pos2 = hmf.moveTo.$clone();
                    var posF = Pidroh.BaseUtils.Vector2D.op_Division$1((Pidroh.BaseUtils.Vector2D.op_Addition(pos.$clone(), pos2.$clone())), 2);

                    var fe = battleRender.battlerRenders.getItem(eId);
                    if (hmf.success) {
                        var finalPosScreen = battleRender.BattleEntityToScreenPosition(hmf.moveTo.$clone());
                        posAnim.Add$1(fe.AnimBase(0.2), new Pidroh.TextRendering.PositionAnimation.PositionData.$ctor1(battleRender.BattleEntityToScreenPosition(hmf.moveFrom.$clone()), finalPosScreen.$clone()));
                        fe.SetPosition$1(finalPosScreen.$clone());
                    } else {
                        posAnim.Add$1(fe.AnimBase(0.2), new Pidroh.TextRendering.PositionAnimation.PositionData.$ctor1(battleRender.BattleEntityToScreenPosition(hmf.moveFrom.$clone()), battleRender.BattleEntityToScreenPosition(posF.$clone())));
                    }

                };
                this.handlers.add(new Pidroh.TurnBased.TextRendering.HappHandling.HappHandler(moveHandle, [Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Movement, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));

                this.handlers.add(new Pidroh.TurnBased.TextRendering.HappHandling.HappHandler(function (e) {
                    var $t;
                    var ha = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.HappArea, e);
                    var hmd = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.HappMoveData, e);
                    var eId = hmd.user;
                    var mover = battleMain.entities.getItem(eId);
                    var area = ha.area;
                    var points = area.points;

                    var useEffect = world.GetTempEntity(1, 1);
                    useEffect.SetPosition$1(battleRender.BattleEntityToScreenPosition(mover.pos.$clone()));
                    blinkAnim.Add$1(useEffect.AnimBase(0.5), Pidroh.TextRendering.BlinkAnim.BlinkData.BackColor(Pidroh.ConsoleApp.Turnbased.BattleRender.ElementToProjColor(hmd.element), 0.15));
                    $t = Bridge.getEnumerator(points);
                    try {
                        while ($t.moveNext()) {
                            var item = $t.Current.$clone();
                            var entity = world.GetTempEntity(1, 1);
                            var finalPos = Pidroh.BaseUtils.Vector2D.op_Addition(Pidroh.BaseUtils.Vector2D.op_Multiply(item.$clone(), new Pidroh.BaseUtils.Vector2D.$ctor2(ha.mirroringX, 1)), ha.offset.$clone());
                            if (finalPos.X < 0) {
                                continue;
                            }
                            if (finalPos.Y < 0) {
                                continue;
                            }
                            if (finalPos.X > 5) {
                                continue;
                            }
                            if (finalPos.Y > 2) {
                                continue;
                            }
                            var pos = battleRender.BattleEntityToScreenPosition(finalPos.$clone());
                            entity.SetPosition$2(pos.XInt, pos.YInt);
                            blinkAnim.Add$1(entity.AnimBase(0.5), Pidroh.TextRendering.BlinkAnim.BlinkData.BackColor(Pidroh.ConsoleApp.Turnbased.BattleRender.ElementToProjColor(hmd.element), 0.15));
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }}, [Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Bomb, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));
                this.handlers.add(new Pidroh.TurnBased.TextRendering.HappHandling.HappHandler(function (e) {
                    var ha = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.HappShoot, e);
                    var md = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.HappMoveData, e);
                    if (ha != null) {

                        var element = md.element;
                        var fe = battleRender.GetProjTextEntity(element);
                        var pos = ha.start.$clone();
                        var pos2 = ha.end.$clone();
                        var xDis = Math.abs(pos.X - pos2.X);
                        var timeV = xDis * 0.1;
                        posAnim.Add$1(fe.AnimBase(timeV), new Pidroh.TextRendering.PositionAnimation.PositionData.$ctor1(battleRender.BattleEntityToScreenPosition(pos.$clone()), battleRender.BattleEntityToScreenPosition(pos2.$clone())));


                    }

                }, [Bridge.box(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Shoot, Pidroh.ConsoleApp.Turnbased.MoveDataTags, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MoveDataTags))]));

                this.Handle = Bridge.fn.bind(this, function () {
                    var $t, $t1;
                    var newHighestHandled = this.highestHandled;
                    for (var i = 0; i < this.happs.Length; i = (i + 1) | 0) {
                        if (!battleRender.CanAdvanceGraphics()) {
                            break;
                        }
                        var tags = this.happs.Comp1(i);
                        if (i > this.highestHandled) {
                            newHighestHandled = i;
                            var handled = false;
                            $t = Bridge.getEnumerator(this.handlers);
                            try {
                                while ($t.moveNext()) {
                                    var han = $t.Current;
                                    if (han.CanHandle(tags.tags)) {
                                        handled = true;
                                        han.Handler(this.happs.Entity(i));
                                    }
                                }
                            } finally {
                                if (Bridge.is($t, System.IDisposable)) {
                                    $t.System$IDisposable$Dispose();
                                }
                            }if (!handled) {
                                $t1 = Bridge.getEnumerator(tags.tags);
                                try {
                                    while ($t1.moveNext()) {
                                        var t = $t1.Current;
                                    }
                                } finally {
                                    if (Bridge.is($t1, System.IDisposable)) {
                                        $t1.System$IDisposable$Dispose();
                                    }
                                }}
                        } else {
                        }
                    }
                    this.highestHandled = newHighestHandled;
                });

            }
        },
        methods: {
            IsDone: function () {
                return this.highestHandled >= ((this.happs.Length - 1) | 0);
            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.HappHandling.HappHandler", {
        $kind: "nested class",
        fields: {
            necessaryTags: null,
            Handler: null
        },
        ctors: {
            init: function () {
                this.necessaryTags = new (System.Collections.Generic.List$1(System.Int32)).ctor();
            },
            ctor: function (handler, tags) {
                if (tags === void 0) { tags = []; }
                var $t;

                this.$initialize();
                $t = Bridge.getEnumerator(tags);
                try {
                    while ($t.moveNext()) {
                        var t = $t.Current;
                        this.necessaryTags.add(System.Convert.toInt32(t));
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }this.Handler = handler;
            }
        },
        methods: {
            CanHandle: function (tags) {
                var $t;
                $t = Bridge.getEnumerator(this.necessaryTags);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        if (!tags.contains(item)) {
                            return false;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }return true;
            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.HappHandling.HappHandleState", {
        $kind: "nested class",
        fields: {
            highestHandled: 0
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.HelpScreenIntegration", {
        fields: {
            showRequest: false,
            caller: null
        },
        methods: {
            Show: function (screen) {
                this.showRequest = true;
                this.caller = screen;
            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.HelpScreenModel", {
        fields: {
            battleMain: null,
            commandsHero: null,
            commandsEnemy: null,
            battleIntroMode: false,
            attackDemo: false,
            killAllEnemies: false
        },
        ctors: {
            init: function () {
                this.commandsHero = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.commandsEnemy = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.battleIntroMode = false;
            },
            ctor: function (battleMain) {
                this.$initialize();
                this.battleMain = battleMain;

            }
        },
        methods: {
            RefreshData: function () {
                var $t;
                this.commandsHero.clear();
                this.AddAll(this.battleMain.playerHandFixed, this.commandsHero);
                this.AddAll(this.battleMain.playerHandUnfixed, this.commandsHero);
                this.AddAll(this.battleMain.playerHandPool, this.commandsHero);
                $t = Bridge.getEnumerator(this.battleMain.entities);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        this.AddAllArray(item.moves, this.commandsEnemy);
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }this.attackDemo = this.battleMain.BattleConfig.attackDemonstrationMode;
                this.killAllEnemies = this.battleMain.BattleConfig.needKillAllEnemies;
            },
            AddAll: function (moves, commands) {
                var $t;
                $t = Bridge.getEnumerator(moves);
                try {
                    while ($t.moveNext()) {
                        var m = $t.Current;
                        var a = m;
                        if (a < 0) {
                            continue;
                        }
                        if (!commands.contains(a)) {
                            commands.add(a);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }},
            AddAllArray: function (moves, commands) {
                var $t;
                $t = Bridge.getEnumerator(moves);
                try {
                    while ($t.moveNext()) {
                        var a = $t.Current;
                        if (a < 0) {
                            continue;
                        }
                        if (!commands.contains(a)) {
                            commands.add(a);
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }}
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.InputHandling", {
        fields: {
            unfixedCommandKeys: null,
            fixedMoveButtons: null,
            fixedMoveButtonAlternative: null
        },
        ctors: {
            init: function () {
                this.unfixedCommandKeys = System.Array.init([
                    49, 
                    50, 
                    51, 
                    52, 
                    53
                ], System.Int32);
                this.fixedMoveButtons = function (_o1) {
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.Move, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.NormalShot, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))), 103);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.Move, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))), 102);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.Move, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Ice, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))), 105);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.Move, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.IceBomb, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))), 98);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.Move, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.ThunderBomb, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))), 121);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.Move, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Thunder, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))), 116);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.Move, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveRight, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))), 100);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.Move, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveUp, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))), 119);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.Move, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveDown, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))), 115);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.Move, Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.MoveLeft, Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType))), 97);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle, Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Done, Pidroh.ConsoleApp.Turnbased.MiscBattleInput, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscBattleInput))), Pidroh.BaseUtils.Unicode.Space);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle, Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Redo, Pidroh.ConsoleApp.Turnbased.MiscBattleInput, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscBattleInput))), 114);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle, Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Preview, Pidroh.ConsoleApp.Turnbased.MiscBattleInput, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscBattleInput))), 112);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle, Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Help, Pidroh.ConsoleApp.Turnbased.MiscBattleInput, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscBattleInput))), 104);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle, Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Cancel, Pidroh.ConsoleApp.Turnbased.MiscBattleInput, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscBattleInput))), 114);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle, Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Confirm, Pidroh.ConsoleApp.Turnbased.MiscBattleInput, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscBattleInput))), Pidroh.BaseUtils.Unicode.Space);
                        _o1.add(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle, Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.LeaveAttackDemonstration, Pidroh.ConsoleApp.Turnbased.MiscBattleInput, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscBattleInput))), Pidroh.BaseUtils.Unicode.Escape);
                        return _o1;
                    }(new (System.Collections.Generic.Dictionary$2(Pidroh.ConsoleApp.Turnbased.InputUnit,System.Int32))());
                this.fixedMoveButtonAlternative = function (_o2) {
                        _o2.add(new (System.Collections.Generic.KeyValuePair$2(Pidroh.ConsoleApp.Turnbased.InputUnit,System.Int32)).$ctor1(new Pidroh.ConsoleApp.Turnbased.InputUnit.$ctor1(Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle, Bridge.box(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Redo, Pidroh.ConsoleApp.Turnbased.MiscBattleInput, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.MiscBattleInput))), Pidroh.BaseUtils.Unicode.Backspace));
                        return _o2;
                    }(new (System.Collections.Generic.List$1(System.Collections.Generic.KeyValuePair$2(Pidroh.ConsoleApp.Turnbased.InputUnit,System.Int32))).ctor());
            }
        },
        methods: {
            GetFixedMoveUnicode: function (input) {
                var value = { };
                if (this.fixedMoveButtons.tryGetValue(input, value)) {

                } else {
                    value.v = -1;
                }
                return value.v;
            },
            Inputted: function (unicodeKey, input) {
                var $t, $t1;
                $t = Bridge.getEnumerator(this.fixedMoveButtons);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;
                        if (item.value === unicodeKey) {
                            if (input.Contains(item.key)) {
                                return item.key;
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }$t1 = Bridge.getEnumerator(this.fixedMoveButtonAlternative);
                try {
                    while ($t1.moveNext()) {
                        var item1 = $t1.Current;
                        if (item1.value === unicodeKey) {
                            if (input.Contains(item1.key)) {
                                return item1.key;
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }for (var i = 0; i < this.unfixedCommandKeys.length; i = (i + 1) | 0) {
                    if (this.unfixedCommandKeys[System.Array.index(i, this.unfixedCommandKeys)] === unicodeKey) {
                        var unfixedCommandPos = 0;
                        for (var i2 = 0; i2 < input.inputs.Count; i2 = (i2 + 1) | 0) {
                            if (input.TagIs(i2, Pidroh.ConsoleApp.Turnbased.InputTags.MOVEUNFIX)) {
                                if (unfixedCommandPos === i) {
                                    return input.inputs.getItem(i2);
                                }
                                unfixedCommandPos = (unfixedCommandPos + 1) | 0;
                            }
                        }
                    }
                }
                return Bridge.getDefaultValue(Pidroh.ConsoleApp.Turnbased.InputUnit);
            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.MessageOnPosition", {
        fields: {
            battleRender: null,
            textWorld: null,
            blinkAnim: null
        },
        ctors: {
            ctor: function (battleRender) {
                this.$initialize();
                this.textWorld = battleRender.textWorld;
                this.blinkAnim = this.textWorld.AddAnimation(Bridge.global.Pidroh.TextRendering.BlinkAnim, new Pidroh.TextRendering.BlinkAnim());
            }
        },
        methods: {
            MessageOnPos: function (pos, v) {
                var entity = this.textWorld.GetTempEntity(((v.length + 2) | 0), 6);
                this.blinkAnim.Add$1(entity.AnimBase(2.0), new Pidroh.TextRendering.BlinkAnim.BlinkData.$ctor1(Pidroh.TextRendering.TextBoard.NOCHANGECHAR, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, 0.35, 0.35));
                var xOff = (Bridge.Int.div((((v.length - 3) | 0)), 2)) | 0;
                if (xOff < 0) {
                    xOff = 0;
                }
                var lineStart = new Pidroh.BaseUtils.Vector2D.$ctor2(xOff, 0);
                entity.SetPosition$1(Pidroh.BaseUtils.Vector2D.op_Addition(pos.$clone(), new Pidroh.BaseUtils.Vector2D.$ctor2(((1 - xOff) | 0), 0)));
                entity.Origin.DrawWithGrid(v, 0, 3, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero);

                entity.Origin.DrawLines(Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero, [lineStart.$clone(), Pidroh.BaseUtils.Vector2D.op_Addition(lineStart.$clone(), new Pidroh.BaseUtils.Vector2D.$ctor2(2, 0)), Pidroh.BaseUtils.Vector2D.op_Addition(lineStart.$clone(), new Pidroh.BaseUtils.Vector2D.$ctor2(2, 2))]);
                entity.Origin.AutoFixGridding();
            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.MouseHoverText", {
        fields: {
            texts: null,
            hoverManager: null,
            entity: null
        },
        ctors: {
            init: function () {
                this.texts = System.Array.init(3, null, System.Array.type(System.String));
            },
            ctor: function (hoverManager, entity, moveDescriptions) {
                this.$initialize();
                this.hoverManager = hoverManager;
                this.entity = entity;

                this.texts[System.Array.index(0, this.texts)] = moveDescriptions;
                this.texts[System.Array.index(1, this.texts)] = System.Array.init(["Starts command execution", "Removes the last inputted command", "Preview moves of the opponents", "Inputs move", "Returns", "Shows helpful information"], System.String);
                this.texts[System.Array.index(2, this.texts)] = System.Array.init(["Moves in the corresponding direction"], System.String);
            }
        },
        methods: {
            Update: function () {
                var $t;
                this.entity.ResetFull();
                this.hoverManager.Update();
                var active = this.hoverManager.mouseHoversActive;
                if (active.Count > 0) {
                    var id = active.getItem(0).$clone().id;
                    if (id >= 0) {
                        var text = ($t = this.texts[System.Array.index(active.getItem(0).$clone().type, this.texts)])[System.Array.index(id, $t)];
                        this.entity.Origin.SetCursorAt(0, 0);
                        this.entity.Origin.Draw_Cursor_SmartLineBreak(text, 2);

                        var x = (((active.getItem(0).$clone().rect.X + 1) | 0) - ((Bridge.Int.div(text.length, 2)) | 0)) | 0;
                        if (x < 0) {
                            x = 1;
                        }
                        this.entity.SetPosition$2(x, ((active.getItem(0).$clone().rect.Y - 2) | 0));
                    }


                }
            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.NavigationKeyboard", {
        fields: {
            points: null,
            currentPoint: 0,
            textWorld: null,
            cursor: null,
            chosenOption: 0,
            showEscape: false,
            wantToEscape: false
        },
        ctors: {
            init: function () {
                this.points = new (System.Collections.Generic.List$1(Pidroh.BaseUtils.Point2D)).ctor();
                this.currentPoint = 0;
                this.chosenOption = -1;
                this.showEscape = true;
                this.wantToEscape = false;
            },
            ctor: function (textWorld) {
                this.$initialize();
                this.textWorld = textWorld;
                this.cursor = textWorld.GetFreeEntity(1, 1);
                this.cursor.Origin.DrawChar$1(64, 0, 0, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero);
            }
        },
        methods: {
            CheckInput: function (inputUnicode) {

                if (inputUnicode === Pidroh.BaseUtils.Unicode.Space) {
                    this.chosenOption = this.currentPoint;
                }
                if (inputUnicode === 115 || inputUnicode === 100) {
                    this.Move(1);
                }
                if (inputUnicode === 119 || inputUnicode === 97) {
                    this.Move(-1);
                }
                if (inputUnicode === Pidroh.BaseUtils.Unicode.Escape && this.showEscape) {
                    this.wantToEscape = true;
                }
            },
            Move: function (v) {
                this.currentPoint = (this.currentPoint + v) | 0;
                if (this.currentPoint >= this.points.Count) {
                    this.currentPoint = 0;
                }
                if (this.currentPoint < 0) {
                    this.currentPoint = (this.points.Count - 1) | 0;
                }
                this.UpdatePoint();
            },
            UpdatePoint: function () {
                if (this.currentPoint < this.points.Count) {
                    this.cursor.SetPosition(this.points.getItem(this.currentPoint).$clone());
                }
            },
            DrawControls: function () {
                var y = 30;
                Pidroh.TurnBased.TextRendering.UIReusable.DrawControlsLabel(this.textWorld, y);
                {
                    var forceInputLabel = Pidroh.TurnBased.TextRendering.UIReusable.WASD;
                    var forceCommandLabel = Pidroh.TurnBased.TextRendering.UIReusable.arrows;

                    Pidroh.ConsoleApp.Turnbased.BattleRender.DrawInput$1(7, ((y + 2) | 0), forceInputLabel, forceCommandLabel, this.textWorld.mainBoard);
                    Pidroh.ConsoleApp.Turnbased.GameMain.DrawInput(7, ((y + 4) | 0), Pidroh.BaseUtils.Unicode.Space, "SELECT", this.textWorld.mainBoard);
                    if (this.showEscape) {
                        Pidroh.ConsoleApp.Turnbased.GameMain.DrawInput(7, ((y + 6) | 0), Pidroh.BaseUtils.Unicode.Escape, "RETURN", this.textWorld.mainBoard);
                    }
                }


            },
            Clear: function () {
                this.points.clear();
            },
            ResetChoice: function () {
                this.chosenOption = -1;
                this.wantToEscape = false;
            },
            Add: function (x, y) {
                this.points.add(new Pidroh.BaseUtils.Point2D.$ctor1(x, y));
                this.UpdatePoint();
            },
            ShowCursor: function (v) {
                if (v) {
                    this.cursor.Origin.DrawChar$1(64, 0, 0, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero);
                } else {
                    this.cursor.Origin.Reset();

                }
            },
            ResetCursor: function () {
                this.Move(((-this.currentPoint) | 0));
            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.PreviewSystem", {
        fields: {
            ecs: null,
            battleMain: null,
            previewActive: false,
            clonedState: null,
            battleEntity: null,
            debug: null
        },
        ctors: {
            init: function () {
                this.previewActive = false;
                this.debug = new Pidroh.BaseUtils.Debugger(true);
            },
            ctor: function (ecs, battleMain) {
                this.$initialize();
                this.ecs = ecs;
                ecs.AddCopyMethod(Pidroh.ConsoleApp.Turnbased.BattleMain.BattleEntity, function (o1, o2) {
                    var to = Bridge.as(o2, Pidroh.ConsoleApp.Turnbased.BattleMain.BattleEntity);
                    var from = Bridge.as(o1, Pidroh.ConsoleApp.Turnbased.BattleMain.BattleEntity);
                    to.pos = from.pos.$clone();
                    to.life = from.life;
                    to.maxLife = from.maxLife;
                    to.element = from.element;
                    for (var i = 0; i < to.moves.length; i = (i + 1) | 0) {
                        to.moves[System.Array.index(i, to.moves)] = from.moves[System.Array.index(i, from.moves)];
                    }
                });
                ecs.AddCopyMethod(Pidroh.ConsoleApp.Turnbased.BattleMain.BattleState, function (o1, o2) {
                    var to = Bridge.as(o2, Pidroh.ConsoleApp.Turnbased.BattleMain.BattleState);
                    var from = Bridge.as(o1, Pidroh.ConsoleApp.Turnbased.BattleMain.BattleState);
                    to.actingEntity = from.actingEntity;
                    to.BattleEndEnable = from.BattleEndEnable;
                    to.moveTick_Now = from.moveTick_Now;
                    to.moveTick_Total = from.moveTick_Total;
                    to.phase = from.phase;
                    to.turn = from.turn;
                    to.turnsPerPhase = from.turnsPerPhase;
                    to.totalTurns = from.totalTurns;
                });
                ecs.AddCopyMethod(Pidroh.BaseUtils.TimeStamp, function (o1, o2) {
                    var to = Bridge.as(o2, Pidroh.BaseUtils.TimeStamp);
                    var from = Bridge.as(o1, Pidroh.BaseUtils.TimeStamp);
                    to.CurrentSnap = from.CurrentSnap;
                });
                ecs.AddCopyMethod(Pidroh.TurnBased.TextRendering.HappHandling.HappHandleState, function (o1, o2) {
                    var to = Bridge.as(o2, Pidroh.TurnBased.TextRendering.HappHandling.HappHandleState);
                    var from = Bridge.as(o1, Pidroh.TurnBased.TextRendering.HappHandling.HappHandleState);
                    to.highestHandled = from.highestHandled;
                });
                this.battleMain = battleMain;
                this.clonedState = new Pidroh.ECS.ClonedState();
                this.battleEntity = ecs.QuickAccessor1(Pidroh.ConsoleApp.Turnbased.BattleMain.BattleEntity);
            }
        },
        methods: {
            StartPreview: function () {
                var $t, $t1;
                this.battleMain.trackBattle.Preview();
                $t = Bridge.getEnumerator(this.battleMain.entities);
                try {
                    while ($t.moveNext()) {
                        var item = $t.Current;

                        this.debug.Print$1("ALL ENTITIES BEFORE PREVIEW");
                        this.debug.Print(item);
                        this.debug.Print$1(System.Boolean.toString(item.randomPosition) + " RANDOM POS");
                        this.debug.Print$1(System.Enum.toString(Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType, item.Type) + " type");
                        this.debug.Print$1(System.Boolean.toString(item.drawTurn) + " draw turn");
                        this.debug.Print$1("END");
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }this.ecs.CloneState(this.clonedState);
                this.battleMain.battleState.BattleEndEnable = false;
                this.previewActive = true;

                $t1 = Bridge.getEnumerator(this.battleMain.entities);
                try {
                    while ($t1.moveNext()) {
                        var item1 = $t1.Current;
                        if (item1.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.hero) {
                            item1.life = 0;
                            for (var i = 0; i < item1.moves.length; i = (i + 1) | 0) {
                                item1.moves[System.Array.index(i, item1.moves)] = -1;
                            }
                        }
                    }
                } finally {
                    if (Bridge.is($t1, System.IDisposable)) {
                        $t1.System$IDisposable$Dispose();
                    }
                }this.battleMain.Tick();

            },
            EndPreview: function () {
                this.previewActive = false;

                this.ecs.RestoreState(this.clonedState);
                this.battleMain.battleState.phase = Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.PickHands;

                for (var j = 0; j < this.battleMain.entities.Count; j = (j + 1) | 0) {
                    var item = this.battleMain.entities.getItem(j);
                    var exist = false;
                    for (var i = 0; i < this.battleEntity.Count; i = (i + 1) | 0) {
                        if (Bridge.referenceEquals(item, this.battleEntity.Comp1(i))) {
                            exist = true;
                            break;
                        }
                    }
                    if (!exist) {
                        this.battleMain.entities.remove(item);
                        j = (j - 1) | 0;
                    }
                    this.debug.Print$1("ALL ENTITIES AFTER PREVIEW");
                    this.debug.Print(item);
                    this.debug.Print$1(System.Boolean.toString(item.randomPosition) + " RANDOM POS");
                    this.debug.Print$1(System.Enum.toString(Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType, item.Type) + " type");
                    this.debug.Print$1(System.Boolean.toString(item.drawTurn) + " draw turn");
                    this.debug.Print$1("END");
                }
            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.ReflectionTest", {
        ctors: {
            ctor: function () {
                this.$initialize();
                var debug = new Pidroh.BaseUtils.Debugger(true);

                var be = new Pidroh.ConsoleApp.Turnbased.BattleMain.BattleEntity();
                var type = Bridge.getType(be);
                var be2 = new Pidroh.ConsoleApp.Turnbased.BattleMain.BattleEntity();
                be2.randomPosition = true;
                debug.Print$1(Bridge.toString(Bridge.Reflection.fieldAccess(Bridge.Reflection.getMembers(type, 4, 284, "randomPosition"), be2)));
                debug.Print$1(System.Boolean.toString(be2.randomPosition) + "");
                debug.Print(be);
                Pidroh.BaseUtils.DeepCloneHelper.DeepCopyPartial(be, be2);
                Pidroh.BaseUtils.DeepCloneHelper.DeepCopyPartial(be2, be);
                debug.Print(be);
                debug.Print(be2);


                debug.Print$1(Bridge.toString(Bridge.Reflection.fieldAccess(Bridge.Reflection.getMembers(type, 4, 284, "randomPosition"), be2)));
                debug.Print$1(System.Boolean.toString(be2.randomPosition) + "");

            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.ScreenUtils");

    Bridge.define("Pidroh.TurnBased.TextRendering.UIReusable", {
        statics: {
            fields: {
                WASD: null,
                arrows: null
            },
            ctors: {
                init: function () {
                    this.WASD = "WASD";
                    this.arrows = "" + String.fromCharCode(Pidroh.BaseUtils.Unicode.Uparrow2) + String.fromCharCode(Pidroh.BaseUtils.Unicode.Leftarrow2) + String.fromCharCode(Pidroh.BaseUtils.Unicode.Downarrow2) + String.fromCharCode(Pidroh.BaseUtils.Unicode.Rightarrow2);
                }
            },
            methods: {
                DrawControlsLabel: function (textWorld, y) {
                    textWorld.mainBoard.DrawOnCenterHorizontal("Controls", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel, 0, y);

                }
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.AsyncTaskSetter$1", function (T) { return {
        inherits: [Pidroh.ConsoleApp.Turnbased.DelayedActions],
        fields: {
            ToValue: null,
            setters: null
        },
        ctors: {
            init: function () {
                this.ToValue = new (System.Collections.Generic.List$1(T)).ctor();
                this.setters = new (System.Collections.Generic.List$1(Function)).ctor();
            }
        },
        methods: {
            Add$1: function (e, setter, time) {
                this.ToValue.add(e);
                this.setters.add(setter);
                this.Add(time);
            },
            Execute: function (i) {
                this.setters.getItem(i)(this.ToValue.getItem(i));
                this.ToValue.removeAt(i);
                this.setters.removeAt(i);

            }
        }
    }; });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.BattleRender", {
        inherits: [Pidroh.ConsoleApp.Turnbased.ITextScreen_],
        statics: {
            methods: {
                ElementToAuraColor: function (element) {
                    var bc = Pidroh.TextRendering.TextBoard.INVISIBLECOLOR;
                    if (element === Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire) {
                        bc = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.FireAura;
                    }
                    if (element === Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Ice) {
                        bc = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.IceAura;
                    }
                    if (element === Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Thunder) {
                        bc = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.ThunderAura;
                    }

                    return bc;
                },
                ElementToProjColor: function (element) {
                    var bc = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.inputKey;
                    if (element === Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire) {
                        bc = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.FireShot;
                    }
                    if (element === Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Ice) {
                        bc = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.IceAura;
                    }
                    if (element === Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Thunder) {
                        bc = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.ThunderAura;
                    }

                    return bc;
                },
                DrawInput: function (x2, y2, keyUnicode, description, TextBoard) {
                    var x3 = Pidroh.ConsoleApp.Turnbased.BattleRender.DrawInpCommon(x2, y2, description, TextBoard);

                    TextBoard.DrawUnicodeLabel(keyUnicode, x3, y2, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.inputKey);
                },
                DrawInput$1: function (x2, y2, keyLabel, description, TextBoard) {
                    var x3 = Pidroh.ConsoleApp.Turnbased.BattleRender.DrawInpCommon(x2, y2, description, TextBoard);
                    TextBoard.Draw$1(keyLabel, x3, y2, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.inputKey);

                },
                DrawInpCommon: function (x2, y2, description, TextBoard) {
                    Pidroh.ConsoleApp.Turnbased.BattleRender.DrawBrownStripe(y2, TextBoard);
                    TextBoard.Draw$1(description, x2, y2, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                    var x3 = (x2 + 14) | 0;

                    var barx = (x2 + description.length) | 0;
                    TextBoard.DrawRect(Pidroh.TextRendering.TextBoard.NOCHANGECHAR, x3, y2, 6, 1, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackBattle);
                    return x3;
                },
                DrawStrippedText: function (x, y, description, TextBoard) {
                    Pidroh.ConsoleApp.Turnbased.BattleRender.DrawBrownStripe(y, TextBoard);
                    TextBoard.Draw$1(description, x, y, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                },
                DrawSubText: function (x, y, description, TextBoard) {
                    TextBoard.DrawRect(Pidroh.TextRendering.TextBoard.NOCHANGECHAR, x, y, 6, 1, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackBattle);
                    TextBoard.Draw$1(description, ((x + 1) | 0), y, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.inputKey);
                },
                DrawBrownStripe: function (yOff, textBoard) {
                    textBoard.DrawRect(Pidroh.TextRendering.TextBoard.NOCHANGECHAR, 0, yOff, textBoard.Width, 1, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackStripe);
                }
            }
        },
        fields: {
            attackPreview: null,
            Keyboard: null,
            turnBaseTry: null,
            stageData: null,
            previewSystem: null,
            moveRenders: null,
            posAnim: null,
            charByCharAnim: null,
            delayAnim: null,
            textWorld: null,
            TextBoard: null,
            inputPhases: null,
            input: 0,
            HappHandling: null,
            keyDownUnicode: 0,
            Mouse: null,
            mouseHover: null,
            miscDescriptions: null,
            moveButtons: null,
            debugOn: false,
            gridScale: 0,
            gridOffsetx: 0,
            gridOffsety: 0,
            battlerRenders: null,
            entitiesChars: null,
            MessageDoNotHide: false,
            message: null,
            waitingForMessageInput: false,
            lastPhase: 0,
            messageEnt: null,
            inputH: null,
            help: null,
            attackMenu: false
        },
        props: {
            Input: {
                get: function () {
                    return this.input;
                },
                set: function (value) {
                    this.input = value;
                }
            }
        },
        alias: [
            "Keyboard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Keyboard",
            "Input", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Input",
            "keyDownUnicode", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$keyDownUnicode",
            "Mouse", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Mouse",
            "Draw", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Draw",
            "GetBoard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$GetBoard"
        ],
        ctors: {
            init: function () {
                this.inputPhases = function (_o1) {
                        _o1.add(Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.PickHands);
                        _o1.add(Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.ConfirmInput);
                        return _o1;
                    }(new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase)).ctor());
                this.keyDownUnicode = -1;
                this.miscDescriptions = function (_o2) {
                        _o2.add(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Done, "DONE");
                        _o2.add(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Redo, "REDO");
                        _o2.add(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Help, "HELP");
                        _o2.add(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Preview, "PREVIEW");
                        _o2.add(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Confirm, "CONFIRM");
                        _o2.add(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Cancel, "CANCEL");
                        _o2.add(Pidroh.ConsoleApp.Turnbased.MiscBattleInput.LeaveAttackDemonstration, "END PREVIEW");
                        return _o2;
                    }(new (System.Collections.Generic.Dictionary$2(Pidroh.ConsoleApp.Turnbased.MiscBattleInput,System.String))());
                this.debugOn = true;
                this.gridScale = 5;
                this.gridOffsetx = 2;
                this.gridOffsety = 1;
                this.inputH = new Pidroh.TurnBased.TextRendering.InputHandling();
                this.attackMenu = false;
            },
            ctor: function (battleLogic, stageData, PreviewSystem, entityTexts, moveRenders) {
                var $t;
                this.$initialize();


                this.entitiesChars = System.Array.init(entityTexts.Count, null, System.Array.type(System.Char));
                for (var i = 0; i < entityTexts.Count; i = (i + 1) | 0) {
                    this.entitiesChars[System.Array.index(i, this.entitiesChars)] = ($t = entityTexts.getItem(i), System.String.toCharArray($t, 0, $t.length));
                }

                this.turnBaseTry = battleLogic;
                this.stageData = stageData;
                this.previewSystem = PreviewSystem;
                this.moveRenders = moveRenders;
                this.textWorld = new Pidroh.TextRendering.TextWorld();
                this.posAnim = this.textWorld.AddAnimation(Bridge.global.Pidroh.TextRendering.PositionAnimation, new Pidroh.TextRendering.PositionAnimation());
                this.charByCharAnim = this.textWorld.AddAnimation(Bridge.global.Pidroh.TextRendering.CharByCharAnimation, new Pidroh.TextRendering.CharByCharAnimation());
                this.delayAnim = this.textWorld.AddAnimation(Bridge.global.Pidroh.TextRendering.DelaysAnimation, new Pidroh.TextRendering.DelaysAnimation());
                this.textWorld.Init(Pidroh.ConsoleApp.Turnbased.GameMain.Width, Pidroh.ConsoleApp.Turnbased.GameMain.Height);
                this.TextBoard = this.textWorld.mainBoard;

                var blinkAnim = this.textWorld.AddAnimation(Bridge.global.Pidroh.TextRendering.BlinkAnim, new Pidroh.TextRendering.BlinkAnim());

                this.battlerRenders = new (System.Collections.Generic.List$1(Pidroh.TextRendering.TextEntity)).ctor();
                this.UpdateBattleRenderCount();


                this.messageEnt = this.textWorld.GetFreeEntity(40, 4);

                this.turnBaseTry.happManager.AddHandler(new Pidroh.ConsoleApp.Turnbased.Happs.HappHandler(Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.HappTag.AttackHit, Pidroh.ConsoleApp.Turnbased.BattleMain.HappTag, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.HappTag)), Bridge.fn.bind(this, function (h) {
                    var attacker = this.turnBaseTry.entities.getItem(h.GetAttribute_Int(1));
                    var defenderEID = h.GetAttribute_Int(0);
                    var defender = null;
                    if (defenderEID >= 0) {
                        defender = this.turnBaseTry.entities.getItem(defenderEID);
                    }
                    var element = h.GetAttribute_Int(2);
                    var fe = this.GetProjTextEntity(element);

                    if (defender != null) {
                        var pos = attacker.PositionV2D.$clone();
                        var pos2 = defender.PositionV2D.$clone();
                        var xDis = Math.abs(pos.X - pos2.X);
                        var time = xDis * 0.1;


                        this.posAnim.Add$1(fe.AnimBase(time), new Pidroh.TextRendering.PositionAnimation.PositionData.$ctor1(this.BattleEntityToScreenPosition(attacker.PositionV2D.$clone()), this.BattleEntityToScreenPosition(defender.PositionV2D.$clone())));
                    } else {
                        var pos1 = attacker.PositionV2D.$clone();
                        var pos21 = pos1.$clone();
                        if (attacker.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                            pos21.X = -1;
                        } else {
                            pos21.X = 6;
                        }
                        var xDis1 = Math.abs(pos1.X - pos21.X);
                        var time1 = xDis1 * 0.1;
                        this.posAnim.Add$1(fe.AnimBase(time1), new Pidroh.TextRendering.PositionAnimation.PositionData.$ctor1(this.BattleEntityToScreenPosition(pos1.$clone()), this.BattleEntityToScreenPosition(pos21.$clone())));
                    }




                })));

                this.turnBaseTry.happManager.AddHandler(new Pidroh.ConsoleApp.Turnbased.Happs.HappHandler(Bridge.box(Pidroh.ConsoleApp.Turnbased.BattleMain.HappTag.AttackMiss, Pidroh.ConsoleApp.Turnbased.BattleMain.HappTag, System.Enum.toStringFn(Pidroh.ConsoleApp.Turnbased.BattleMain.HappTag)), Bridge.fn.bind(this, function (h) {

                    var attacker = this.turnBaseTry.entities.getItem(h.GetAttribute_Int(0));
                    var element = h.GetAttribute_Int(1);
                    var fe = this.GetProjTextEntity(element);
                    var pos = attacker.PositionV2D.$clone();
                    var pos2 = pos.$clone();
                    if (attacker.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                        pos2.X = -1;
                    } else {
                        pos2.X = 6;
                    }
                    var xDis = Math.abs(pos.X - pos2.X);
                    var time = xDis * 0.1;
                    this.posAnim.Add$1(fe.AnimBase(time), new Pidroh.TextRendering.PositionAnimation.PositionData.$ctor1(this.BattleEntityToScreenPosition(pos.$clone()), this.BattleEntityToScreenPosition(pos2.$clone())));
                })));





                var mesOnPos = new Pidroh.TurnBased.TextRendering.MessageOnPosition(this);

                for (var i1 = 0; i1 < this.turnBaseTry.entities.Count; i1 = (i1 + 1) | 0) {
                    var e = this.turnBaseTry.entities.getItem(i1);
                    if (e.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.hero) {
                        var pos = this.battlerRenders.getItem(i1).GetPosition();
                    }
                }


            }
        },
        methods: {
            EntityScreenPosition: function (user) {
                return this.BattleEntityToScreenPosition(this.turnBaseTry.entities.getItem(user).pos.$clone());
            },
            GetGridRect: function () {
                return new Pidroh.BaseUtils.Rect.$ctor1(this.gridOffsetx, this.gridOffsety, Bridge.Int.mul(this.gridScale, 6), Bridge.Int.mul(this.gridScale, 3));
            },
            UpdateBattleRenderCount: function () {
                while (this.battlerRenders.Count < this.turnBaseTry.entities.Count) {
                    var item = this.textWorld.GetFreeEntity(2, 2);
                    this.battlerRenders.add(item);
                    item.SetPosition$1(this.BattleEntityToScreenPosition(this.turnBaseTry.entities.getItem(((this.battlerRenders.Count - 1) | 0)).pos.$clone()));

                }
                if (this.battlerRenders.Count > this.turnBaseTry.entities.Count) {
                    for (var i = this.turnBaseTry.entities.Count; i < this.battlerRenders.Count; i = (i + 1) | 0) {
                        this.battlerRenders.getItem(i).Origin.ResetInvisible();
                    }
                }
            },
            GetEntityName: function (user) {
                var gameEntity = this.turnBaseTry.entities.getItem(user);
                var chars = this.GetChar(gameEntity);
                var name = System.String.fromCharArray(chars);
                if (gameEntity.graphicRepeatedIndex > 0) {
                    return (name || "") + (((gameEntity.graphicRepeatedIndex + 1) | 0));
                } else {
                    return name;
                }


            },
            GetProjTextEntity: function (element) {
                var fe = this.textWorld.GetTempEntity(1, 1);
                fe.Origin.DrawChar(Pidroh.TextRendering.TextBoard.INVISIBLECHAR, 0, 0);
                var elementColor = Pidroh.ConsoleApp.Turnbased.BattleRender.ElementToProjColor(element);
                fe.Origin.SetBackColor(elementColor, 0, 0);
                return fe;
            },
            Draw: function (delta) {

                var input = this.Input;
                if (input !== Pidroh.ConsoleApp.Turnbased.BattleRender.InputKey.NONE && this.waitingForMessageInput) {
                    this.waitingForMessageInput = false;
                    this.message = null;
                }

                if (this.lastPhase !== this.turnBaseTry.battleState.phase) {
                    if (this.turnBaseTry.battleState.phase === Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.PickHands) {

                    }
                    if (this.lastPhase === Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.PickHands) {
                        this.HideMessage();
                    }
                }
                this.lastPhase = this.turnBaseTry.battleState.phase;
                if (this.inputPhases.contains(this.turnBaseTry.battleState.phase)) {
                    if (this.keyDownUnicode >= 0) {
                        if (this.keyDownUnicode === 112) {
                            this.previewSystem.StartPreview();
                            return;
                        }
                        if (this.keyDownUnicode === 101 && this.HasAttacks()) {
                            this.attackMenu = !this.attackMenu;

                        }

                        if (this.attackMenu && this.keyDownUnicode === Pidroh.BaseUtils.Unicode.Escape) {
                            this.attackMenu = false;
                        }
                        var inputX = this.inputH.Inputted(this.keyDownUnicode, this.turnBaseTry.inputs);
                        if (inputX.type === Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle && inputX.arg1 === Pidroh.ConsoleApp.Turnbased.MiscBattleInput.Help) {
                            this.help.Show(this);
                        }

                        if (inputX.type !== Pidroh.ConsoleApp.Turnbased.InputType.None) {

                            this.turnBaseTry.InputDone(inputX);
                        }

                    }
                    if (this.Keyboard.downUnicodes.contains(99)) {
                        this.attackMenu = false;
                    } else {
                        this.attackMenu = true;
                    }
                    if (this.turnBaseTry.inputs.inputForConfirmation.type !== Pidroh.ConsoleApp.Turnbased.InputType.None) {
                        if (false) {
                            this.attackPreview.ShowPreview(0, this.turnBaseTry.inputs.inputForConfirmation.arg1);
                            this.turnBaseTry.ConfirmInputStart();
                        } else {
                            this.attackPreview.End();
                            this.turnBaseTry.InputConfirmed();
                        }

                    } else {
                        this.attackPreview.End();
                    }


                }
                this.UpdateBattleRenderCount();
                this.DrawGraphics(delta);
                if (this.CanAdvance_Logic()) {
                    if (this.turnBaseTry.battleState.phase !== Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.ExecuteMove && this.previewSystem.previewActive) {
                        this.previewSystem.EndPreview();
                    }
                    switch (this.turnBaseTry.battleState.phase) {
                        case Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.EnemyMoveChoice: 
                            this.turnBaseTry.Tick();
                            break;
                        case Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.HandRecharge: 
                            this.turnBaseTry.Tick();
                            break;
                        case Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.PickHands: 
                            break;
                        case Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.ExecuteMove: 
                            this.turnBaseTry.Tick();
                            break;
                        default: 
                            break;
                    }
                }

            },
            CanAdvanceGraphics: function () {
                return this.textWorld.IsDone() && !this.waitingForMessageInput;
            },
            CanAdvance_Logic: function () {
                return this.CanAdvanceGraphics() && this.HappHandling.IsDone();
            },
            ShowMessage: function (s, waitForInput, doNotHide) {
                if (waitForInput === void 0) { waitForInput = true; }
                if (doNotHide === void 0) { doNotHide = false; }
                this.MessageDoNotHide = doNotHide;
                this.message = s;
                this.messageEnt.Origin.ResetInvisible();
                var timeToWrite = this.message.length * 0.015;
                if (timeToWrite > 0.4) {
                    timeToWrite = 0.4;
                }
                this.charByCharAnim.Add$1(this.messageEnt.AnimBase(timeToWrite), new Pidroh.TextRendering.CharByCharAnimation.CharByCharData(0, ((this.message.length + 1) | 0)));
                this.delayAnim.Delay(timeToWrite + 0.8);

            },
            HideMessage: function () {
                this.message = null;
                this.waitingForMessageInput = false;
            },
            ShowBattleMessage: function (s) {
                if (!this.turnBaseTry.BattleDecided()) {
                    this.ShowMessage(s);
                }
            },
            DrawGraphics: function (delta) {
                this.mouseHover.mouseHovers.clear();
                this.turnBaseTry.Update(delta);
                this.TextBoard.Reset();

                if (this.inputPhases.contains(this.turnBaseTry.battleState.phase)) {
                    this.TextBoard.SetAll(Pidroh.TextRendering.TextBoard.NOCHANGECHAR, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackgroundInput);
                }

                var controlsY = (((((Bridge.Int.mul(this.gridScale, 3) + 10) | 0) + 3) | 0) + 2) | 0;

                var enemyGridOffX = Bridge.Int.mul(this.gridScale, 3);
                var drawDot = false;
                this.TextBoard.DrawRepeated(32, this.gridOffsetx, this.gridOffsety, Bridge.Int.mul(this.gridScale, 6), Bridge.Int.mul(this.gridScale, 3), Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackBattle);
                for (var i = 0; i < Bridge.Int.mul(3, this.gridScale); i = (i + 1) | 0) {
                    for (var j = 0; j < Bridge.Int.mul(3, this.gridScale); j = (j + 1) | 0) {
                        if (drawDot) {
                            this.TextBoard.DrawChar$1(46, ((this.gridOffsetx + i) | 0), ((this.gridOffsety + j) | 0), Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero);
                            this.TextBoard.DrawChar$1(46, ((((this.gridOffsetx + i) | 0) + enemyGridOffX) | 0), ((this.gridOffsety + j) | 0), Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridEnemy);
                        }
                        if (i % this.gridScale === 0 && j % this.gridScale === 0) {

                            this.TextBoard.DrawGrid(((((i + this.gridOffsetx) | 0) + enemyGridOffX) | 0), ((j + this.gridOffsety) | 0), this.gridScale, this.gridScale, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridEnemy);
                            this.TextBoard.DrawGrid(((i + this.gridOffsetx) | 0), ((j + this.gridOffsety) | 0), this.gridScale, this.gridScale, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero);
                        }
                    }
                }

                for (var i1 = 0; i1 < this.turnBaseTry.entities.Count; i1 = (i1 + 1) | 0) {

                    var gameEntity = this.turnBaseTry.entities.getItem(i1);

                    var ec = this.GetChar(gameEntity);

                    var pos = gameEntity.PositionV2D.$clone();
                    var screenPos = this.BattleEntityToScreenPosition(pos);
                    if (gameEntity.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.paneleffect) {
                        screenPos.Y = screenPos.Y + 1;
                        screenPos.X = screenPos.X - 1;
                    }
                    if (this.textWorld.IsDone() && this.HappHandling.IsDone()) {
                        this.battlerRenders.getItem(i1).Origin.Position = screenPos.$clone();
                    }
                    if (Pidroh.BaseUtils.Vector2D.op_Inequality(this.battlerRenders.getItem(i1).Origin.Position.$clone(), screenPos.$clone()) && this.textWorld.IsDone()) {
                    }

                    var c = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero;
                    if (gameEntity.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                        c = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Enemy;
                    }
                    if (gameEntity.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.pickup) {
                        c = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.inputKey;
                    }
                    if (gameEntity.Dead) {
                        c = Pidroh.TextRendering.TextBoard.INVISIBLECOLOR;
                    }
                    var bc = Pidroh.TextRendering.TextBoard.INVISIBLECOLOR;

                    if (gameEntity.Alive) {
                        var element = gameEntity.element;
                        if (element !== Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Nothingness) {
                            c = Pidroh.ConsoleApp.Turnbased.BattleRender.ElementToAuraColor(element);
                        }

                    }
                    if (gameEntity.Dead) {
                        for (var j1 = 0; j1 < ((ec.length + 1) | 0); j1 = (j1 + 1) | 0) {
                            this.battlerRenders.getItem(i1).Origin.DrawChar$1(Pidroh.TextRendering.TextBoard.INVISIBLECHAR, j1, 0, c, bc);
                        }

                    } else {
                        this.battlerRenders.getItem(i1).Origin.Draw(ec, 0, 0, c, bc);
                        if (gameEntity.graphicRepeatedIndex > 0) {
                            this.battlerRenders.getItem(i1).Origin.DrawOneDigit(((gameEntity.graphicRepeatedIndex + 1) | 0), ((0 + ec.length) | 0), 0, c, bc);
                        }
                    }


                }


                var textBoardHeight = Bridge.Int.mul(3, this.gridScale);

                {

                    var x = 3;

                    if (this.inputPhases.contains(this.turnBaseTry.battleState.phase)) {
                        this.DrawControls(controlsY, 7);
                        if (this.turnBaseTry.timeToChoose > 0) {
                            var ratio = this.turnBaseTry.timeToChoose / this.turnBaseTry.timeToChooseMax;
                            this.TextBoard.DrawRepeated(32, x, ((controlsY + 16) | 0), Bridge.Int.clip32(ratio * 15), 1, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Board, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero);
                        }
                    } else {
                        this.TextBoard.DrawRepeated(32, ((x - 1) | 0), ((controlsY - 1) | 0), 15, 15, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Board);
                    }
                }

                var turnOrderX = (Bridge.Int.mul(6, this.gridScale) + 5) | 0;
                var turnOrderY = 2;
                turnOrderX = 2;
                turnOrderY = (Bridge.Int.mul(3, this.gridScale) + 1) | 0;
                if (this.inputPhases.contains(this.turnBaseTry.battleState.phase)) {
                    turnOrderY = (turnOrderY + 3) | 0;
                }

                this.DrawTurnOrder(turnOrderX, turnOrderY);
                if (!this.stageData.hideLifeUI) {
                    this.DrawLife(((turnOrderX + 14) | 0), turnOrderY);
                }

                {
                    var X = 2;
                    this.messageEnt.SetPosition$2(X, ((controlsY - 2) | 0));
                    if (this.message != null && (!this.CanAdvanceGraphics())) {
                        this.messageEnt.Origin.DrawWithLinebreaks(this.message, 1, 0, 1, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.HeroTurn);
                    } else {
                        if (!this.MessageDoNotHide) {
                            this.message = null;
                            this.messageEnt.Origin.SetAll(Pidroh.TextRendering.TextBoard.INVISIBLECHAR);
                        }

                    }
                }
                this.TextBoard.CursorNewLine(1);
                this.TextBoard.CursorNewLine(1);


                this.textWorld.DrawChildren();
                this.textWorld.TryEndAnimations();
                this.textWorld.AdvanceTime(delta);

                if (this.CanAdvanceGraphics()) {
                    this.HappHandling.Handle();
                    if (this.CanAdvanceGraphics()) {
                        this.turnBaseTry.happManager.TryHandle();
                    }
                }

            },
            BattleEntityToScreenPosition: function (pos) {
                var x = pos.X;
                var y = pos.Y;
                var screenPos = new Pidroh.BaseUtils.Vector2D.$ctor2(x * this.gridScale + ((Bridge.Int.div(this.gridScale, 2)) | 0) + this.gridOffsetx, Bridge.Int.mul(2, this.gridScale) - y * this.gridScale + ((Bridge.Int.div(this.gridScale, 2)) | 0) + this.gridOffsety);
                return screenPos.$clone();
            },
            DrawControls: function (y, x) {
                this.TextBoard.SetCursorAt(((x + 5) | 0), y);
                this.TextBoard.Draw_Cursor$3("Controls", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel);
                this.TextBoard.CursorNewLine(x);


                var yOff = 0;

                if (!this.attackMenu) {
                    yOff = this.DrawInputs_Fix(y, x, Pidroh.ConsoleApp.Turnbased.InputTags.MOVEFIX, yOff);



                    yOff = this.DrawInputs_Fix(y, x, Pidroh.ConsoleApp.Turnbased.InputTags.MISC, yOff);
                    return;
                }




                var attackNumber = 1;
                for (var i = 0; i < this.turnBaseTry.inputs.inputs.Count; i = (i + 1) | 0) {
                    var x2 = x;
                    var y2 = (((y + 2) | 0) + yOff) | 0;
                    var input = this.turnBaseTry.inputs.inputs.getItem(i);

                    if (this.turnBaseTry.inputs.TagIs(i, Pidroh.ConsoleApp.Turnbased.InputTags.MOVEUNFIX)) {
                        yOff = (yOff + 1) | 0;
                        yOff = (yOff + 1) | 0;
                        var unicode = (48 + attackNumber) | 0;
                        attackNumber = (attackNumber + 1) | 0;
                        this.mouseHover.mouseHovers.add(new Pidroh.TextRendering.GameScreen.MouseHover.$ctor1(new Pidroh.BaseUtils.Rect.$ctor1(((x2 - 2) | 0), y2, 20, 1), 0, input.arg1));


                        var description = "";
                        if (input.type === Pidroh.ConsoleApp.Turnbased.InputType.Move) {
                            if (input.arg1 >= 0) {
                                var m = input.arg1;

                                description = this.moveRenders.getItem(input.arg1).Label;
                                if (description == null) {
                                    description = System.Enum.toString(Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType, m);
                                }
                            }


                        }
                        if (input.type === Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle) {
                            var arg1 = input.arg1;
                            description = this.miscDescriptions.get(arg1);
                        }
                        var TextBoard = this.TextBoard;
                        Pidroh.ConsoleApp.Turnbased.GameMain.DrawInput(x2, y2, unicode, description, TextBoard);

                    }

                }
                if (this.PreviewVisible()) {
                    Pidroh.ConsoleApp.Turnbased.GameMain.DrawInput(x, ((((y + 2) | 0) + yOff) | 0), 112, "PREVIEW", this.TextBoard);
                } else {
                    Pidroh.ConsoleApp.Turnbased.BattleRender.DrawInput$1(x, ((((y + 2) | 0) + yOff) | 0), "", "", this.TextBoard);
                }
                yOff = (yOff + 2) | 0;
                Pidroh.ConsoleApp.Turnbased.GameMain.DrawInput(x, ((((y + 2) | 0) + yOff) | 0), 99, "CONTROLS", this.TextBoard);
            },
            HasAttacks: function () {
                for (var i = 0; i < this.turnBaseTry.inputs.inputs.Count; i = (i + 1) | 0) {
                    if (this.turnBaseTry.inputs.TagIs(i, Pidroh.ConsoleApp.Turnbased.InputTags.MOVEUNFIX)) {
                        return true;
                    }
                }
                return false;
            },
            PreviewVisible: function () {
                var $t;
                $t = Bridge.getEnumerator(this.turnBaseTry.entities);
                try {
                    while ($t.moveNext()) {
                        var e = $t.Current;
                        if (e.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                            return true;
                        }
                    }
                } finally {
                    if (Bridge.is($t, System.IDisposable)) {
                        $t.System$IDisposable$Dispose();
                    }
                }return false;
            },
            DrawInputs_Fix: function (y, x, inputTag, yOff) {

                for (var i = 0; i < this.turnBaseTry.inputs.inputs.Count; i = (i + 1) | 0) {
                    var x2 = x;
                    var y2 = (((y + 2) | 0) + yOff) | 0;
                    var input = this.turnBaseTry.inputs.inputs.getItem(i);

                    if (this.turnBaseTry.inputs.TagIs(i, inputTag)) {
                        var unicode = this.inputH.GetFixedMoveUnicode(input);
                        var forceInputLabel = null;
                        var forceCommandLabel = null;
                        var movementCommand = unicode === 119;
                        if (movementCommand) {
                            forceInputLabel = Pidroh.TurnBased.TextRendering.UIReusable.WASD;
                            forceCommandLabel = Pidroh.TurnBased.TextRendering.UIReusable.arrows;
                        }
                        if (unicode === 97 || unicode === 115 || unicode === 100) {
                            continue;
                        }
                        yOff = (yOff + 1) | 0;
                        yOff = (yOff + 1) | 0;





                        var description = "";
                        if (input.type === Pidroh.ConsoleApp.Turnbased.InputType.Move) {
                            if (forceCommandLabel != null) {
                                description = forceCommandLabel;
                            } else {
                                description = this.moveRenders.getItem(input.arg1).Label;
                            }


                        }
                        if (input.type === Pidroh.ConsoleApp.Turnbased.InputType.MiscBattle) {
                            var arg1 = input.arg1;
                            description = this.miscDescriptions.get(arg1);
                            this.mouseHover.mouseHovers.add(new Pidroh.TextRendering.GameScreen.MouseHover.$ctor1(new Pidroh.BaseUtils.Rect.$ctor1(((x2 - 2) | 0), y2, 20, 1), 1, input.arg1));
                        } else {
                            if (movementCommand) {
                                this.mouseHover.mouseHovers.add(new Pidroh.TextRendering.GameScreen.MouseHover.$ctor1(new Pidroh.BaseUtils.Rect.$ctor1(((x2 - 2) | 0), y2, 20, 1), 2, 0));
                            } else {
                                this.mouseHover.mouseHovers.add(new Pidroh.TextRendering.GameScreen.MouseHover.$ctor1(new Pidroh.BaseUtils.Rect.$ctor1(((x2 - 2) | 0), y2, 20, 1), 0, input.arg1));
                            }
                        }
                        var TextBoard = this.TextBoard;
                        if (forceInputLabel == null) {
                            Pidroh.ConsoleApp.Turnbased.BattleRender.DrawInput(x2, y2, unicode, description, TextBoard);
                        } else {
                            Pidroh.ConsoleApp.Turnbased.BattleRender.DrawInput$1(x2, y2, forceInputLabel, description, TextBoard);
                        }


                    }

                }

                return yOff;
            },
            DrawLife: function (turnOrderX, turnOrderY) {
                this.TextBoard.SetCursorAt(((turnOrderX + 1) | 0), turnOrderY);
                if (this.turnBaseTry.battleState.phase === Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.PickHands) {
                    this.TextBoard.Draw_Cursor$3("Life", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel);
                }
                this.TextBoard.SetCursorAt(((turnOrderX + 8) | 0), turnOrderY);
                if (this.turnBaseTry.battleState.phase === Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.PickHands) {
                    this.TextBoard.Draw_Cursor$3("Element", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel);
                }
                var index = -1;
                for (var i = 0; i < 4; i = (i + 1) | 0) {
                    var xOff = (turnOrderX + 1) | 0;
                    var yOff = (((turnOrderY + 2) | 0) + Bridge.Int.mul(i, 2)) | 0;
                    this.TextBoard.DrawRect(Pidroh.TextRendering.TextBoard.NOCHANGECHAR, xOff, yOff, 4, 1, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackBattle);
                    this.TextBoard.DrawRect(Pidroh.TextRendering.TextBoard.NOCHANGECHAR, ((xOff + 7) | 0), yOff, 8, 1, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackBattle);
                }
                for (var i1 = 0; i1 < this.turnBaseTry.entities.Count; i1 = (i1 + 1) | 0) {
                    if (i1 >= this.turnBaseTry.entities.Count) {
                        continue;
                    }
                    var e = this.turnBaseTry.entities.getItem(i1);
                    if (!e.drawLife) {
                        continue;
                    }
                    if (!e.Dead) {
                        index = (index + 1) | 0;
                        var xOff1 = (turnOrderX + 1) | 0;
                        var yOff1 = (((turnOrderY + 2) | 0) + Bridge.Int.mul(index, 2)) | 0;
                        var color = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.HeroTurn;
                        if (e.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                            color = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.EnemyTurn;
                        }
                        if (e.element !== Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Nothingness) {
                            color = Pidroh.ConsoleApp.Turnbased.BattleRender.ElementToAuraColor(e.element);
                        }

                        this.TextBoard.DrawTwoDigits(e.life, xOff1, yOff1, color);
                        var element = "";
                        switch (e.element) {
                            case Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Fire: 
                                element = "Fire";
                                break;
                            case Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Ice: 
                                element = "Ice";
                                break;
                            case Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Thunder: 
                                element = "Thunder";
                                break;
                            case Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Nothingness: 
                                break;
                            default: 
                                break;
                        }
                        var eColor = Pidroh.ConsoleApp.Turnbased.BattleRender.ElementToAuraColor(e.element);

                        this.TextBoard.Draw$1(element, ((xOff1 + 7) | 0), yOff1, eColor);
                    }


                }
            },
            DrawBrownStripe: function (yOff) {
                Pidroh.ConsoleApp.Turnbased.BattleRender.DrawBrownStripe(yOff, this.TextBoard);
            },
            DrawTurnOrder: function (turnOrderX, turnOrderY, horizontal) {
                if (horizontal === void 0) { horizontal = true; }
                var turnsPerPhase = this.turnBaseTry.battleState.turnsPerPhase;
                this.TextBoard.SetCursorAt(((turnOrderX + 3) | 0), turnOrderY);
                if (this.turnBaseTry.battleState.phase === Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.PickHands) {
                    this.TextBoard.Draw_Cursor$3("Turn", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel);
                }

                var drawingId = -1;
                for (var i = 0; i < 4; i = (i + 1) | 0) {
                    var yOff = (((turnOrderY + 2) | 0) + Bridge.Int.mul(i, 2)) | 0;
                    Pidroh.ConsoleApp.Turnbased.BattleRender.DrawBrownStripe(yOff, this.TextBoard);
                    for (var j = 0; j < 3; j = (j + 1) | 0) {
                        var xOff = (((turnOrderX + Bridge.Int.mul(j, 3)) | 0) + 3) | 0;


                        this.TextBoard.DrawRect(Pidroh.TextRendering.TextBoard.NOCHANGECHAR, xOff, yOff, 2, 1, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackBattle);
                    }
                }
                for (var i1 = 0; i1 < this.turnBaseTry.entities.Count; i1 = (i1 + 1) | 0) {

                    var e = this.turnBaseTry.entities.getItem(i1);
                    if (!e.drawTurn) {
                        continue;
                    }
                    if (!e.Dead) {
                        drawingId = (drawingId + 1) | 0;
                        var color = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.HeroTurn;
                        if (e.Type === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                            color = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.EnemyTurn;
                        }
                        if (e.element !== Pidroh.ConsoleApp.Turnbased.BattleMain.Element.Nothingness) {
                            color = Pidroh.ConsoleApp.Turnbased.BattleRender.ElementToAuraColor(e.element);
                        }

                        var xOff1 = (((turnOrderX + 1) | 0) + Bridge.Int.mul(drawingId, 3)) | 0;
                        var yEntity = (turnOrderY + 2) | 0;
                        var yFirstMove = (turnOrderY + 3) | 0;
                        var xFirstMove = xOff1;
                        if (horizontal) {
                            xOff1 = turnOrderX;
                            yEntity = (((turnOrderY + 2) | 0) + Bridge.Int.mul(drawingId, 2)) | 0;
                            yFirstMove = yEntity;
                            xFirstMove = (turnOrderX + 3) | 0;
                        }
                        this.DrawEntityChar(e, color, xOff1, yEntity);

                        this.TextBoard.SetCursorAt(xFirstMove, yFirstMove);

                        for (var i2 = 0; i2 < Pidroh.ConsoleApp.Turnbased.Value.op_Implicit(turnsPerPhase); i2 = (i2 + 1) | 0) {
                            var color2 = color;
                            var backColor = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackCommand;
                            if (this.turnBaseTry.battleState.phase === Pidroh.ConsoleApp.Turnbased.BattleMain.BattlePhase.ExecuteMove) {
                                if (drawingId === this.turnBaseTry.battleState.actingEntity && i2 === Pidroh.ConsoleApp.Turnbased.Value.op_Implicit(this.turnBaseTry.battleState.turn)) {
                                } else {
                                    backColor = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackBattle;
                                    color2 = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription;
                                }

                            }

                            if (i2 < Pidroh.ConsoleApp.Turnbased.Value.op_Implicit(turnsPerPhase)) {
                                var c = this.GetCharOfMove(e, i2);
                                this.mouseHover.mouseHovers.add(new Pidroh.TextRendering.GameScreen.MouseHover.$ctor1(new Pidroh.BaseUtils.Rect.$ctor1(this.TextBoard.CursorX, this.TextBoard.CursorY, c.length, 1), 0, e.moves[System.Array.index(i2, e.moves)]));

                                this.TextBoard.Draw_Cursor$3(c, color2);
                                if (horizontal) {
                                    for (var j1 = c.length; j1 < 3; j1 = (j1 + 1) | 0) {
                                        this.TextBoard.AdvanceCursor();
                                    }




                                }

                            } else {
                                this.TextBoard.Draw_Cursor$1(32, color, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackCommand);
                            }
                            if (horizontal) {

                            } else {
                                this.TextBoard.CursorNewLine(xFirstMove);
                            }
                        }
                    }


                }
            },
            DrawEntityChar: function (e, color, x, y) {
                var chars = this.GetChar(e);

                this.TextBoard.Draw(chars, x, y, color);
                if (e.graphicRepeatedIndex > 0) {
                    this.TextBoard.DrawOneDigit(((e.graphicRepeatedIndex + 1) | 0), ((x + chars.length) | 0), y, color);
                }
            },
            GetCharOfMove: function (e, i2) {


                var val = e.moves[System.Array.index(i2, e.moves)];
                if (val >= 0) {
                    return this.moveRenders.getItem(val).Abrev;
                } else {
                    return " ";
                }
            },
            GetChar: function (gameEntity) {
                return this.entitiesChars[System.Array.index(gameEntity.graphic, this.entitiesChars)];

            },
            DrawMove$1: function (move, color) {
                if (move.Val >= 0) {
                    var m = Bridge.Int.clip32(move.Val);
                    this.DrawMove(m, color);
                } else {
                    this.TextBoard.Draw_Cursor(32);
                }

            },
            DrawMove: function (move, color) {
                var c = this.moveRenders.getItem(move).Abrev;
                this.TextBoard.Draw_Cursor$3(c, color);
            },
            GetBoard: function () {
                return this.TextBoard;
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.GameMain", {
        inherits: [Pidroh.ConsoleApp.Turnbased.ITextScreen_],
        statics: {
            fields: {
                Width: 0,
                Height: 0
            },
            ctors: {
                init: function () {
                    this.Width = 35;
                    this.Height = 46;
                }
            },
            methods: {
                DrawInput: function (x2, y2, unicode, description, textBoard) {
                    Pidroh.ConsoleApp.Turnbased.BattleRender.DrawInput(x2, y2, unicode, description, textBoard);
                }
            }
        },
        fields: {
            battleMain: null,
            battleRender: null,
            modeSelectionScreen: null,
            mainDraw: null,
            beforeLevelMenuScreen: null,
            helpScreen: null,
            helpInt: null,
            resultScreen: null,
            stageId: 0,
            mouseHover: null,
            stageToBattle: null,
            stageProgressPersistence: null,
            Keyboard: null,
            stageGroupNav: null,
            movePreviewCounter: 0,
            aux: null,
            Mouse: null,
            remap: null,
            stageSelecScreen: null,
            attackInventory: null,
            currencyHolder: null,
            equipScreen: null,
            stageEntity: null
        },
        props: {
            Input: {
                get: function () {
                    return 99;
                },
                set: function (value) {
                    this.mainDraw.Pidroh$ConsoleApp$Turnbased$ITextScreen_$Input = value;
                }
            },
            keyDownUnicode: {
                get: function () {
                    return 99;
                },
                set: function (value) {
                    value = this.remap.Remap(value);
                    this.mainDraw.Pidroh$ConsoleApp$Turnbased$ITextScreen_$keyDownUnicode = value;
                }
            }
        },
        alias: [
            "Keyboard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Keyboard",
            "Input", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Input",
            "keyDownUnicode", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$keyDownUnicode",
            "Mouse", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Mouse",
            "Draw", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Draw",
            "GetBoard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$GetBoard"
        ],
        ctors: {
            init: function () {
                this.stageEntity = new Pidroh.ECS.Entity();
                this.helpInt = new Pidroh.TurnBased.TextRendering.HelpScreenIntegration();
                this.stageToBattle = new Pidroh.ConsoleApp.Turnbased.StageToBattle();
                this.stageProgressPersistence = new (System.Collections.Generic.List$1(Pidroh.ConsoleApp.Turnbased.StageProgressPersistence)).ctor();
                this.Keyboard = new Pidroh.TextRendering.GameScreen.KeyboardIO();
                this.movePreviewCounter = -1;
                this.aux = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.Mouse = new Pidroh.TextRendering.GameScreen.MouseIO();
                this.remap = new Pidroh.TextRendering.GameScreen.UnicodeRemap();
            },
            ctor: function () {
                var $t, $t1, $t2;
                this.$initialize();
                this.modeSelectionScreen = new Pidroh.TurnBased.TextRendering.ModeSelectionScreen();
                this.stageSelecScreen = new Pidroh.TurnBased.TextRendering.StageSelectionScreen();
                this.attackInventory = new Pidroh.ConsoleApp.Turnbased.AttackInventory();
                this.currencyHolder = new Pidroh.ConsoleApp.Turnbased.CurrencyHolder();
                this.currencyHolder.currency = 200;
                for (var i = Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire; i <= Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Thunder; i = (i + 1) | 0) {
                    this.attackInventory.attackInventory.add(i);
                }
                ($t = this.attackInventory.equippedAttacks)[System.Array.index(0, $t)] = Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Fire;
                ($t1 = this.attackInventory.equippedAttacks)[System.Array.index(1, $t1)] = Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Ice;
                ($t2 = this.attackInventory.equippedAttacks)[System.Array.index(2, $t2)] = Pidroh.ConsoleApp.Turnbased.BattleMain.MoveType.Thunder;

                this.Reset();
                this.modeSelectionScreen.mode = 1;
                this.modeSelectionScreen.wannaLeave = 1;
                this.mainDraw = this.modeSelectionScreen;
                this.beforeLevelMenuScreen = new Pidroh.TurnBased.TextRendering.GenericChoiceScreen();
                this.beforeLevelMenuScreen.choices.add("Begin Stage");
                this.beforeLevelMenuScreen.choices.add("Change Attacks");
                this.beforeLevelMenuScreen.choices.add("Acquire New Attack   Cost: 100");
                this.beforeLevelMenuScreen.title = "Stage Prelude";

            }
        },
        methods: {
            Reset: function () {
                var $t, $t1, $t2;
                var wasInBeforeLevelMenu = Bridge.referenceEquals(this.mainDraw, this.beforeLevelMenuScreen);

                var moveDescriptions = System.Array.init(["", "Move up", "Move left", "Move down", "Move right", "Shoots forward", "Shoots fire forward", "Shoots ice forward", "Shoots bolt forward", "Throws ice bomb three squares forward", "Throws bolt bomb three squares forward", "Summons another enemy", "Shoot, down, shoot", "Shoots in three lines around user", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""], System.String);

                var mode = this.modeSelectionScreen.mode;
                var timeAttack = this.modeSelectionScreen.timeAttack;

                var ecs = Pidroh.ECS.ECSManager.Create();


                var sdc = new Pidroh.ConsoleApp.Turnbased.StageDataCreator(ecs);

                new Pidroh.ConsoleApp.Turnbased.ContentCreator.StageDataProcedural_A(sdc);

                var groups = ecs.QuickAccessor1(Pidroh.ConsoleApp.Turnbased.StageDataGroup);
                if (this.stageGroupNav == null) {
                    this.stageGroupNav = new Pidroh.ConsoleApp.Turnbased.StageGroupNavigator(ecs);
                }

                var group = this.stageGroupNav.currentSDG;

                this.stageSelecScreen.stageGroup = group;

                this.stageId = this.stageSelecScreen.chosenStage;
                if (this.stageSelecScreen.chosenStage < 0) {
                    this.stageId = 0;
                }
                var d = this.stageId;
                if (group.childIds.Count <= d) {
                    this.mainDraw = this.modeSelectionScreen;
                    this.modeSelectionScreen.Reset();
                    this.stageId = 0;
                    this.stageGroupNav.Backtrack();
                    this.Reset();
                    return;
                }

                var entityRenderTexts = new (System.Collections.Generic.List$1(System.String)).ctor();
                var moveCreator = new Pidroh.ConsoleApp.Turnbased.MoveCreatorProg(ecs);

                var enemyData = new Pidroh.ConsoleApp.Turnbased.EnemyDataCreator(entityRenderTexts, moveCreator);
                sdc.CalculateTrackInfo(enemyData.enemyDatas);
                sdc.InitializeProgress(this.stageProgressPersistence);

                var stageData = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.StageData, group.childIds.getItem(this.stageId).$clone());
                if (this.stageSelecScreen.chosenStage < 0) {
                    if (stageData == null) {
                        this.stageSelecScreen.ResetChoice();
                        this.stageSelecScreen.chosenStage = -1;
                    }
                } else {
                    if (stageData == null) {
                        this.stageSelecScreen.ResetChoice();
                        this.stageSelecScreen.chosenStage = -1;
                        var stageDataGroup = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.StageDataGroup, group.childIds.getItem(this.stageId).$clone());
                        this.stageSelecScreen.stageGroup = stageDataGroup;
                        this.stageGroupNav.Enter(this.stageId);
                    }

                }


                if (this.stageSelecScreen.chosenStage < 0) {
                    this.mainDraw = this.stageSelecScreen;
                    this.stageSelecScreen.ResetChoice();
                    this.stageSelecScreen.ResetCursor();
                    return;

                }


                var battleConfig = stageData.battleConfig;

                this.stageEntity = group.childIds.getItem(this.stageId).$clone();
                if (group.childIds.Count > ((this.stageId + 1) | 0)) {
                    this.stageToBattle.stageToUnlock = group.childIds.getItem(((this.stageId + 1) | 0)).$clone();
                } else {
                    this.stageToBattle.stageToUnlock = Pidroh.ECS.Entity.None.$clone();
                }
                this.stageToBattle.CurrentStage = this.stageEntity.$clone();

                var movePosition = -1;
                var spawns = stageData.spawnDatas;
                var moveDataChosenPreview = null;
                var moveDataChosenPreviewIndex = -1;
                this.aux.clear();
                if (false) {
                    $t = Bridge.getEnumerator(spawns);
                    try {
                        while ($t.moveNext()) {
                            var s = $t.Current;
                            if (s.entityType === Pidroh.ConsoleApp.Turnbased.BattleMain.EntityType.enemy) {
                                var enemy = enemyData.enemyDatas.getItem(s.id);
                                var ai = enemy.enemyAI;
                                var moves = ai.moves;
                                $t1 = Bridge.getEnumerator(moves);
                                try {
                                    while ($t1.moveNext()) {
                                        var move = $t1.Current;
                                        if (Bridge.is(move, Pidroh.ConsoleApp.Turnbased.MoveUse)) {


                                            var moveIndex = Bridge.cast(move, Pidroh.ConsoleApp.Turnbased.MoveUse).move;
                                            var moveData = moveCreator.moveDatas.getItem(moveIndex);
                                            if (!moveData.tags.contains(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Movement)) {
                                                if (!this.aux.contains(moveIndex)) {
                                                    this.aux.add(moveIndex);
                                                    movePosition = (movePosition + 1) | 0;
                                                    if (movePosition === this.movePreviewCounter) {
                                                        this.movePreviewCounter = (this.movePreviewCounter + 1) | 0;
                                                        moveDataChosenPreview = moveData;
                                                        moveDataChosenPreviewIndex = moveIndex;
                                                        break;
                                                    }
                                                }

                                            }
                                        }
                                    }
                                } finally {
                                    if (Bridge.is($t1, System.IDisposable)) {
                                        $t1.System$IDisposable$Dispose();
                                    }
                                }if (moveDataChosenPreview != null) {
                                    break;
                                }
                            }
                        }
                    } finally {
                        if (Bridge.is($t, System.IDisposable)) {
                            $t.System$IDisposable$Dispose();
                        }
                    }}


                var battleSetup = new Pidroh.ConsoleApp.Turnbased.BattleSetup(mode, ecs, enemyData, moveCreator);
                if (moveDataChosenPreview == null) {

                    battleSetup.StageInitialization(this.stageEntity.$clone(), ecs);
                    var fixedAttack = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.FixedAttackStage, this.stageEntity);
                    if (fixedAttack == null) {
                        for (var i = 0; i < this.attackInventory.equippedAttacks.length; i = (i + 1) | 0) {
                            battleSetup.SetDefaultAttack(i, ($t2 = this.attackInventory.equippedAttacks)[System.Array.index(i, $t2)]);
                        }
                    }

                } else {
                    battleSetup.AttackPreviewInitialization(moveDataChosenPreview, enemyData.startOfTutorialEnemy, moveDataChosenPreviewIndex);
                }



                this.battleMain = battleSetup.battleMain;
                var moveRenders = moveCreator.moveRenders;
                this.equipScreen = new Pidroh.TurnBased.TextRendering.EquipScreen(moveRenders);
                this.equipScreen.inventory = this.attackInventory;
                var helpModel = new Pidroh.TurnBased.TextRendering.HelpScreenModel(this.battleMain);
                this.helpScreen = new Pidroh.TurnBased.TextRendering.HelpScreen(helpModel, moveRenders, moveCreator.moveDatas);

                var ps = new Pidroh.TurnBased.TextRendering.PreviewSystem(ecs, this.battleMain);


                var timeToChoose = -1;
                if (timeAttack) {
                    timeToChoose = 30.0;

                }
                this.battleMain.timeToChooseMax = timeToChoose;
                this.battleMain.Init();



                this.battleRender = new Pidroh.ConsoleApp.Turnbased.BattleRender(this.battleMain, stageData, ps, entityRenderTexts, moveRenders);
                this.battleRender.help = this.helpInt;
                new Pidroh.TurnBased.TextRendering.AttackPreview(ecs, this.battleRender);
                new Pidroh.TurnBased.TextRendering.HappHandling(this.battleRender, battleSetup);

                if (this.helpScreen.IsWannaShowIntro()) {
                    this.helpScreen.Show();
                    this.mainDraw = this.helpScreen;
                    helpModel.battleIntroMode = true;
                } else {
                    this.mainDraw = this.battleRender;
                }

                this.resultScreen = new Pidroh.ConsoleApp.Turnbased.ResultScreen(this.battleMain.trackBattle);

                this.resultScreen.battleResult = this.battleMain.battleResult;
                this.resultScreen.moveRenders = moveRenders;

                var hoverManager = new Pidroh.TextRendering.GameScreen.MouseHoverManager(this.Mouse);
                hoverManager.mouseHovers.add(new Pidroh.TextRendering.GameScreen.MouseHover.$ctor1(new Pidroh.BaseUtils.Rect.$ctor1(5, 5, 5, 5), 0, 0));


                this.mouseHover = new Pidroh.TurnBased.TextRendering.MouseHoverText(hoverManager, this.battleRender.textWorld.GetFreeEntity(((this.battleRender.textWorld.mainBoard.Width - 2) | 0), 3), moveDescriptions);

                this.battleRender.mouseHover = hoverManager;

                var intermissionScreen = true;
                if (battleConfig != null) {
                    intermissionScreen = battleConfig.intermissionScreen;
                }
                if (!wasInBeforeLevelMenu && intermissionScreen) {
                    this.mainDraw = this.beforeLevelMenuScreen;
                    this.beforeLevelMenuScreen.SetExtraText(2, "Fragments: " + this.currencyHolder.currency);
                    this.beforeLevelMenuScreen.SetEnabled(2, this.currencyHolder.currency >= 100);
                }

            },
            Draw: function (f) {
                if (this.mouseHover != null) {
                    this.mouseHover.Update();
                }
                this.mainDraw.Pidroh$ConsoleApp$Turnbased$ITextScreen_$Draw(f);
                this.mainDraw.Pidroh$ConsoleApp$Turnbased$ITextScreen_$Mouse = this.Mouse;
                this.mainDraw.Pidroh$ConsoleApp$Turnbased$ITextScreen_$Keyboard = this.Keyboard;
                if (Bridge.referenceEquals(this.mainDraw, this.stageSelecScreen) && this.stageSelecScreen.chosenStage >= 0) {
                    this.movePreviewCounter = 0;
                    this.Reset();
                }
                if (Bridge.referenceEquals(this.mainDraw, this.beforeLevelMenuScreen)) {
                    if (this.beforeLevelMenuScreen.WannaLeave()) {
                        this.stageSelecScreen.ResetChoice();
                        this.mainDraw = this.stageSelecScreen;
                        this.beforeLevelMenuScreen.ResetChoice();
                    }
                    if (this.beforeLevelMenuScreen.chosenOption >= 0) {
                        if (this.beforeLevelMenuScreen.chosenOption === 0) {
                            this.Reset();
                        }
                        if (this.beforeLevelMenuScreen.chosenOption === 1) {
                            this.mainDraw = this.equipScreen;
                        }
                        if (this.beforeLevelMenuScreen.chosenOption === 2) {
                            if (this.currencyHolder.currency >= 100) {
                                this.currencyHolder.currency = (this.currencyHolder.currency - 100) | 0;
                                this.aux.clear();
                                for (var i = 14; i < 38; i = (i + 1) | 0) {
                                    if (!this.attackInventory.attackInventory.contains(i)) {
                                        this.aux.add(i);
                                    }
                                }
                                var attack = Pidroh.BaseUtils.Extensions.RandomElement(System.Int32, this.aux);
                                this.attackInventory.attackInventory.add(attack);
                                this.mainDraw = this.resultScreen;
                                this.resultScreen.AddMovePrize(attack);
                                this.resultScreen.SkipToShowMove();
                            }
                        }

                        this.beforeLevelMenuScreen.ResetChoice();
                    }
                }
                if (Bridge.referenceEquals(this.mainDraw, this.equipScreen)) {
                    if (this.equipScreen.wantToReturn) {
                        this.mainDraw = this.beforeLevelMenuScreen;
                        this.equipScreen.ResetChoice();
                    }
                }
                if (this.stageSelecScreen.wantToReturn) {

                    this.stageSelecScreen.ResetChoice();


                    this.stageSelecScreen.chosenStage = -1;
                    this.stageGroupNav.Backtrack();

                    this.Reset();
                }
                if (this.helpScreen != null) {
                    if (this.helpScreen.wannaLeave === true) {
                        this.helpScreen.wannaLeave = false;
                        this.mainDraw = this.battleRender;

                    }
                }

                if (this.helpInt.showRequest) {
                    this.helpScreen.Show();
                    this.helpInt.showRequest = false;
                    this.mainDraw = this.helpScreen;
                    this.helpScreen.HelpMode();
                }
                if (Bridge.referenceEquals(this.mainDraw, this.battleRender)) {
                    if (this.battleMain.IsOver()) {
                        if (this.battleMain.BattleConfig.attackDemonstrationMode) {
                            this.Reset();
                        } else {
                            if (this.battleMain.IsVictory()) {
                                this.stageId = (this.stageId + 1) | 0;
                                this.stageToBattle.Victory();
                                this.stageSelecScreen.ResetChoice();
                                this.stageToBattle.BattleMetricsUpdate(this.battleMain.trackBattle.metrics);
                                var attackPrize = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.AttackPrize, this.stageToBattle.CurrentStage);
                                if (attackPrize != null) {
                                    if (attackPrize.prizes != null) {
                                        this.attackInventory.attackInventory.AddRange(attackPrize.prizes);
                                        this.resultScreen.AddMovePrize(attackPrize.prizes[System.Array.index(0, attackPrize.prizes)]);
                                    }

                                }
                                var currencyPrize = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.CurrencyPrize, this.stageToBattle.CurrentStage);
                                if (currencyPrize != null) {
                                    if (currencyPrize.currency != null) {
                                        this.currencyHolder.currency = (this.currencyHolder.currency + currencyPrize.currency[System.Array.index(0, currencyPrize.currency)]) | 0;
                                        this.resultScreen.currencyPrize = currencyPrize.currency[System.Array.index(0, currencyPrize.currency)];
                                    }
                                }
                            }
                            this.resultScreen.Enter();
                            this.mainDraw = this.resultScreen;
                        }

                    }
                }
                if (Bridge.referenceEquals(this.mainDraw, this.resultScreen)) {
                    if (this.resultScreen.wannaLeave === 1) {
                        this.Reset();
                    }
                }
                if (Bridge.referenceEquals(this.mainDraw, this.modeSelectionScreen)) {
                    if (this.modeSelectionScreen.wannaLeave === 1) {
                        this.Reset();
                    }
                }

            },
            GetBoard: function () {
                return this.mainDraw.Pidroh$ConsoleApp$Turnbased$ITextScreen_$GetBoard();
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.ResultScreen", {
        inherits: [Pidroh.ConsoleApp.Turnbased.ITextScreen_],
        fields: {
            textWorld: null,
            youWin: null,
            Mouse: null,
            youLose: null,
            battleResult: null,
            trackBattle: null,
            prizeEntity: null,
            Keyboard: null,
            movePrizes: null,
            wannaLeave: 0,
            mode: 0,
            moveRenders: null,
            Input: 0,
            keyDownUnicode: 0,
            MoveRenders: null,
            currencyPrize: 0,
            moveIndex: 0
        },
        alias: [
            "Mouse", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Mouse",
            "Keyboard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Keyboard",
            "Input", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Input",
            "keyDownUnicode", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$keyDownUnicode",
            "Draw", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Draw",
            "GetBoard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$GetBoard"
        ],
        ctors: {
            init: function () {
                this.youWin = "You Win";
                this.youLose = "You lose";
                this.movePrizes = new (System.Collections.Generic.List$1(System.Int32)).ctor();
                this.currencyPrize = -1;
                this.moveIndex = 0;
            },
            ctor: function (trackBattle) {
                this.$initialize();
                this.textWorld = new Pidroh.TextRendering.TextWorld();
                this.textWorld.Init(Pidroh.ConsoleApp.Turnbased.GameMain.Width, Pidroh.ConsoleApp.Turnbased.GameMain.Height);
                this.trackBattle = trackBattle;
                this.prizeEntity = this.textWorld.GetFreeEntity(Pidroh.ConsoleApp.Turnbased.GameMain.Width, Pidroh.ConsoleApp.Turnbased.GameMain.Height);
                this.prizeEntity.Origin.ResetInvisible();
            }
        },
        methods: {
            Enter: function () {
                this.wannaLeave = 0;
                this.mode = 0;
            },
            Draw: function (f) {
                if (this.keyDownUnicode > 0) {
                    if (this.mode === 1) {
                        this.moveIndex = (this.moveIndex + 1) | 0;

                    } else {
                        if (this.mode === 2) {
                            this.wannaLeave = 1;
                        }
                        if (this.mode === 0) {
                            this.mode = 1;
                        }
                    }
                    if (this.movePrizes.Count <= this.moveIndex) {
                        if (this.currencyPrize > 0) {
                            this.mode = 2;
                            this.DrawCurrencyGet(this.currencyPrize);
                        } else {
                            this.wannaLeave = 1;
                        }

                    } else {
                        this.DrawMoveGet(this.movePrizes.getItem(this.moveIndex));
                    }


                }
                this.textWorld.mainBoard.SetAll(32, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackgroundInput);
                var message = this.youWin;
                if (this.battleResult.result === 2) {
                    message = this.youLose;
                }
                this.textWorld.mainBoard.DrawOnCenter(message, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.ThunderShot);

                var x = 3;
                var y = 3;
                Pidroh.ConsoleApp.Turnbased.BattleRender.DrawStrippedText(x, y, "TURNS", this.textWorld.mainBoard);
                var metrics = this.trackBattle.metrics;
                Pidroh.ConsoleApp.Turnbased.BattleRender.DrawSubText(((x + 14) | 0), y, metrics.round + "", this.textWorld.mainBoard);
                Pidroh.ConsoleApp.Turnbased.BattleRender.DrawStrippedText(x, ((y + 2) | 0), "TIMES HIT", this.textWorld.mainBoard);
                Pidroh.ConsoleApp.Turnbased.BattleRender.DrawSubText(((x + 14) | 0), ((y + 2) | 0), metrics.damageTimes + "", this.textWorld.mainBoard);

                Pidroh.ConsoleApp.Turnbased.BattleRender.DrawStrippedText(x, ((y + 10) | 0), "RANK", this.textWorld.mainBoard);
                Pidroh.ConsoleApp.Turnbased.BattleRender.DrawSubText(((x + 14) | 0), ((y + 10) | 0), metrics.rank + "", this.textWorld.mainBoard);

                this.textWorld.mainBoard.DrawHorizontalLine(Pidroh.BaseUtils.Unicode.AsciiGridHor, ((y + 7) | 0), Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                this.textWorld.mainBoard.DrawHorizontalLine(Pidroh.BaseUtils.Unicode.AsciiGridHor, ((y + 13) | 0), Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                this.textWorld.DrawChildren();

            },
            SkipToShowMove: function () {
                this.mode = 1;
                this.DrawMoveGet(this.movePrizes.getItem(this.moveIndex));
            },
            GetBoard: function () {
                return this.textWorld.mainBoard;
            },
            DrawMoveGet: function (move) {
                this.prizeEntity.Origin.SetAll(32, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackgroundInput);
                this.prizeEntity.Origin.DrawOnCenterHorizontal("You received a new attack", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription, 0, 18, true);
                this.prizeEntity.Origin.DrawOnCenterHorizontal(this.moveRenders.getItem(move).Label, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.inputKey, 0, 20, true);
            },
            DrawCurrencyGet: function (amount) {
                this.prizeEntity.Origin.SetAll(32, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackgroundInput);
                this.prizeEntity.Origin.DrawOnCenterHorizontal("You received data fragments", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription, 0, 18, true);
                this.prizeEntity.Origin.DrawOnCenterHorizontal("" + amount, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.inputKey, 0, 20, true);
            },
            AddMovePrize: function (v) {
                this.movePrizes.add(v);
            }
        }
    });

    Bridge.define("Pidroh.ConsoleApp.Turnbased.StageGroupSelectionScreen", {
        inherits: [Pidroh.ConsoleApp.Turnbased.ITextScreen_],
        fields: {
            stageGroups: null,
            textWorld: null,
            Mouse: null,
            Keyboard: null,
            wantedGroup: 0,
            wantedGroupEntity: null,
            wannaLeave: 0,
            navKey: null,
            Input: 0,
            keyDownUnicode: 0
        },
        alias: [
            "Mouse", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Mouse",
            "Keyboard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Keyboard",
            "Input", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Input",
            "keyDownUnicode", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$keyDownUnicode",
            "Draw", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Draw",
            "GetBoard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$GetBoard"
        ],
        ctors: {
            init: function () {
                this.wantedGroupEntity = new Pidroh.ECS.Entity();
                this.wantedGroup = -1;
                this.wantedGroupEntity = Pidroh.ECS.Entity.None.$clone();
            },
            ctor: function () {
                this.$initialize();

                this.textWorld = new Pidroh.TextRendering.TextWorld();
                this.textWorld.Init(Pidroh.ConsoleApp.Turnbased.GameMain.Width, Pidroh.ConsoleApp.Turnbased.GameMain.Height);
                this.navKey = new Pidroh.TurnBased.TextRendering.NavigationKeyboard(this.textWorld);
                this.navKey.showEscape = false;
                this.textWorld.mainBoard.SetAll(Pidroh.TextRendering.TextBoard.NOCHANGECHAR, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackgroundInput);

                this.textWorld.mainBoard.DrawOnCenterHorizontal("Stage Selection", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero, 0, 1);

                this.textWorld.mainBoard.DrawOnCenterHorizontal("Controls", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel, 0, 6);


            }
        },
        methods: {
            SetECS: function (ecs) {
                this.stageGroups = ecs.QuickAccessor1(Pidroh.ConsoleApp.Turnbased.StageDataGroup);


            },
            Enter: function () {
                this.wannaLeave = 0;
            },
            Draw: function (f) {
                this.navKey.Clear();
                this.textWorld.mainBoard.Reset();
                this.textWorld.mainBoard.SetAll(32, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackgroundInput);
                this.textWorld.DrawChildren();
                this.textWorld.mainBoard.DrawOnCenterHorizontal("Stage Selection", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero, 0, 1);

                for (var i = 0; i < this.stageGroups.Count; i = (i + 1) | 0) {
                    var x = 5;
                    var y = (5 + Bridge.Int.mul(i, 2)) | 0;
                    this.textWorld.mainBoard.Draw$1("World " + (((i + 1) | 0)), x, y, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel);
                    this.navKey.Add(((x - 2) | 0), y);
                }

                if (this.keyDownUnicode >= 0) {
                    this.navKey.CheckInput(this.keyDownUnicode);
                }

                this.wantedGroup = this.navKey.chosenOption;
                if (this.wantedGroup >= 0) {
                    this.wantedGroupEntity = this.stageGroups.Entity(this.wantedGroup);
                }
                this.navKey.DrawControls();


            },
            ResetChoice: function () {
                this.wantedGroup = -1;
                this.navKey.ResetChoice();
            },
            GetBoard: function () {
                return this.textWorld.mainBoard;
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.TextAnimation$1", function (T) { return {
        inherits: [Pidroh.TextRendering.TextAnimation],
        fields: {
            mainData: null
        },
        ctors: {
            init: function () {
                this.mainData = new (System.Collections.Generic.List$1(T)).ctor();
            }
        },
        methods: {
            RequestRegisterLists: function () {
                this.RegisterList(this.mainData);
            },
            Add$1: function (baseData, mainD) {
                this.Add(baseData);
                this.mainData.add(mainD);
            },
            Modify: function (entity, index, progress, length) {
                this.Modify$2(entity, this.mainData.getItem(index), progress, length);
            },
            Modify$2: function (entity, mainData, progress, length) { }
        }
    }; });

    Bridge.define("Pidroh.TextRendering.DelaysAnimation", {
        inherits: [Pidroh.TextRendering.TextAnimation],
        methods: {
            RequestRegisterLists: function () {

            },
            Delay: function (v) {
                this.Add(new Pidroh.TextRendering.TextAnimation.BaseData.$ctor1(v, 0, -1));
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.TestGame", {
        inherits: [Pidroh.TextRendering.ITextGame],
        fields: {
            ScreenHolder: null,
            palette: null
        },
        alias: [
            "ScreenHolder", "Pidroh$TextRendering$ITextGame$ScreenHolder",
            "GetPalette", "Pidroh$TextRendering$ITextGame$GetPalette",
            "Init", "Pidroh$TextRendering$ITextGame$Init",
            "Update", "Pidroh$TextRendering$ITextGame$Update"
        ],
        ctors: {
            init: function () {
                this.ScreenHolder = new Pidroh.TextRendering.TextScreenHolder();
                this.palette = Pidroh.TextRendering.DefaultPalettes.C4Novel;
            }
        },
        methods: {
            GetPalette: function () {
                return this.palette;
            },
            Init: function (w, h) {
                var screen = new Pidroh.TextRendering.TestScreen();
                this.ScreenHolder.SetAll(screen);
                screen.Init(w, h);
                screen.GetBoard().Draw$1("Test", 0, 0, 2);
            },
            Update: function (delta) {

            }
        }
    });

    Bridge.define("Pidroh.TextRendering.TextScreenN", {
        inherits: [Pidroh.TextRendering.ITextScreen,Pidroh.TextRendering.IMouseInput,Pidroh.TextRendering.IKeyboardInput],
        fields: {
            TextWorld: null,
            InputUnicode: 0,
            mouseIO: null
        },
        props: {
            InputAsNumber: {
                get: function () {
                    return ((this.InputUnicode - 48) | 0);
                }
            }
        },
        alias: [
            "Update", "Pidroh$TextRendering$ITextScreen$Update",
            "GetBoard", "Pidroh$TextRendering$ITextScreen$GetBoard",
            "MouseEvent", "Pidroh$TextRendering$IMouseInput$MouseEvent",
            "InputUnicode", "Pidroh$TextRendering$IKeyboardInput$InputUnicode",
            "mouseIO", "Pidroh$TextRendering$IMouseInput$mouseIO"
        ],
        ctors: {
            init: function () {
                this.mouseIO = new Pidroh.TextRendering.GameScreen.MouseIO();
            },
            ctor: function () {
                this.$initialize();
            },
            $ctor1: function (textWorld) {
                this.$initialize();
                this.TextWorld = textWorld;
            }
        },
        methods: {
            Update: function (f) { },
            Init: function (w, h) {
                this.TextWorld = new Pidroh.TextRendering.TextWorld();
                this.TextWorld.Init(w, h);

            },
            GetBoard: function () {
                return this.TextWorld.mainBoard;
            },
            MouseEvent: function (mouseDown, v1, v2) {

            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.EquipScreen", {
        inherits: [Pidroh.ConsoleApp.Turnbased.ITextScreen_],
        fields: {
            inventory: null,
            textWorld: null,
            navKey_Inventory: null,
            navKey_Equip: null,
            moveMetaDatas: null,
            Input: 0,
            keyDownUnicode: 0,
            Mouse: null,
            Keyboard: null,
            mode: 0,
            wantToReturn: false
        },
        alias: [
            "Input", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Input",
            "keyDownUnicode", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$keyDownUnicode",
            "Mouse", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Mouse",
            "Keyboard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Keyboard",
            "Draw", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Draw",
            "GetBoard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$GetBoard"
        ],
        ctors: {
            init: function () {
                this.mode = 0;
            },
            ctor: function (moveMetaDatas) {
                this.$initialize();
                this.textWorld = new Pidroh.TextRendering.TextWorld();
                this.textWorld.Init(Pidroh.ConsoleApp.Turnbased.GameMain.Width, Pidroh.ConsoleApp.Turnbased.GameMain.Height);
                this.navKey_Inventory = new Pidroh.TurnBased.TextRendering.NavigationKeyboard(this.textWorld);
                this.navKey_Equip = new Pidroh.TurnBased.TextRendering.NavigationKeyboard(this.textWorld);
                this.moveMetaDatas = moveMetaDatas;
            }
        },
        methods: {
            Draw: function (f) {
                var $t, $t1, $t2, $t3;
                this.navKey_Inventory.Clear();
                this.navKey_Equip.Clear();
                this.textWorld.mainBoard.Reset();
                this.textWorld.mainBoard.SetAll(32, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackgroundInput);
                this.textWorld.DrawChildren();

                this.textWorld.mainBoard.DrawOnCenterHorizontal("ATTACK EQUIPMENT", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero, 0, 1);

                for (var i = 0; i < this.inventory.equippedAttacks.length; i = (i + 1) | 0) {
                    var x = 4;
                    var y = (Bridge.Int.mul(i, 2) + 5) | 0;
                    this.navKey_Equip.Add(((x - 2) | 0), y);
                    this.textWorld.mainBoard.DrawOneDigit(((i + 1) | 0), x, y, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                    this.textWorld.mainBoard.DrawChar$1(46, ((x + 1) | 0), y, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                    if (($t = this.inventory.equippedAttacks)[System.Array.index(i, $t)] >= 0) {


                        this.textWorld.mainBoard.Draw$1(this.moveMetaDatas.getItem(($t1 = this.inventory.equippedAttacks)[System.Array.index(i, $t1)]).Label, ((x + 3) | 0), y, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                    } else {
                        this.textWorld.mainBoard.Draw$1("_____", ((x + 3) | 0), y, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                    }
                }

                var yOffset = (((5 + Bridge.Int.mul(this.inventory.equippedAttacks.length, 2)) | 0) + 2) | 0;

                this.textWorld.mainBoard.DrawHorizontalLine(95, ((yOffset - 2) | 0), Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel);

                for (var i1 = 0; i1 < this.inventory.attackInventory.Count; i1 = (i1 + 1) | 0) {
                    var x1 = 4;
                    var y1 = (i1 + yOffset) | 0;
                    this.navKey_Inventory.Add(((x1 - 2) | 0), y1);
                    this.textWorld.mainBoard.Draw$1(this.moveMetaDatas.getItem(this.inventory.attackInventory.getItem(i1)).Label, x1, y1, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                }
                if (this.keyDownUnicode >= 0) {
                    if (this.mode === 1) {
                        this.navKey_Inventory.CheckInput(this.keyDownUnicode);
                    }
                    if (this.mode === 0) {
                        this.navKey_Equip.CheckInput(this.keyDownUnicode);
                    }
                }

                var attackDescription = "";
                var move = -1;
                if (this.mode === 1) {
                    var cp = this.navKey_Inventory.currentPoint;
                    if (cp >= 0) {
                        move = this.inventory.attackInventory.getItem(cp);
                    }
                }
                if (this.mode === 0) {
                    var cp1 = this.navKey_Equip.currentPoint;
                    if (cp1 >= 0) {
                        move = ($t2 = this.inventory.equippedAttacks)[System.Array.index(cp1, $t2)];
                    }
                }
                if (move >= 0) {
                    this.textWorld.mainBoard.Draw$1(this.moveMetaDatas.getItem(move).Description, 4, ((yOffset + 13) | 0), Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                    this.textWorld.mainBoard.Draw$1("Power: ", 4, ((yOffset + 14) | 0), Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                    this.textWorld.mainBoard.DrawTwoDigits(this.moveMetaDatas.getItem(move).damage, ((4 + ("Power: ").length) | 0), ((yOffset + 14) | 0), Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                }


                this.navKey_Inventory.DrawControls();


                if (this.navKey_Inventory.chosenOption >= 0) {
                    var attack = this.inventory.attackInventory.getItem(this.navKey_Inventory.chosenOption);
                    ($t3 = this.inventory.equippedAttacks)[System.Array.index(this.navKey_Equip.chosenOption, $t3)] = attack;
                    this.navKey_Equip.ResetChoice();
                    this.navKey_Inventory.ResetChoice();
                    this.mode = 0;

                }
                if (this.navKey_Equip.chosenOption >= 0) {
                    this.mode = 1;
                }
                if (this.navKey_Inventory.wantToEscape) {
                    this.navKey_Equip.ResetChoice();
                    this.navKey_Inventory.ResetChoice();
                    this.mode = 0;
                }
                this.navKey_Inventory.ShowCursor(this.mode === 1);
                this.navKey_Equip.ShowCursor(this.mode === 0);
                this.wantToReturn = this.navKey_Equip.wantToEscape;
            },
            GetBoard: function () {
                return this.textWorld.mainBoard;
            },
            ResetChoice: function () {
                this.navKey_Equip.ResetChoice();
                this.wantToReturn = false;
            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.GenericChoiceScreen", {
        inherits: [Pidroh.ConsoleApp.Turnbased.ITextScreen_],
        fields: {
            textWorld: null,
            navKey: null,
            Input: 0,
            keyDownUnicode: 0,
            Mouse: null,
            Keyboard: null,
            mode: 0,
            chosenOption: 0,
            choices: null,
            extraText: null,
            enabled: null,
            title: null
        },
        alias: [
            "Input", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Input",
            "keyDownUnicode", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$keyDownUnicode",
            "Mouse", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Mouse",
            "Keyboard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Keyboard",
            "Draw", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Draw",
            "GetBoard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$GetBoard"
        ],
        ctors: {
            init: function () {
                this.mode = 0;
                this.chosenOption = -1;
                this.choices = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.extraText = new (System.Collections.Generic.List$1(System.String)).ctor();
                this.enabled = new (System.Collections.Generic.List$1(System.Boolean)).ctor();
            },
            ctor: function () {
                this.$initialize();
                this.textWorld = new Pidroh.TextRendering.TextWorld();
                this.textWorld.Init(Pidroh.ConsoleApp.Turnbased.GameMain.Width, Pidroh.ConsoleApp.Turnbased.GameMain.Height);
                this.navKey = new Pidroh.TurnBased.TextRendering.NavigationKeyboard(this.textWorld);
            }
        },
        methods: {
            Draw: function (f) {
                this.navKey.Clear();
                this.textWorld.mainBoard.Reset();
                this.textWorld.mainBoard.SetAll(32, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackgroundInput);
                this.textWorld.DrawChildren();

                if (this.title != null) {
                    this.textWorld.mainBoard.DrawOnCenterHorizontal(this.title, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero, 0, 1);
                }

                for (var i = 0; i < this.choices.Count; i = (i + 1) | 0) {
                    var y = (Bridge.Int.mul(i, 2) + 5) | 0;
                    var x = 4;
                    var color = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription;
                    if (this.enabled.Count > i) {
                        if (!this.enabled.getItem(i)) {
                            color = Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel;
                        }
                    }
                    this.textWorld.mainBoard.Draw$1(this.choices.getItem(i), x, y, color);
                    this.navKey.Add(((x - 2) | 0), y);

                }
                for (var i1 = 0; i1 < this.extraText.Count; i1 = (i1 + 1) | 0) {
                    var y1 = (((Bridge.Int.mul(i1, 2) + 5) | 0) + 1) | 0;
                    var x1 = 12;
                    this.textWorld.mainBoard.Draw$1(this.extraText.getItem(i1), x1, y1, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel);
                }

                if (this.keyDownUnicode >= 0) {
                    this.navKey.CheckInput(this.keyDownUnicode);
                }


                this.navKey.DrawControls();

                this.chosenOption = this.navKey.chosenOption;
            },
            GetBoard: function () {
                return this.textWorld.mainBoard;
            },
            ResetChoice: function () {
                this.navKey.ResetChoice();
                this.chosenOption = -1;
            },
            WannaLeave: function () {
                return this.navKey.wantToEscape;
            },
            SetExtraText: function (id, text) {
                while (this.extraText.Count <= id) {
                    this.extraText.add("");
                }
                this.extraText.setItem(id, text);
            },
            SetEnabled: function (id, enable) {
                while (this.enabled.Count <= id) {
                    this.enabled.add(true);
                }
                this.enabled.setItem(id, enable);
            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.HelpScreen", {
        inherits: [Pidroh.ConsoleApp.Turnbased.ITextScreen_],
        fields: {
            Input: 0,
            keyDownUnicode: 0,
            Keyboard: null,
            Mouse: null,
            textWorld: null,
            model: null,
            moveRenders: null,
            moveDatas: null,
            LeaveButton: 0,
            wannaLeave: false,
            explanationEntity: null
        },
        alias: [
            "Input", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Input",
            "keyDownUnicode", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$keyDownUnicode",
            "Keyboard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Keyboard",
            "Mouse", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Mouse",
            "Draw", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Draw",
            "GetBoard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$GetBoard"
        ],
        ctors: {
            init: function () {
                this.Mouse = new Pidroh.TextRendering.GameScreen.MouseIO();
            },
            ctor: function (helpModel, moveRenders, moveDatas) {
                this.$initialize();
                this.textWorld = new Pidroh.TextRendering.TextWorld();
                this.textWorld.Init(Pidroh.ConsoleApp.Turnbased.GameMain.Width, Pidroh.ConsoleApp.Turnbased.GameMain.Height);
                this.model = helpModel;
                this.moveRenders = moveRenders;
                this.moveDatas = moveDatas;
                this.textWorld.mainBoard.SetAll(Pidroh.TextRendering.TextBoard.INVISIBLECHAR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackCommand, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackCommand);
                this.explanationEntity = this.textWorld.GetFreeEntity(((Pidroh.ConsoleApp.Turnbased.GameMain.Width - 4) | 0), 35);
                this.explanationEntity.SetPosition$2(2, 4);
            }
        },
        methods: {
            Draw: function (f) {
                var input = this.keyDownUnicode;
                if (input === this.LeaveButton) {
                    this.wannaLeave = true;
                }
                if (input === 72) {
                    this.wannaLeave = true;
                }
                if (input === 104) {
                    this.wannaLeave = true;
                }
                if (input === Pidroh.BaseUtils.Unicode.Escape) {
                    this.wannaLeave = true;
                }



                var pos = 0;
                this.explanationEntity.Origin.SetCursorAt(0, 0);
                if (false) {
                    this.explanationEntity.Origin.Draw_Cursor_SmartLineBreak("Input your commands and watch the turn play out. Plan your moves based on what the enemy will do!", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                    this.explanationEntity.Origin.CursorNewLine(0);
                    this.explanationEntity.Origin.CursorNewLine(0);
                    this.explanationEntity.Origin.Draw_Cursor_SmartLineBreak("Attacks have three elements, Fire, Thunder and Ice. Fire beats Ice, Ice beats Thunder, Thunder beats Fire.", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                    this.explanationEntity.Origin.CursorNewLine(0);
                    this.explanationEntity.Origin.CursorNewLine(0);

                    this.explanationEntity.Origin.Draw_Cursor_SmartLineBreak("The element of the attacker changes upon attacking. Attackers are immune to attacks of the same element!", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                    pos = (pos + 18) | 0;
                } else {
                    pos = 5;
                }

                if (this.model.attackDemo) {
                    this.explanationEntity.Origin.Draw_Cursor_SmartLineBreak("A battle simulation so you can examine enemy attacks beforehand", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                } else {
                    this.explanationEntity.Origin.Draw_Cursor_SmartLineBreak("Pick your moves and execute them!", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);

                    pos = (pos + 6) | 0;
                    this.explanationEntity.Origin.CursorNewLine(0);
                    this.explanationEntity.Origin.CursorNewLine(0);
                    if (this.model.killAllEnemies) {

                        this.explanationEntity.Origin.Draw_Cursor_SmartLineBreak("Defeat all enemies!", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                    } else {
                        this.explanationEntity.Origin.Draw_Cursor_SmartLineBreak("Collect all objects", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription);
                    }


                }

                this.textWorld.mainBoard.SetAll(32, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackgroundInput);
                this.textWorld.Draw();




                var menuTitle = "HELP";
                var leaveLabel = "EXIT";
                if (this.model.battleIntroMode) {
                    leaveLabel = "START";
                    menuTitle = "BATTLE INTRO";
                    this.LeaveButton = 32;
                } else {
                    this.LeaveButton = 120;
                }
                if (this.model.attackDemo) {
                    menuTitle = "ATTACK SIMULATION";
                }
                this.textWorld.mainBoard.DrawOnCenterHorizontal(menuTitle, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel, 0, 1);
                var heroCommandExist = false;
                for (var i = 0; i < this.model.commandsHero.Count; i = (i + 1) | 0) {
                    if (this.CheckDrawCommand(this.model.commandsHero.getItem(i))) {
                        heroCommandExist = true;
                        break;
                    }
                }
                var enemyCommandExist = false;
                for (var i1 = 0; i1 < this.model.commandsEnemy.Count; i1 = (i1 + 1) | 0) {
                    if (this.CheckDrawCommand(this.model.commandsEnemy.getItem(i1))) {
                        enemyCommandExist = true;
                        break;
                    }
                }
                if (this.model.attackDemo) {
                    pos = (pos + 4) | 0;
                    this.textWorld.mainBoard.Draw$1("SIMULATED ATTACK", 2, pos, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel);
                } else {
                    if (heroCommandExist && false) {
                        this.textWorld.mainBoard.Draw$1("YOUR COMMANDS", 2, ((pos - 2) | 0), Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel);
                        var commandList = this.model.commandsHero;
                        pos = this.ShowCommands(pos, commandList);
                        pos = (pos + 4) | 0;
                    }

                    if (enemyCommandExist) {
                        this.textWorld.mainBoard.Draw$1("ENEMY COMMANDS", 2, pos, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel);
                    }
                }


                if (enemyCommandExist) {
                    pos = (pos + 2) | 0;
                    pos = this.ShowCommands(pos, this.model.commandsEnemy);
                }


                Pidroh.ConsoleApp.Turnbased.GameMain.DrawInput(1, ((pos + 3) | 0), this.LeaveButton, leaveLabel, this.textWorld.mainBoard);


            },
            ShowCommands: function (pos, commandList) {
                for (var i = 0; i < commandList.Count; i = (i + 1) | 0) {

                    var command = commandList.getItem(i);
                    var drawFlag = this.CheckDrawCommand(command);
                    if (drawFlag) {
                        this.textWorld.mainBoard.Draw$1(this.moveRenders.getItem(command).Abrev, 2, pos, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.HeroTurn);
                        this.textWorld.mainBoard.Draw$1(this.moveRenders.getItem(command).Label.toUpperCase(), 5, pos, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.HeroTurn);
                        this.textWorld.mainBoard.SetCursorAt(3, ((pos + 1) | 0));
                        this.textWorld.mainBoard.Draw_Cursor_SmartLineBreak$1(this.moveRenders.getItem(command).Description, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.InputDescription, 0, ((this.moveRenders.getItem(command).Description.length - 1) | 0), 3);
                        pos = (pos + 3) | 0;
                    }

                }

                return pos;
            },
            IsShowingCommandInList: function (commandList) {
                for (var i = 0; i < commandList.Count; i = (i + 1) | 0) {

                    var command = commandList.getItem(i);
                    if (this.CheckDrawCommand(command)) {
                        return true;
                    }


                }

                return false;
            },
            CheckDrawCommand: function (command) {
                var drawFlag = false;
                if (command >= 0) {
                    var md = this.moveDatas.getItem(command);
                    if (!md.HasTag(Pidroh.ConsoleApp.Turnbased.MoveDataTags.Movement)) {
                        drawFlag = this.moveRenders.getItem(command).Label.length !== 0;
                    }


                }

                return drawFlag;
            },
            GetBoard: function () {
                return this.textWorld.mainBoard;
            },
            Show: function () {
                this.model.RefreshData();
            },
            HelpMode: function () {
                this.model.battleIntroMode = false;
            },
            IsWannaShowIntro: function () {
                this.model.RefreshData();
                return this.IsShowingCommandInList(this.model.commandsEnemy) || this.IsShowingCommandInList(this.model.commandsHero);
            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.ModeSelectionScreen", {
        inherits: [Pidroh.ConsoleApp.Turnbased.ITextScreen_],
        fields: {
            textWorld: null,
            Mouse: null,
            selection: 0,
            battleResult: null,
            Keyboard: null,
            wannaLeave: 0,
            mode: 0,
            timeAttack: false,
            screenStage: 0,
            Input: 0,
            keyDownUnicode: 0
        },
        alias: [
            "Mouse", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Mouse",
            "Keyboard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Keyboard",
            "Input", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Input",
            "keyDownUnicode", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$keyDownUnicode",
            "Draw", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Draw",
            "GetBoard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$GetBoard"
        ],
        ctors: {
            init: function () {
                this.timeAttack = false;
            },
            ctor: function () {
                this.$initialize();
                this.textWorld = new Pidroh.TextRendering.TextWorld();
                this.textWorld.Init(70, 25);
            }
        },
        methods: {
            Enter: function () {
                this.wannaLeave = 0;
            },
            Draw: function (f) {
                this.textWorld.mainBoard.Reset();
                var ik = this.Input;
                this.mode = -1;
                this.textWorld.mainBoard.Draw$1("ProgBattle Prototype v0.3", 1, 1, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero);
                this.textWorld.mainBoard.Draw$1("A game by Pidroh", 1, 2, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero);
                if (this.screenStage === 0) {
                    switch (ik) {
                        case Pidroh.ConsoleApp.Turnbased.BattleRender.InputKey.LEFT: 
                            this.screenStage = 1;
                            this.timeAttack = false;
                            break;
                        case Pidroh.ConsoleApp.Turnbased.BattleRender.InputKey.RIGHT: 
                            this.screenStage = 1;
                            this.timeAttack = true;
                            break;
                        case Pidroh.ConsoleApp.Turnbased.BattleRender.InputKey.DOWN: 
                            this.timeAttack = true;
                            this.mode = 0;
                            break;
                        case Pidroh.ConsoleApp.Turnbased.BattleRender.InputKey.UP: 
                            this.mode = 0;
                            this.timeAttack = false;
                            break;
                        default: 
                            break;
                    }
                    this.textWorld.mainBoard.DrawOnCenter("[w] Vanilla", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero, 0, 4, false);
                    this.textWorld.mainBoard.DrawOnCenter("[a] Elemental", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero, 0, 5, false);
                    this.textWorld.mainBoard.DrawOnCenter("[s] Vanilla Time Attack", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero, 0, 6, false);
                    this.textWorld.mainBoard.DrawOnCenter("[d] Elemental Time Attack", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero, 0, 7, false);
                }
                if (this.screenStage === 1) {
                    if (ik === Pidroh.ConsoleApp.Turnbased.BattleRender.InputKey.UP) {
                        this.mode = 1;

                    }
                    if (ik === Pidroh.ConsoleApp.Turnbased.BattleRender.InputKey.DOWN) {
                        this.screenStage = 0;
                    }
                    this.textWorld.mainBoard.DrawOnCenter("Elemental Mode", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero, 0, -5, true);
                    this.textWorld.mainBoard.DrawOnCenter("Fire beats Ice, Ice beats Thunder, Thunder beats fire", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero, 0, -2, true);
                    this.textWorld.mainBoard.DrawOnCenter("Same element = no damage", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero, 0, 0, true);
                    this.textWorld.mainBoard.DrawOnCenter("It is best to have had some experience with vanilla mode", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero, 0, 1, true);
                    this.textWorld.mainBoard.DrawOnCenter("[w] Start Elemental Mode", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero, 0, 4, false);
                    this.textWorld.mainBoard.DrawOnCenter("[s] Go back", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.GridHero, 0, 5, false);
                }


                if (this.mode >= 0) {
                    this.wannaLeave = 1;
                }




            },
            Reset: function () {
                this.mode = -1;
                this.wannaLeave = 0;
            },
            GetBoard: function () {
                return this.textWorld.mainBoard;
            }
        }
    });

    Bridge.define("Pidroh.TurnBased.TextRendering.StageSelectionScreen", {
        inherits: [Pidroh.ConsoleApp.Turnbased.ITextScreen_],
        fields: {
            stageGroup: null,
            Input: 0,
            keyDownUnicode: 0,
            Mouse: null,
            Keyboard: null,
            textWorld: null,
            navKey: null,
            chosenStage: 0,
            wantToReturn: false,
            groupLabels: null
        },
        alias: [
            "Input", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Input",
            "keyDownUnicode", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$keyDownUnicode",
            "Mouse", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Mouse",
            "Keyboard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Keyboard",
            "Draw", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$Draw",
            "GetBoard", "Pidroh$ConsoleApp$Turnbased$ITextScreen_$GetBoard"
        ],
        ctors: {
            init: function () {
                this.chosenStage = -1;
                this.groupLabels = System.Array.init(["Sector ", "World "], System.String);
            },
            ctor: function () {
                this.$initialize();
                this.textWorld = new Pidroh.TextRendering.TextWorld();
                this.textWorld.Init(Pidroh.ConsoleApp.Turnbased.GameMain.Width, Pidroh.ConsoleApp.Turnbased.GameMain.Height);
                this.navKey = new Pidroh.TurnBased.TextRendering.NavigationKeyboard(this.textWorld);
            }
        },
        methods: {
            Draw: function (f) {
                this.navKey.Clear();
                this.textWorld.mainBoard.Reset();
                this.textWorld.mainBoard.SetAll(32, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.BackgroundInput);
                this.textWorld.DrawChildren();
                this.textWorld.mainBoard.DrawOnCenterHorizontal("Stage Selection", Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.Hero, 0, 1);

                var stageN = 1;
                for (var i = 0; i < this.stageGroup.childIds.Count; i = (i + 1) | 0) {
                    var x = 5;
                    var y = (5 + Bridge.Int.mul(i, 3)) | 0;
                    var e = this.stageGroup.childIds.getItem(i).$clone();
                    var stageProgressPersistence = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.StageProgressPersistence, e);
                    var group = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.StageDataGroup, e);
                    var stageLabelPrefix = "Stage ";
                    var tags = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.TagComponent, e);
                    if (group != null) {
                        stageLabelPrefix = this.groupLabels[System.Array.index(group.level, this.groupLabels)];
                    }
                    var finalLabel = "";

                    if (tags != null && tags.Contains("tutorial")) {
                        finalLabel = "Tutorial";
                    } else {
                        finalLabel = (stageLabelPrefix || "") + stageN;
                        stageN = (stageN + 1) | 0;
                    }
                    if (stageProgressPersistence != null) {
                        if (stageProgressPersistence.available) {
                            this.textWorld.mainBoard.Draw$1(finalLabel, x, y, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.inputKey);

                            var rank = stageProgressPersistence.bestBattleMetrics.rank;
                            if (rank >= 0) {
                                this.textWorld.mainBoard.Draw$1("Best Rank: " + rank, ((x + 2) | 0), ((y + 1) | 0), Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel);
                            }
                        } else {
                            this.textWorld.mainBoard.Draw$1("???", x, y, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.WindowLabel);
                        }
                    } else {
                        this.textWorld.mainBoard.Draw$1(finalLabel, x, y, Pidroh.ConsoleApp.Turnbased.BattleRender.Colors.inputKey);
                    }

                    this.navKey.Add(((x - 2) | 0), y);
                }
                if (this.keyDownUnicode >= 0) {
                    this.navKey.CheckInput(this.keyDownUnicode);
                }

                this.chosenStage = this.navKey.chosenOption;
                if (this.chosenStage >= 0) {
                    var stageProgressPersistence1 = Pidroh.ECS.ExtensionMethods.GetComponent(Pidroh.ConsoleApp.Turnbased.StageProgressPersistence, this.stageGroup.childIds.getItem(this.chosenStage).$clone());
                    if (stageProgressPersistence1 != null) {
                        if (!stageProgressPersistence1.available) {
                            this.chosenStage = -1;
                            this.navKey.chosenOption = -1;
                        }
                    } else {

                    }
                }
                this.navKey.DrawControls();
                this.wantToReturn = this.navKey.wantToEscape;
            },
            GetBoard: function () {
                return this.textWorld.mainBoard;
            },
            ResetChoice: function () {
                this.chosenStage = -1;
                this.navKey.ResetChoice();
                this.wantToReturn = false;
            },
            ResetCursor: function () {
                this.navKey.ResetCursor();
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.BlinkAnim.BlinkData", {
        $kind: "nested struct",
        statics: {
            methods: {
                BackColor: function (backColor, blinkDuration, changeNoChangeColor) {
                    if (changeNoChangeColor === void 0) { changeNoChangeColor = true; }
                    return new Pidroh.TextRendering.BlinkAnim.BlinkData.$ctor1(Pidroh.TextRendering.TextBoard.NOCHANGECHAR, backColor, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, blinkDuration, blinkDuration, changeNoChangeColor);
                },
                FrontColor: function (frontColor, blinkDuration) {
                    return new Pidroh.TextRendering.BlinkAnim.BlinkData.$ctor1(Pidroh.TextRendering.TextBoard.NOCHANGECHAR, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, frontColor, blinkDuration, blinkDuration);
                },
                Char: function (c, blinkDuration) {
                    return new Pidroh.TextRendering.BlinkAnim.BlinkData.$ctor1(c, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, Pidroh.TextRendering.TextBoard.NOCHANGECOLOR, blinkDuration, blinkDuration);
                },
                getDefaultValue: function () { return new Pidroh.TextRendering.BlinkAnim.BlinkData(); }
            }
        },
        fields: {
            text: 0,
            backColor: 0,
            textColor: 0,
            blinkActiveTime: 0,
            blinkInactive: 0,
            changeInvisible: false
        },
        ctors: {
            $ctor1: function (text, backColor, textColor, blinkActiveTime, blinkInactive, changeNoChangeColor) {
                if (changeNoChangeColor === void 0) { changeNoChangeColor = true; }

                this.$initialize();
                this.text = text;
                this.backColor = backColor;
                this.textColor = textColor;
                this.blinkActiveTime = blinkActiveTime;
                this.blinkInactive = blinkInactive;
                this.changeInvisible = true;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            getHashCode: function () {
                var h = Bridge.addHash([3804934414, this.text, this.backColor, this.textColor, this.blinkActiveTime, this.blinkInactive, this.changeInvisible]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, Pidroh.TextRendering.BlinkAnim.BlinkData)) {
                    return false;
                }
                return Bridge.equals(this.text, o.text) && Bridge.equals(this.backColor, o.backColor) && Bridge.equals(this.textColor, o.textColor) && Bridge.equals(this.blinkActiveTime, o.blinkActiveTime) && Bridge.equals(this.blinkInactive, o.blinkInactive) && Bridge.equals(this.changeInvisible, o.changeInvisible);
            },
            $clone: function (to) {
                var s = to || new Pidroh.TextRendering.BlinkAnim.BlinkData();
                s.text = this.text;
                s.backColor = this.backColor;
                s.textColor = this.textColor;
                s.blinkActiveTime = this.blinkActiveTime;
                s.blinkInactive = this.blinkInactive;
                s.changeInvisible = this.changeInvisible;
                return s;
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.CharByCharAnimation.CharByCharData", {
        $kind: "nested class",
        fields: {
            charStart: 0,
            charEnd: 0
        },
        ctors: {
            ctor: function (charStart, charEnd) {
                this.$initialize();
                this.charStart = charStart;
                this.charEnd = charEnd;
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.PositionAnimation.PositionData", {
        $kind: "nested struct",
        statics: {
            methods: {
                getDefaultValue: function () { return new Pidroh.TextRendering.PositionAnimation.PositionData(); }
            }
        },
        fields: {
            permanent: false,
            startPosition: null,
            endPosition: null
        },
        ctors: {
            init: function () {
                this.startPosition = new Pidroh.BaseUtils.Vector2D();
                this.endPosition = new Pidroh.BaseUtils.Vector2D();
            },
            $ctor1: function (startPosition, endPosition, perm) {
                if (perm === void 0) { perm = false; }

                this.$initialize();
                this.startPosition = startPosition.$clone();
                this.endPosition = endPosition.$clone();
                this.permanent = perm;
            },
            ctor: function () {
                this.$initialize();
            }
        },
        methods: {
            getHashCode: function () {
                var h = Bridge.addHash([5256985096, this.permanent, this.startPosition, this.endPosition]);
                return h;
            },
            equals: function (o) {
                if (!Bridge.is(o, Pidroh.TextRendering.PositionAnimation.PositionData)) {
                    return false;
                }
                return Bridge.equals(this.permanent, o.permanent) && Bridge.equals(this.startPosition, o.startPosition) && Bridge.equals(this.endPosition, o.endPosition);
            },
            $clone: function (to) {
                var s = to || new Pidroh.TextRendering.PositionAnimation.PositionData();
                s.permanent = this.permanent;
                s.startPosition = this.startPosition.$clone();
                s.endPosition = this.endPosition.$clone();
                return s;
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.TestScreen", {
        inherits: [Pidroh.TextRendering.TextScreenN],
        alias: ["Update", "Pidroh$TextRendering$ITextScreen$Update"],
        methods: {
            Update: function (f) {

            }
        }
    });

    Bridge.define("Pidroh.TextRendering.BlinkAnim", {
        inherits: [Pidroh.TextRendering.TextAnimation$1(Pidroh.TextRendering.BlinkAnim.BlinkData)],
        methods: {
            Modify$2: function (entity, mainData, progress, length) {
                Pidroh.TextRendering.TextAnimation$1(Pidroh.TextRendering.BlinkAnim.BlinkData).prototype.Modify$2.call(this, entity, mainData, progress, length);
                var aux = progress;
                var blink = true;
                while (true) {
                    if (blink) {
                        aux -= mainData.blinkActiveTime;
                    } else {
                        aux -= mainData.blinkInactive;
                    }
                    if (aux < 0) {
                        break;
                    } else {
                        blink = !blink;
                    }
                }
                if (!blink) {
                    if (mainData.changeInvisible) {
                        entity.Animation.SetAll(mainData.text, mainData.textColor, mainData.backColor);
                    } else {
                        entity.Animation.SetAllIfVisible(mainData.text, mainData.textColor, mainData.backColor);
                    }

                }
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.CharByCharAnimation", {
        inherits: [Pidroh.TextRendering.TextAnimation$1(Pidroh.TextRendering.CharByCharAnimation.CharByCharData)],
        methods: {
            Modify$2: function (entity, mainData, progress, length) {
                Pidroh.TextRendering.TextAnimation$1(Pidroh.TextRendering.CharByCharAnimation.CharByCharData).prototype.Modify$2.call(this, entity, mainData, progress, length);
                var ratio = progress / length;
                var lengthText = (mainData.charEnd - mainData.charStart) | 0;
                var lineBreaks = 0;
                var offsetedPerm = 0;
                for (var i = mainData.charStart; i < mainData.charEnd; i = (i + 1) | 0) {
                    var offseted = (i + offsetedPerm) | 0;
                    var line = 0;
                    var tb = entity.Animation;


                    while (offseted >= tb.Width) {
                        line = (line + 1) | 0;
                        offseted = (offseted - tb.Width) | 0;
                    }
                    if (entity.Origin.CharAt(offseted, ((line + lineBreaks) | 0)) === 10) {
                        lineBreaks = (lineBreaks + 1) | 0;
                        offsetedPerm = (offsetedPerm - offseted) | 0;
                        offseted = 0;
                    }
                    if (i > ((lengthText * ratio) + mainData.charStart)) {
                        tb.DrawChar(32, offseted, ((line + lineBreaks) | 0));

                    }
                }
            }
        }
    });

    Bridge.define("Pidroh.TextRendering.PositionAnimation", {
        inherits: [Pidroh.TextRendering.TextAnimation$1(Pidroh.TextRendering.PositionAnimation.PositionData)],
        methods: {
            Modify$2: function (entity, mainData, progress, length) {
                Pidroh.TextRendering.TextAnimation$1(Pidroh.TextRendering.PositionAnimation.PositionData).prototype.Modify$2.call(this, entity, mainData, progress, length);
                var target = entity.Animation;
                if (mainData.permanent) {
                    target = entity.Origin;
                }
                target.Position = Pidroh.BaseUtils.Vector2D.InterpolateRounded(mainData.startPosition.$clone(), mainData.endPosition.$clone(), progress / length);

            }
        }
    });
});

//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICJCdWlsZEJyaWRnZUIuanMiLAogICJzb3VyY2VSb290IjogIiIsCiAgInNvdXJjZXMiOiBbIkFwcC5jcyIsIi4uLy4uL1JldXNhYmxlUGlkcm9oVlMvQmFzZVV0aWxzL09iamVjdENsb25lci5jcyIsIi4uLy4uL1JldXNhYmxlUGlkcm9oVlMvQmFzZVV0aWxzL0RlYnVnZ2VyLmNzIiwiLi4vLi4vUmV1c2FibGVQaWRyb2hWUy9CYXNlVXRpbHMvRGVlcENsb25lSGVscGVyLmNzIiwiLi4vLi4vUmV1c2FibGVQaWRyb2hWUy9CYXNlVXRpbHMvRXh0ZW5zaW9ucy5jcyIsIi4uLy4uL1JldXNhYmxlUGlkcm9oVlMvQmFzZVV0aWxzL1BvaW50LmNzIiwiLi4vLi4vUmV1c2FibGVQaWRyb2hWUy9CYXNlVXRpbHMvUmFuZG9tU3VwcGxpZXIuY3MiLCIuLi8uLi9SZXVzYWJsZVBpZHJvaFZTL0Jhc2VVdGlscy9SZWN0YW5nbGUuY3MiLCIuLi8uLi9SZXVzYWJsZVBpZHJvaFZTL0Jhc2VVdGlscy9UaW1lU3RhbXAuY3MiLCIuLi8uLi9SZXVzYWJsZVBpZHJvaFZTL0Jhc2VVdGlscy9Vbmljb2RlLmNzIiwiLi4vLi4vUmV1c2FibGVQaWRyb2hWUy9CYXNlVXRpbHMvVmVjdG9yMkQuY3MiLCIuLi8uLi9SZXVzYWJsZVBpZHJvaFZTL0Jhc2VVdGlscy9WZWN0b3IzRC5jcyIsIi4uL1R1cm5CYXNlZExvZ2ljL01vdmVEYXRhLmNzIiwiLi4vVHVybkJhc2VkVGV4dFJlbmRlcmluZy9Bc3luY1Rhc2tzLmNzIiwiLi4vVHVybkJhc2VkTG9naWMvQXR0YWNrSW52ZW50b3J5LmNzIiwiLi4vVHVybkJhc2VkTG9naWMvU3RhZ2VEYXRhLmNzIiwiLi4vVHVybkJhc2VkTG9naWMvQmF0dGxlU2V0dXAuY3MiLCIuLi9UdXJuQmFzZWRMb2dpYy9CYXR0bGVNYWluLmNzIiwiLi4vVHVybkJhc2VkVGV4dFJlbmRlcmluZy9Db2xvclN0dWZmLmNzIiwiLi4vVHVybkJhc2VkTG9naWMvQ29udGVudENyZWF0b3IvU3RhZ2VEYXRhUHJvY2VkdXJhbF9BLmNzIiwiLi4vVHVybkJhc2VkTG9naWMvRGVidWdFeHRyYS9EZWJ1Z0V4LmNzIiwiLi4vVHVybkJhc2VkTG9naWMvRGVja01hbmFnZXIuY3MiLCIuLi9UdXJuQmFzZWRMb2dpYy9FQ1NJbnRlZ3JhdGlvbi5jcyIsIi4uL1R1cm5CYXNlZExvZ2ljL0VuZW15QUkuY3MiLCIuLi9UdXJuQmFzZWRMb2dpYy9TcGF3bkZhY3RvcnkuY3MiLCIuLi9UdXJuQmFzZWRMb2dpYy9FbmVteURhdGFDcmVhdG9yLmNzIiwiLi4vVHVybkJhc2VkTG9naWMvTW92ZURhdGFFeGVjdXRlci5jcyIsIi4uL1R1cm5CYXNlZExvZ2ljL0hhcHBzL0hhcHAuY3MiLCIuLi9UdXJuQmFzZWRMb2dpYy9JbnB1dEhvbGRlci5jcyIsIi4uL1R1cm5CYXNlZExvZ2ljL01vdmVDcmVhdG9yUHJvZy5jcyIsIi4uL1R1cm5CYXNlZExvZ2ljL1RyYWNrQmF0dGxlLmNzIiwiLi4vVHVybkJhc2VkTG9naWMvU3RhZ2VHcm91cE5hdmlnYXRvci5jcyIsIi4uL1R1cm5CYXNlZExvZ2ljL1N0YWdlVG9CYXR0bGUuY3MiLCIuLi9UdXJuQmFzZWRMb2dpYy9UYWdDb21wb25lbnQuY3MiLCIuLi8uLi9WaXN1YWxTdHVkaW9Tb2x1dGlvblJtay9FQ1MvQWNjZXNzb3IuY3MiLCIuLi8uLi9WaXN1YWxTdHVkaW9Tb2x1dGlvblJtay9FQ1MvQ2xvbmVkU3RhdGUuY3MiLCIuLi8uLi9WaXN1YWxTdHVkaW9Tb2x1dGlvblJtay9FQ1MvRUNTTWFuYWdlci5jcyIsIi4uLy4uL1Zpc3VhbFN0dWRpb1NvbHV0aW9uUm1rL0VDUy9FbnRpdHkuY3MiLCIuLi8uLi9WaXN1YWxTdHVkaW9Tb2x1dGlvblJtay9FQ1MvUHJvY2Vzc29yRmxleC5jcyIsIi4uLy4uL1JldXNhYmxlUGlkcm9oVlMvVGV4dFJlbmRlcmluZ0xvZ2ljL1RleHRXb3JsZC5jcyIsIi4uLy4uL1JldXNhYmxlUGlkcm9oVlMvVGV4dFJlbmRlcmluZ0xvZ2ljL1BhbGV0dGUuY3MiLCIuLi8uLi9SZXVzYWJsZVBpZHJvaFZTL1RleHRSZW5kZXJpbmdMb2dpYy9HYW1lU2NyZWVuL0tleWJvYXJkSU8uY3MiLCIuLi8uLi9SZXVzYWJsZVBpZHJvaFZTL1RleHRSZW5kZXJpbmdMb2dpYy9HYW1lU2NyZWVuL01vdXNlSG92ZXIuY3MiLCIuLi8uLi9SZXVzYWJsZVBpZHJvaFZTL1RleHRSZW5kZXJpbmdMb2dpYy9HYW1lU2NyZWVuL1VuaWNvZGVSZW1hcC5jcyIsIi4uLy4uL1JldXNhYmxlUGlkcm9oVlMvVGV4dFJlbmRlcmluZ0xvZ2ljL1RleHRCb2FyZC5jcyIsIi4uLy4uL1JldXNhYmxlUGlkcm9oVlMvVGV4dFJlbmRlcmluZ0xvZ2ljL0dhbWVTY3JlZW4vSVRleHRTY3JlZW5OLmNzIiwiLi4vVHVybkJhc2VkVGV4dFJlbmRlcmluZy9BdHRhY2tQcmV2aWV3LmNzIiwiLi4vVHVybkJhc2VkVGV4dFJlbmRlcmluZy9IYXBwSGFuZGxpbmcuY3MiLCIuLi9UdXJuQmFzZWRUZXh0UmVuZGVyaW5nL0hlbHBTY3JlZW5JbnRlZ3JhdGlvbi5jcyIsIi4uL1R1cm5CYXNlZFRleHRSZW5kZXJpbmcvSGVscFNjcmVlbi5jcyIsIi4uL1R1cm5CYXNlZFRleHRSZW5kZXJpbmcvSW5wdXRIYW5kbGluZy5jcyIsIi4uL1R1cm5CYXNlZFRleHRSZW5kZXJpbmcvTWVzc2FnZU9uUG9zaXRpb24uY3MiLCIuLi9UdXJuQmFzZWRUZXh0UmVuZGVyaW5nL01vdXNlSG92ZXJUZXh0LmNzIiwiLi4vVHVybkJhc2VkVGV4dFJlbmRlcmluZy9OYXZpZ2F0aW9uS2V5Ym9hcmQuY3MiLCIuLi9UdXJuQmFzZWRUZXh0UmVuZGVyaW5nL1ByZXZpZXdTeXN0ZW0uY3MiLCIuLi9UdXJuQmFzZWRUZXh0UmVuZGVyaW5nL1JlZmxlY3Rpb25UZXN0LmNzIiwiLi4vVHVybkJhc2VkVGV4dFJlbmRlcmluZy9VSVJldXNhYmxlLmNzIiwiLi4vVHVybkJhc2VkVGV4dFJlbmRlcmluZy9CYXR0bGVSZW5kZXIuY3MiLCIuLi9UdXJuQmFzZWRUZXh0UmVuZGVyaW5nL0dhbWVNYWluLmNzIiwiLi4vVHVybkJhc2VkVGV4dFJlbmRlcmluZy9SZXN1bHRTY3JlZW4uY3MiLCIuLi9UdXJuQmFzZWRUZXh0UmVuZGVyaW5nL1N0YWdlR3JvdXBTZWxlY3Rpb25TY3JlZW4uY3MiLCIuLi8uLi9SZXVzYWJsZVBpZHJvaFZTL1RleHRSZW5kZXJpbmdMb2dpYy9HYW1lU2NyZWVuL1Rlc3RHYW1lLmNzIiwiLi4vVHVybkJhc2VkVGV4dFJlbmRlcmluZy9FcXVpcFNjcmVlbi5jcyIsIi4uL1R1cm5CYXNlZFRleHRSZW5kZXJpbmcvR2VuZXJpY0Nob2ljZVNjcmVlbi5jcyIsIi4uL1R1cm5CYXNlZFRleHRSZW5kZXJpbmcvTW9kZVNlbGVjdGlvblNjcmVlbi5jcyIsIi4uL1R1cm5CYXNlZFRleHRSZW5kZXJpbmcvU3RhZ2VTZWxlY3Rpb25TY3JlZW4uY3MiLCIuLi8uLi9SZXVzYWJsZVBpZHJvaFZTL1RleHRSZW5kZXJpbmdMb2dpYy9CbGlua0FuaW1hdGlvbi5jcyIsIi4uLy4uL1JldXNhYmxlUGlkcm9oVlMvVGV4dFJlbmRlcmluZ0xvZ2ljL0NoYXJCeUNoYXJBbmltYXRpb24uY3MiXSwKICAibmFtZXMiOiBbIiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7WUFnRVlBO1lBR0FBO1lBRUFBLHFDQUFjQSxtQ0FBUUE7WUFDdEJBLHlCQUFTQTtZQUNUQSxLQUFLQSxXQUFXQSxJQUFJQSxzREFBMEJBOztnQkFHMUNBLDBDQUFPQSxHQUFQQSwyQkFBWUEsaUVBQWtCQSxHQUFsQkE7Ozs7O1lBS2hCQSxZQUFZQTtZQUNaQSxrQkFBa0JBO1lBQ2xCQSwwQkFBMEJBO1lBQzFCQTtZQUNBQTs7WUFFQUEsdURBQW9CQSxVQUFDQTtnQkFFakJBLFdBQVdBO2dCQUNYQSxJQUFJQTtvQkFBV0EsT0FBT0E7O2dCQUN0QkEsY0FBY0E7Z0JBQ2RBLElBQUlBLGlCQUFpQkE7b0JBRWpCQSxVQUFVQTs7Z0JBRWRBLE9BQU9BLGtDQUFr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VUFBVUE7Z0JBQ3hDQSxVQUFZQTtnQkFDWkE7Z0JBQ0FBO29CQUVJQSxJQUFJQTt3QkFFQUEsT0FBT0E7O3dCQUlQQSxPQUFPQTs7b0JBRVhBLElBQUlBO3dCQUVBQTs7d0JBSUFBLFFBQVFBLENBQUNBOzs7Z0JBR2pCQSxJQUFJQSxDQUFDQTtvQkFFREEsSUFBSUE7d0JBRUFBLHdCQUF3QkEsZUFBZUEsb0JBQW9CQTs7d0JBRzNEQSxpQ0FBaUNBLGVBQWVBLG9CQUFvQkE7Ozs7Ozs7Ozs7O2dDQ3BDcERBLFFBQW1CQSxVQUF5QkEsVUFBZ0JBO2dCQUVwRkEsNEhBQVlBLFFBQVFBLFVBQVVBLFVBQVVBO2dCQUN4Q0EsWUFBY0EsV0FBV0E7Z0JBQ3pCQSxpQkFBbUJBLG9CQUFtQkE7Z0JBQ3RDQTtnQkFDQUE7Z0JBQ0FBLEtBQUtBLFFBQVFBLG9CQUFvQkEsSUFBSUEsa0JBQWtCQTtvQkFFbkRBLGVBQWVBLEtBQUlBO29CQUNuQkE7b0JBQ0FBLFNBQVNBOzs7b0JBR1RBLE9BQU9BLFlBQVlBO3dCQUVmQTt3QkFDQUEsdUJBQVlBOztvQkFFaEJBLElBQUlBLHFCQUFxQkEsVUFBVUEsU0FBT0E7d0JBRXRDQTt3QkFDQUEsK0JBQWdCQTt3QkFDaEJBOztvQkFFSkEsSUFBSUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsYUFBYUEsU0FBU0E7d0JBRTVCQSxnQkFBaUJBLFVBQVVBLFNBQU9BOzs7Ozs7Ozs7OztnQzVCMktsQkEsUUFBbUJBLFVBQXVCQSxVQUFnQkE7Z0JBRWxGQSx3SEFBWUEsUUFBUUEsVUFBVUEsVUFBVUE7Z0JBQ3hDQSxhQUFtQkE7Z0JBQ25CQSxJQUFJQTtvQkFDQUEsU0FBU0E7O2dCQUNiQSxrQkFBa0JBLDZDQUE0QkEsaUNBQXdCQSwrQkFBc0JBLFdBQVdBIiwKICAic291cmNlc0NvbnRlbnQiOiBbInVzaW5nIEJyaWRnZTtcclxudXNpbmcgQnJpZGdlLkh0bWw1O1xyXG4vL3VzaW5nIEVDUztcclxuLy91c2luZyBOZXd0b25zb2Z0Lkpzb247XHJcbnVzaW5nIFBpZHJvaC5CYXNlVXRpbHM7XHJcbnVzaW5nIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZDtcclxudXNpbmcgUGlkcm9oLlRleHRSZW5kZXJpbmc7XHJcbnVzaW5nIFBpZHJvaC5UdXJuQmFzZWQuVGV4dFJlbmRlcmluZztcclxuLy91c2luZyBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQ7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIEJyaWRnZUJ1aWxkXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBBcHBcclxuICAgIHtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBpbnQgYnVmZmVyO1xyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIGJvb2wgYnVmZmVyT247XHJcbiAgICAgICAgLy9wcml2YXRlIHN0YXRpYyBIVE1MUHJlRWxlbWVudCB0ZXh0O1xyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIEdhbWVNYWluIGdyO1xyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIFRleHRCb2FyZCBUZXh0Qm9hcmQ7XHJcbiAgICAgICAgLy9wcml2YXRlIHN0YXRpYyBTdHJpbmdCdWlsZGVyIHNiO1xyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIHN0cmluZ1tdIGNvbG9ycztcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBpbnQgYnVmZmVyVW5pY29kZSA9IC0xO1xyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIFRleHRCb2FyZCBhdXg7XHJcbiAgICAgICAgc3RhdGljIERhdGVUaW1lIGxhc3QgPSBEYXRlVGltZS5Ob3c7XHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgYm9vbCBDYW5EcmF3O1xyXG5cclxuICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIFNldHVwR2FtZShvdXQgR2FtZU1haW4gZ3IsIG91dCBUZXh0Qm9hcmQgVGV4dEJvYXJkKVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoXCJTZXR1cFwiKTtcclxuICAgICAgICAgICAgUmFuZG9tIHJuZCA9IG5ldyBSYW5kb20oKTtcclxuICAgICAgICAgICAgUmFuZG9tU3VwcGxpZXIuR2VuZXJhdGUgPSAoKSA9PlxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmbG9hdCB2ID0gKGZsb2F0KXJuZC5OZXh0RG91YmxlKCk7XHJcbiAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKHYpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHY7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBnciA9IG5ldyBHYW1lTWFpbigpO1xyXG4gICAgICAgICAgICBUZXh0Qm9hcmQgPSBnci5HZXRCb2FyZCgpO1xyXG4gICAgICAgICAgICBhdXggPSBuZXcgVGV4dEJvYXJkKDMwMCwgMzAwKTtcclxuXHJcblxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBjbGFzcyBCbGFcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHB1YmxpYyBpbnQgaSA9IDM7XHJcbiAgICAgICAgICAgIHB1YmxpYyBCcmlkZ2VCdWlsZC5BcHAuVmVjdG9yIHBvcyA9IG5ldyBCcmlkZ2VCdWlsZC5BcHAuVmVjdG9yKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdHJ1Y3QgVmVjdG9yXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwdWJsaWMgZmxvYXQgeDtcclxuICAgICAgICAgICAgcHVibGljIGZsb2F0IHk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzdGF0aWMgTGlzdDxpbnQ+IGtleXNEb3duID0gbmV3IExpc3Q8aW50PigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgTWFpbigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBEZWJ1Z2dlci5BY3RpdmVTdGF0aWMgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy9EZWVwQ2xvbmVIZWxwZXIuZGVidWcuQWN0aXZlKGZhbHNlKTtcclxuICAgICAgICAgICAgLy9uZXcgUmVmbGVjdGlvblRlc3QoKTtcclxuICAgICAgICAgICAgVGVzdEVudGl0eVN5c3RlbSgpO1xyXG4gICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKFwiR2FtZSBTdGFydFwiKTtcclxuICAgICAgICAgICAgU2V0dXBHYW1lKG91dCBnciwgb3V0IFRleHRCb2FyZCk7XHJcbiAgICAgICAgICAgIGNvbG9ycyA9IG5ldyBzdHJpbmdbMzBdO1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IENvbG9yU3R1ZmYuY29sb3JzLkxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgY29sb3JzW2ldID0gQ29sb3JTdHVmZi5jb2xvcnNbaV07XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgdmFyIHN0eWxlID0gbmV3IEhUTUxTdHlsZUVsZW1lbnQoKTtcclxuICAgICAgICAgICAgc3R5bGUuSW5uZXJIVE1MID0gXCJodG1sLGJvZHkge2ZvbnQtZmFtaWx5OiBDb3VyaWVyOyBiYWNrZ3JvdW5kLWNvbG9yOiMxZjI1MjY7IGhlaWdodDogMTAwJTsgY29sb3I6Izg4ODt9XCIgKyBcIlxcbiAjY2FudmFzLWNvbnRhaW5lciB7d2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsgdGV4dC1hbGlnbjpjZW50ZXI7IHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7IH0gXCI7XHJcbiAgICAgICAgICAgIERvY3VtZW50LkhlYWQuQXBwZW5kQ2hpbGQoc3R5bGUpO1xyXG4gICAgICAgICAgICBidWZmZXIgPSA5O1xyXG4gICAgICAgICAgICBidWZmZXJPbiA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgRG9jdW1lbnQuT25LZXlVcCArPSAoS2V5Ym9hcmRFdmVudCBhKSA9PlxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnQgY29kZSA9IGEuS2V5Q29kZTtcclxuICAgICAgICAgICAgICAgIGlmIChjb2RlID09IDApIGNvZGUgPSBhLkNoYXJDb2RlO1xyXG4gICAgICAgICAgICAgICAgaW50IHVuaWNvZGUgPSBjb2RlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHVuaWNvZGUgPj0gNjUgJiYgdW5pY29kZSA8PSA5MClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB1bmljb2RlID0gdW5pY29kZSAtIDY1ICsgOTc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoa2V5c0Rvd24uQ29udGFpbnModW5pY29kZSkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZSh1bmljb2RlKTtcclxuICAgICAgICAgICAgICAgICAgICBrZXlzRG93bi5SZW1vdmUodW5pY29kZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBEb2N1bWVudC5PbktleURvd24gKz0gKEtleWJvYXJkRXZlbnQgYSkgPT5cclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGEuS2V5Q29kZSA+PSAzNyAmJiBhLktleUNvZGUgPD0gNDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgSGFuZGxlKGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGEuUHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChhLktleUNvZGUgPT0gVW5pY29kZS5Fc2NhcGUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgSGFuZGxlKGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGEuUHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChhLktleUNvZGUgPT0gVW5pY29kZS5FbnRlcilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBIYW5kbGUoYSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYS5QcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShcIktEXCIgKyBhLktleUNvZGUpO1xyXG4gICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShcIktEXCIrYS5DaGFyQ29kZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlKHVuaWNvZGUpO1xyXG4gICAgICAgICAgICAgICAgLy9idWZmZXIgPSBhLkNoYXJDb2RlO1xyXG5cclxuICAgICAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgICAgICBEb2N1bWVudC5PbktleVByZXNzICs9IChLZXlib2FyZEV2ZW50IGEpID0+XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChhLktleUNvZGUgPj0gMzcgJiYgYS5LZXlDb2RlIDw9IDQwKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKGEuS2V5Q29kZSk7XHJcbiAgICAgICAgICAgICAgICBIYW5kbGUoYSk7XHJcbiAgICAgICAgICAgICAgICBhLlByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlKHVuaWNvZGUpO1xyXG4gICAgICAgICAgICAgICAgLy9idWZmZXIgPSBhLkNoYXJDb2RlO1xyXG5cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIFVwZGF0ZUdhbWUoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIEFmdGVyIGJ1aWxkaW5nIChDdHJsICsgU2hpZnQgKyBCKSB0aGlzIHByb2plY3QsIFxyXG4gICAgICAgICAgICAvLyBicm93c2UgdG8gdGhlIC9iaW4vRGVidWcgb3IgL2Jpbi9SZWxlYXNlIGZvbGRlci5cclxuXHJcbiAgICAgICAgICAgIC8vIEEgbmV3IGJyaWRnZS8gZm9sZGVyIGhhcyBiZWVuIGNyZWF0ZWQgYW5kXHJcbiAgICAgICAgICAgIC8vIGNvbnRhaW5zIHlvdXIgcHJvamVjdHMgSmF2YVNjcmlwdCBmaWxlcy4gXHJcblxyXG4gICAgICAgICAgICAvLyBPcGVuIHRoZSBicmlkZ2UvaW5kZXguaHRtbCBmaWxlIGluIGEgYnJvd3NlciBieVxyXG4gICAgICAgICAgICAvLyBSaWdodC1DbGljayA+IE9wZW4gV2l0aC4uLiwgdGhlbiBjaG9vc2UgYVxyXG4gICAgICAgICAgICAvLyB3ZWIgYnJvd3NlciBmcm9tIHRoZSBsaXN0XHJcblxyXG4gICAgICAgICAgICAvLyBUaGlzIGFwcGxpY2F0aW9uIHdpbGwgdGhlbiBydW4gaW4gYSBicm93c2VyLlxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBIYW5kbGUoS2V5Ym9hcmRFdmVudCBhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IGNvZGUgPSBhLktleUNvZGU7XHJcbiAgICAgICAgICAgIGlmIChjb2RlID09IDApIGNvZGUgPSBhLkNoYXJDb2RlO1xyXG4gICAgICAgICAgICBpbnQgdW5pY29kZSA9IGNvZGU7XHJcbiAgICAgICAgICAgIGJ1ZmZlclVuaWNvZGUgPSB1bmljb2RlO1xyXG4gICAgICAgICAgICBrZXlzRG93bi5BZGQodW5pY29kZSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBUZXN0RW50aXR5U3lzdGVtKClcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBVcGRhdGVHYW1lKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChDYW5EcmF3KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBEYXRlVGltZSBub3cgPSBEYXRlVGltZS5Ob3c7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VjcyA9IChub3cgLSBsYXN0KS5Ub3RhbFNlY29uZHM7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VjcyA+IDAuMDgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShzZWNzKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWNzID0gMC4wODtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBUZXh0Qm9hcmQgPSBnci5HZXRCb2FyZCgpO1xyXG4gICAgICAgICAgICAgICAgbGFzdCA9IG5vdztcclxuICAgICAgICAgICAgICAgIGdyLmtleURvd25Vbmljb2RlID0gYnVmZmVyVW5pY29kZTtcclxuICAgICAgICAgICAgICAgIGJ1ZmZlclVuaWNvZGUgPSAtMTtcclxuICAgICAgICAgICAgICAgIHZhciBtb3VzZVggPSBTY3JpcHQuQ2FsbDxpbnQ+KFwiZ2V0TW91c2VYXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG1vdXNlWSA9IFNjcmlwdC5DYWxsPGludD4oXCJnZXRNb3VzZVlcIik7XHJcbiAgICAgICAgICAgICAgICBQb2ludDJEIHBvaW50MkQgPSBuZXcgUG9pbnQyRChtb3VzZVgsIG1vdXNlWSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZ3IuTW91c2UucG9zICE9IHBvaW50MkQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShtb3VzZVgrXCJzeFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKG1vdXNlWSArIFwic3lcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgZ3IuTW91c2UucG9zID0gcG9pbnQyRDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGdyLktleWJvYXJkLmRvd25Vbmljb2Rlcy5DbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgZ3IuS2V5Ym9hcmQuZG93blVuaWNvZGVzLkFkZFJhbmdlKGtleXNEb3duKTtcclxuXHJcbiAgICAgICAgICAgICAgICBnci5EcmF3KChmbG9hdClzZWNzKTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAvLzs7U2NyaXB0LkNhbGwoXCJjbGVhclwiKTtcclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgVGV4dEJvYXJkLkhlaWdodDsgaisrKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgVGV4dEJvYXJkLldpZHRoOyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWF1eC5TYW1lQXMoVGV4dEJvYXJkLCB4OiBpLCB5OiBqKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHRjSSA9IFRleHRCb2FyZC5UZXh0Q29sb3JbaSwgal07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgY29sb3IgPSBjb2xvcnNbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGNJIDwgMCkgeyB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRjSSA+PSBjb2xvcnMuTGVuZ3RoKSB7IH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IGNvbG9yc1t0Y0ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGJhY2tDb2xvciA9IGNvbG9yc1tUZXh0Qm9hcmQuQmFja0NvbG9yW2ksIGpdXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXIgQGNoYXIgPSBUZXh0Qm9hcmQuQ2hhckF0KGksIGopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU2NyaXB0LkNhbGwoXCJkcmF3XCIsIGksIGosIGNvbG9yLCBiYWNrQ29sb3IsIFwiXCIgKyBAY2hhcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXguQ29weShUZXh0Qm9hcmQsIHg6IGksIHk6IGopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9TY3JpcHQuQ2FsbChcImRyYXdcIiwgaSwgaiwgY29sb3JzW1RleHRCb2FyZC5UZXh0Q29sb3JbaSwgal1dLCBjb2xvcnNbVGV4dEJvYXJkLkJhY2tDb2xvcltpLCBqXV0sIFwieFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQ2FuRHJhdyA9IFNjcmlwdC5DYWxsPGJvb2w+KFwiaXNSZWFkeVRvRHJhd1wiKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIFdpbmRvdy5TZXRUaW1lb3V0KChnbG9iYWw6OlN5c3RlbS5BY3Rpb24pVXBkYXRlR2FtZSwgMTUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSIsInVzaW5nIFBpZHJvaC5CYXNlVXRpbHMuQXJyYXlFeHRlbnNpb25zO1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uUmVmbGVjdGlvbjtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLkJhc2VVdGlsc1xyXG57XHJcbiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIE9iamVjdEV4dGVuc2lvbnNcclxuICAgIHtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBNZXRob2RJbmZvIENsb25lTWV0aG9kID0gdHlwZW9mKE9iamVjdCkuR2V0TWV0aG9kKFwiTWVtYmVyd2lzZUNsb25lXCIsIEJpbmRpbmdGbGFncy5Ob25QdWJsaWMgfCBCaW5kaW5nRmxhZ3MuSW5zdGFuY2UpO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgSXNQcmltaXRpdmVNZXRob2QodGhpcyBUeXBlIHR5cGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PSB0eXBlb2YoU3RyaW5nKSkgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIGlmICh0eXBlID09IHR5cGVvZihpbnQpKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKHR5cGUgPT0gdHlwZW9mKGZsb2F0KSkgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIGlmICh0eXBlID09IHR5cGVvZihkb3VibGUpKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKHR5cGUgPT0gdHlwZW9mKGNoYXIpKSByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgLy9ib29sIGlzUHJpbWl0aXZlID0gdHlwZS5Jc1ByaW1pdGl2ZTtcclxuICAgICAgICAgICAgYm9vbCBpc1ZhbHVlVHlwZSA9IHR5cGUuSXNWYWx1ZVR5cGU7XHJcbiAgICAgICAgICAgIHJldHVybiBpc1ZhbHVlVHlwZTsgLy8mIGlzUHJpbWl0aXZlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBPYmplY3QgQ29weSh0aGlzIE9iamVjdCBvcmlnaW5hbE9iamVjdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBJbnRlcm5hbENvcHkob3JpZ2luYWxPYmplY3QsIG5ldyBEaWN0aW9uYXJ5PE9iamVjdCwgT2JqZWN0PihuZXcgUmVmZXJlbmNlRXF1YWxpdHlDb21wYXJlcigpKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIE9iamVjdCBJbnRlcm5hbENvcHkoT2JqZWN0IG9yaWdpbmFsT2JqZWN0LCBJRGljdGlvbmFyeTxPYmplY3QsIE9iamVjdD4gdmlzaXRlZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChvcmlnaW5hbE9iamVjdCA9PSBudWxsKSByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgdmFyIHR5cGVUb1JlZmxlY3QgPSBvcmlnaW5hbE9iamVjdC5HZXRUeXBlKCk7XHJcbiAgICAgICAgICAgIGlmIChJc1ByaW1pdGl2ZU1ldGhvZCh0eXBlVG9SZWZsZWN0KSkgcmV0dXJuIG9yaWdpbmFsT2JqZWN0O1xyXG4gICAgICAgICAgICBpZiAodmlzaXRlZC5Db250YWluc0tleShvcmlnaW5hbE9iamVjdCkpIHJldHVybiB2aXNpdGVkW29yaWdpbmFsT2JqZWN0XTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZihEZWxlZ2F0ZSkuSXNBc3NpZ25hYmxlRnJvbSh0eXBlVG9SZWZsZWN0KSkgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIHZhciBjbG9uZU9iamVjdCA9IENsb25lTWV0aG9kLkludm9rZShvcmlnaW5hbE9iamVjdCwgbmV3IG9iamVjdFtdIHsgfSk7XHJcbiAgICAgICAgICAgIGlmICh0eXBlVG9SZWZsZWN0LklzQXJyYXkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBhcnJheVR5cGUgPSB0eXBlVG9SZWZsZWN0LkdldEVsZW1lbnRUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoSXNQcmltaXRpdmVNZXRob2QoYXJyYXlUeXBlKSA9PSBmYWxzZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBBcnJheSBjbG9uZWRBcnJheSA9IChBcnJheSljbG9uZU9iamVjdDtcclxuICAgICAgICAgICAgICAgICAgICBjbG9uZWRBcnJheS5Gb3JFYWNoKChnbG9iYWw6OlN5c3RlbS5BY3Rpb248Z2xvYmFsOjpTeXN0ZW0uQXJyYXksIGludFtdPikoKGFycmF5LCBpbmRpY2VzKSA9PiBhcnJheS5TZXRWYWx1ZShJbnRlcm5hbENvcHkoY2xvbmVkQXJyYXkuR2V0VmFsdWUoaW5kaWNlcyksIHZpc2l0ZWQpLCBpbmRpY2VzKSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2aXNpdGVkLkFkZChvcmlnaW5hbE9iamVjdCwgY2xvbmVPYmplY3QpO1xyXG4gICAgICAgICAgICBDb3B5RmllbGRzKG9yaWdpbmFsT2JqZWN0LCB2aXNpdGVkLCBjbG9uZU9iamVjdCwgdHlwZVRvUmVmbGVjdCk7XHJcbiAgICAgICAgICAgIFJlY3Vyc2l2ZUNvcHlCYXNlVHlwZVByaXZhdGVGaWVsZHMob3JpZ2luYWxPYmplY3QsIHZpc2l0ZWQsIGNsb25lT2JqZWN0LCB0eXBlVG9SZWZsZWN0KTtcclxuICAgICAgICAgICAgcmV0dXJuIGNsb25lT2JqZWN0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBSZWN1cnNpdmVDb3B5QmFzZVR5cGVQcml2YXRlRmllbGRzKG9iamVjdCBvcmlnaW5hbE9iamVjdCwgSURpY3Rpb25hcnk8b2JqZWN0LCBvYmplY3Q+IHZpc2l0ZWQsIG9iamVjdCBjbG9uZU9iamVjdCwgVHlwZSB0eXBlVG9SZWZsZWN0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVUb1JlZmxlY3QuQmFzZVR5cGUgIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgUmVjdXJzaXZlQ29weUJhc2VUeXBlUHJpdmF0ZUZpZWxkcyhvcmlnaW5hbE9iamVjdCwgdmlzaXRlZCwgY2xvbmVPYmplY3QsIHR5cGVUb1JlZmxlY3QuQmFzZVR5cGUpO1xyXG4gICAgICAgICAgICAgICAgQ29weUZpZWxkcyhvcmlnaW5hbE9iamVjdCwgdmlzaXRlZCwgY2xvbmVPYmplY3QsIHR5cGVUb1JlZmxlY3QuQmFzZVR5cGUsIEJpbmRpbmdGbGFncy5JbnN0YW5jZSB8IEJpbmRpbmdGbGFncy5Ob25QdWJsaWMsIChnbG9iYWw6OlN5c3RlbS5GdW5jPGdsb2JhbDo6U3lzdGVtLlJlZmxlY3Rpb24uRmllbGRJbmZvLCBib29sPikoaW5mbyA9PiBpbmZvLklzUHJpdmF0ZSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHN0YXRpYyB2b2lkIENvcHlGaWVsZHMob2JqZWN0IG9yaWdpbmFsT2JqZWN0LCBJRGljdGlvbmFyeTxvYmplY3QsIG9iamVjdD4gdmlzaXRlZCwgb2JqZWN0IGNsb25lT2JqZWN0LCBUeXBlIHR5cGVUb1JlZmxlY3QsIEJpbmRpbmdGbGFncyBiaW5kaW5nRmxhZ3MgPSBCaW5kaW5nRmxhZ3MuSW5zdGFuY2UgfCBCaW5kaW5nRmxhZ3MuTm9uUHVibGljIHwgQmluZGluZ0ZsYWdzLlB1YmxpYyB8IEJpbmRpbmdGbGFncy5GbGF0dGVuSGllcmFyY2h5LCBGdW5jPEZpZWxkSW5mbywgYm9vbD4gZmlsdGVyID0gbnVsbClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKEZpZWxkSW5mbyBmaWVsZEluZm8gaW4gdHlwZVRvUmVmbGVjdC5HZXRGaWVsZHMoYmluZGluZ0ZsYWdzKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZpbHRlciAhPSBudWxsICYmIGZpbHRlcihmaWVsZEluZm8pID09IGZhbHNlKSBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGlmIChJc1ByaW1pdGl2ZU1ldGhvZChmaWVsZEluZm8uRmllbGRUeXBlKSkgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3JpZ2luYWxGaWVsZFZhbHVlID0gZmllbGRJbmZvLkdldFZhbHVlKG9yaWdpbmFsT2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIHZhciBjbG9uZWRGaWVsZFZhbHVlID0gSW50ZXJuYWxDb3B5KG9yaWdpbmFsRmllbGRWYWx1ZSwgdmlzaXRlZCk7XHJcbiAgICAgICAgICAgICAgICBmaWVsZEluZm8uU2V0VmFsdWUoY2xvbmVPYmplY3QsIGNsb25lZEZpZWxkVmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVCBDb3B5PFQ+KHRoaXMgVCBvcmlnaW5hbClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAoVClDb3B5KChPYmplY3Qpb3JpZ2luYWwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgUmVmZXJlbmNlRXF1YWxpdHlDb21wYXJlciA6IEVxdWFsaXR5Q29tcGFyZXI8T2JqZWN0PlxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSBib29sIEVxdWFscyhvYmplY3QgeCwgb2JqZWN0IHkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gUmVmZXJlbmNlRXF1YWxzKHgsIHkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgaW50IEdldEhhc2hDb2RlKG9iamVjdCBvYmopXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAob2JqID09IG51bGwpIHJldHVybiAwO1xyXG4gICAgICAgICAgICByZXR1cm4gb2JqLkdldEhhc2hDb2RlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5hbWVzcGFjZSBBcnJheUV4dGVuc2lvbnNcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIGNsYXNzIEFycmF5RXh0ZW5zaW9uc1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIEZvckVhY2godGhpcyBBcnJheSBhcnJheSwgQWN0aW9uPEFycmF5LCBpbnRbXT4gYWN0aW9uKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXJyYXkuTGVuZ3RoID09IDApIHJldHVybjtcclxuICAgICAgICAgICAgICAgIEFycmF5VHJhdmVyc2Ugd2Fsa2VyID0gbmV3IEFycmF5VHJhdmVyc2UoYXJyYXkpO1xyXG4gICAgICAgICAgICAgICAgZG8gYWN0aW9uKGFycmF5LCB3YWxrZXIuUG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKHdhbGtlci5TdGVwKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCBjbGFzcyBBcnJheVRyYXZlcnNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwdWJsaWMgaW50W10gUG9zaXRpb247XHJcbiAgICAgICAgICAgIHByaXZhdGUgaW50W10gbWF4TGVuZ3RocztcclxuXHJcbiAgICAgICAgICAgIHB1YmxpYyBBcnJheVRyYXZlcnNlKEFycmF5IGFycmF5KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBtYXhMZW5ndGhzID0gbmV3IGludFthcnJheS5SYW5rXTtcclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYXJyYXkuUmFuazsgKytpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG1heExlbmd0aHNbaV0gPSBhcnJheS5HZXRMZW5ndGgoaSkgLSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgUG9zaXRpb24gPSBuZXcgaW50W2FycmF5LlJhbmtdO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBwdWJsaWMgYm9vbCBTdGVwKClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBQb3NpdGlvbi5MZW5ndGg7ICsraSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoUG9zaXRpb25baV0gPCBtYXhMZW5ndGhzW2ldKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb25baV0rKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBpOyBqKyspXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uW2pdID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlJlZmxlY3Rpb247XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5CYXNlVXRpbHNcclxue1xyXG4gICAgcHVibGljIGNsYXNzIERlYnVnZ2VyXHJcbiAgICB7XHJcbiAgICAgICAgYm9vbCBkZWJ1Z2dpbmc7XHJcbiAgICAgICAgaW50IGlkZW50O1xyXG4gICAgICAgIFN0cmluZ0J1aWxkZXIgc3RyaW5nQnVpbGRlciA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBBY3RpdmVTdGF0aWMgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgRGVidWdnZXIoYm9vbCBkZWJ1Z2dpbmcpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZihBY3RpdmVTdGF0aWMpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRlYnVnZ2luZyA9IGRlYnVnZ2luZztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFByaW50KHN0cmluZyBzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKCFkZWJ1Z2dpbmcpIHJldHVybjtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBpZGVudDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlKCcgJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUocyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIERlaWRlbnQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWRlbnQgPSBpZGVudCAtIDI7IDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgSWRlbnQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWRlbnQgPSBpZGVudCsyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBBY3RpdmUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKCFBY3RpdmVTdGF0aWMpIHJldHVybjtcclxuICAgICAgICAgICAgZGVidWdnaW5nID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgQWN0aXZlKGJvb2wgdilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICghQWN0aXZlU3RhdGljKSByZXR1cm47XHJcbiAgICAgICAgICAgIGRlYnVnZ2luZyA9IHY7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBQcmludChPYmplY3Qgb2JqKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKCFkZWJ1Z2dpbmcpIHJldHVybjtcclxuICAgICAgICAgICAgc3RyaW5nQnVpbGRlci5MZW5ndGggPSAwO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIHR5cGUgPSBvYmouR2V0VHlwZSgpO1xyXG4gICAgICAgICAgICBzdHJpbmdCdWlsZGVyLkFwcGVuZChcIlR5cGU6IFwiKTtcclxuICAgICAgICAgICAgc3RyaW5nQnVpbGRlci5BcHBlbmQodHlwZS5OYW1lKTtcclxuICAgICAgICAgICAgc3RyaW5nQnVpbGRlci5BcHBlbmRMaW5lKCk7XHJcbiAgICAgICAgICAgIHZhciBmaWVsZHMgPSB0eXBlLkdldEZpZWxkcyhCaW5kaW5nRmxhZ3MuUHVibGljIHwgQmluZGluZ0ZsYWdzLk5vblB1YmxpYyB8IEJpbmRpbmdGbGFncy5JbnN0YW5jZSk7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBmIGluIGZpZWxkcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc3RyaW5nQnVpbGRlci5BcHBlbmQoJyAnKTtcclxuICAgICAgICAgICAgICAgIHN0cmluZ0J1aWxkZXIuQXBwZW5kKCcgJyk7XHJcbiAgICAgICAgICAgICAgICBzdHJpbmdCdWlsZGVyLkFwcGVuZChmLkdldFZhbHVlKG9iaikpO1xyXG4gICAgICAgICAgICAgICAgc3RyaW5nQnVpbGRlci5BcHBlbmQoJyAnKTtcclxuICAgICAgICAgICAgICAgIHN0cmluZ0J1aWxkZXIuQXBwZW5kKCcgJyk7XHJcbiAgICAgICAgICAgICAgICBzdHJpbmdCdWlsZGVyLkFwcGVuZChmLk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgc3RyaW5nQnVpbGRlci5BcHBlbmRMaW5lKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoc3RyaW5nQnVpbGRlci5Ub1N0cmluZygpKTtcclxuICAgICAgICB9XHJcblxuICAgIFxucHJpdmF0ZSBzdGF0aWMgYm9vbCBfX1Byb3BlcnR5X19Jbml0aWFsaXplcl9fQWN0aXZlU3RhdGljPXRydWU7fVxyXG59XHJcbiIsIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogTW9kdWxlIEhlYWRlciAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcXFxyXG5Nb2R1bGUgTmFtZTogIERlZXBDbG9uZUhlbHBlci5jc1xyXG5Qcm9qZWN0OiAgICAgIENTRGVlcENsb25lT2JqZWN0XHJcbkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLlxyXG5cclxuVGhlIGNsYXNzIGNvbnRhaW5zIHRoZSBtZXRob2RzIHRoYXQgaW1wbGVtZW50IGRlZXAgY2xvbmUgdXNpbmcgcmVmbGVjdGlvbi5cclxuXHJcblRoaXMgc291cmNlIGlzIHN1YmplY3QgdG8gdGhlIE1pY3Jvc29mdCBQdWJsaWMgTGljZW5zZS5cclxuU2VlIGh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9lbi11cy9vcGVubmVzcy9saWNlbnNlcy5hc3B4I01QTC5cclxuQWxsIG90aGVyIHJpZ2h0cyByZXNlcnZlZC5cclxuXHJcblRISVMgQ09ERSBBTkQgSU5GT1JNQVRJT04gSVMgUFJPVklERUQgXCJBUyBJU1wiIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIFxyXG5FSVRIRVIgRVhQUkVTU0VEIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIElNUExJRUQgXHJcbldBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORC9PUiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS5cclxuXFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXHJcblxyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5SZWZsZWN0aW9uO1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5CYXNlVXRpbHNcclxue1xyXG4gICAgcHVibGljIHN0YXRpYyBjbGFzcyBEZWVwQ2xvbmVIZWxwZXJcclxuICAgIHtcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBEZWJ1Z2dlciBkZWJ1ZyA9IG5ldyBEZWJ1Z2dlcihmYWxzZSk7XHJcblxyXG4gICAgICAgIC8vLyA8c3VtbWFyeT5cclxuICAgICAgICAvLy8gR2V0IHRoZSBkZWVwIGNsb25lIG9mIGFuIG9iamVjdC5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIC8vLyA8dHlwZXBhcmFtIG5hbWU9XCJUXCI+VGhlIHR5cGUgb2YgdGhlIG9iai48L3R5cGVwYXJhbT5cclxuICAgICAgICAvLy8gPHBhcmFtIG5hbWU9XCJvYmpcIj5JdCBpcyB0aGUgb2JqZWN0IHVzZWQgdG8gZGVlcCBjbG9uZS48L3BhcmFtPlxyXG4gICAgICAgIC8vLyA8cmV0dXJucz5SZXR1cm4gdGhlIGRlZXAgY2xvbmUuPC9yZXR1cm5zPlxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVCBEZWVwQ2xvbmU8VD4oVCBvYmopXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAob2JqID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudE51bGxFeGNlcHRpb24oXCJPYmplY3QgaXMgbnVsbFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gKFQpQ2xvbmVQcm9jZWR1cmUob2JqKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBEZWVwQ29weVBhcnRpYWwoT2JqZWN0IGZyb20sIE9iamVjdCB0bylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChmcm9tID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudE51bGxFeGNlcHRpb24oXCJPYmplY3QgaXMgbnVsbFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBDb3B5UHJvY2VkdXJlUGFydGlhbChmcm9tLCB0byk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAgICAgLy8vIFRoZSBtZXRob2QgaW1wbGVtZW50cyBkZWVwIGNsb25lIHVzaW5nIHJlZmxlY3Rpb24uXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICAvLy8gPHBhcmFtIG5hbWU9XCJvYmpcIj5JdCBpcyB0aGUgb2JqZWN0IHVzZWQgdG8gZGVlcCBjbG9uZS48L3BhcmFtPlxyXG4gICAgICAgIC8vLyA8cmV0dXJucz5SZXR1cm4gdGhlIGRlZXAgY2xvbmUuPC9yZXR1cm5zPlxyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIG9iamVjdCBDbG9uZVByb2NlZHVyZShPYmplY3Qgb2JqKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChvYmogPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFR5cGUgdHlwZSA9IG9iai5HZXRUeXBlKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBkZWJ1Zy5QcmludChcIkNsb25pbmc6IFwiICsgdHlwZSk7XHJcbiAgICAgICAgICAgIC8vZGVidWcuUHJpbnQodHlwZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBJZiB0aGUgdHlwZSBvZiBvYmplY3QgaXMgdGhlIHZhbHVlIHR5cGUsIHdlIHdpbGwgYWx3YXlzIGdldCBhIG5ldyBvYmplY3Qgd2hlbiBcclxuICAgICAgICAgICAgLy8gdGhlIG9yaWdpbmFsIG9iamVjdCBpcyBhc3NpZ25lZCB0byBhbm90aGVyIHZhcmlhYmxlLiBTbyBpZiB0aGUgdHlwZSBvZiB0aGUgXHJcbiAgICAgICAgICAgIC8vIG9iamVjdCBpcyBwcmltaXRpdmUgb3IgZW51bSwgd2UganVzdCByZXR1cm4gdGhlIG9iamVjdC4gV2Ugd2lsbCBwcm9jZXNzIHRoZSBcclxuICAgICAgICAgICAgLy8gc3RydWN0IHR5cGUgc3Vic2VxdWVudGx5IGJlY2F1c2UgdGhlIHN0cnVjdCB0eXBlIG1heSBjb250YWluIHRoZSByZWZlcmVuY2UgXHJcbiAgICAgICAgICAgIC8vIGZpZWxkcy5cclxuICAgICAgICAgICAgLy8gSWYgdGhlIHN0cmluZyB2YXJpYWJsZXMgY29udGFpbiB0aGUgc2FtZSBjaGFycywgdGhleSBhbHdheXMgcmVmZXIgdG8gdGhlIHNhbWUgXHJcbiAgICAgICAgICAgIC8vIHN0cmluZyBpbiB0aGUgaGVhcC4gU28gaWYgdGhlIHR5cGUgb2YgdGhlIG9iamVjdCBpcyBzdHJpbmcsIHdlIGFsc28gcmV0dXJuIHRoZSBcclxuICAgICAgICAgICAgLy8gb2JqZWN0LlxyXG4gICAgICAgICAgICBpZiAodHlwZS5Jc0VudW0gfHwgdHlwZSA9PSB0eXBlb2Yoc3RyaW5nKSB8fCB0eXBlID09IHR5cGVvZihpbnQpIHx8IHR5cGUgPT0gdHlwZW9mKGNoYXIpIHx8IHR5cGUgPT0gdHlwZW9mKGZsb2F0KSB8fCB0eXBlID09IHR5cGVvZihkb3VibGUpIHx8IHR5cGUgPT0gdHlwZW9mKEJvb2xlYW4pKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVidWcuUHJpbnQodHlwZSArIFwiIFwiICsgb2JqKyBcIiAtVlwiKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9iajtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBJZiB0aGUgdHlwZSBvZiB0aGUgb2JqZWN0IGlzIHRoZSBBcnJheSwgd2UgdXNlIHRoZSBDcmVhdGVJbnN0YW5jZSBtZXRob2QgdG8gZ2V0XHJcbiAgICAgICAgICAgIC8vIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBhcnJheS4gV2UgYWxzbyBwcm9jZXNzIHJlY3Vyc2l2ZWx5IHRoaXMgbWV0aG9kIGluIHRoZSBcclxuICAgICAgICAgICAgLy8gZWxlbWVudHMgb2YgdGhlIG9yaWdpbmFsIGFycmF5IGJlY2F1c2UgdGhlIHR5cGUgb2YgdGhlIGVsZW1lbnQgbWF5IGJlIHRoZSByZWZlcmVuY2UgXHJcbiAgICAgICAgICAgIC8vIHR5cGUuXHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUuSXNBcnJheSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvL3N0cmluZyB0eXBlTmFtZSA9IHR5cGUuRnVsbE5hbWUuUmVwbGFjZShcIltdXCIsIHN0cmluZy5FbXB0eSk7XHJcbiAgICAgICAgICAgICAgICAvL2RlYnVnLlByaW50KHR5cGVOYW1lKTtcclxuICAgICAgICAgICAgICAgIFR5cGUgdHlwZUVsZW1lbnQgPSB0eXBlLkdldEVsZW1lbnRUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vZGVidWcuUHJpbnQodHlwZUVsZW1lbnQrXCJzc1wiKTtcclxuICAgICAgICAgICAgICAgIHZhciBhcnJheSA9IG9iaiBhcyBBcnJheTtcclxuICAgICAgICAgICAgICAgIGludCBsZW5ndGggPSBhcnJheS5MZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBBcnJheSBjb3BpZWRBcnJheSA9IEFycmF5LkNyZWF0ZUluc3RhbmNlKHR5cGVFbGVtZW50LCBsZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBhcnJheS5MZW5ndGg7IGkrKylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBHZXQgdGhlIGRlZXAgY2xvbmUgb2YgdGhlIGVsZW1lbnQgaW4gdGhlIG9yaWdpbmFsIGFycmF5IGFuZCBhc3NpZ24gdGhlIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNsb25lIHRvIHRoZSBuZXcgYXJyYXkuXHJcbiAgICAgICAgICAgICAgICAgICAgY29waWVkQXJyYXkuU2V0VmFsdWUoQ2xvbmVQcm9jZWR1cmUoYXJyYXkuR2V0VmFsdWUoaSkpLCBpKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29waWVkQXJyYXk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gSWYgdGhlIHR5cGUgb2YgdGhlIG9iamVjdCBpcyBjbGFzcyBvciBzdHJ1Y3QsIGl0IG1heSBjb250YWluIHRoZSByZWZlcmVuY2UgZmllbGRzLCBcclxuICAgICAgICAgICAgLy8gc28gd2UgdXNlIHJlZmxlY3Rpb24gYW5kIHByb2Nlc3MgcmVjdXJzaXZlbHkgdGhpcyBtZXRob2QgaW4gdGhlIGZpZWxkcyBvZiB0aGUgb2JqZWN0IFxyXG4gICAgICAgICAgICAvLyB0byBnZXQgdGhlIGRlZXAgY2xvbmUgb2YgdGhlIG9iamVjdC4gXHJcbiAgICAgICAgICAgIC8vIFdlIHVzZSBUeXBlLklzVmFsdWVUeXBlIG1ldGhvZCBoZXJlIGJlY2F1c2UgdGhlcmUgaXMgbm8gd2F5IHRvIGluZGljYXRlIGRpcmVjdGx5IHdoZXRoZXIgXHJcbiAgICAgICAgICAgIC8vIHRoZSBUeXBlIGlzIGEgc3RydWN0IHR5cGUuXHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUuSXNDbGFzc3x8dHlwZS5Jc1ZhbHVlVHlwZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgb2JqZWN0IGNvcGllZE9iamVjdCA9IEFjdGl2YXRvci5DcmVhdGVJbnN0YW5jZShvYmouR2V0VHlwZSgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBHZXQgYWxsIEZpZWxkSW5mby5cclxuICAgICAgICAgICAgICAgIEZpZWxkSW5mb1tdIGZpZWxkcyA9IHR5cGUuR2V0RmllbGRzKEJpbmRpbmdGbGFncy5QdWJsaWMgfCBCaW5kaW5nRmxhZ3MuTm9uUHVibGljIHwgQmluZGluZ0ZsYWdzLkluc3RhbmNlKTtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKEZpZWxkSW5mbyBmaWVsZCBpbiBmaWVsZHMpXHJcbiAgICAgICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWJ1Zy5QcmludChcIkZpZWxkOiBcIiArIGZpZWxkLk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdCBmaWVsZFZhbHVlID0gZmllbGQuR2V0VmFsdWUob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmllbGRWYWx1ZSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlYnVnLlByaW50KFwiRmllbGQ6IFwiICsgZmllbGQuTmFtZSArIFwiIGJlaW5nIHNldFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBkZWVwIGNsb25lIG9mIHRoZSBmaWVsZCBpbiB0aGUgb3JpZ2luYWwgb2JqZWN0IGFuZCBhc3NpZ24gdGhlIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjbG9uZSB0byB0aGUgZmllbGQgaW4gdGhlIG5ldyBvYmplY3QuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkLlNldFZhbHVlKGNvcGllZE9iamVjdCwgQ2xvbmVQcm9jZWR1cmUoZmllbGRWYWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvcGllZE9iamVjdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudEV4Y2VwdGlvbihcIlRoZSBvYmplY3QgaXMgdW5rbm93biB0eXBlXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBvYmplY3QgQ29weVByb2NlZHVyZVBhcnRpYWwoT2JqZWN0IGZyb20sIE9iamVjdCB0bylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChmcm9tID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBUeXBlIHR5cGUgPSBmcm9tLkdldFR5cGUoKTtcclxuXHJcbiAgICAgICAgICAgIGRlYnVnLlByaW50KFwiQ29weWluZyBcIit0eXBlKTtcclxuICAgICAgICAgICAgZGVidWcuSWRlbnQoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIElmIHRoZSB0eXBlIG9mIG9iamVjdCBpcyB0aGUgdmFsdWUgdHlwZSwgd2Ugd2lsbCBhbHdheXMgZ2V0IGEgbmV3IG9iamVjdCB3aGVuIFxyXG4gICAgICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0IGlzIGFzc2lnbmVkIHRvIGFub3RoZXIgdmFyaWFibGUuIFNvIGlmIHRoZSB0eXBlIG9mIHRoZSBcclxuICAgICAgICAgICAgLy8gb2JqZWN0IGlzIHByaW1pdGl2ZSBvciBlbnVtLCB3ZSBqdXN0IHJldHVybiB0aGUgb2JqZWN0LiBXZSB3aWxsIHByb2Nlc3MgdGhlIFxyXG4gICAgICAgICAgICAvLyBzdHJ1Y3QgdHlwZSBzdWJzZXF1ZW50bHkgYmVjYXVzZSB0aGUgc3RydWN0IHR5cGUgbWF5IGNvbnRhaW4gdGhlIHJlZmVyZW5jZSBcclxuICAgICAgICAgICAgLy8gZmllbGRzLlxyXG4gICAgICAgICAgICAvLyBJZiB0aGUgc3RyaW5nIHZhcmlhYmxlcyBjb250YWluIHRoZSBzYW1lIGNoYXJzLCB0aGV5IGFsd2F5cyByZWZlciB0byB0aGUgc2FtZSBcclxuICAgICAgICAgICAgLy8gc3RyaW5nIGluIHRoZSBoZWFwLiBTbyBpZiB0aGUgdHlwZSBvZiB0aGUgb2JqZWN0IGlzIHN0cmluZywgd2UgYWxzbyByZXR1cm4gdGhlIFxyXG4gICAgICAgICAgICAvLyBvYmplY3QuXHJcbiAgICAgICAgICAgIGlmICh0eXBlLklzRW51bSB8fCB0eXBlID09IHR5cGVvZihzdHJpbmcpIHx8IHR5cGUgPT0gdHlwZW9mKGludCkgfHwgdHlwZSA9PSB0eXBlb2YoY2hhcikgfHwgdHlwZSA9PSB0eXBlb2YoZmxvYXQpIHx8IHR5cGUgPT0gdHlwZW9mKGRvdWJsZSkpXHJcbiAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGVidWcuUHJpbnQodHlwZSArIFwiIFwiK2Zyb20gKyBcIiAtVlwiKTtcclxuICAgICAgICAgICAgICAgIGRlYnVnLkRlaWRlbnQoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmcm9tO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGFycmF5cyBub3QgaW1wbGVtZW50ZWRcclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZS5Jc0FycmF5KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBkZWJ1Zy5EZWlkZW50KCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBJZiB0aGUgdHlwZSBvZiB0aGUgb2JqZWN0IGlzIGNsYXNzIG9yIHN0cnVjdCwgaXQgbWF5IGNvbnRhaW4gdGhlIHJlZmVyZW5jZSBmaWVsZHMsIFxyXG4gICAgICAgICAgICAvLyBzbyB3ZSB1c2UgcmVmbGVjdGlvbiBhbmQgcHJvY2VzcyByZWN1cnNpdmVseSB0aGlzIG1ldGhvZCBpbiB0aGUgZmllbGRzIG9mIHRoZSBvYmplY3QgXHJcbiAgICAgICAgICAgIC8vIHRvIGdldCB0aGUgZGVlcCBjbG9uZSBvZiB0aGUgb2JqZWN0LiBcclxuICAgICAgICAgICAgLy8gV2UgdXNlIFR5cGUuSXNWYWx1ZVR5cGUgbWV0aG9kIGhlcmUgYmVjYXVzZSB0aGVyZSBpcyBubyB3YXkgdG8gaW5kaWNhdGUgZGlyZWN0bHkgd2hldGhlciBcclxuICAgICAgICAgICAgLy8gdGhlIFR5cGUgaXMgYSBzdHJ1Y3QgdHlwZS5cclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZS5Jc0NsYXNzIHx8IHR5cGUuSXNWYWx1ZVR5cGUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG9iamVjdCBjb3BpZWRPYmplY3QgPSB0bztcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBHZXQgYWxsIEZpZWxkSW5mby5cclxuICAgICAgICAgICAgICAgIEZpZWxkSW5mb1tdIGZpZWxkcyA9IHR5cGUuR2V0RmllbGRzKEJpbmRpbmdGbGFncy5QdWJsaWMgfCBCaW5kaW5nRmxhZ3MuTm9uUHVibGljIHwgQmluZGluZ0ZsYWdzLkluc3RhbmNlKTtcclxuICAgICAgICAgICAgICAgIGZvcmVhY2ggKEZpZWxkSW5mbyBmaWVsZCBpbiBmaWVsZHMpXHJcbiAgICAgICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWJ1Zy5QcmludChcIkZpZWxkOiBcIiArIGZpZWxkLk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdCBmaWVsZFZhbHVlID0gZmllbGQuR2V0VmFsdWUoZnJvbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkVmFsdWUgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYnVnLlByaW50KFwiRmllbGQ6IFwiICsgZmllbGQuTmFtZSArIFwiIG5vdCBudWxsLCBiZWluZyBzZXRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgZGVlcCBjbG9uZSBvZiB0aGUgZmllbGQgaW4gdGhlIG9yaWdpbmFsIG9iamVjdCBhbmQgYXNzaWduIHRoZSBcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2xvbmUgdG8gdGhlIGZpZWxkIGluIHRoZSBuZXcgb2JqZWN0LlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWJ1Zy5JZGVudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWVsZC5TZXRWYWx1ZShjb3BpZWRPYmplY3QsIENsb25lUHJvY2VkdXJlKGZpZWxkVmFsdWUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVidWcuRGVpZGVudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBkZWJ1Zy5EZWlkZW50KCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29waWVkT2JqZWN0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZGVidWcuRGVpZGVudCgpO1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uKFwiVGhlIG9iamVjdCBpcyB1bmtub3duIHR5cGVcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5CYXNlVXRpbHNcclxue1xyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgRXh0ZW5zaW9uc1xyXG4gICAge1xyXG4gICAgICAgIC8vcHJpdmF0ZSBzdGF0aWMgUmFuZG9tIHJuZyA9IG5ldyBSYW5kb20oKTtcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIFNodWZmbGU8VD4odGhpcyBJTGlzdDxUPiBsaXN0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IG4gPSBsaXN0LkNvdW50O1xyXG4gICAgICAgICAgICB3aGlsZSAobiA+IDEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG4tLTtcclxuICAgICAgICAgICAgICAgIGludCBrID0gUmFuZG9tU3VwcGxpZXIuTmV4dChuICsgMSk7XHJcbiAgICAgICAgICAgICAgICBUIHZhbHVlID0gbGlzdFtrXTtcclxuICAgICAgICAgICAgICAgIGxpc3Rba10gPSBsaXN0W25dO1xyXG4gICAgICAgICAgICAgICAgbGlzdFtuXSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFQgUmFuZG9tRWxlbWVudDxUPih0aGlzIElMaXN0PFQ+IGxpc3QpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgZWxlbWVudCA9IFJhbmRvbVN1cHBsaWVyLk5leHQobGlzdC5Db3VudC0xKTtcclxuICAgICAgICAgICAgcmV0dXJuIGxpc3RbZWxlbWVudF07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsIiNyZWdpb24gTGljZW5zZVxyXG4vKlxyXG5NSVQgTGljZW5zZVxyXG5Db3B5cmlnaHQgwqkgMjAwNiBUaGUgTW9uby5YbmEgVGVhbVxyXG5cclxuQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuXHJcblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcclxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxyXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXHJcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcclxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXHJcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XHJcblxyXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcclxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cclxuXHJcblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcclxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxyXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXHJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXHJcblNPRlRXQVJFLlxyXG4qL1xyXG4jZW5kcmVnaW9uIExpY2Vuc2VcclxudXNpbmcgU3lzdGVtO1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5CYXNlVXRpbHNcclxue1xyXG4gICAgcHVibGljIHN0cnVjdCBQb2ludDJEIDogSUVxdWF0YWJsZTxQb2ludDJEPlxyXG4gICAge1xyXG4gICAgICAgICNyZWdpb24gUHJpdmF0ZSBGaWVsZHNcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgUG9pbnQyRCB6ZXJvUG9pbnQgPSBuZXcgUG9pbnQyRCgpO1xyXG5cclxuICAgICAgICAjZW5kcmVnaW9uIFByaXZhdGUgRmllbGRzXHJcblxyXG5cclxuICAgICAgICAjcmVnaW9uIFB1YmxpYyBGaWVsZHNcclxuXHJcbiAgICAgICAgcHVibGljIGludCBYO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgWTtcclxuXHJcbiAgICAgICAgI2VuZHJlZ2lvbiBQdWJsaWMgRmllbGRzXHJcblxyXG5cclxuICAgICAgICAjcmVnaW9uIFByb3BlcnRpZXNcclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBQb2ludDJEIFplcm9cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldCB7IHJldHVybiB6ZXJvUG9pbnQ7IH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICNlbmRyZWdpb24gUHJvcGVydGllc1xyXG5cclxuXHJcbiAgICAgICAgI3JlZ2lvbiBDb25zdHJ1Y3RvcnNcclxuXHJcbiAgICAgICAgcHVibGljIFBvaW50MkQoaW50IHgsIGludCB5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5YID0geDtcclxuICAgICAgICAgICAgdGhpcy5ZID0geTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICNlbmRyZWdpb24gQ29uc3RydWN0b3JzXHJcblxyXG5cclxuICAgICAgICAjcmVnaW9uIFB1YmxpYyBtZXRob2RzXHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBvcGVyYXRvciA9PShQb2ludDJEIGEsIFBvaW50MkQgYilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBhLkVxdWFscyhiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBvcGVyYXRvciAhPShQb2ludDJEIGEsIFBvaW50MkQgYilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAhYS5FcXVhbHMoYik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBFcXVhbHMoUG9pbnQyRCBvdGhlcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAoKFggPT0gb3RoZXIuWCkgJiYgKFkgPT0gb3RoZXIuWSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIGJvb2wgRXF1YWxzKG9iamVjdCBvYmopXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gKG9iaiBpcyBQb2ludDJEKSA/IEVxdWFscygoUG9pbnQyRClvYmopIDogZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgaW50IEdldEhhc2hDb2RlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBYIF4gWTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSBzdHJpbmcgVG9TdHJpbmcoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0cmluZy5Gb3JtYXQoXCJ7e1g6ezB9IFk6ezF9fX1cIiwgWCwgWSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAjZW5kcmVnaW9uXHJcbiAgICB9XHJcbn1cclxuXHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guQmFzZVV0aWxzXHJcbntcclxuICAgIHN0YXRpYyBwdWJsaWMgY2xhc3MgUmFuZG9tU3VwcGxpZXJcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIEZ1bmM8ZmxvYXQ+IEdlbmVyYXRleyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGludCBSYW5nZShpbnQgbWluLCBpbnQgbWF4KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAoaW50KSAoKEdlbmVyYXRlKCkgKiAobWF4LW1pbikrbWluKSswLjVmKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVCBSYW5kb21FbGVtZW50PFQ+KFRbXSBhcnJheSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBhcnJheVtSYW5nZSgwLCBhcnJheS5MZW5ndGgtMSldO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgc3RhdGljIGludCBOZXh0KGludCBjb3VudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBSYW5nZSgwLCBjb3VudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsIiNyZWdpb24gTGljZW5zZVxyXG4vKlxyXG5NSVQgTGljZW5zZVxyXG5Db3B5cmlnaHQgwqkgMjAwNiBUaGUgTW9uby5YbmEgVGVhbVxyXG5cclxuQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuXHJcblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcclxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxyXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXHJcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcclxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXHJcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XHJcblxyXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcclxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cclxuXHJcblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcclxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXHJcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxyXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXHJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXHJcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXHJcblNPRlRXQVJFLlxyXG4qL1xyXG4jZW5kcmVnaW9uIExpY2Vuc2VcclxuXHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkdsb2JhbGl6YXRpb247XHJcbnVzaW5nIFN5c3RlbS5Db21wb25lbnRNb2RlbDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guQmFzZVV0aWxzXHJcbntcclxuXHJcbiAgICBwdWJsaWMgc3RydWN0IFJlY3QgOiBJRXF1YXRhYmxlPFJlY3Q+XHJcbiAgICB7XHJcbiAgICAgICAgI3JlZ2lvbiBQcml2YXRlIEZpZWxkc1xyXG5cclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBSZWN0IGVtcHR5UmVjdGFuZ2xlID0gbmV3IFJlY3QoKTtcclxuXHJcbiAgICAgICAgI2VuZHJlZ2lvbiBQcml2YXRlIEZpZWxkc1xyXG5cclxuXHJcbiAgICAgICAgI3JlZ2lvbiBQdWJsaWMgRmllbGRzXHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgWDtcclxuICAgICAgICBwdWJsaWMgaW50IFk7XHJcbiAgICAgICAgcHVibGljIGludCBXaWR0aDtcclxuICAgICAgICBwdWJsaWMgaW50IEhlaWdodDtcclxuXHJcbiAgICAgICAgI2VuZHJlZ2lvbiBQdWJsaWMgRmllbGRzXHJcblxyXG5cclxuICAgICAgICAjcmVnaW9uIFB1YmxpYyBQcm9wZXJ0aWVzXHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgUmVjdCBFbXB0eVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIGVtcHR5UmVjdGFuZ2xlOyB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgaW50IExlZnRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldCB7IHJldHVybiB0aGlzLlg7IH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgUmlnaHRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldCB7IHJldHVybiAodGhpcy5YICsgdGhpcy5XaWR0aCk7IH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgVG9wXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXQgeyByZXR1cm4gdGhpcy5ZOyB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgaW50IEJvdHRvbVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0IHsgcmV0dXJuICh0aGlzLlkgKyB0aGlzLkhlaWdodCk7IH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICNlbmRyZWdpb24gUHVibGljIFByb3BlcnRpZXNcclxuXHJcblxyXG4gICAgICAgICNyZWdpb24gQ29uc3RydWN0b3JzXHJcblxyXG4gICAgICAgIHB1YmxpYyBSZWN0KGludCB4LCBpbnQgeSwgaW50IHdpZHRoLCBpbnQgaGVpZ2h0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5YID0geDtcclxuICAgICAgICAgICAgdGhpcy5ZID0geTtcclxuICAgICAgICAgICAgdGhpcy5XaWR0aCA9IHdpZHRoO1xyXG4gICAgICAgICAgICB0aGlzLkhlaWdodCA9IGhlaWdodDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICNlbmRyZWdpb24gQ29uc3RydWN0b3JzXHJcblxyXG5cclxuICAgICAgICAjcmVnaW9uIFB1YmxpYyBNZXRob2RzXHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBvcGVyYXRvciA9PShSZWN0IGEsIFJlY3QgYilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAoKGEuWCA9PSBiLlgpICYmIChhLlkgPT0gYi5ZKSAmJiAoYS5XaWR0aCA9PSBiLldpZHRoKSAmJiAoYS5IZWlnaHQgPT0gYi5IZWlnaHQpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIENvbnRhaW5zKGludCB4LCBpbnQgeSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAoKCgodGhpcy5YIDw9IHgpICYmICh4IDwgKHRoaXMuWCArIHRoaXMuV2lkdGgpKSkgJiYgKHRoaXMuWSA8PSB5KSkgJiYgKHkgPCAodGhpcy5ZICsgdGhpcy5IZWlnaHQpKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBDb250YWlucyhWZWN0b3IyRCB2YWx1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAoKCgodGhpcy5YIDw9IHZhbHVlLlgpICYmICh2YWx1ZS5YIDwgKHRoaXMuWCArIHRoaXMuV2lkdGgpKSkgJiYgKHRoaXMuWSA8PSB2YWx1ZS5ZKSkgJiYgKHZhbHVlLlkgPCAodGhpcy5ZICsgdGhpcy5IZWlnaHQpKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBDb250YWlucyhQb2ludDJEIHZhbHVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuICgoKCh0aGlzLlggPD0gdmFsdWUuWCkgJiYgKHZhbHVlLlggPCAodGhpcy5YICsgdGhpcy5XaWR0aCkpKSAmJiAodGhpcy5ZIDw9IHZhbHVlLlkpKSAmJiAodmFsdWUuWSA8ICh0aGlzLlkgKyB0aGlzLkhlaWdodCkpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIENvbnRhaW5zKFJlY3QgdmFsdWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gKCgoKHRoaXMuWCA8PSB2YWx1ZS5YKSAmJiAoKHZhbHVlLlggKyB2YWx1ZS5XaWR0aCkgPD0gKHRoaXMuWCArIHRoaXMuV2lkdGgpKSkgJiYgKHRoaXMuWSA8PSB2YWx1ZS5ZKSkgJiYgKCh2YWx1ZS5ZICsgdmFsdWUuSGVpZ2h0KSA8PSAodGhpcy5ZICsgdGhpcy5IZWlnaHQpKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgb3BlcmF0b3IgIT0oUmVjdCBhLCBSZWN0IGIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gIShhID09IGIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgT2Zmc2V0KFBvaW50MkQgb2Zmc2V0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgWCArPSBvZmZzZXQuWDtcclxuICAgICAgICAgICAgWSArPSBvZmZzZXQuWTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIE9mZnNldChpbnQgb2Zmc2V0WCwgaW50IG9mZnNldFkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBYICs9IG9mZnNldFg7XHJcbiAgICAgICAgICAgIFkgKz0gb2Zmc2V0WTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBQb2ludDJEIENlbnRlclxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUG9pbnQyRCgodGhpcy5YICsgdGhpcy5XaWR0aCkgLyAyLCAodGhpcy5ZICsgdGhpcy5IZWlnaHQpIC8gMik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEluZmxhdGUoaW50IGhvcml6b250YWxWYWx1ZSwgaW50IHZlcnRpY2FsVmFsdWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBYIC09IGhvcml6b250YWxWYWx1ZTtcclxuICAgICAgICAgICAgWSAtPSB2ZXJ0aWNhbFZhbHVlO1xyXG4gICAgICAgICAgICBXaWR0aCArPSBob3Jpem9udGFsVmFsdWUgKiAyO1xyXG4gICAgICAgICAgICBIZWlnaHQgKz0gdmVydGljYWxWYWx1ZSAqIDI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBJc0VtcHR5XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICgoKCh0aGlzLldpZHRoID09IDApICYmICh0aGlzLkhlaWdodCA9PSAwKSkgJiYgKHRoaXMuWCA9PSAwKSkgJiYgKHRoaXMuWSA9PSAwKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIEVxdWFscyhSZWN0IG90aGVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMgPT0gb3RoZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgYm9vbCBFcXVhbHMob2JqZWN0IG9iailcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAob2JqIGlzIFJlY3QpID8gdGhpcyA9PSAoKFJlY3Qpb2JqKSA6IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHN0cmluZyBUb1N0cmluZygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gc3RyaW5nLkZvcm1hdChcInt7WDp7MH0gWTp7MX0gV2lkdGg6ezJ9IEhlaWdodDp7M319fVwiLCBYLCBZLCBXaWR0aCwgSGVpZ2h0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSBpbnQgR2V0SGFzaENvZGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuICh0aGlzLlggXiB0aGlzLlkgXiB0aGlzLldpZHRoIF4gdGhpcy5IZWlnaHQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgSW50ZXJzZWN0cyhSZWN0IHIyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuICEocjIuTGVmdCA+IFJpZ2h0XHJcbiAgICAgICAgICAgICAgICAgICAgIHx8IHIyLlJpZ2h0IDwgTGVmdFxyXG4gICAgICAgICAgICAgICAgICAgICB8fCByMi5Ub3AgPiBCb3R0b21cclxuICAgICAgICAgICAgICAgICAgICAgfHwgcjIuQm90dG9tIDwgVG9wXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgSW50ZXJzZWN0cyhyZWYgUmVjdCB2YWx1ZSwgb3V0IGJvb2wgcmVzdWx0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gISh2YWx1ZS5MZWZ0ID4gUmlnaHRcclxuICAgICAgICAgICAgICAgICAgICAgfHwgdmFsdWUuUmlnaHQgPCBMZWZ0XHJcbiAgICAgICAgICAgICAgICAgICAgIHx8IHZhbHVlLlRvcCA+IEJvdHRvbVxyXG4gICAgICAgICAgICAgICAgICAgICB8fCB2YWx1ZS5Cb3R0b20gPCBUb3BcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICNlbmRyZWdpb24gUHVibGljIE1ldGhvZHNcclxuICAgIH1cclxufSIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5CYXNlVXRpbHNcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFRpbWVTdGFtcFxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBDdXJyZW50U25hcDtcclxuXHJcbiAgICAgICAgcHVibGljIFRpbWVTdGFtcFNuYXAgR2V0U25hcCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFRpbWVTdGFtcFNuYXAoQ3VycmVudFNuYXApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBwdWJsaWMgdm9pZCBBZHZhbmNlKGZsb2F0IGRlbHRhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQ3VycmVudFNuYXAgKz0gZGVsdGE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdHJ1Y3QgVGltZVN0YW1wU25hcFxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBmbG9hdCBUaW1lU25hcDtcclxuXHJcbiAgICAgICAgcHVibGljIFRpbWVTdGFtcFNuYXAoZmxvYXQgc25hcClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFRpbWVTbmFwID0gc25hcDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLkJhc2VVdGlsc1xyXG57XHJcbiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIFVuaWNvZGVcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgY29uc3QgaW50IFNwYWNlID0gMzI7XHJcbiAgICAgICAgcHVibGljIGNvbnN0IGludCBFbnRlciA9IDEzO1xyXG4gICAgICAgIHB1YmxpYyBjb25zdCBpbnQgQmFja3NwYWNlID0gODtcclxuXHJcbiAgICAgICAgcHVibGljIGNvbnN0IGludCBrZXlEb3duID0gNDA7XHJcbiAgICAgICAgcHVibGljIGNvbnN0IGludCBrZXlMZWZ0ID0gMzc7XHJcbiAgICAgICAgcHVibGljIGNvbnN0IGludCBrZXlVcCA9IDM4O1xyXG4gICAgICAgIHB1YmxpYyBjb25zdCBpbnQga2V5UmlnaHQgPSAzOTtcclxuXHJcbiAgICAgICAgcHVibGljIGNvbnN0IGNoYXIgVXBhcnJvdzIgPSAoY2hhcikyNDtcclxuICAgICAgICBwdWJsaWMgY29uc3QgY2hhciBEb3duYXJyb3cyID0gKGNoYXIpMjU7XHJcbiAgICAgICAgcHVibGljIGNvbnN0IGNoYXIgUmlnaHRhcnJvdzIgPSAoY2hhcikyNjtcclxuICAgICAgICBwdWJsaWMgY29uc3QgY2hhciBMZWZ0YXJyb3cyID0gKGNoYXIpMjc7XHJcbiAgICAgICAgcHVibGljIGNvbnN0IGNoYXIgVXBhcnJvdyA9IChjaGFyKTMwO1xyXG4gICAgICAgIHB1YmxpYyBjb25zdCBjaGFyIERvd25hcnJvdyA9IChjaGFyKTMxO1xyXG4gICAgICAgIHB1YmxpYyBjb25zdCBjaGFyIExlZnRhcnJvdyA9IChjaGFyKTE3O1xyXG4gICAgICAgIHB1YmxpYyBjb25zdCBjaGFyIFJpZ2h0YXJyb3cgPSAoY2hhcikxNjtcclxuICAgICAgICBwdWJsaWMgY29uc3QgY2hhciBBc2NpaUdyaWRIb3IgPSAoY2hhcikxOTY7XHJcbiAgICAgICAgcHVibGljIGNvbnN0IGNoYXIgQXNjaWlHcmlkVmVyID0gKGNoYXIpMTc5O1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IGNoYXJbXSBncmlkcyA9IG5ldyBjaGFyW10ge1xyXG4gICAgICAgICAgICBBc2NpaUdyaWRIb3IsXHJcbiAgICAgICAgICAgIEFzY2lpR3JpZFZlclxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyByZWFkb25seSBjaGFyIEFzY2lpR3JpZFVwTGVmdCA9IChjaGFyKTIxNztcclxuICAgICAgICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IGNoYXIgQXNjaWlHcmlkVXBSaWdodCA9IChjaGFyKSAxOTI7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyByZWFkb25seSBjaGFyIEFzY2lpR3JpZFVwUmlnaHRMZWZ0ID0gKGNoYXIpMTkzO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgY2hhciBBc2NpaUdyaWREb3duTGVmdCA9IChjaGFyKTE5MTtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IGNoYXIgQXNjaWlHcmlkRG93blJpZ2h0ID0gKGNoYXIpMjE4O1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgY2hhciBBc2NpaUdyaWREb3duUmlnaHRMZWZ0ID0gKGNoYXIpMTk0O1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgaW50IEVzY2FwZSA9IChjaGFyKTI3O1xyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcbi8vdXNpbmcgU3lzdGVtLkRyYXdpbmc7XHJcbnVzaW5nIFN5c3RlbS5HbG9iYWxpemF0aW9uO1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5CYXNlVXRpbHNcclxue1xyXG4gICAgW1NlcmlhbGl6YWJsZV1cclxuICAgIHB1YmxpYyBzdHJ1Y3QgVmVjdG9yMkQgOiBJRXF1YXRhYmxlPFZlY3RvcjJEPlxyXG4gICAge1xyXG4gICAgICAgICNyZWdpb24gUHJpdmF0ZSBGaWVsZHNcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgVmVjdG9yMkQgemVyb1ZlY3RvciA9IG5ldyBWZWN0b3IyRCgwZiwgMGYpO1xyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIFZlY3RvcjJEIHVuaXRWZWN0b3IgPSBuZXcgVmVjdG9yMkQoMWYsIDFmKTtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IyRCB1bml0WFZlY3RvciA9IG5ldyBWZWN0b3IyRCgxZiwgMGYpO1xyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIFZlY3RvcjJEIHVuaXRZVmVjdG9yID0gbmV3IFZlY3RvcjJEKDBmLCAxZik7XHJcblxyXG4gICAgICAgICNlbmRyZWdpb24gUHJpdmF0ZSBGaWVsZHNcclxuXHJcblxyXG4gICAgICAgICNyZWdpb24gUHVibGljIEZpZWxkc1xyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgWDtcclxuICAgICAgICBwdWJsaWMgZmxvYXQgWTtcclxuXHJcbiAgICAgICAgI2VuZHJlZ2lvbiBQdWJsaWMgRmllbGRzXHJcblxyXG4gICAgICAgICMgcmVnaW9uIFB1YmxpYyBQcm9wZXJ0aWVzXHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgWEludCB7IGdldCB7IHJldHVybiAoaW50KVg7IH0gfVxyXG4gICAgICAgIHB1YmxpYyBpbnQgWUludCB7IGdldCB7IHJldHVybiAoaW50KVk7IH0gfVxyXG5cclxuICAgICAgICAjZW5kcmVnaW9uIFB1YmxpYyBQcm9wZXJ0aWVzXHJcblxyXG4gICAgICAgICNyZWdpb24gQ29uc3RhbnRzXHJcbiAgICAgICAgI2VuZHJlZ2lvblxyXG5cclxuXHJcbiAgICAgICAgI3JlZ2lvbiBQcm9wZXJ0aWVzXHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yMkQgWmVyb1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIHplcm9WZWN0b3I7IH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yMkQgT25lXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXQgeyByZXR1cm4gdW5pdFZlY3RvcjsgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyRCBVbml0WFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIHVuaXRYVmVjdG9yOyB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjJEIFVuaXRZXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXQgeyByZXR1cm4gdW5pdFlWZWN0b3I7IH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICNlbmRyZWdpb24gUHJvcGVydGllc1xyXG5cclxuXHJcbiAgICAgICAgI3JlZ2lvbiBDb25zdHJ1Y3RvcnNcclxuXHJcbiAgICAgICAgcHVibGljIFZlY3RvcjJEKGZsb2F0IHgsIGZsb2F0IHkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLlggPSB4O1xyXG4gICAgICAgICAgICB0aGlzLlkgPSB5O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIFZlY3RvcjJEKGZsb2F0IHZhbHVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5YID0gdmFsdWU7XHJcbiAgICAgICAgICAgIHRoaXMuWSA9IHZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyRCBJbnRlcnBvbGF0ZVJvdW5kZWQoVmVjdG9yMkQgc3RhcnRQb3NpdGlvbiwgVmVjdG9yMkQgZW5kUG9zaXRpb24sIGZsb2F0IHJhdGlvKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIChzdGFydFBvc2l0aW9uICogKDEgLSByYXRpbykgKyBlbmRQb3NpdGlvbiAqIHJhdGlvKS5Sb3VuZCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBWZWN0b3IyRCBSb3VuZCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjJEKChmbG9hdClNYXRoLlJvdW5kKFgpLCAoZmxvYXQpTWF0aC5Sb3VuZChZKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAjZW5kcmVnaW9uIENvbnN0cnVjdG9yc1xyXG5cclxuXHJcbiAgICAgICAgI3JlZ2lvbiBQdWJsaWMgTWV0aG9kc1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjJEIEFkZChWZWN0b3IyRCB2YWx1ZTEsIFZlY3RvcjJEIHZhbHVlMilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhbHVlMS5YICs9IHZhbHVlMi5YO1xyXG4gICAgICAgICAgICB2YWx1ZTEuWSArPSB2YWx1ZTIuWTtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBBZGQocmVmIFZlY3RvcjJEIHZhbHVlMSwgcmVmIFZlY3RvcjJEIHZhbHVlMiwgb3V0IFZlY3RvcjJEIHJlc3VsdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5YID0gdmFsdWUxLlggKyB2YWx1ZTIuWDtcclxuICAgICAgICAgICAgcmVzdWx0LlkgPSB2YWx1ZTEuWSArIHZhbHVlMi5ZO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvYXQgRGlzdGFuY2UoVmVjdG9yMkQgdmFsdWUxLCBWZWN0b3IyRCB2YWx1ZTIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmbG9hdCB2MSA9IHZhbHVlMS5YIC0gdmFsdWUyLlgsIHYyID0gdmFsdWUxLlkgLSB2YWx1ZTIuWTtcclxuICAgICAgICAgICAgcmV0dXJuIChmbG9hdClNYXRoLlNxcnQoKHYxICogdjEpICsgKHYyICogdjIpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBEaXN0YW5jZShyZWYgVmVjdG9yMkQgdmFsdWUxLCByZWYgVmVjdG9yMkQgdmFsdWUyLCBvdXQgZmxvYXQgcmVzdWx0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgdjEgPSB2YWx1ZTEuWCAtIHZhbHVlMi5YLCB2MiA9IHZhbHVlMS5ZIC0gdmFsdWUyLlk7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IChmbG9hdClNYXRoLlNxcnQoKHYxICogdjEpICsgKHYyICogdjIpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvYXQgRGlzdGFuY2VTcXVhcmVkKFZlY3RvcjJEIHZhbHVlMSwgVmVjdG9yMkQgdmFsdWUyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgdjEgPSB2YWx1ZTEuWCAtIHZhbHVlMi5YLCB2MiA9IHZhbHVlMS5ZIC0gdmFsdWUyLlk7XHJcbiAgICAgICAgICAgIHJldHVybiAodjEgKiB2MSkgKyAodjIgKiB2Mik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgRGlzdGFuY2VTcXVhcmVkKHJlZiBWZWN0b3IyRCB2YWx1ZTEsIHJlZiBWZWN0b3IyRCB2YWx1ZTIsIG91dCBmbG9hdCByZXN1bHQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmbG9hdCB2MSA9IHZhbHVlMS5YIC0gdmFsdWUyLlgsIHYyID0gdmFsdWUxLlkgLSB2YWx1ZTIuWTtcclxuICAgICAgICAgICAgcmVzdWx0ID0gKHYxICogdjEpICsgKHYyICogdjIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0KGludCB4LCBpbnQgeSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFggPSB4O1xyXG4gICAgICAgICAgICBZID0geTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjJEIERpdmlkZShWZWN0b3IyRCB2YWx1ZTEsIFZlY3RvcjJEIHZhbHVlMilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhbHVlMS5YIC89IHZhbHVlMi5YO1xyXG4gICAgICAgICAgICB2YWx1ZTEuWSAvPSB2YWx1ZTIuWTtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBEaXZpZGUocmVmIFZlY3RvcjJEIHZhbHVlMSwgcmVmIFZlY3RvcjJEIHZhbHVlMiwgb3V0IFZlY3RvcjJEIHJlc3VsdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5YID0gdmFsdWUxLlggLyB2YWx1ZTIuWDtcclxuICAgICAgICAgICAgcmVzdWx0LlkgPSB2YWx1ZTEuWSAvIHZhbHVlMi5ZO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyRCBEaXZpZGUoVmVjdG9yMkQgdmFsdWUxLCBmbG9hdCBkaXZpZGVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgZmFjdG9yID0gMSAvIGRpdmlkZXI7XHJcbiAgICAgICAgICAgIHZhbHVlMS5YICo9IGZhY3RvcjtcclxuICAgICAgICAgICAgdmFsdWUxLlkgKj0gZmFjdG9yO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIERpdmlkZShyZWYgVmVjdG9yMkQgdmFsdWUxLCBmbG9hdCBkaXZpZGVyLCBvdXQgVmVjdG9yMkQgcmVzdWx0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgZmFjdG9yID0gMSAvIGRpdmlkZXI7XHJcbiAgICAgICAgICAgIHJlc3VsdC5YID0gdmFsdWUxLlggKiBmYWN0b3I7XHJcbiAgICAgICAgICAgIHJlc3VsdC5ZID0gdmFsdWUxLlkgKiBmYWN0b3I7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGZsb2F0IERvdChWZWN0b3IyRCB2YWx1ZTEsIFZlY3RvcjJEIHZhbHVlMilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAodmFsdWUxLlggKiB2YWx1ZTIuWCkgKyAodmFsdWUxLlkgKiB2YWx1ZTIuWSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgRG90KHJlZiBWZWN0b3IyRCB2YWx1ZTEsIHJlZiBWZWN0b3IyRCB2YWx1ZTIsIG91dCBmbG9hdCByZXN1bHQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXN1bHQgPSAodmFsdWUxLlggKiB2YWx1ZTIuWCkgKyAodmFsdWUxLlkgKiB2YWx1ZTIuWSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgYm9vbCBFcXVhbHMob2JqZWN0IG9iailcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChvYmogaXMgVmVjdG9yMkQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBFcXVhbHMoKFZlY3RvcjJEKXRoaXMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBFcXVhbHMoVmVjdG9yMkQgb3RoZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gKFggPT0gb3RoZXIuWCkgJiYgKFkgPT0gb3RoZXIuWSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjJEIFJlZmxlY3QoVmVjdG9yMkQgdmVjdG9yLCBWZWN0b3IyRCBub3JtYWwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBWZWN0b3IyRCByZXN1bHQ7XHJcbiAgICAgICAgICAgIGZsb2F0IHZhbCA9IDIuMGYgKiAoKHZlY3Rvci5YICogbm9ybWFsLlgpICsgKHZlY3Rvci5ZICogbm9ybWFsLlkpKTtcclxuICAgICAgICAgICAgcmVzdWx0LlggPSB2ZWN0b3IuWCAtIChub3JtYWwuWCAqIHZhbCk7XHJcbiAgICAgICAgICAgIHJlc3VsdC5ZID0gdmVjdG9yLlkgLSAobm9ybWFsLlkgKiB2YWwpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIFJlZmxlY3QocmVmIFZlY3RvcjJEIHZlY3RvciwgcmVmIFZlY3RvcjJEIG5vcm1hbCwgb3V0IFZlY3RvcjJEIHJlc3VsdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0IHZhbCA9IDIuMGYgKiAoKHZlY3Rvci5YICogbm9ybWFsLlgpICsgKHZlY3Rvci5ZICogbm9ybWFsLlkpKTtcclxuICAgICAgICAgICAgcmVzdWx0LlggPSB2ZWN0b3IuWCAtIChub3JtYWwuWCAqIHZhbCk7XHJcbiAgICAgICAgICAgIHJlc3VsdC5ZID0gdmVjdG9yLlkgLSAobm9ybWFsLlkgKiB2YWwpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIGludCBHZXRIYXNoQ29kZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gWC5HZXRIYXNoQ29kZSgpICsgWS5HZXRIYXNoQ29kZSgpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBMZW5ndGgoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIChmbG9hdClNYXRoLlNxcnQoKFggKiBYKSArIChZICogWSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IExlbmd0aFNxdWFyZWQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIChYICogWCkgKyAoWSAqIFkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjJEIE1heChWZWN0b3IyRCB2YWx1ZTEsIFZlY3RvcjJEIHZhbHVlMilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmVjdG9yMkQodmFsdWUxLlggPiB2YWx1ZTIuWCA/IHZhbHVlMS5YIDogdmFsdWUyLlgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTEuWSA+IHZhbHVlMi5ZID8gdmFsdWUxLlkgOiB2YWx1ZTIuWSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgTWF4KHJlZiBWZWN0b3IyRCB2YWx1ZTEsIHJlZiBWZWN0b3IyRCB2YWx1ZTIsIG91dCBWZWN0b3IyRCByZXN1bHQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXN1bHQuWCA9IHZhbHVlMS5YID4gdmFsdWUyLlggPyB2YWx1ZTEuWCA6IHZhbHVlMi5YO1xyXG4gICAgICAgICAgICByZXN1bHQuWSA9IHZhbHVlMS5ZID4gdmFsdWUyLlkgPyB2YWx1ZTEuWSA6IHZhbHVlMi5ZO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyRCBNaW4oVmVjdG9yMkQgdmFsdWUxLCBWZWN0b3IyRCB2YWx1ZTIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZlY3RvcjJEKHZhbHVlMS5YIDwgdmFsdWUyLlggPyB2YWx1ZTEuWCA6IHZhbHVlMi5YLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUxLlkgPCB2YWx1ZTIuWSA/IHZhbHVlMS5ZIDogdmFsdWUyLlkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIE1pbihyZWYgVmVjdG9yMkQgdmFsdWUxLCByZWYgVmVjdG9yMkQgdmFsdWUyLCBvdXQgVmVjdG9yMkQgcmVzdWx0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmVzdWx0LlggPSB2YWx1ZTEuWCA8IHZhbHVlMi5YID8gdmFsdWUxLlggOiB2YWx1ZTIuWDtcclxuICAgICAgICAgICAgcmVzdWx0LlkgPSB2YWx1ZTEuWSA8IHZhbHVlMi5ZID8gdmFsdWUxLlkgOiB2YWx1ZTIuWTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yMkQgTXVsdGlwbHkoVmVjdG9yMkQgdmFsdWUxLCBWZWN0b3IyRCB2YWx1ZTIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YWx1ZTEuWCAqPSB2YWx1ZTIuWDtcclxuICAgICAgICAgICAgdmFsdWUxLlkgKj0gdmFsdWUyLlk7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjJEIE11bHRpcGx5KFZlY3RvcjJEIHZhbHVlMSwgZmxvYXQgc2NhbGVGYWN0b3IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YWx1ZTEuWCAqPSBzY2FsZUZhY3RvcjtcclxuICAgICAgICAgICAgdmFsdWUxLlkgKj0gc2NhbGVGYWN0b3I7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgTXVsdGlwbHkocmVmIFZlY3RvcjJEIHZhbHVlMSwgZmxvYXQgc2NhbGVGYWN0b3IsIG91dCBWZWN0b3IyRCByZXN1bHQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXN1bHQuWCA9IHZhbHVlMS5YICogc2NhbGVGYWN0b3I7XHJcbiAgICAgICAgICAgIHJlc3VsdC5ZID0gdmFsdWUxLlkgKiBzY2FsZUZhY3RvcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBNdWx0aXBseShyZWYgVmVjdG9yMkQgdmFsdWUxLCByZWYgVmVjdG9yMkQgdmFsdWUyLCBvdXQgVmVjdG9yMkQgcmVzdWx0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmVzdWx0LlggPSB2YWx1ZTEuWCAqIHZhbHVlMi5YO1xyXG4gICAgICAgICAgICByZXN1bHQuWSA9IHZhbHVlMS5ZICogdmFsdWUyLlk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjJEIE5lZ2F0ZShWZWN0b3IyRCB2YWx1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhbHVlLlggPSAtdmFsdWUuWDtcclxuICAgICAgICAgICAgdmFsdWUuWSA9IC12YWx1ZS5ZO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgTmVnYXRlKHJlZiBWZWN0b3IyRCB2YWx1ZSwgb3V0IFZlY3RvcjJEIHJlc3VsdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5YID0gLXZhbHVlLlg7XHJcbiAgICAgICAgICAgIHJlc3VsdC5ZID0gLXZhbHVlLlk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBOb3JtYWxpemUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgdmFsID0gMS4wZiAvIChmbG9hdClNYXRoLlNxcnQoKFggKiBYKSArIChZICogWSkpO1xyXG4gICAgICAgICAgICBYICo9IHZhbDtcclxuICAgICAgICAgICAgWSAqPSB2YWw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjJEIE5vcm1hbGl6ZShWZWN0b3IyRCB2YWx1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0IHZhbCA9IDEuMGYgLyAoZmxvYXQpTWF0aC5TcXJ0KCh2YWx1ZS5YICogdmFsdWUuWCkgKyAodmFsdWUuWSAqIHZhbHVlLlkpKTtcclxuICAgICAgICAgICAgdmFsdWUuWCAqPSB2YWw7XHJcbiAgICAgICAgICAgIHZhbHVlLlkgKj0gdmFsO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgTm9ybWFsaXplKHJlZiBWZWN0b3IyRCB2YWx1ZSwgb3V0IFZlY3RvcjJEIHJlc3VsdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0IHZhbCA9IDEuMGYgLyAoZmxvYXQpTWF0aC5TcXJ0KCh2YWx1ZS5YICogdmFsdWUuWCkgKyAodmFsdWUuWSAqIHZhbHVlLlkpKTtcclxuICAgICAgICAgICAgcmVzdWx0LlggPSB2YWx1ZS5YICogdmFsO1xyXG4gICAgICAgICAgICByZXN1bHQuWSA9IHZhbHVlLlkgKiB2YWw7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yMkQgU3VidHJhY3QoVmVjdG9yMkQgdmFsdWUxLCBWZWN0b3IyRCB2YWx1ZTIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YWx1ZTEuWCAtPSB2YWx1ZTIuWDtcclxuICAgICAgICAgICAgdmFsdWUxLlkgLT0gdmFsdWUyLlk7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgU3VidHJhY3QocmVmIFZlY3RvcjJEIHZhbHVlMSwgcmVmIFZlY3RvcjJEIHZhbHVlMiwgb3V0IFZlY3RvcjJEIHJlc3VsdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5YID0gdmFsdWUxLlggLSB2YWx1ZTIuWDtcclxuICAgICAgICAgICAgcmVzdWx0LlkgPSB2YWx1ZTEuWSAtIHZhbHVlMi5ZO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHN0cmluZyBUb1N0cmluZygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBDdWx0dXJlSW5mbyBjdXJyZW50Q3VsdHVyZSA9IEN1bHR1cmVJbmZvLkN1cnJlbnRDdWx0dXJlO1xyXG4gICAgICAgICAgICByZXR1cm4gc3RyaW5nLkZvcm1hdChjdXJyZW50Q3VsdHVyZSwgXCJ7e1g6ezB9IFk6ezF9fX1cIiwgbmV3IG9iamVjdFtdIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuWC5Ub1N0cmluZyhjdXJyZW50Q3VsdHVyZSksIHRoaXMuWS5Ub1N0cmluZyhjdXJyZW50Q3VsdHVyZSkgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAjZW5kcmVnaW9uIFB1YmxpYyBNZXRob2RzXHJcblxyXG5cclxuICAgICAgICAjcmVnaW9uIE9wZXJhdG9yc1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjJEIG9wZXJhdG9yIC0oVmVjdG9yMkQgdmFsdWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YWx1ZS5YID0gLXZhbHVlLlg7XHJcbiAgICAgICAgICAgIHZhbHVlLlkgPSAtdmFsdWUuWTtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBvcGVyYXRvciA9PShWZWN0b3IyRCB2YWx1ZTEsIFZlY3RvcjJEIHZhbHVlMilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTEuWCA9PSB2YWx1ZTIuWCAmJiB2YWx1ZTEuWSA9PSB2YWx1ZTIuWTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgb3BlcmF0b3IgIT0oVmVjdG9yMkQgdmFsdWUxLCBWZWN0b3IyRCB2YWx1ZTIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUxLlggIT0gdmFsdWUyLlggfHwgdmFsdWUxLlkgIT0gdmFsdWUyLlk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyRCBvcGVyYXRvciArKFZlY3RvcjJEIHZhbHVlMSwgVmVjdG9yMkQgdmFsdWUyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFsdWUxLlggKz0gdmFsdWUyLlg7XHJcbiAgICAgICAgICAgIHZhbHVlMS5ZICs9IHZhbHVlMi5ZO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUxO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yMkQgb3BlcmF0b3IgLShWZWN0b3IyRCB2YWx1ZTEsIFZlY3RvcjJEIHZhbHVlMilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhbHVlMS5YIC09IHZhbHVlMi5YO1xyXG4gICAgICAgICAgICB2YWx1ZTEuWSAtPSB2YWx1ZTIuWTtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjJEIG9wZXJhdG9yICooVmVjdG9yMkQgdmFsdWUxLCBWZWN0b3IyRCB2YWx1ZTIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YWx1ZTEuWCAqPSB2YWx1ZTIuWDtcclxuICAgICAgICAgICAgdmFsdWUxLlkgKj0gdmFsdWUyLlk7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTE7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IyRCBvcGVyYXRvciAqKFZlY3RvcjJEIHZhbHVlLCBmbG9hdCBzY2FsZUZhY3RvcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhbHVlLlggKj0gc2NhbGVGYWN0b3I7XHJcbiAgICAgICAgICAgIHZhbHVlLlkgKj0gc2NhbGVGYWN0b3I7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjJEIG9wZXJhdG9yICooZmxvYXQgc2NhbGVGYWN0b3IsIFZlY3RvcjJEIHZhbHVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFsdWUuWCAqPSBzY2FsZUZhY3RvcjtcclxuICAgICAgICAgICAgdmFsdWUuWSAqPSBzY2FsZUZhY3RvcjtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yMkQgb3BlcmF0b3IgLyhWZWN0b3IyRCB2YWx1ZTEsIFZlY3RvcjJEIHZhbHVlMilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhbHVlMS5YIC89IHZhbHVlMi5YO1xyXG4gICAgICAgICAgICB2YWx1ZTEuWSAvPSB2YWx1ZTIuWTtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjJEIG9wZXJhdG9yIC8oVmVjdG9yMkQgdmFsdWUxLCBmbG9hdCBkaXZpZGVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgZmFjdG9yID0gMSAvIGRpdmlkZXI7XHJcbiAgICAgICAgICAgIHZhbHVlMS5YICo9IGZhY3RvcjtcclxuICAgICAgICAgICAgdmFsdWUxLlkgKj0gZmFjdG9yO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgI2VuZHJlZ2lvbiBPcGVyYXRvcnNcclxuICAgIH1cclxufSIsIi8vIE1JVCBMaWNlbnNlIC0gQ29weXJpZ2h0IChDKSBUaGUgTW9uby5YbmEgVGVhbVxyXG4vLyBUaGlzIGZpbGUgaXMgc3ViamVjdCB0byB0aGUgdGVybXMgYW5kIGNvbmRpdGlvbnMgZGVmaW5lZCBpblxyXG4vLyBmaWxlICdMSUNFTlNFLnR4dCcsIHdoaWNoIGlzIHBhcnQgb2YgdGhpcyBzb3VyY2UgY29kZSBwYWNrYWdlLlxyXG5cclxudXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uRGlhZ25vc3RpY3M7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBTeXN0ZW0uUnVudGltZS5TZXJpYWxpemF0aW9uO1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5CYXNlVXRpbHNcclxue1xyXG5cclxuICAgIFxyXG4gICAgcHVibGljIHN0cnVjdCBWZWN0b3IzRCA6IElFcXVhdGFibGU8VmVjdG9yM0Q+XHJcbiAgICB7XHJcbiAgICAgICAgI3JlZ2lvbiBQcml2YXRlIEZpZWxkc1xyXG5cclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IzRCB6ZXJvID0gbmV3IFZlY3RvcjNEKDBmLCAwZiwgMGYpO1xyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIFZlY3RvcjNEIG9uZSA9IG5ldyBWZWN0b3IzRCgxZiwgMWYsIDFmKTtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IzRCB1bml0WCA9IG5ldyBWZWN0b3IzRCgxZiwgMGYsIDBmKTtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IzRCB1bml0WSA9IG5ldyBWZWN0b3IzRCgwZiwgMWYsIDBmKTtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IzRCB1bml0WiA9IG5ldyBWZWN0b3IzRCgwZiwgMGYsIDFmKTtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IzRCB1cCA9IG5ldyBWZWN0b3IzRCgwZiwgMWYsIDBmKTtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IzRCBkb3duID0gbmV3IFZlY3RvcjNEKDBmLCAtMWYsIDBmKTtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IzRCByaWdodCA9IG5ldyBWZWN0b3IzRCgxZiwgMGYsIDBmKTtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IzRCBsZWZ0ID0gbmV3IFZlY3RvcjNEKC0xZiwgMGYsIDBmKTtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IzRCBmb3J3YXJkID0gbmV3IFZlY3RvcjNEKDBmLCAwZiwgLTFmKTtcclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBWZWN0b3IzRCBiYWNrd2FyZCA9IG5ldyBWZWN0b3IzRCgwZiwgMGYsIDFmKTtcclxuXHJcbiAgICAgICAgI2VuZHJlZ2lvbiBQcml2YXRlIEZpZWxkc1xyXG5cclxuXHJcbiAgICAgICAgI3JlZ2lvbiBQdWJsaWMgRmllbGRzXHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBYO1xyXG5cclxuICAgICAgICBcclxuICAgICAgICBwdWJsaWMgZmxvYXQgWTtcclxuXHJcbiAgICAgICAgXHJcbiAgICAgICAgcHVibGljIGZsb2F0IFo7XHJcblxyXG4gICAgICAgICNlbmRyZWdpb24gUHVibGljIEZpZWxkc1xyXG5cclxuXHJcbiAgICAgICAgI3JlZ2lvbiBQcm9wZXJ0aWVzXHJcblxyXG4gICAgICAgIC8vLyA8c3VtbWFyeT5cclxuICAgICAgICAvLy8gUmV0dXJucyBhIDxzZWU+VmVjdG9yMzwvc2VlPiB3aXRoIGNvbXBvbmVudHMgMCwgMCwgMC5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yM0QgWmVyb1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIHplcm87IH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vLyA8c3VtbWFyeT5cclxuICAgICAgICAvLy8gUmV0dXJucyBhIDxzZWU+VmVjdG9yMzwvc2VlPiB3aXRoIGNvbXBvbmVudHMgMSwgMSwgMS5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yM0QgT25lXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXQgeyByZXR1cm4gb25lOyB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAgICAgLy8vIFJldHVybnMgYSA8c2VlPlZlY3RvcjM8L3NlZT4gd2l0aCBjb21wb25lbnRzIDEsIDAsIDAuXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjNEIFVuaXRYXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXQgeyByZXR1cm4gdW5pdFg7IH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vLyA8c3VtbWFyeT5cclxuICAgICAgICAvLy8gUmV0dXJucyBhIDxzZWU+VmVjdG9yMzwvc2VlPiB3aXRoIGNvbXBvbmVudHMgMCwgMSwgMC5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yM0QgVW5pdFlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldCB7IHJldHVybiB1bml0WTsgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyBSZXR1cm5zIGEgPHNlZT5WZWN0b3IzPC9zZWU+IHdpdGggY29tcG9uZW50cyAwLCAwLCAxLlxyXG4gICAgICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IzRCBVbml0WlxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIHVuaXRaOyB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjNEIFVwXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXQgeyByZXR1cm4gdXA7IH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yM0QgRG93blxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIGRvd247IH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yM0QgUmlnaHRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldCB7IHJldHVybiByaWdodDsgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IzRCBMZWZ0XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXQgeyByZXR1cm4gbGVmdDsgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IzRCBGb3J3YXJkXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXQgeyByZXR1cm4gZm9yd2FyZDsgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IzRCBCYWNrd2FyZFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZ2V0IHsgcmV0dXJuIGJhY2t3YXJkOyB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAjZW5kcmVnaW9uIFByb3BlcnRpZXNcclxuXHJcblxyXG4gICAgICAgICNyZWdpb24gQ29uc3RydWN0b3JzXHJcblxyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IzRChmbG9hdCB4LCBmbG9hdCB5LCBmbG9hdCB6KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5YID0geDtcclxuICAgICAgICAgICAgdGhpcy5ZID0geTtcclxuICAgICAgICAgICAgdGhpcy5aID0gejtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgVmVjdG9yM0QoZmxvYXQgdmFsdWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLlggPSB2YWx1ZTtcclxuICAgICAgICAgICAgdGhpcy5ZID0gdmFsdWU7XHJcbiAgICAgICAgICAgIHRoaXMuWiA9IHZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBWZWN0b3IzRChWZWN0b3IyRCB2YWx1ZSwgZmxvYXQgeilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuWCA9IHZhbHVlLlg7XHJcbiAgICAgICAgICAgIHRoaXMuWSA9IHZhbHVlLlk7XHJcbiAgICAgICAgICAgIHRoaXMuWiA9IHo7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgI2VuZHJlZ2lvbiBDb25zdHJ1Y3RvcnNcclxuXHJcblxyXG4gICAgICAgICNyZWdpb24gUHVibGljIE1ldGhvZHNcclxuXHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyBQZXJmb3JtcyB2ZWN0b3IgYWRkaXRpb24gb24gPHBhcmFtcmVmIG5hbWU9XCJ2YWx1ZTFcIi8+IGFuZCA8cGFyYW1yZWYgbmFtZT1cInZhbHVlMlwiLz4uXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICAvLy8gPHBhcmFtIG5hbWU9XCJ2YWx1ZTFcIj5UaGUgZmlyc3QgdmVjdG9yIHRvIGFkZC48L3BhcmFtPlxyXG4gICAgICAgIC8vLyA8cGFyYW0gbmFtZT1cInZhbHVlMlwiPlRoZSBzZWNvbmQgdmVjdG9yIHRvIGFkZC48L3BhcmFtPlxyXG4gICAgICAgIC8vLyA8cmV0dXJucz5UaGUgcmVzdWx0IG9mIHRoZSB2ZWN0b3IgYWRkaXRpb24uPC9yZXR1cm5zPlxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yM0QgQWRkKFZlY3RvcjNEIHZhbHVlMSwgVmVjdG9yM0QgdmFsdWUyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFsdWUxLlggKz0gdmFsdWUyLlg7XHJcbiAgICAgICAgICAgIHZhbHVlMS5ZICs9IHZhbHVlMi5ZO1xyXG4gICAgICAgICAgICB2YWx1ZTEuWiArPSB2YWx1ZTIuWjtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vLyA8c3VtbWFyeT5cclxuICAgICAgICAvLy8gUGVyZm9ybXMgdmVjdG9yIGFkZGl0aW9uIG9uIDxwYXJhbXJlZiBuYW1lPVwidmFsdWUxXCIvPiBhbmRcclxuICAgICAgICAvLy8gPHBhcmFtcmVmIG5hbWU9XCJ2YWx1ZTJcIi8+LCBzdG9yaW5nIHRoZSByZXN1bHQgb2YgdGhlXHJcbiAgICAgICAgLy8vIGFkZGl0aW9uIGluIDxwYXJhbXJlZiBuYW1lPVwicmVzdWx0XCIvPi5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIC8vLyA8cGFyYW0gbmFtZT1cInZhbHVlMVwiPlRoZSBmaXJzdCB2ZWN0b3IgdG8gYWRkLjwvcGFyYW0+XHJcbiAgICAgICAgLy8vIDxwYXJhbSBuYW1lPVwidmFsdWUyXCI+VGhlIHNlY29uZCB2ZWN0b3IgdG8gYWRkLjwvcGFyYW0+XHJcbiAgICAgICAgLy8vIDxwYXJhbSBuYW1lPVwicmVzdWx0XCI+VGhlIHJlc3VsdCBvZiB0aGUgdmVjdG9yIGFkZGl0aW9uLjwvcGFyYW0+XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIEFkZChyZWYgVmVjdG9yM0QgdmFsdWUxLCByZWYgVmVjdG9yM0QgdmFsdWUyLCBvdXQgVmVjdG9yM0QgcmVzdWx0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmVzdWx0LlggPSB2YWx1ZTEuWCArIHZhbHVlMi5YO1xyXG4gICAgICAgICAgICByZXN1bHQuWSA9IHZhbHVlMS5ZICsgdmFsdWUyLlk7XHJcbiAgICAgICAgICAgIHJlc3VsdC5aID0gdmFsdWUxLlogKyB2YWx1ZTIuWjtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjNEIENyb3NzKFZlY3RvcjNEIHZlY3RvcjEsIFZlY3RvcjNEIHZlY3RvcjIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBDcm9zcyhyZWYgdmVjdG9yMSwgcmVmIHZlY3RvcjIsIG91dCB2ZWN0b3IxKTtcclxuICAgICAgICAgICAgcmV0dXJuIHZlY3RvcjE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgQ3Jvc3MocmVmIFZlY3RvcjNEIHZlY3RvcjEsIHJlZiBWZWN0b3IzRCB2ZWN0b3IyLCBvdXQgVmVjdG9yM0QgcmVzdWx0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIHggPSB2ZWN0b3IxLlkgKiB2ZWN0b3IyLlogLSB2ZWN0b3IyLlkgKiB2ZWN0b3IxLlo7XHJcbiAgICAgICAgICAgIHZhciB5ID0gLSh2ZWN0b3IxLlggKiB2ZWN0b3IyLlogLSB2ZWN0b3IyLlggKiB2ZWN0b3IxLlopO1xyXG4gICAgICAgICAgICB2YXIgeiA9IHZlY3RvcjEuWCAqIHZlY3RvcjIuWSAtIHZlY3RvcjIuWCAqIHZlY3RvcjEuWTtcclxuICAgICAgICAgICAgcmVzdWx0LlggPSB4O1xyXG4gICAgICAgICAgICByZXN1bHQuWSA9IHk7XHJcbiAgICAgICAgICAgIHJlc3VsdC5aID0gejtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvYXQgRGlzdGFuY2UoVmVjdG9yM0QgdmVjdG9yMSwgVmVjdG9yM0QgdmVjdG9yMilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0IHJlc3VsdDtcclxuICAgICAgICAgICAgRGlzdGFuY2VTcXVhcmVkKHJlZiB2ZWN0b3IxLCByZWYgdmVjdG9yMiwgb3V0IHJlc3VsdCk7XHJcbiAgICAgICAgICAgIHJldHVybiAoZmxvYXQpTWF0aC5TcXJ0KHJlc3VsdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgRGlzdGFuY2UocmVmIFZlY3RvcjNEIHZhbHVlMSwgcmVmIFZlY3RvcjNEIHZhbHVlMiwgb3V0IGZsb2F0IHJlc3VsdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIERpc3RhbmNlU3F1YXJlZChyZWYgdmFsdWUxLCByZWYgdmFsdWUyLCBvdXQgcmVzdWx0KTtcclxuICAgICAgICAgICAgcmVzdWx0ID0gKGZsb2F0KU1hdGguU3FydChyZXN1bHQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBmbG9hdCBEaXN0YW5jZVNxdWFyZWQoVmVjdG9yM0QgdmFsdWUxLCBWZWN0b3IzRCB2YWx1ZTIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmbG9hdCByZXN1bHQ7XHJcbiAgICAgICAgICAgIERpc3RhbmNlU3F1YXJlZChyZWYgdmFsdWUxLCByZWYgdmFsdWUyLCBvdXQgcmVzdWx0KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBEaXN0YW5jZVNxdWFyZWQocmVmIFZlY3RvcjNEIHZhbHVlMSwgcmVmIFZlY3RvcjNEIHZhbHVlMiwgb3V0IGZsb2F0IHJlc3VsdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9ICh2YWx1ZTEuWCAtIHZhbHVlMi5YKSAqICh2YWx1ZTEuWCAtIHZhbHVlMi5YKSArXHJcbiAgICAgICAgICAgICAgICAgICAgICh2YWx1ZTEuWSAtIHZhbHVlMi5ZKSAqICh2YWx1ZTEuWSAtIHZhbHVlMi5ZKSArXHJcbiAgICAgICAgICAgICAgICAgICAgICh2YWx1ZTEuWiAtIHZhbHVlMi5aKSAqICh2YWx1ZTEuWiAtIHZhbHVlMi5aKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yM0QgRGl2aWRlKFZlY3RvcjNEIHZhbHVlMSwgVmVjdG9yM0QgdmFsdWUyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFsdWUxLlggLz0gdmFsdWUyLlg7XHJcbiAgICAgICAgICAgIHZhbHVlMS5ZIC89IHZhbHVlMi5ZO1xyXG4gICAgICAgICAgICB2YWx1ZTEuWiAvPSB2YWx1ZTIuWjtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yM0QgRGl2aWRlKFZlY3RvcjNEIHZhbHVlMSwgZmxvYXQgdmFsdWUyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgZmFjdG9yID0gMSAvIHZhbHVlMjtcclxuICAgICAgICAgICAgdmFsdWUxLlggKj0gZmFjdG9yO1xyXG4gICAgICAgICAgICB2YWx1ZTEuWSAqPSBmYWN0b3I7XHJcbiAgICAgICAgICAgIHZhbHVlMS5aICo9IGZhY3RvcjtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBEaXZpZGUocmVmIFZlY3RvcjNEIHZhbHVlMSwgZmxvYXQgZGl2aXNvciwgb3V0IFZlY3RvcjNEIHJlc3VsdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0IGZhY3RvciA9IDEgLyBkaXZpc29yO1xyXG4gICAgICAgICAgICByZXN1bHQuWCA9IHZhbHVlMS5YICogZmFjdG9yO1xyXG4gICAgICAgICAgICByZXN1bHQuWSA9IHZhbHVlMS5ZICogZmFjdG9yO1xyXG4gICAgICAgICAgICByZXN1bHQuWiA9IHZhbHVlMS5aICogZmFjdG9yO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIERpdmlkZShyZWYgVmVjdG9yM0QgdmFsdWUxLCByZWYgVmVjdG9yM0QgdmFsdWUyLCBvdXQgVmVjdG9yM0QgcmVzdWx0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmVzdWx0LlggPSB2YWx1ZTEuWCAvIHZhbHVlMi5YO1xyXG4gICAgICAgICAgICByZXN1bHQuWSA9IHZhbHVlMS5ZIC8gdmFsdWUyLlk7XHJcbiAgICAgICAgICAgIHJlc3VsdC5aID0gdmFsdWUxLlogLyB2YWx1ZTIuWjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvYXQgRG90KFZlY3RvcjNEIHZlY3RvcjEsIFZlY3RvcjNEIHZlY3RvcjIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gdmVjdG9yMS5YICogdmVjdG9yMi5YICsgdmVjdG9yMS5ZICogdmVjdG9yMi5ZICsgdmVjdG9yMS5aICogdmVjdG9yMi5aO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIERvdChyZWYgVmVjdG9yM0QgdmVjdG9yMSwgcmVmIFZlY3RvcjNEIHZlY3RvcjIsIG91dCBmbG9hdCByZXN1bHQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXN1bHQgPSB2ZWN0b3IxLlggKiB2ZWN0b3IyLlggKyB2ZWN0b3IxLlkgKiB2ZWN0b3IyLlkgKyB2ZWN0b3IxLlogKiB2ZWN0b3IyLlo7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgYm9vbCBFcXVhbHMob2JqZWN0IG9iailcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICghKG9iaiBpcyBWZWN0b3IzRCkpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICB2YXIgb3RoZXIgPSAoVmVjdG9yM0Qpb2JqO1xyXG4gICAgICAgICAgICByZXR1cm4gWCA9PSBvdGhlci5YICYmXHJcbiAgICAgICAgICAgICAgICAgICAgWSA9PSBvdGhlci5ZICYmXHJcbiAgICAgICAgICAgICAgICAgICAgWiA9PSBvdGhlci5aO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgRXF1YWxzKFZlY3RvcjNEIG90aGVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIFggPT0gb3RoZXIuWCAmJlxyXG4gICAgICAgICAgICAgICAgICAgIFkgPT0gb3RoZXIuWSAmJlxyXG4gICAgICAgICAgICAgICAgICAgIFogPT0gb3RoZXIuWjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSBpbnQgR2V0SGFzaENvZGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIChpbnQpKHRoaXMuWCArIHRoaXMuWSArIHRoaXMuWik7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IExlbmd0aCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmbG9hdCByZXN1bHQ7XHJcbiAgICAgICAgICAgIERpc3RhbmNlU3F1YXJlZChyZWYgdGhpcywgcmVmIHplcm8sIG91dCByZXN1bHQpO1xyXG4gICAgICAgICAgICByZXR1cm4gKGZsb2F0KU1hdGguU3FydChyZXN1bHQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IExlbmd0aFNxdWFyZWQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgcmVzdWx0O1xyXG4gICAgICAgICAgICBEaXN0YW5jZVNxdWFyZWQocmVmIHRoaXMsIHJlZiB6ZXJvLCBvdXQgcmVzdWx0KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yM0QgTXVsdGlwbHkoVmVjdG9yM0QgdmFsdWUxLCBWZWN0b3IzRCB2YWx1ZTIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YWx1ZTEuWCAqPSB2YWx1ZTIuWDtcclxuICAgICAgICAgICAgdmFsdWUxLlkgKj0gdmFsdWUyLlk7XHJcbiAgICAgICAgICAgIHZhbHVlMS5aICo9IHZhbHVlMi5aO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IzRCBNdWx0aXBseShWZWN0b3IzRCB2YWx1ZTEsIGZsb2F0IHNjYWxlRmFjdG9yKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFsdWUxLlggKj0gc2NhbGVGYWN0b3I7XHJcbiAgICAgICAgICAgIHZhbHVlMS5ZICo9IHNjYWxlRmFjdG9yO1xyXG4gICAgICAgICAgICB2YWx1ZTEuWiAqPSBzY2FsZUZhY3RvcjtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBNdWx0aXBseShyZWYgVmVjdG9yM0QgdmFsdWUxLCBmbG9hdCBzY2FsZUZhY3Rvciwgb3V0IFZlY3RvcjNEIHJlc3VsdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5YID0gdmFsdWUxLlggKiBzY2FsZUZhY3RvcjtcclxuICAgICAgICAgICAgcmVzdWx0LlkgPSB2YWx1ZTEuWSAqIHNjYWxlRmFjdG9yO1xyXG4gICAgICAgICAgICByZXN1bHQuWiA9IHZhbHVlMS5aICogc2NhbGVGYWN0b3I7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgTXVsdGlwbHkocmVmIFZlY3RvcjNEIHZhbHVlMSwgcmVmIFZlY3RvcjNEIHZhbHVlMiwgb3V0IFZlY3RvcjNEIHJlc3VsdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5YID0gdmFsdWUxLlggKiB2YWx1ZTIuWDtcclxuICAgICAgICAgICAgcmVzdWx0LlkgPSB2YWx1ZTEuWSAqIHZhbHVlMi5ZO1xyXG4gICAgICAgICAgICByZXN1bHQuWiA9IHZhbHVlMS5aICogdmFsdWUyLlo7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAgICAgLy8vIFJldHVybnMgYSA8c2VlPlZlY3RvcjM8L3NlZT4gcG9pbnRpbmcgaW4gdGhlIG9wcG9zaXRlXHJcbiAgICAgICAgLy8vIGRpcmVjdGlvbiBvZiA8cGFyYW1yZWYgbmFtZT1cInZhbHVlXCIvPi5cclxuICAgICAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgICAgIC8vLyA8cGFyYW0gbmFtZT1cInZhbHVlXCI+VGhlIHZlY3RvciB0byBuZWdhdGUuPC9wYXJhbT5cclxuICAgICAgICAvLy8gPHJldHVybnM+VGhlIHZlY3RvciBuZWdhdGlvbiBvZiA8cGFyYW1yZWYgbmFtZT1cInZhbHVlXCIvPi48L3JldHVybnM+XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IzRCBOZWdhdGUoVmVjdG9yM0QgdmFsdWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YWx1ZSA9IG5ldyBWZWN0b3IzRCgtdmFsdWUuWCwgLXZhbHVlLlksIC12YWx1ZS5aKTtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyBTdG9yZXMgYSA8c2VlPlZlY3RvcjM8L3NlZT4gcG9pbnRpbmcgaW4gdGhlIG9wcG9zaXRlXHJcbiAgICAgICAgLy8vIGRpcmVjdGlvbiBvZiA8cGFyYW1yZWYgbmFtZT1cInZhbHVlXCIvPiBpbiA8cGFyYW1yZWYgbmFtZT1cInJlc3VsdFwiLz4uXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICAvLy8gPHBhcmFtIG5hbWU9XCJ2YWx1ZVwiPlRoZSB2ZWN0b3IgdG8gbmVnYXRlLjwvcGFyYW0+XHJcbiAgICAgICAgLy8vIDxwYXJhbSBuYW1lPVwicmVzdWx0XCI+VGhlIHZlY3RvciB0aGF0IHRoZSBuZWdhdGlvbiBvZiA8cGFyYW1yZWYgbmFtZT1cInZhbHVlXCIvPiB3aWxsIGJlIHN0b3JlZCBpbi48L3BhcmFtPlxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBOZWdhdGUocmVmIFZlY3RvcjNEIHZhbHVlLCBvdXQgVmVjdG9yM0QgcmVzdWx0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmVzdWx0LlggPSAtdmFsdWUuWDtcclxuICAgICAgICAgICAgcmVzdWx0LlkgPSAtdmFsdWUuWTtcclxuICAgICAgICAgICAgcmVzdWx0LlogPSAtdmFsdWUuWjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIE5vcm1hbGl6ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBOb3JtYWxpemUocmVmIHRoaXMsIG91dCB0aGlzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yM0QgTm9ybWFsaXplKFZlY3RvcjNEIHZlY3RvcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE5vcm1hbGl6ZShyZWYgdmVjdG9yLCBvdXQgdmVjdG9yKTtcclxuICAgICAgICAgICAgcmV0dXJuIHZlY3RvcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBOb3JtYWxpemUocmVmIFZlY3RvcjNEIHZhbHVlLCBvdXQgVmVjdG9yM0QgcmVzdWx0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZmxvYXQgZmFjdG9yO1xyXG4gICAgICAgICAgICBEaXN0YW5jZShyZWYgdmFsdWUsIHJlZiB6ZXJvLCBvdXQgZmFjdG9yKTtcclxuICAgICAgICAgICAgZmFjdG9yID0gMWYgLyBmYWN0b3I7XHJcbiAgICAgICAgICAgIHJlc3VsdC5YID0gdmFsdWUuWCAqIGZhY3RvcjtcclxuICAgICAgICAgICAgcmVzdWx0LlkgPSB2YWx1ZS5ZICogZmFjdG9yO1xyXG4gICAgICAgICAgICByZXN1bHQuWiA9IHZhbHVlLlogKiBmYWN0b3I7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjNEIFJlZmxlY3QoVmVjdG9yM0QgdmVjdG9yLCBWZWN0b3IzRCBub3JtYWwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvLyBJIGlzIHRoZSBvcmlnaW5hbCBhcnJheVxyXG4gICAgICAgICAgICAvLyBOIGlzIHRoZSBub3JtYWwgb2YgdGhlIGluY2lkZW50IHBsYW5lXHJcbiAgICAgICAgICAgIC8vIFIgPSBJIC0gKDIgKiBOICogKCBEb3RQcm9kdWN0WyBJLE5dICkpXHJcbiAgICAgICAgICAgIFZlY3RvcjNEIHJlZmxlY3RlZFZlY3RvcjtcclxuICAgICAgICAgICAgLy8gaW5saW5lIHRoZSBkb3RQcm9kdWN0IGhlcmUgaW5zdGVhZCBvZiBjYWxsaW5nIG1ldGhvZFxyXG4gICAgICAgICAgICBmbG9hdCBkb3RQcm9kdWN0ID0gKCh2ZWN0b3IuWCAqIG5vcm1hbC5YKSArICh2ZWN0b3IuWSAqIG5vcm1hbC5ZKSkgKyAodmVjdG9yLlogKiBub3JtYWwuWik7XHJcbiAgICAgICAgICAgIHJlZmxlY3RlZFZlY3Rvci5YID0gdmVjdG9yLlggLSAoMi4wZiAqIG5vcm1hbC5YKSAqIGRvdFByb2R1Y3Q7XHJcbiAgICAgICAgICAgIHJlZmxlY3RlZFZlY3Rvci5ZID0gdmVjdG9yLlkgLSAoMi4wZiAqIG5vcm1hbC5ZKSAqIGRvdFByb2R1Y3Q7XHJcbiAgICAgICAgICAgIHJlZmxlY3RlZFZlY3Rvci5aID0gdmVjdG9yLlogLSAoMi4wZiAqIG5vcm1hbC5aKSAqIGRvdFByb2R1Y3Q7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVmbGVjdGVkVmVjdG9yO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIFJlZmxlY3QocmVmIFZlY3RvcjNEIHZlY3RvciwgcmVmIFZlY3RvcjNEIG5vcm1hbCwgb3V0IFZlY3RvcjNEIHJlc3VsdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vIEkgaXMgdGhlIG9yaWdpbmFsIGFycmF5XHJcbiAgICAgICAgICAgIC8vIE4gaXMgdGhlIG5vcm1hbCBvZiB0aGUgaW5jaWRlbnQgcGxhbmVcclxuICAgICAgICAgICAgLy8gUiA9IEkgLSAoMiAqIE4gKiAoIERvdFByb2R1Y3RbIEksTl0gKSlcclxuXHJcbiAgICAgICAgICAgIC8vIGlubGluZSB0aGUgZG90UHJvZHVjdCBoZXJlIGluc3RlYWQgb2YgY2FsbGluZyBtZXRob2RcclxuICAgICAgICAgICAgZmxvYXQgZG90UHJvZHVjdCA9ICgodmVjdG9yLlggKiBub3JtYWwuWCkgKyAodmVjdG9yLlkgKiBub3JtYWwuWSkpICsgKHZlY3Rvci5aICogbm9ybWFsLlopO1xyXG4gICAgICAgICAgICByZXN1bHQuWCA9IHZlY3Rvci5YIC0gKDIuMGYgKiBub3JtYWwuWCkgKiBkb3RQcm9kdWN0O1xyXG4gICAgICAgICAgICByZXN1bHQuWSA9IHZlY3Rvci5ZIC0gKDIuMGYgKiBub3JtYWwuWSkgKiBkb3RQcm9kdWN0O1xyXG4gICAgICAgICAgICByZXN1bHQuWiA9IHZlY3Rvci5aIC0gKDIuMGYgKiBub3JtYWwuWikgKiBkb3RQcm9kdWN0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyBQZXJmb3JtcyB2ZWN0b3Igc3VidHJhY3Rpb24gb24gPHBhcmFtcmVmIG5hbWU9XCJ2YWx1ZTFcIi8+IGFuZCA8cGFyYW1yZWYgbmFtZT1cInZhbHVlMlwiLz4uXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICAvLy8gPHBhcmFtIG5hbWU9XCJ2YWx1ZTFcIj5UaGUgdmVjdG9yIHRvIGJlIHN1YnRyYWN0ZWQgZnJvbS48L3BhcmFtPlxyXG4gICAgICAgIC8vLyA8cGFyYW0gbmFtZT1cInZhbHVlMlwiPlRoZSB2ZWN0b3IgdG8gYmUgc3VidHJhY3RlZCBmcm9tIDxwYXJhbXJlZiBuYW1lPVwidmFsdWUxXCIvPi48L3BhcmFtPlxyXG4gICAgICAgIC8vLyA8cmV0dXJucz5UaGUgcmVzdWx0IG9mIHRoZSB2ZWN0b3Igc3VidHJhY3Rpb24uPC9yZXR1cm5zPlxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yM0QgU3VidHJhY3QoVmVjdG9yM0QgdmFsdWUxLCBWZWN0b3IzRCB2YWx1ZTIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YWx1ZTEuWCAtPSB2YWx1ZTIuWDtcclxuICAgICAgICAgICAgdmFsdWUxLlkgLT0gdmFsdWUyLlk7XHJcbiAgICAgICAgICAgIHZhbHVlMS5aIC09IHZhbHVlMi5aO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLyBQZXJmb3JtcyB2ZWN0b3Igc3VidHJhY3Rpb24gb24gPHBhcmFtcmVmIG5hbWU9XCJ2YWx1ZTFcIi8+IGFuZCA8cGFyYW1yZWYgbmFtZT1cInZhbHVlMlwiLz4uXHJcbiAgICAgICAgLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICAvLy8gPHBhcmFtIG5hbWU9XCJ2YWx1ZTFcIj5UaGUgdmVjdG9yIHRvIGJlIHN1YnRyYWN0ZWQgZnJvbS48L3BhcmFtPlxyXG4gICAgICAgIC8vLyA8cGFyYW0gbmFtZT1cInZhbHVlMlwiPlRoZSB2ZWN0b3IgdG8gYmUgc3VidHJhY3RlZCBmcm9tIDxwYXJhbXJlZiBuYW1lPVwidmFsdWUxXCIvPi48L3BhcmFtPlxyXG4gICAgICAgIC8vLyA8cGFyYW0gbmFtZT1cInJlc3VsdFwiPlRoZSByZXN1bHQgb2YgdGhlIHZlY3RvciBzdWJ0cmFjdGlvbi48L3BhcmFtPlxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBTdWJ0cmFjdChyZWYgVmVjdG9yM0QgdmFsdWUxLCByZWYgVmVjdG9yM0QgdmFsdWUyLCBvdXQgVmVjdG9yM0QgcmVzdWx0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmVzdWx0LlggPSB2YWx1ZTEuWCAtIHZhbHVlMi5YO1xyXG4gICAgICAgICAgICByZXN1bHQuWSA9IHZhbHVlMS5ZIC0gdmFsdWUyLlk7XHJcbiAgICAgICAgICAgIHJlc3VsdC5aID0gdmFsdWUxLlogLSB2YWx1ZTIuWjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHN0cmluZyBEZWJ1Z0Rpc3BsYXlTdHJpbmdcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RyaW5nLkNvbmNhdChcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLlguVG9TdHJpbmcoKSwgXCIgIFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuWS5Ub1N0cmluZygpLCBcIiAgXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5aLlRvU3RyaW5nKClcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSBzdHJpbmcgVG9TdHJpbmcoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKDMyKTtcclxuICAgICAgICAgICAgc2IuQXBwZW5kKFwie1g6XCIpO1xyXG4gICAgICAgICAgICBzYi5BcHBlbmQodGhpcy5YKTtcclxuICAgICAgICAgICAgc2IuQXBwZW5kKFwiIFk6XCIpO1xyXG4gICAgICAgICAgICBzYi5BcHBlbmQodGhpcy5ZKTtcclxuICAgICAgICAgICAgc2IuQXBwZW5kKFwiIFo6XCIpO1xyXG4gICAgICAgICAgICBzYi5BcHBlbmQodGhpcy5aKTtcclxuICAgICAgICAgICAgc2IuQXBwZW5kKFwifVwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIHNiLlRvU3RyaW5nKCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIC8vLy8vIDxzdW1tYXJ5PlxyXG4gICAgICAgIC8vLy8vIFRyYW5zZm9ybXMgYSB2ZWN0b3IgYnkgYSBxdWF0ZXJuaW9uIHJvdGF0aW9uLlxyXG4gICAgICAgIC8vLy8vIDwvc3VtbWFyeT5cclxuICAgICAgICAvLy8vLyA8cGFyYW0gbmFtZT1cInZlY1wiPlRoZSB2ZWN0b3IgdG8gdHJhbnNmb3JtLjwvcGFyYW0+XHJcbiAgICAgICAgLy8vLy8gPHBhcmFtIG5hbWU9XCJxdWF0XCI+VGhlIHF1YXRlcm5pb24gdG8gcm90YXRlIHRoZSB2ZWN0b3IgYnkuPC9wYXJhbT5cclxuICAgICAgICAvLy8vLyA8cGFyYW0gbmFtZT1cInJlc3VsdFwiPlRoZSByZXN1bHQgb2YgdGhlIG9wZXJhdGlvbi48L3BhcmFtPlxyXG4gICAgICAgIC8vICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgVHJhbnNmb3JtKHJlZiBWZWN0b3IzIHZlYywgcmVmIFF1YXRlcm5pb24gcXVhdCwgb3V0IFZlY3RvcjMgcmVzdWx0KVxyXG4gICAgICAgIC8vICAgICAgICB7XHJcbiAgICAgICAgLy9cdFx0Ly8gVGFrZW4gZnJvbSB0aGUgT3BlbnRUSyBpbXBsZW1lbnRhdGlvbiBvZiBWZWN0b3IzXHJcbiAgICAgICAgLy8gICAgICAgICAgICAvLyBTaW5jZSB2ZWMuVyA9PSAwLCB3ZSBjYW4gb3B0aW1pemUgcXVhdCAqIHZlYyAqIHF1YXReLTEgYXMgZm9sbG93czpcclxuICAgICAgICAvLyAgICAgICAgICAgIC8vIHZlYyArIDIuMCAqIGNyb3NzKHF1YXQueHl6LCBjcm9zcyhxdWF0Lnh5eiwgdmVjKSArIHF1YXQudyAqIHZlYylcclxuICAgICAgICAvLyAgICAgICAgICAgIFZlY3RvcjMgeHl6ID0gcXVhdC5YeXosIHRlbXAsIHRlbXAyO1xyXG4gICAgICAgIC8vICAgICAgICAgICAgVmVjdG9yMy5Dcm9zcyhyZWYgeHl6LCByZWYgdmVjLCBvdXQgdGVtcCk7XHJcbiAgICAgICAgLy8gICAgICAgICAgICBWZWN0b3IzLk11bHRpcGx5KHJlZiB2ZWMsIHF1YXQuVywgb3V0IHRlbXAyKTtcclxuICAgICAgICAvLyAgICAgICAgICAgIFZlY3RvcjMuQWRkKHJlZiB0ZW1wLCByZWYgdGVtcDIsIG91dCB0ZW1wKTtcclxuICAgICAgICAvLyAgICAgICAgICAgIFZlY3RvcjMuQ3Jvc3MocmVmIHh5eiwgcmVmIHRlbXAsIG91dCB0ZW1wKTtcclxuICAgICAgICAvLyAgICAgICAgICAgIFZlY3RvcjMuTXVsdGlwbHkocmVmIHRlbXAsIDIsIG91dCB0ZW1wKTtcclxuICAgICAgICAvLyAgICAgICAgICAgIFZlY3RvcjMuQWRkKHJlZiB2ZWMsIHJlZiB0ZW1wLCBvdXQgcmVzdWx0KTtcclxuICAgICAgICAvLyAgICAgICAgfVxyXG5cclxuXHJcblxyXG5cclxuICAgICAgICAjZW5kcmVnaW9uIFB1YmxpYyBtZXRob2RzXHJcblxyXG5cclxuICAgICAgICAjcmVnaW9uIE9wZXJhdG9yc1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgb3BlcmF0b3IgPT0oVmVjdG9yM0QgdmFsdWUxLCBWZWN0b3IzRCB2YWx1ZTIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUxLlggPT0gdmFsdWUyLlhcclxuICAgICAgICAgICAgICAgICYmIHZhbHVlMS5ZID09IHZhbHVlMi5ZXHJcbiAgICAgICAgICAgICAgICAmJiB2YWx1ZTEuWiA9PSB2YWx1ZTIuWjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBvcGVyYXRvciAhPShWZWN0b3IzRCB2YWx1ZTEsIFZlY3RvcjNEIHZhbHVlMilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAhKHZhbHVlMSA9PSB2YWx1ZTIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IzRCBvcGVyYXRvciArKFZlY3RvcjNEIHZhbHVlMSwgVmVjdG9yM0QgdmFsdWUyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFsdWUxLlggKz0gdmFsdWUyLlg7XHJcbiAgICAgICAgICAgIHZhbHVlMS5ZICs9IHZhbHVlMi5ZO1xyXG4gICAgICAgICAgICB2YWx1ZTEuWiArPSB2YWx1ZTIuWjtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yM0Qgb3BlcmF0b3IgLShWZWN0b3IzRCB2YWx1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhbHVlID0gbmV3IFZlY3RvcjNEKC12YWx1ZS5YLCAtdmFsdWUuWSwgLXZhbHVlLlopO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjNEIG9wZXJhdG9yIC0oVmVjdG9yM0QgdmFsdWUxLCBWZWN0b3IzRCB2YWx1ZTIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YWx1ZTEuWCAtPSB2YWx1ZTIuWDtcclxuICAgICAgICAgICAgdmFsdWUxLlkgLT0gdmFsdWUyLlk7XHJcbiAgICAgICAgICAgIHZhbHVlMS5aIC09IHZhbHVlMi5aO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWUxO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IzRCBvcGVyYXRvciAqKFZlY3RvcjNEIHZhbHVlMSwgVmVjdG9yM0QgdmFsdWUyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFsdWUxLlggKj0gdmFsdWUyLlg7XHJcbiAgICAgICAgICAgIHZhbHVlMS5ZICo9IHZhbHVlMi5ZO1xyXG4gICAgICAgICAgICB2YWx1ZTEuWiAqPSB2YWx1ZTIuWjtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yM0Qgb3BlcmF0b3IgKihWZWN0b3IzRCB2YWx1ZSwgZmxvYXQgc2NhbGVGYWN0b3IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YWx1ZS5YICo9IHNjYWxlRmFjdG9yO1xyXG4gICAgICAgICAgICB2YWx1ZS5ZICo9IHNjYWxlRmFjdG9yO1xyXG4gICAgICAgICAgICB2YWx1ZS5aICo9IHNjYWxlRmFjdG9yO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFZlY3RvcjNEIG9wZXJhdG9yICooZmxvYXQgc2NhbGVGYWN0b3IsIFZlY3RvcjNEIHZhbHVlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFsdWUuWCAqPSBzY2FsZUZhY3RvcjtcclxuICAgICAgICAgICAgdmFsdWUuWSAqPSBzY2FsZUZhY3RvcjtcclxuICAgICAgICAgICAgdmFsdWUuWiAqPSBzY2FsZUZhY3RvcjtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBWZWN0b3IzRCBvcGVyYXRvciAvKFZlY3RvcjNEIHZhbHVlMSwgVmVjdG9yM0QgdmFsdWUyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFsdWUxLlggLz0gdmFsdWUyLlg7XHJcbiAgICAgICAgICAgIHZhbHVlMS5ZIC89IHZhbHVlMi5ZO1xyXG4gICAgICAgICAgICB2YWx1ZTEuWiAvPSB2YWx1ZTIuWjtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmVjdG9yM0Qgb3BlcmF0b3IgLyhWZWN0b3IzRCB2YWx1ZSwgZmxvYXQgZGl2aWRlcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZsb2F0IGZhY3RvciA9IDEgLyBkaXZpZGVyO1xyXG4gICAgICAgICAgICB2YWx1ZS5YICo9IGZhY3RvcjtcclxuICAgICAgICAgICAgdmFsdWUuWSAqPSBmYWN0b3I7XHJcbiAgICAgICAgICAgIHZhbHVlLlogKj0gZmFjdG9yO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAjZW5kcmVnaW9uXHJcbiAgICB9XHJcbn0iLCJ1c2luZyBQaWRyb2guQmFzZVV0aWxzO1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWRcclxue1xyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBNb3ZlRGF0YVxyXG4gICAge1xyXG4gICAgICAgIHN0cmluZyBsYWJlbDtcclxuICAgICAgICBpbnRlcm5hbCBMaXN0PFRpY2s+IHVuaXRzID0gbmV3IExpc3Q8VGljaz4oKTtcclxuICAgICAgICBpbnRlcm5hbCBMaXN0PGludD4gdGFncyA9IG5ldyBMaXN0PGludD4oKTtcclxuXHJcbiAgICAgICAgcHVibGljIE1vdmVEYXRhKHN0cmluZyBsYWJlbClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMubGFiZWwgPSBsYWJlbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBNb3ZlRGF0YSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBpbnQgRmluZEJ5TGFiZWwoTGlzdDxNb3ZlRGF0YT4gbW92ZURhdGFzLCBzdHJpbmcgbGFiZWwpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1vdmVEYXRhcy5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAobW92ZURhdGFzW2ldICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1vdmVEYXRhc1tpXS5sYWJlbCA9PSBsYWJlbCkgcmV0dXJuIGk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgYm9vbCBIYXNUYWcoaW50IHRhZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiB0YWdzLkNvbnRhaW5zKHRhZyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgVGlja1xyXG4gICAge1xyXG4gICAgICAgIGludGVybmFsIENvbmRpdGlvbiBjb25kaXRpb247XHJcbiAgICAgICAgaW50ZXJuYWwgTGlzdDxvYmplY3Q+IHRoaW5nc1RvSGFwcGVuID0gbmV3IExpc3Q8b2JqZWN0PigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgVGljayhvYmplY3QgYWN0aW9uKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpbmdzVG9IYXBwZW4uQWRkKGFjdGlvbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVGljayhvYmplY3RbXSBhY3Rpb25zKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpbmdzVG9IYXBwZW4uQWRkUmFuZ2UoYWN0aW9ucyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVGljaygpXHJcbiAgICAgICAge1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHB1YmxpYyBjbGFzcyBDb25kaXRpb25cclxuICAgIHtcclxuICAgICAgICBpbnRlcm5hbCByZWFkb25seSBDb25kaXRpb25UeXBlIHR5cGU7XHJcbiAgICAgICAgaW50ZXJuYWwgcmVhZG9ubHkgVGFyZ2V0IHRhcmdldDtcclxuICAgICAgICBpbnRlcm5hbCByZWFkb25seSBCYXNlVXRpbHMuVmVjdG9yMkQgdmVjdG9yO1xyXG5cclxuICAgICAgICBwdWJsaWMgQ29uZGl0aW9uKENvbmRpdGlvblR5cGUgdHlwZSwgVGFyZ2V0IHRhcmdldCwgQmFzZVV0aWxzLlZlY3RvcjJEIHZlY3RvcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xyXG4gICAgICAgICAgICB0aGlzLnZlY3RvciA9IHZlY3RvcjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGVudW0gQ29uZGl0aW9uVHlwZVxyXG4gICAge1xyXG4gICAgICAgIENhbk1vdmVcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgU3VtbW9uRW50aXR5XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IGludCBlbmVteVdoaWNoO1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBWZWN0b3IyRCBwcmVmZXJlbnRpYWxSb3dDb2x1bW47XHJcblxyXG4gICAgICAgIHB1YmxpYyBTdW1tb25FbnRpdHkoaW50IGVuZW15V2hpY2gsIFZlY3RvcjJEIHByZWZlcmVudGlhbFJvd0NvbHVtbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuZW5lbXlXaGljaCA9IGVuZW15V2hpY2g7XHJcbiAgICAgICAgICAgIHRoaXMucHJlZmVyZW50aWFsUm93Q29sdW1uID0gcHJlZmVyZW50aWFsUm93Q29sdW1uO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgc3RhdGljIFN1bW1vbkVudGl0eSBFbmVteShpbnQgdiwgVmVjdG9yMkQgdmVjdG9yMkQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFN1bW1vbkVudGl0eSh2LCB2ZWN0b3IyRCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgQW5pbWF0aW9uXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IEFyZWEgYXJlYSA9IG51bGw7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IFRhcmdldCB0YXJnZXQgPSBUYXJnZXQuTm9uZTtcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uRWxlbWVudCBlbGVtZW50ID0gUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uRWxlbWVudC5Ob3RoaW5nbmVzcztcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgVmVjdG9yMkQgdXNlclJlZk9mZnNldDtcclxuXHJcbiAgICAgICAgcHVibGljIEFuaW1hdGlvbihUYXJnZXQgdGFyZ2V0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQW5pbWF0aW9uKFRhcmdldCB0YXJnZXQsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVsZW1lbnQgZWxlbWVudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEFuaW1hdGlvbihBcmVhIGFyZWEsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVsZW1lbnQgZWxlbWVudCwgVGFyZ2V0IHRhcmdldClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuYXJlYSA9IGFyZWE7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEFuaW1hdGlvbihBcmVhIGFyZWEsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVsZW1lbnQgZWxlbWVudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuYXJlYSA9IGFyZWE7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQW5pbWF0aW9uKFRhcmdldCB0YXJnZXQsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVsZW1lbnQgZWxlbWVudCwgVmVjdG9yMkQgdXNlclJlZk9mZnNldCkgOiB0aGlzKHRhcmdldCwgZWxlbWVudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMudXNlclJlZk9mZnNldCA9IHVzZXJSZWZPZmZzZXQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBNb3ZlQWN0aW9uXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IFRhcmdldCB0YXJnZXQ7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IEJhc2VVdGlscy5WZWN0b3IyRCBkaXN0YW5jZTtcclxuXHJcbiAgICAgICAgcHVibGljIE1vdmVBY3Rpb24oVGFyZ2V0IHRhcmdldCwgQmFzZVV0aWxzLlZlY3RvcjJEIGFtb3VudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xyXG4gICAgICAgICAgICB0aGlzLmRpc3RhbmNlID0gYW1vdW50O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgRGVhbERhbWFnZUFjdGlvblxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBBcmVhIGFyZWE7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IFRhcmdldCB0YXJnZXQgPSBUYXJnZXQuTm9uZTtcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgaW50IGRhbWFnZTtcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uRWxlbWVudCBlbGVtZW50O1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBWZWN0b3IyRCB1c2VyUmVmT2Zmc2V0O1xyXG5cclxuICAgICAgICBwdWJsaWMgRGVhbERhbWFnZUFjdGlvbihBcmVhIGFyZWEsIGludCBkYW1hZ2UsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVsZW1lbnQgZWxlbWVudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuYXJlYSA9IGFyZWE7XHJcbiAgICAgICAgICAgIHRoaXMuZGFtYWdlID0gZGFtYWdlO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgICAgICAgICB0YXJnZXQgPSBUYXJnZXQuQXJlYTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBEZWFsRGFtYWdlQWN0aW9uKFRhcmdldCB0YXJnZXQsIGludCBkYW1hZ2UsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVsZW1lbnQgZWxlbWVudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xyXG4gICAgICAgICAgICB0aGlzLmRhbWFnZSA9IGRhbWFnZTtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBEZWFsRGFtYWdlQWN0aW9uKFRhcmdldCB0YXJnZXQsIGludCBkYW1hZ2UsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVsZW1lbnQgZWxlbWVudCwgVmVjdG9yMkQgdXNlclJlZk9mZnNldCkgOiB0aGlzKHRhcmdldCwgZGFtYWdlLCBlbGVtZW50KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy51c2VyUmVmT2Zmc2V0ID0gdXNlclJlZk9mZnNldDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIEFyZWFcclxuICAgIHtcclxuICAgICAgICAvL3B1YmxpYyByZWFkb25seSBBcmVhIGFyZWE7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IFRhcmdldCB0YXJnZXQ7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IExpc3Q8VmVjdG9yMkQ+IHBvaW50cyA9IG5ldyBMaXN0PFZlY3RvcjJEPigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgQXJlYShUYXJnZXQgdGFyZ2V0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBlbnVtIFRhcmdldFxyXG4gICAge1xyXG4gICAgICAgIE5vbmUsIFNlbGYsIENsb3Nlc3RUYXJnZXQsIENsb3Nlc3RUYXJnZXRYLCBBcmVhXHJcbiAgICB9XHJcblxyXG5cclxuXHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnM7XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBBc3luY1Rhc2tzXHJcbiAgICB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBBc3luY1RyYWNrXHJcbiAgICB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhYnN0cmFjdCBjbGFzcyBEZWxheWVkQWN0aW9uc1xyXG4gICAge1xyXG4gICAgICAgIExpc3Q8ZmxvYXQ+IHRpbWVzID0gbmV3IExpc3Q8ZmxvYXQ+KCk7XHJcbiAgICAgICAgTGlzdDxJTGlzdD4gbGlzdHMgPSBuZXcgTGlzdDxJTGlzdD4oKTtcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgVXBkYXRlKGZsb2F0IGRlbHRhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0aW1lcy5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aW1lc1tpXSAtPSBkZWx0YTtcclxuICAgICAgICAgICAgICAgIGlmICh0aW1lc1tpXSA8PSAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEV4ZWN1dGUoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgRW5kVGFzayhpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgYWJzdHJhY3Qgdm9pZCBFeGVjdXRlKGludCBpKTtcclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBBZGQoZmxvYXQgdGltZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRpbWVzLkFkZCh0aW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIElzRG9uZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gdGltZXMuQ291bnQgPT0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgRW5kVGFzayhpbnQgaSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRpbWVzLlJlbW92ZUF0KGkpO1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgbCBpbiBsaXN0cylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbC5SZW1vdmVBdChpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgQXN5bmNUYXNrU2V0dGVyPFQ+IDogRGVsYXllZEFjdGlvbnNcclxuICAgIHtcclxuICAgICAgICBMaXN0PFQ+IFRvVmFsdWUgPSBuZXcgTGlzdDxUPigpO1xyXG4gICAgICAgIExpc3Q8QWN0aW9uPFQ+PiBzZXR0ZXJzID0gbmV3IExpc3Q8QWN0aW9uPFQ+PigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBBZGQoVCBlLCBBY3Rpb248VD4gc2V0dGVyLCBmbG9hdCB0aW1lKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVG9WYWx1ZS5BZGQoZSk7XHJcbiAgICAgICAgICAgIHNldHRlcnMuQWRkKChnbG9iYWw6OlN5c3RlbS5BY3Rpb248VD4pc2V0dGVyKTtcclxuICAgICAgICAgICAgYmFzZS5BZGQodGltZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCBvdmVycmlkZSB2b2lkIEV4ZWN1dGUoaW50IGkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzZXR0ZXJzW2ldKFRvVmFsdWVbaV0pO1xyXG4gICAgICAgICAgICBUb1ZhbHVlLlJlbW92ZUF0KGkpO1xyXG4gICAgICAgICAgICBzZXR0ZXJzLlJlbW92ZUF0KGkpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBBdHRhY2tJbnZlbnRvcnlcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgTGlzdDxpbnQ+IGF0dGFja0ludmVudG9yeSA9IG5ldyBMaXN0PGludD4oKTtcclxuICAgICAgICAvL2ludFtdIGVxdWlwcGVkQXR0YWNrcyA9IG5ldyBpbnRbM107XHJcbiAgICAgICAgcHVibGljIGludFtdIGVxdWlwcGVkQXR0YWNrcyA9IG5ldyBpbnRbXXsgLTEsLTEsLTEsIC0xfTtcclxuXHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgUGlkcm9oLkJhc2VVdGlscztcclxudXNpbmcgUGlkcm9oLkVDUztcclxudXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkXHJcbntcclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgU3RhZ2VEYXRhQ3JlYXRvclxyXG4gICAge1xyXG4gICAgICAgIC8vcHVibGljIExpc3Q8U3RhZ2VEYXRhPiBzdGFnZXMgPSBuZXcgTGlzdDxTdGFnZURhdGE+KCk7XHJcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBFQ1NNYW5hZ2VyIGVjcztcclxuICAgICAgICBwdWJsaWMgU3RhZ2VEYXRhR3JvdXAgY3VycmVudEdyb3VwO1xyXG5cclxuICAgICAgICBwdWJsaWMgU3RhZ2VEYXRhQ3JlYXRvcihFQ1NNYW5hZ2VyIGVjcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuZWNzID0gZWNzO1xyXG5cclxuICAgICAgICAgICAgU3RhZ2VEYXRhLlJlc2V0SWRDcmVhdGlvbigpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENyZWF0ZURlZmF1bHRTdGFnZURhdGEoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVHV0b3JpYWxHcm91cCgpO1xyXG5cclxuICAgICAgICAgICAgY3VycmVudEdyb3VwID0gbmV3IFN0YWdlRGF0YUdyb3VwKCk7XHJcbiAgICAgICAgICAgIEFkZEdyb3VwKGN1cnJlbnRHcm91cCk7XHJcblxyXG4gICAgICAgICAgICBBZGQoXHJcblxyXG4gICAgICAgICAgICAgICAgbmV3IFN0YWdlRGF0YShcclxuICAgICAgICAgICAgICAgIEVuZW15KDEsIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoMywgMikpLFxyXG4gICAgICAgICAgICAgICAgRW5lbXkoMiwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCg1LCAxKSlcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICxcclxuICAgICAgICAgICAgICAgICBuZXcgU3RhZ2VEYXRhKFxyXG4gICAgICAgICAgICAgICAgRW5lbXkoMCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCg0LCAxKSksXHJcbiAgICAgICAgICAgICAgICBFbmVteSgxLCBuZXcgQmFzZVV0aWxzLlZlY3RvcjJEKDUsIDEpKVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgLFxyXG4gICAgICAgICAgICAgICAgbmV3IFN0YWdlRGF0YShcclxuICAgICAgICAgICAgICAgIEVuZW15KDAsIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoMywgMikpLFxyXG4gICAgICAgICAgICAgICAgRW5lbXkoMiwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCgzLCAxKSksXHJcbiAgICAgICAgICAgICAgICBFbmVteSgyLCBuZXcgQmFzZVV0aWxzLlZlY3RvcjJEKDUsIDEpKVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgLFxyXG4gICAgICAgICAgICAgICAgbmV3IFN0YWdlRGF0YShcclxuICAgICAgICAgICAgICAgICAgICBuZXcgQmF0dGxlQ29uZmlnKG5ldyBpbnRbXSB7IDEgfSksXHJcbiAgICAgICAgICAgICAgICAgICAgRW5lbXkoMywgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCg0LCAxKSlcclxuICAgICAgICAgICAgICAgIClcclxuXHJcbiAgICAgICAgICAgICAgICAvLyxcclxuXHJcbiAgICAgICAgICAgICAgICAvLyxcclxuICAgICAgICAgICAgICAgIC8vbmV3IFN0YWdlRGF0YShcclxuICAgICAgICAgICAgICAgIC8vbmV3IEVuZW15U3Bhd25EYXRhKDEsIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoNCwgMSkpLFxyXG4gICAgICAgICAgICAgICAgLy9uZXcgRW5lbXlTcGF3bkRhdGEoMSwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCg1LCAxKSkpXHJcbiAgICAgICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgY3VycmVudEdyb3VwID0gbmV3IFN0YWdlRGF0YUdyb3VwKCk7XHJcbiAgICAgICAgICAgIEFkZEdyb3VwKGN1cnJlbnRHcm91cCk7XHJcblxyXG4gICAgICAgICAgICBBZGQoXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICBuZXcgU3RhZ2VEYXRhKFxyXG4gICAgICAgICAgICAgICAgRW5lbXkoOCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCgzLCAxKSlcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICxcclxuICAgICAgICAgICAgICAgIG5ldyBTdGFnZURhdGEoXHJcbiAgICAgICAgICAgICAgICBFbmVteSg4LCBuZXcgQmFzZVV0aWxzLlZlY3RvcjJEKDQsIDEpKSxcclxuICAgICAgICAgICAgICAgIEVuZW15KDUsIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoNSwgMSkpXHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAsXHJcbiAgICAgICAgICAgICAgICBuZXcgU3RhZ2VEYXRhKFxyXG4gICAgICAgICAgICAgICAgRW5lbXkoOCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCg0LCAyKSksXHJcbiAgICAgICAgICAgICAgICBFbmVteSgyLCBuZXcgQmFzZVV0aWxzLlZlY3RvcjJEKDMsIDApKVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgLFxyXG4gICAgICAgICAgICAgICAgbmV3IFN0YWdlRGF0YShcclxuICAgICAgICAgICAgICAgIEVuZW15KDgsIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoMywgMCkpLFxyXG4gICAgICAgICAgICAgICAgRW5lbXkoMSwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCg0LCAyKSksXHJcbiAgICAgICAgICAgICAgICBFbmVteSgxLCBuZXcgQmFzZVV0aWxzLlZlY3RvcjJEKDUsIDEpKVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgLFxyXG4gICAgICAgICAgICAgICAgbmV3IFN0YWdlRGF0YShcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLk5ldXRyYWwoMCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCgxLCAyKSksXHJcbiAgICAgICAgICAgICAgICBFbmVteSg5LCBuZXcgQmFzZVV0aWxzLlZlY3RvcjJEKDMsIDApKSxcclxuICAgICAgICAgICAgICAgIEVuZW15KDEwLCBuZXcgQmFzZVV0aWxzLlZlY3RvcjJEKDUsIDIpKVxyXG4gICAgICAgICAgICAgICAgKVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEVudGl0eSBUdXRvcmlhbEdyb3VwKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFN0YWdlRGF0YUdyb3VwIHRyYWluaW5nR3JvdXAgPSBuZXcgU3RhZ2VEYXRhR3JvdXAoKTtcclxuICAgICAgICAgICAgY3VycmVudEdyb3VwID0gdHJhaW5pbmdHcm91cDtcclxuICAgICAgICAgICAgdmFyIGVUdXRvID0gQWRkR3JvdXAodHJhaW5pbmdHcm91cCk7XHJcbiAgICAgICAgICAgIGVUdXRvLkFkZENvbXBvbmVudChuZXcgVGFnQ29tcG9uZW50KFwidHV0b3JpYWxcIikpO1xyXG5cclxuICAgICAgICAgICAgQWRkU3RhZ2UobmV3IFN0YWdlRGF0YShcclxuICAgICAgICAgICAgICAgIC8vRW5lbXkoMCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCg0LCAwKSksXHJcbiAgICAgICAgICAgICAgICBuZXcgQmF0dGxlQ29uZmlnKG5lZWRLaWxsQWxsRW5lbWllczogZmFsc2UpLk5vSW50ZXJtaXNzaW9uKCksXHJcbiAgICAgICAgICAgICAgICBQaWNrdXAoMCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCgwLCAwKSksXHJcbiAgICAgICAgICAgICAgICBQaWNrdXAoMCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCgyLCAyKSlcclxuICAgICAgICAgICAgICAgICkuSGlkZUxpZmVVSSgpLCBuZXcgRml4ZWRBdHRhY2tTdGFnZSgpKTtcclxuXHJcbiAgICAgICAgICAgIEFkZFN0YWdlKG5ldyBTdGFnZURhdGEoXHJcbiAgICAgICAgICAgICAgICAvL0VuZW15KDAsIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoNCwgMCkpLFxyXG4gICAgICAgICAgICAgICAgbmV3IEJhdHRsZUNvbmZpZyhuZWVkS2lsbEFsbEVuZW1pZXM6IGZhbHNlKS5Ob0ludGVybWlzc2lvbigpLFxyXG4gICAgICAgICAgICAgICAgUGlja3VwKDAsIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoMiwgMSkpLFxyXG4gICAgICAgICAgICAgICAgUGlja3VwKDAsIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoMCwgMikpLFxyXG4gICAgICAgICAgICAgICAgRW5lbXkoNCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCg1LCAxKSlcclxuICAgICAgICAgICAgICAgICkuSGlkZUxpZmVVSSgpLCBuZXcgRml4ZWRBdHRhY2tTdGFnZSgpKTtcclxuICAgICAgICAgICAgQWRkU3RhZ2UobmV3IFN0YWdlRGF0YShcclxuICAgICAgICAgICAgICAgIC8vRW5lbXkoMCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCg0LCAwKSksXHJcbiAgICAgICAgICAgICAgICBuZXcgQmF0dGxlQ29uZmlnKG5lZWRLaWxsQWxsRW5lbWllczogZmFsc2UpLk5vSW50ZXJtaXNzaW9uKCksXHJcbiAgICAgICAgICAgICAgICBQaWNrdXAoMCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCgyLCAyKSksXHJcbiAgICAgICAgICAgICAgICBQaWNrdXAoMCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCgxLCAyKSksXHJcbiAgICAgICAgICAgICAgICBQaWNrdXAoMCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCgwLCAyKSksXHJcbiAgICAgICAgICAgICAgICBFbmVteSg1LCBuZXcgQmFzZVV0aWxzLlZlY3RvcjJEKDUsIDIpKVxyXG4gICAgICAgICAgICAgICAgKSwgbmV3IEZpeGVkQXR0YWNrU3RhZ2UoKSk7XHJcbiAgICAgICAgICAgIEFkZFN0YWdlKG5ldyBTdGFnZURhdGEoXHJcbiAgICAgICAgICAgICAgICBuZXcgQmF0dGxlQ29uZmlnKG5lZWRLaWxsQWxsRW5lbWllczogdHJ1ZSkuTm9JbnRlcm1pc3Npb24oKSxcclxuICAgICAgICAgICAgICAgIC8vRW5lbXkoMCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCg0LCAwKSksXHJcbiAgICAgICAgICAgICAgICBFbmVteSg2LCBuZXcgQmFzZVV0aWxzLlZlY3RvcjJEKDUsIDApKVxyXG4gICAgICAgICAgICAgICAgKSwgbmV3IEZpeGVkQXR0YWNrU3RhZ2UoXHJcbiAgICAgICAgICAgICAgICAgICAgKGludClCYXR0bGVNYWluLk1vdmVUeXBlLkZpcmUpLCBuZXcgVHJhY2tJbmZvU3RhZ2UoMikpO1xyXG4gICAgICAgICAgICBBZGRTdGFnZShuZXcgU3RhZ2VEYXRhKFxyXG4gICAgICAgICAgICAgICAgbmV3IEJhdHRsZUNvbmZpZyhuZWVkS2lsbEFsbEVuZW1pZXM6IHRydWUpLk5vSW50ZXJtaXNzaW9uKCksXHJcbiAgICAgICAgICAgICAgIC8vRW5lbXkoMCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCg0LCAwKSksXHJcbiAgICAgICAgICAgICAgIEVuZW15KDQsIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoNCwgMSkpXHJcbiAgICAgICAgICAgICAgICksIG5ldyBGaXhlZEF0dGFja1N0YWdlKFxyXG4gICAgICAgICAgICAgICAgICAgKGludClCYXR0bGVNYWluLk1vdmVUeXBlLkZpcmUpLCBuZXcgVHJhY2tJbmZvU3RhZ2UoMikpO1xyXG4gICAgICAgICAgICBBZGRTdGFnZShuZXcgU3RhZ2VEYXRhKFxyXG4gICAgICAgICAgICAgICAgbmV3IEJhdHRsZUNvbmZpZyhuZWVkS2lsbEFsbEVuZW1pZXM6IHRydWUpLk5vSW50ZXJtaXNzaW9uKCksXHJcbiAgICAgICAgICAgICAgIC8vRW5lbXkoMCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCg0LCAwKSksXHJcbiAgICAgICAgICAgICAgIEVuZW15KDUsIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoNCwgMSkpXHJcbiAgICAgICAgICAgICAgICksIG5ldyBGaXhlZEF0dGFja1N0YWdlKFxyXG4gICAgICAgICAgICAgICAgICAgKGludClCYXR0bGVNYWluLk1vdmVUeXBlLkZpcmUpKTtcclxuICAgICAgICAgICAgQWRkU3RhZ2UobmV3IFN0YWdlRGF0YShcclxuICAgICAgICAgICAgICAgIG5ldyBCYXR0bGVDb25maWcobmVlZEtpbGxBbGxFbmVtaWVzOiB0cnVlKS5Ob0ludGVybWlzc2lvbigpLFxyXG4gICAgICAgICAgICAgIC8vRW5lbXkoMCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCg0LCAwKSksXHJcbiAgICAgICAgICAgICAgRW5lbXkoNSwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCg0LCAxKSksXHJcbiAgICAgICAgICAgICAgRW5lbXkoNywgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCgzLCAwKSlcclxuICAgICAgICAgICAgICApLCBuZXcgRml4ZWRBdHRhY2tTdGFnZShcclxuICAgICAgICAgICAgICAgICAgKGludClCYXR0bGVNYWluLk1vdmVUeXBlLkZpcmUsIChpbnQpQmF0dGxlTWFpbi5Nb3ZlVHlwZS5UaHVuZGVyKSk7XHJcblxyXG4gICAgICAgICAgICBBZGQobmV3IFN0YWdlRGF0YShcclxuICAgICAgICAgICAgICAgIG5ldyBCYXR0bGVDb25maWcobmVlZEtpbGxBbGxFbmVtaWVzOiB0cnVlKS5Ob0ludGVybWlzc2lvbigpLFxyXG4gICAgICAgICAgICAgICAgRW5lbXkoMCwgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCgzLCAwKSksXHJcbiAgICAgICAgICAgICAgICBFbmVteSgwLCBuZXcgQmFzZVV0aWxzLlZlY3RvcjJEKDUsIDIpKVxyXG4gICAgICAgICAgICAgICAgKSk7XHJcbiAgICAgICAgICAgIHJldHVybiBlVHV0bztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEluaXRpYWxpemVQcm9ncmVzcyhMaXN0PFN0YWdlUHJvZ3Jlc3NQZXJzaXN0ZW5jZT4gcGVyc2lzdGVudExpc3QpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgc3RhZ2VEYXRhcyA9IGVjcy5RdWlja0FjY2Vzc29yMTxTdGFnZURhdGE+KCk7XHJcbiAgICAgICAgICAgIHZhciBzdGFnZUdyb3VwcyA9IGVjcy5RdWlja0FjY2Vzc29yMTxTdGFnZURhdGFHcm91cD4oKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3RhZ2VEYXRhcy5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBib29sIGxvY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHN0YWdlR3JvdXBzLkNvdW50OyBqKyspXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWdlR3JvdXBzLkNvbXAxKGopLmNoaWxkSWRzWzBdLkVxdWFscyhzdGFnZURhdGFzLkVudGl0eShpKSkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBTdGFnZVByb2dyZXNzUGVyc2lzdGVuY2UgY29tcCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpbnQgaWQgPSBzdGFnZURhdGFzLkNvbXAxKGkpLmlkO1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIHBlciBpbiBwZXJzaXN0ZW50TGlzdClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGVyLnN0YWdlSWQgPT0gaWQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wID0gcGVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNvbXAgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2lmICh0cnVlKSB7IFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbXAgPSBuZXcgU3RhZ2VQcm9ncmVzc1BlcnNpc3RlbmNlKGlkKTtcclxuICAgICAgICAgICAgICAgICAgICBjb21wLmF2YWlsYWJsZSA9ICFsb2NrZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgcGVyc2lzdGVudExpc3QuQWRkKGNvbXApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZShcInNcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBzdGFnZURhdGFzLkVudGl0eShpKS5BZGRDb21wb25lbnQoY29tcCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENhbGN1bGF0ZVRyYWNrSW5mbyhMaXN0PEVuZW15RGF0YT4gZW5lbWllcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBzdGFnZURhdGFzID0gZWNzLlF1aWNrQWNjZXNzb3IxPFN0YWdlRGF0YT4oKTtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdGFnZURhdGFzLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBzZCA9IHN0YWdlRGF0YXMuQ29tcDEoaSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHNwYXducyA9IHNkLnNwYXduRGF0YXM7XHJcbiAgICAgICAgICAgICAgICBpbnQgdG90YWxIUCA9IDA7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiBzcGF3bnMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uZW50aXR5VHlwZSA9PSAoaW50KUJhdHRsZU1haW4uRW50aXR5VHlwZS5lbmVteSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmVteUlkID0gaXRlbS5pZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IGhwID0gZW5lbWllc1tlbmVteUlkXS5ocDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxIUCArPSBocDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpbnQgdGFyZ2V0ID0gMTtcclxuICAgICAgICAgICAgICAgIGlmICh0b3RhbEhQID09IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gMjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0b3RhbEhQID4gMylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3RhcmdldCA9ICgodG90YWxIUCAtIDEpIC8gMikgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldCA9IChpbnQpTWF0aC5DZWlsaW5nKHRvdGFsSFAgLyAzZik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNkLmJhdHRsZUNvbmZpZyAhPSBudWxsICYmICFzZC5iYXR0bGVDb25maWcubmVlZEtpbGxBbGxFbmVtaWVzKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldCA9IDI7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgRW50aXR5IGVudGl0eSA9IHN0YWdlRGF0YXMuRW50aXR5KGkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHRyYWNrSW5mb1N0YWUgPSBlbnRpdHkuR2V0Q29tcG9uZW50PFRyYWNrSW5mb1N0YWdlPigpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRyYWNrSW5mb1N0YWUgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBlbnRpdHkuQWRkQ29tcG9uZW50KG5ldyBUcmFja0luZm9TdGFnZSh0YXJnZXQpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgQWRkU3RhZ2UocGFyYW1zIG9iamVjdFtdIGNvbXBzKVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBlID0gZWNzLkNyZWF0ZUVudGl0eSgpO1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiBjb21wcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZS5BZGRDb21wb25lbnQoaXRlbSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGN1cnJlbnRHcm91cC5jaGlsZElkcy5BZGQoZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgRW50aXR5IEFkZEdyb3VwKFN0YWdlRGF0YUdyb3VwIGdyb3VwKVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBlID0gZWNzLkNyZWF0ZUVudGl0eSgpO1xyXG4gICAgICAgICAgICBlLkFkZENvbXBvbmVudChncm91cCk7XHJcbiAgICAgICAgICAgIHJldHVybiBlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBTcGF3bkRhdGEgUGlja3VwKGludCB2LCBWZWN0b3IyRCB2ZWN0b3IyRClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU3Bhd25EYXRhKHYsIHZlY3RvcjJELCAoaW50KUJhdHRsZU1haW4uRW50aXR5VHlwZS5waWNrdXApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIFNwYXduRGF0YSBOZXV0cmFsKGludCB2LCBWZWN0b3IyRCB2ZWN0b3IyRClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgU3Bhd25EYXRhKHYsIHZlY3RvcjJELCAoaW50KUJhdHRsZU1haW4uRW50aXR5VHlwZS5uZXV0cmFsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBTcGF3bkRhdGEgRW5lbXkoaW50IHYsIFZlY3RvcjJEIHZlY3RvcjJEKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBTcGF3bkRhdGEodiwgdmVjdG9yMkQsIChpbnQpQmF0dGxlTWFpbi5FbnRpdHlUeXBlLmVuZW15KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFkZChwYXJhbXMgU3RhZ2VEYXRhW10gc3RhZ2VEYXRhMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBpdGVtIGluIHN0YWdlRGF0YTEpXHJcbiAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjdXJyZW50R3JvdXAuY2hpbGRJZHMuQWRkKGVjcy5DcmVhdGVFbnRpdHlXaXRoQ29tcG9uZW50KGl0ZW0pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL3N0YWdlcy5BZGRSYW5nZShzdGFnZURhdGExKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIFN0YWdlRGF0YVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PFNwYXduRGF0YT4gc3Bhd25EYXRhcyA9IG5ldyBMaXN0PFNwYXduRGF0YT4oKTtcclxuICAgICAgICBwdWJsaWMgQmF0dGxlQ29uZmlnIGJhdHRsZUNvbmZpZztcclxuICAgICAgICBwdWJsaWMgYm9vbCBoaWRlTGlmZVVJID0gZmFsc2U7XHJcbiAgICAgICAgc3RhdGljIGludCBzdGF0aWNJZEhlbHBlciA9IC0xO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgaWQgPSAtMTtcclxuXHJcbiAgICAgICAgcHVibGljIFN0YWdlRGF0YSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzdGF0aWNJZEhlbHBlcisrO1xyXG4gICAgICAgICAgICBpZCA9IHN0YXRpY0lkSGVscGVyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIFN0YWdlRGF0YShwYXJhbXMgU3Bhd25EYXRhW10gc3Bhd25zKSA6IHRoaXMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5zcGF3bkRhdGFzLkFkZFJhbmdlKHNwYXducyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgU3RhZ2VEYXRhKEJhdHRsZUNvbmZpZyBiYXR0bGVDb25maWcsIHBhcmFtcyBTcGF3bkRhdGFbXSBzcGF3bnMpIDogdGhpcygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnNwYXduRGF0YXMuQWRkUmFuZ2Uoc3Bhd25zKTtcclxuICAgICAgICAgICAgdGhpcy5iYXR0bGVDb25maWcgPSBiYXR0bGVDb25maWc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgU3RhZ2VEYXRhIEhpZGVMaWZlVUkoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaGlkZUxpZmVVSSA9IHRydWU7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgc3RhdGljIHZvaWQgUmVzZXRJZENyZWF0aW9uKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHN0YXRpY0lkSGVscGVyID0gLTE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qXHJcbiAgICAgKiBIYXMgYmVlbiBleHBhbmRlZCB0byBhbHNvIGJlIGFibGUgdG8gY29udGFpbiBvdGhlciBzdGFnZSBkYXRhIGdyb3Vwc1xyXG4gICAgICogXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjbGFzcyBTdGFnZURhdGFHcm91cFxyXG4gICAge1xyXG4gICAgICAgIC8vY2FuIGJlIHN0YWdlIGRhdGEgYnV0IGFsc28gYmUgc3RhZ2UgZGF0YSBncm91cFxyXG4gICAgICAgIHB1YmxpYyBMaXN0PEVudGl0eT4gY2hpbGRJZHMgPSBuZXcgTGlzdDxFbnRpdHk+KCk7XHJcbiAgICAgICAgcHVibGljIGludCBsZXZlbDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgVHJhY2tJbmZvU3RhZ2VcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgaW50IHRhcmdldFJvdW5kcyA9IDA7XHJcblxyXG4gICAgICAgIHB1YmxpYyBUcmFja0luZm9TdGFnZSgpXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBUcmFja0luZm9TdGFnZShpbnQgdGFyZ2V0VHVybnMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnRhcmdldFJvdW5kcyA9IHRhcmdldFR1cm5zO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgRml4ZWRBdHRhY2tTdGFnZVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PGludD4gbW92ZXMgPSBuZXcgTGlzdDxpbnQ+KCk7XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgRml4ZWRBdHRhY2tTdGFnZShpbnQgbW92ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG1vdmVzLkFkZChtb3ZlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBGaXhlZEF0dGFja1N0YWdlKHBhcmFtcyBpbnRbXSBtb3ZlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbW92ZXMuQWRkUmFuZ2UobW92ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgRml4ZWRBdHRhY2tTdGFnZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgQXR0YWNrUHJpemVcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgaW50W10gcHJpemVzO1xyXG5cclxuICAgICAgICBwdWJsaWMgQXR0YWNrUHJpemUoaW50IGF0dGFjaylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHByaXplcyA9IG5ldyBpbnRbMV07XHJcbiAgICAgICAgICAgIHByaXplc1swXSA9IGF0dGFjaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBBdHRhY2tQcml6ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgQ3VycmVuY3lQcml6ZVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBpbnRbXSBjdXJyZW5jeTtcclxuXHJcbiAgICAgICAgcHVibGljIEN1cnJlbmN5UHJpemUoaW50IGF0dGFjaylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGN1cnJlbmN5ID0gbmV3IGludFsxXTtcclxuICAgICAgICAgICAgY3VycmVuY3lbMF0gPSBhdHRhY2s7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQ3VycmVuY3lQcml6ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHVibGljIGNsYXNzIFNwYXduRGF0YVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBpbnQgaWQ7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IGludCBlbnRpdHlUeXBlO1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBCYXNlVXRpbHMuVmVjdG9yMkQgcG9zaXRpb247XHJcblxyXG4gICAgICAgIHB1YmxpYyBTcGF3bkRhdGEoKVxyXG4gICAgICAgIHtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBTcGF3bkRhdGEoaW50IGlkLCBWZWN0b3IyRCBwb3NpdGlvbiwgaW50IHR5cGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XHJcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjtcclxuICAgICAgICAgICAgdGhpcy5lbnRpdHlUeXBlID0gdHlwZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgUGlkcm9oLkJhc2VVdGlscztcclxudXNpbmcgUGlkcm9oLkVDUztcclxudXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBCYXR0bGVTZXR1cFxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBFQ1NNYW5hZ2VyIGVjcztcclxuICAgICAgICBwdWJsaWMgQmF0dGxlTWFpbiBiYXR0bGVNYWluO1xyXG4gICAgICAgIHB1YmxpYyBNb3ZlQ3JlYXRvclByb2cgbW92ZUNyZWF0b3I7XHJcbiAgICAgICAgcHVibGljIFRpbWVTdGFtcCB0aW1lU3RhbXA7XHJcblxyXG4gICAgICAgIHB1YmxpYyBCYXR0bGVTZXR1cChpbnQgbW9kZSwgRUNTTWFuYWdlciBlY3MsIEVuZW15RGF0YUNyZWF0b3IgZW5lbXlEYXRhQ3JlYXRvciwgTW92ZUNyZWF0b3JQcm9nIG12KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5lY3MgPSBlY3M7XHJcbiAgICAgICAgICAgIHRpbWVTdGFtcCA9IG5ldyBUaW1lU3RhbXAoKTtcclxuICAgICAgICAgICAgZWNzLkNyZWF0ZUVudGl0eVdpdGhDb21wb25lbnQodGltZVN0YW1wKTtcclxuICAgICAgICAgICAgYmF0dGxlTWFpbiA9IG5ldyBCYXR0bGVNYWluKG1vZGUsIGVjcywgdGltZVN0YW1wKTtcclxuXHJcbiAgICAgICAgICAgIG1vdmVDcmVhdG9yID0gbXY7XHJcblxyXG4gICAgICAgICAgICBiYXR0bGVNYWluLk1vdmVEYXRhRXhlY3V0ZXIgPSBuZXcgTW92ZURhdGFFeGVjdXRlcihiYXR0bGVNYWluLCBtb3ZlQ3JlYXRvci5tb3ZlRGF0YXMsIGVjcywgdGltZVN0YW1wKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBlbmVteURhdGFzID0gZW5lbXlEYXRhQ3JlYXRvci5lbmVteURhdGFzO1xyXG4gICAgICAgICAgICB2YXIgZW5lbXlGYWN0b3J5ID0gbmV3IFNwYXduRW50aXR5RmFjdG9yeShlY3MsIGVuZW15RGF0YXMsIGJhdHRsZU1haW4pO1xyXG4gICAgICAgICAgICBiYXR0bGVNYWluLmVjc0ludGVnID0gbmV3IEVDU0ludGVncmF0aW9uKGVuZW15RmFjdG9yeSwgZWNzKTtcclxuICAgICAgICAgICAgdmFyIGJhdHRsZVN0YXRlID0gYmF0dGxlTWFpbi5iYXR0bGVTdGF0ZTtcclxuXHJcbiAgICAgICAgICAgIHsgLy9BSSBoYW5kbGluZyBjb2RlXHJcbiAgICAgICAgICAgICAgICB2YXIgZW5lbXlBaXMgPSBlY3MuUXVpY2tBY2Nlc3NvcjI8RW5lbXlBSSwgQmF0dGxlTWFpbi5CYXR0bGVFbnRpdHk+KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZW5lbXlBaVN0YXRlbGVzcyA9IGVjcy5DcmVhdGVBY2Nlc3NvcihuZWNlc3Nhcnk6IG5ldyBUeXBlW10geyB0eXBlb2YoRW5lbXlBSSkgfSwgbm90OiBuZXcgVHlwZVtdIHsgdHlwZW9mKEVuZW15QUlTdGF0ZSkgfSk7XHJcbiAgICAgICAgICAgICAgICBMaXN0PGludD4gcG9zc2libGVNb3ZlcyA9IG5ldyBMaXN0PGludD4oKTtcclxuICAgICAgICAgICAgICAgIHZhciBtb3ZlRGF0YXMgPSBtb3ZlQ3JlYXRvci5tb3ZlRGF0YXM7XHJcblxyXG4gICAgICAgICAgICAgICAgYmF0dGxlTWFpbi5FbmVteUdlbmVyYXRlTW92ZXMgPSAoKSA9PlxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChlbmVteUFpU3RhdGVsZXNzLkxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmVteUFpU3RhdGVsZXNzLkdldCgwKS5BZGRDb21wb25lbnQ8RW5lbXlBSVN0YXRlPigpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZW5lbXlBaXMuTGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFpID0gZW5lbXlBaXMuQ29tcDEoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiYXR0bGVyID0gZW5lbXlBaXMuQ29tcDIoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhaVN0YXRlID0gZW5lbXlBaXMuRW50aXR5KGkpLkdldENvbXBvbmVudDxFbmVteUFJU3RhdGU+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtb3ZlcyA9IGFpLm1vdmVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9zUyA9IGJhdHRsZXIucG9zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IGJhdHRsZVN0YXRlLnR1cm5zUGVyUGhhc2U7IGorKylcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGFpUHJvID0gKGogKyBhaVN0YXRlLnByb2dyZXNzKSAlIG1vdmVzLkNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vdmUgPSBtb3Zlc1thaVByb107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgbW92ZUlkID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobW92ZSBpcyBNb3ZlVXNlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3ZlSWQgPSAobW92ZSBhcyBNb3ZlVXNlKS5tb3ZlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb3ZlIGlzIFNwZWNpYWxFbmVteU1vdmVzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbSA9IChTcGVjaWFsRW5lbXlNb3Zlcyltb3ZlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtID09IFNwZWNpYWxFbmVteU1vdmVzLlNtYXJ0TW92ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NzaWJsZU1vdmVzLkNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkyID0gMDsgaTIgPCBtb3ZlRGF0YXMuQ291bnQ7IGkyKyspIC8vY29kZSB0byBhZGQgbW92ZW1lbnQgbW92ZXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhZ3MgPSBtb3ZlRGF0YXNbaTJdLnRhZ3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFncy5Db250YWlucygoaW50KU1vdmVEYXRhVGFncy5Nb3ZlbWVudCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCB2YWxpZE1vdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cyA9IG1vdmVEYXRhc1tpMl0udW5pdHM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciBpdGVtIGluIHVzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRoaW5ncyA9IGl0ZW0udGhpbmdzVG9IYXBwZW47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciB0aGluZyBpbiB0aGluZ3MpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGluZyBpcyBNb3ZlQWN0aW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYSA9IHRoaW5nIGFzIE1vdmVBY3Rpb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpcyA9IG1hLmRpc3RhbmNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZXN0UG9zID0gcG9zUyArIGRpcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVzdFBvcy5YIDwgMylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkTW92ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVzdFBvcy5YID4gNSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkTW92ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVzdFBvcy5ZIDwgMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkTW92ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVzdFBvcy5ZID4gMilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkTW92ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsaWRNb3ZlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NzaWJsZU1vdmVzLkFkZChpMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ZUlkID0gUGlkcm9oLkJhc2VVdGlscy5FeHRlbnNpb25zLlJhbmRvbUVsZW1lbnQ8aW50Pihwb3NzaWJsZU1vdmVzKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUobW92ZUlkKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobW92ZUlkID49IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmF0dGxlci5tb3Zlc1tqXSA9IG1vdmVJZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWQgPSBtb3ZlQ3JlYXRvci5tb3ZlRGF0YXNbbW92ZUlkXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXMgPSBtZC51bml0cztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiB1cylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aGluZ3MgPSBpdGVtLnRoaW5nc1RvSGFwcGVuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgdGhpbmcgaW4gdGhpbmdzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpbmcgaXMgTW92ZUFjdGlvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWEgPSB0aGluZyBhcyBNb3ZlQWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkaXMgPSBtYS5kaXN0YW5jZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NTICs9IGRpcztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2JlLm1vdmVzW2pdID0gO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFpU3RhdGUucHJvZ3Jlc3MgKz0gYmF0dGxlU3RhdGUudHVybnNQZXJQaGFzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgdHJhY2tCYXR0bGUgPSBuZXcgVHJhY2tCYXR0bGUoKTtcclxuICAgICAgICAgICAgYmF0dGxlTWFpbi5Nb3ZlRGF0YUV4ZWN1dGVyLnRyYWNrQmF0dGxlID0gdHJhY2tCYXR0bGU7XHJcbiAgICAgICAgICAgIGJhdHRsZU1haW4udHJhY2tCYXR0bGUgPSB0cmFja0JhdHRsZTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIEF0dGFja1ByZXZpZXdJbml0aWFsaXphdGlvbihNb3ZlRGF0YSBtb3ZlRGF0YUNob3NlblByZXZpZXcsIGludCBlbmVteVR1dG9yaWFsSWQsIGludCBtb3ZlRGF0YUluZGV4KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmF0dGxlTWFpbi5CYXR0bGVDb25maWd1cmUobmV3IEJhdHRsZUNvbmZpZyhmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlKSk7XHJcbiAgICAgICAgICAgIHZhciB0ZXN0RW5lbXlTcGF3biA9IG5ldyBTcGF3bkRhdGEoZW5lbXlUdXRvcmlhbElkK21vdmVEYXRhSW5kZXgsIG5ldyBWZWN0b3IyRCg0LCAxKSwoaW50KUJhdHRsZU1haW4uRW50aXR5VHlwZS5lbmVteSk7XHJcbiAgICAgICAgICAgIGVjcy5DcmVhdGVFbnRpdHlXaXRoQ29tcG9uZW50KHRlc3RFbmVteVNwYXduKTtcclxuXHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU3RhZ2VJbml0aWFsaXphdGlvbihFbnRpdHkgc3RhZ2VFbnRpdHksIEVDU01hbmFnZXIgZWNzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGZpeGVkQXR0YWNrID0gc3RhZ2VFbnRpdHkuR2V0Q29tcG9uZW50PEZpeGVkQXR0YWNrU3RhZ2U+KCk7XHJcbiAgICAgICAgICAgIHZhciBwbGF5ZXJIYW5kUG9vbCA9IGJhdHRsZU1haW4ucGxheWVySGFuZFBvb2w7XHJcbiAgICAgICAgICAgIGlmIChmaXhlZEF0dGFjayAhPSBudWxsKVxyXG4gICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGl0ZW0gaW4gZml4ZWRBdHRhY2subW92ZXMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxheWVySGFuZFBvb2wuQWRkKChCYXR0bGVNYWluLk1vdmVUeXBlKWl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGxheWVySGFuZFBvb2wuQWRkKEJhdHRsZU1haW4uTW92ZVR5cGUuRmlyZSk7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJIYW5kUG9vbC5BZGQoQmF0dGxlTWFpbi5Nb3ZlVHlwZS5JY2UpO1xyXG4gICAgICAgICAgICAgICAgcGxheWVySGFuZFBvb2wuQWRkKEJhdHRsZU1haW4uTW92ZVR5cGUuVGh1bmRlcik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhciBkZWNrTWFuYWdlciA9IG5ldyBEZWNrTWFuYWdlcig1KTtcclxuICAgICAgICAgICAgYmF0dGxlTWFpbi5kZWNrTWFuYWdlciA9IGRlY2tNYW5hZ2VyO1xyXG5cclxuICAgICAgICAgICAgaWYgKGZpeGVkQXR0YWNrICE9IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiBmaXhlZEF0dGFjay5tb3ZlcylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnQgZGVja0lkID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG1vdmVDcmVhdG9yLm1vdmVSZW5kZXJzW2l0ZW1dLmVsZW1lbnQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEJhdHRsZU1haW4uRWxlbWVudC5GaXJlOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVja01hbmFnZXIuU2V0RGVmYXVsdEF0dGFjaygwLCAoaW50KUJhdHRsZU1haW4uTW92ZVR5cGUuRmlyZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBCYXR0bGVNYWluLkVsZW1lbnQuSWNlOlxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY2tNYW5hZ2VyLlNldERlZmF1bHRBdHRhY2soMSwgKGludClCYXR0bGVNYWluLk1vdmVUeXBlLkljZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNrSWQgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQmF0dGxlTWFpbi5FbGVtZW50LlRodW5kZXI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNrSWQgPSAyO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY2tNYW5hZ2VyLlNldERlZmF1bHRBdHRhY2soMiwgKGludClCYXR0bGVNYWluLk1vdmVUeXBlLlRodW5kZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQmF0dGxlTWFpbi5FbGVtZW50Lk5vdGhpbmduZXNzOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0gIT0gKGludClCYXR0bGVNYWluLk1vdmVUeXBlLkZpcmUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtICE9IChpbnQpQmF0dGxlTWFpbi5Nb3ZlVHlwZS5JY2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSAhPSAoaW50KUJhdHRsZU1haW4uTW92ZVR5cGUuVGh1bmRlcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWNrTWFuYWdlci5BZGQoZGVja0lkLCBpdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGRlY2tNYW5hZ2VyLlNldERlZmF1bHRBdHRhY2soMCwgKGludClCYXR0bGVNYWluLk1vdmVUeXBlLkZpcmUpO1xyXG4gICAgICAgICAgICAgICAgZGVja01hbmFnZXIuU2V0RGVmYXVsdEF0dGFjaygxLCAoaW50KUJhdHRsZU1haW4uTW92ZVR5cGUuSWNlKTtcclxuICAgICAgICAgICAgICAgIGRlY2tNYW5hZ2VyLlNldERlZmF1bHRBdHRhY2soMiwgKGludClCYXR0bGVNYWluLk1vdmVUeXBlLlRodW5kZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vZGVja01hbmFnZXIuQWRkKDAsIChpbnQpQmF0dGxlTWFpbi5Nb3ZlVHlwZS5GaXJlKTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgIC8vZGVja01hbmFnZXIuQWRkKDEsIChpbnQpQmF0dGxlTWFpbi5Nb3ZlVHlwZS5JY2UpOyAgIFxyXG4gICAgICAgICAgICAgICAgLy9kZWNrTWFuYWdlci5BZGQoMiwgKGludClCYXR0bGVNYWluLk1vdmVUeXBlLlRodW5kZXIpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vZGVja01hbmFnZXIuQWRkKDAsIChpbnQpQmF0dGxlTWFpbi5Nb3ZlVHlwZS5Eb3duRmlyZSk7XHJcbiAgICAgICAgICAgICAgICAvL2RlY2tNYW5hZ2VyLkFkZCgxLCAoaW50KUJhdHRsZU1haW4uTW92ZVR5cGUuSWNlQm9tYik7XHJcbiAgICAgICAgICAgICAgICAvL2RlY2tNYW5hZ2VyLkFkZCgyLCAoaW50KUJhdHRsZU1haW4uTW92ZVR5cGUuVGh1bmRlckJvbWIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgc3RhZ2UgPSBzdGFnZUVudGl0eS5HZXRDb21wb25lbnQ8U3RhZ2VEYXRhPigpO1xyXG4gICAgICAgICAgICB2YXIgZW5teXMgPSBzdGFnZS5zcGF3bkRhdGFzO1xyXG5cclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGVuZW15IGluIGVubXlzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBlY3MuQ3JlYXRlRW50aXR5V2l0aENvbXBvbmVudChlbmVteSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgdHJhY2tJbmZvID0gc3RhZ2VFbnRpdHkuR2V0Q29tcG9uZW50PFRyYWNrSW5mb1N0YWdlPigpO1xyXG4gICAgICAgICAgICBiYXR0bGVNYWluLnRyYWNrQmF0dGxlLnN0YWdlSW5mbyA9IHRyYWNrSW5mbztcclxuXHJcbiAgICAgICAgICAgIGJhdHRsZU1haW4uQmF0dGxlQ29uZmlndXJlKHN0YWdlLmJhdHRsZUNvbmZpZyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIFNldERlZmF1bHRBdHRhY2soaW50IGluZGV4LCBpbnQgYXR0YWNrKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmF0dGxlTWFpbi5kZWNrTWFuYWdlci5TZXREZWZhdWx0QXR0YWNrKGluZGV4LCBhdHRhY2spO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgLy8vIGRhdGEgdGhhdCB3aWxsIGJlIGEgcGFydCBvZiBzdGFnZWRhdGEgc28gZWFjaCBzdGFnZSBjYW4gaGF2ZSBpdCdzIGNvbmZpZ1xyXG4gICAgLy8vIEl0IHdpbGwgYWxzbyBiZSBjb250YWluZWQgaW4gYmF0dGxlbWFpbi5cclxuICAgIC8vLyBTaG91bGQgYmUgc3RhdGljLCBvbmNlIGNyZWF0ZWQuXHJcbiAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgcHVibGljIGNsYXNzIEJhdHRsZUNvbmZpZ1xyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBMaXN0PGludD4gZW5lbWllc1RvU3VtbW9uID0gbmV3IExpc3Q8aW50PigpO1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBib29sIG5lZWRLaWxsQWxsRW5lbWllcyA9IHRydWU7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IGJvb2wgYXR0YWNrRGVtb25zdHJhdGlvbk1vZGUgPSBmYWxzZTtcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgYm9vbCBoZXJvUHJlc2VudCA9IHRydWU7XHJcbiAgICAgICAgcHVibGljIGJvb2wgaW50ZXJtaXNzaW9uU2NyZWVuID0gdHJ1ZTtcclxuXHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgQmF0dGxlQ29uZmlnKClcclxuICAgICAgICB7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQmF0dGxlQ29uZmlnKGludFtdIGVuZW1pZXNUb1N1bW1vbilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuZW5lbWllc1RvU3VtbW9uLkFkZFJhbmdlKGVuZW1pZXNUb1N1bW1vbik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQmF0dGxlQ29uZmlnKGJvb2wgbmVlZEtpbGxBbGxFbmVtaWVzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5uZWVkS2lsbEFsbEVuZW1pZXMgPSBuZWVkS2lsbEFsbEVuZW1pZXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQmF0dGxlQ29uZmlnKGJvb2wgbmVlZEtpbGxBbGxFbmVtaWVzLCBib29sIHByZXZpZXdNb2RlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5uZWVkS2lsbEFsbEVuZW1pZXMgPSBuZWVkS2lsbEFsbEVuZW1pZXM7XHJcbiAgICAgICAgICAgIHRoaXMuYXR0YWNrRGVtb25zdHJhdGlvbk1vZGUgPSBwcmV2aWV3TW9kZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBCYXR0bGVDb25maWcoYm9vbCBuZWVkS2lsbEFsbEVuZW1pZXMsIGJvb2wgYXR0YWNrRGVtb25zdHJhdGlvbk1vZGUsIGJvb2wgaGVyb1ByZXNlbnQsIGJvb2wgaW50ZXJtaXNzaW9uKSA6IHRoaXMobmVlZEtpbGxBbGxFbmVtaWVzLCBhdHRhY2tEZW1vbnN0cmF0aW9uTW9kZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuaW50ZXJtaXNzaW9uU2NyZWVuID0gaW50ZXJtaXNzaW9uO1xyXG4gICAgICAgICAgICB0aGlzLmhlcm9QcmVzZW50ID0gaGVyb1ByZXNlbnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQmF0dGxlQ29uZmlnIE5vSW50ZXJtaXNzaW9uKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuaW50ZXJtaXNzaW9uU2NyZWVuID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBQaWRyb2guQmFzZVV0aWxzO1xyXG51c2luZyBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuSGFwcHM7XHJcbnVzaW5nIFBpZHJvaC5FQ1M7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkXHJcbntcclxuXHJcblxyXG4gICAgcHVibGljIGNsYXNzIEJhdHRsZU1haW5cclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgRGVja01hbmFnZXIgZGVja01hbmFnZXI7XHJcbiAgICAgICAgcHVibGljIExpc3Q8QmF0dGxlRW50aXR5PiBlbnRpdGllcyA9IG5ldyBMaXN0PEJhdHRsZUVudGl0eT4oKTtcclxuICAgICAgICBwdWJsaWMgQmF0dGxlU3RhdGUgYmF0dGxlU3RhdGUgPSBuZXcgQmF0dGxlU3RhdGUoKTtcclxuICAgICAgICBwdWJsaWMgSGFwcE1hbmFnZXIgaGFwcE1hbmFnZXIgPSBuZXcgSGFwcE1hbmFnZXIoKTtcclxuICAgICAgICBEaWN0aW9uYXJ5PE1vdmVUeXBlLCBWZWN0b3IyRD4gbW92ZW1lbnRNb3ZlcyA9IG5ldyBEaWN0aW9uYXJ5PE1vdmVUeXBlLCBWZWN0b3IyRD4oKTtcclxuICAgICAgICAvL0RpY3Rpb25hcnk8TW92ZVR5cGUsIFBvaW50PiBhdHRhY2tNb3ZlcyA9IG5ldyBEaWN0aW9uYXJ5PE1vdmVUeXBlLCBQb2ludD4oKTtcclxuICAgICAgICBNb3ZlVHlwZVtdIGVuZW15TW92ZXM7XHJcbiAgICAgICAgLy9wdWJsaWMgTGlzdDxJbnB1dD4gaW5wdXRzID0gbmV3IExpc3Q8VHVybmJhc2VkLklucHV0PigpO1xyXG4gICAgICAgIHB1YmxpYyBJbnB1dEhvbGRlciBpbnB1dHMgPSBuZXcgSW5wdXRIb2xkZXIoKTtcclxuICAgICAgICBwdWJsaWMgTGlzdDxNb3ZlVHlwZT4gcGxheWVySGFuZEZpeGVkID0gbmV3IExpc3Q8TW92ZVR5cGU+KCk7XHJcbiAgICAgICAgcHVibGljIExpc3Q8TW92ZVR5cGU+IHBsYXllckhhbmRVbmZpeGVkID0gbmV3IExpc3Q8TW92ZVR5cGU+KCk7XHJcbiAgICAgICAgcHVibGljIExpc3Q8TW92ZVR5cGU+IHBsYXllckhhbmRQb29sID0gbmV3IExpc3Q8TW92ZVR5cGU+KCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBmbG9hdCB0aW1lVG9DaG9vc2VNYXggPSAxNWY7XHJcbiAgICAgICAgcHVibGljIGZsb2F0IHRpbWVUb0Nob29zZSA9IC0xO1xyXG5cclxuICAgICAgICBwdWJsaWMgQmF0dGxlUmVzdWx0IGJhdHRsZVJlc3VsdCA9IG5ldyBCYXR0bGVSZXN1bHQoKTtcclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBCYXR0bGVDb25maWd1cmUoQmF0dGxlQ29uZmlnIGJhdHRsZUNvbmZpZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChiYXR0bGVDb25maWcgPT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYmF0dGxlQ29uZmlnID0gbmV3IEJhdHRsZUNvbmZpZyhuZWVkS2lsbEFsbEVuZW1pZXM6IHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuQmF0dGxlQ29uZmlnID0gYmF0dGxlQ29uZmlnO1xyXG4gICAgICAgICAgICBiYXR0bGVTdGF0ZS50dXJuc1BlclBoYXNlLlZhbCA9IDM7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgTW92ZURhdGFFeGVjdXRlciBNb3ZlRGF0YUV4ZWN1dGVyO1xyXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgVGltZVN0YW1wIHRpbWVTdGFtcDtcclxuICAgICAgICBwcml2YXRlIFF1aWNrQWNjZXNzb3JUd288QmF0dGxlRW50aXR5LCBQaWNrdXBJbmZvPiBwaWNrdXBBY2Nlc3NvcjtcclxuICAgICAgICBpbnRlcm5hbCBFQ1NJbnRlZ3JhdGlvbiBlY3NJbnRlZztcclxuXHJcbiAgICAgICAgcHVibGljIEFjdGlvbiBFbmVteUdlbmVyYXRlTW92ZXM7XHJcbiAgICAgICAgcHVibGljIFRyYWNrQmF0dGxlIHRyYWNrQmF0dGxlO1xyXG5cclxuICAgICAgICBwdWJsaWMgQmF0dGxlQ29uZmlnIEJhdHRsZUNvbmZpZyB7IGdldDsgcHJpdmF0ZSBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgaW50IEJvYXJkV2lkdGggeyBnZXQ7IGludGVybmFsIHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBpbnQgQm9hcmRIZWlnaHQgeyBnZXQ7IGludGVybmFsIHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQmF0dGxlTWFpbihpbnQgbW9kZSwgRUNTTWFuYWdlciBlY3MsIFRpbWVTdGFtcCB0aW1lU3RhbXApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL3RoaXMuZWNzID0gZWNzO1xyXG4gICAgICAgICAgICB0aGlzLnRpbWVTdGFtcCA9IHRpbWVTdGFtcDtcclxuICAgICAgICAgICAgcGlja3VwQWNjZXNzb3IgPSBlY3MuUXVpY2tBY2Nlc3NvcjI8QmF0dGxlRW50aXR5LCBQaWNrdXBJbmZvPigpO1xyXG4gICAgICAgICAgICBtb3ZlbWVudE1vdmVzLkFkZChNb3ZlVHlwZS5Nb3ZlVXAsIFZlY3RvcjJELlVuaXRZKTtcclxuICAgICAgICAgICAgbW92ZW1lbnRNb3Zlcy5BZGQoTW92ZVR5cGUuTW92ZURvd24sIC1WZWN0b3IyRC5Vbml0WSk7XHJcbiAgICAgICAgICAgIG1vdmVtZW50TW92ZXMuQWRkKE1vdmVUeXBlLk1vdmVMZWZ0LCAtVmVjdG9yMkQuVW5pdFgpO1xyXG4gICAgICAgICAgICBtb3ZlbWVudE1vdmVzLkFkZChNb3ZlVHlwZS5Nb3ZlUmlnaHQsIFZlY3RvcjJELlVuaXRYKTtcclxuXHJcbiAgICAgICAgICAgIGVjcy5DcmVhdGVFbnRpdHlXaXRoQ29tcG9uZW50KGJhdHRsZVN0YXRlKTtcclxuXHJcbiAgICAgICAgICAgIHBsYXllckhhbmRGaXhlZC5DbGVhcigpO1xyXG4gICAgICAgICAgICBwbGF5ZXJIYW5kRml4ZWQuQWRkKE1vdmVUeXBlLk1vdmVSaWdodCk7XHJcbiAgICAgICAgICAgIHBsYXllckhhbmRGaXhlZC5BZGQoTW92ZVR5cGUuTW92ZUxlZnQpO1xyXG4gICAgICAgICAgICBwbGF5ZXJIYW5kRml4ZWQuQWRkKE1vdmVUeXBlLk1vdmVEb3duKTtcclxuICAgICAgICAgICAgcGxheWVySGFuZEZpeGVkLkFkZChNb3ZlVHlwZS5Nb3ZlVXApO1xyXG5cclxuICAgICAgICAgICAgaWYgKG1vZGUgPT0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcGxheWVySGFuZFVuZml4ZWQuQWRkKE1vdmVUeXBlLk5vcm1hbFNob3QpO1xyXG4gICAgICAgICAgICAgICAgZW5lbXlNb3ZlcyA9IG5ldyBNb3ZlVHlwZVtdIHtcclxuICAgICAgICAgICAgICAgICAgICBNb3ZlVHlwZS5Nb3ZlVXAsXHJcbiAgICAgICAgICAgICAgICAgICAgTW92ZVR5cGUuTW92ZUxlZnQsXHJcbiAgICAgICAgICAgICAgICAgICAgTW92ZVR5cGUuTW92ZURvd24sXHJcbiAgICAgICAgICAgICAgICAgICAgTW92ZVR5cGUuTW92ZVJpZ2h0LFxyXG4gICAgICAgICAgICAgICAgICAgIE1vdmVUeXBlLk5vcm1hbFNob3QsXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9wbGF5ZXJIYW5kVW5maXhlZC5BZGQoTW92ZVR5cGUuRmlyZSk7XHJcbiAgICAgICAgICAgICAgICAvL3BsYXllckhhbmRVbmZpeGVkLkFkZChNb3ZlVHlwZS5JY2UpO1xyXG4gICAgICAgICAgICAgICAgLy9wbGF5ZXJIYW5kVW5maXhlZC5BZGQoTW92ZVR5cGUuVGh1bmRlcik7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGVuZW15TW92ZXMgPSBuZXcgTW92ZVR5cGVbXSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTW92ZVR5cGUuTW92ZURvd24sXHJcbiAgICAgICAgICAgICAgICAgICAgTW92ZVR5cGUuTW92ZUxlZnQsXHJcbiAgICAgICAgICAgICAgICAgICAgTW92ZVR5cGUuTW92ZVVwLFxyXG4gICAgICAgICAgICAgICAgICAgIE1vdmVUeXBlLk1vdmVSaWdodCxcclxuICAgICAgICAgICAgICAgICAgICBNb3ZlVHlwZS5GaXJlLFxyXG4gICAgICAgICAgICAgICAgICAgIE1vdmVUeXBlLkljZSxcclxuICAgICAgICAgICAgICAgICAgICBNb3ZlVHlwZS5UaHVuZGVyLFxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy9wbGF5ZXJIYW5kLkFkZChNb3ZlVHlwZS5Ob3JtYWxTaG90KTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBJc1ZpY3RvcnkoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIGJhdHRsZVJlc3VsdC5yZXN1bHQgPT0gMTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBJbml0KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChCYXR0bGVDb25maWcuYXR0YWNrRGVtb25zdHJhdGlvbk1vZGUgPT0gZmFsc2UpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEJhdHRsZUVudGl0eSBoZXJvID0gbmV3IEJhdHRsZUVudGl0eSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGhlcm8ucG9zLlNldCgxLCAxKTtcclxuICAgICAgICAgICAgICAgIGhlcm8ubWluUG9zLlNldCgwLCAwKTtcclxuICAgICAgICAgICAgICAgIGhlcm8ubWF4UG9zLlNldCgyLCAyKTtcclxuICAgICAgICAgICAgICAgIGhlcm8uVHlwZSA9IEVudGl0eVR5cGUuaGVybztcclxuICAgICAgICAgICAgICAgIGhlcm8ubWF4TGlmZSA9IDUwO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGhlcm8ubW92ZXMuTGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGVyby5tb3Zlc1tpXSA9IC0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBlbnRpdGllcy5BZGQoaGVybyk7XHJcbiAgICAgICAgICAgICAgICBlY3NJbnRlZy5IZXJvQ3JlYXRlZChoZXJvKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGVjc0ludGVnLlNwYXduRW5lbWllcygpO1xyXG5cclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9HYW1lRW50aXR5IHBpY2t1cCA9IG5ldyBHYW1lRW50aXR5KCk7XHJcbiAgICAgICAgICAgICAgICAvL3BpY2t1cC5UeXBlID0gRW50aXR5VHlwZS5waWNrdXA7XHJcbiAgICAgICAgICAgICAgICAvL3BpY2t1cC5wb3MuU2V0KDAsIDIpO1xyXG4gICAgICAgICAgICAgICAgLy9waWNrdXAubGlmZSA9IDI7XHJcbiAgICAgICAgICAgICAgICAvL3BpY2t1cC5ncmFwaGljID0gNDtcclxuICAgICAgICAgICAgICAgIC8vZW50aXRpZXMuQWRkKHBpY2t1cCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy97XHJcbiAgICAgICAgICAgIC8vICAgIEJhdHRsZUVudGl0eSBwYW5lbEVmZmVjdCA9IG5ldyBCYXR0bGVFbnRpdHkoKTtcclxuICAgICAgICAgICAgLy8gICAgcGFuZWxFZmZlY3QuVHlwZSA9IEVudGl0eVR5cGUucGFuZWxlZmZlY3Q7XHJcbiAgICAgICAgICAgIC8vICAgIHBhbmVsRWZmZWN0LnBvcy5TZXQoMCwgMik7XHJcbiAgICAgICAgICAgIC8vICAgIHBhbmVsRWZmZWN0LmxpZmUgPSA1O1xyXG4gICAgICAgICAgICAvLyAgICBwYW5lbEVmZmVjdC5ncmFwaGljID0gNTtcclxuICAgICAgICAgICAgLy8gICAgcGFuZWxFZmZlY3QucmFuZG9tUG9zaXRpb24gPSB0cnVlO1xyXG4gICAgICAgICAgICAvLyAgICBwYW5lbEVmZmVjdC5kcmF3TGlmZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAvLyAgICBwYW5lbEVmZmVjdC5kcmF3VHVybiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAvLyAgICBSYW5kb21Qb3NpdGlvbihwYW5lbEVmZmVjdCk7XHJcbiAgICAgICAgICAgIC8vICAgIGVudGl0aWVzLkFkZChwYW5lbEVmZmVjdCk7XHJcbiAgICAgICAgICAgIC8vfVxyXG5cclxuICAgICAgICAgICAgLy97XHJcbiAgICAgICAgICAgIC8vICAgIEJhdHRsZUVudGl0eSBwYW5lbEVmZmVjdCA9IG5ldyBCYXR0bGVFbnRpdHkoKTtcclxuICAgICAgICAgICAgLy8gICAgcGFuZWxFZmZlY3QuVHlwZSA9IEVudGl0eVR5cGUucGFuZWxlZmZlY3Q7XHJcbiAgICAgICAgICAgIC8vICAgIHBhbmVsRWZmZWN0LnBvcy5TZXQoMCwgMik7XHJcbiAgICAgICAgICAgIC8vICAgIHBhbmVsRWZmZWN0LmxpZmUgPSA1O1xyXG4gICAgICAgICAgICAvLyAgICBwYW5lbEVmZmVjdC5ncmFwaGljID0gNTtcclxuICAgICAgICAgICAgLy8gICAgcGFuZWxFZmZlY3QucmFuZG9tUG9zaXRpb24gPSB0cnVlO1xyXG4gICAgICAgICAgICAvLyAgICBwYW5lbEVmZmVjdC5kcmF3TGlmZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAvLyAgICBwYW5lbEVmZmVjdC5kcmF3VHVybiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAvLyAgICBSYW5kb21Qb3NpdGlvbihwYW5lbEVmZmVjdCk7XHJcbiAgICAgICAgICAgIC8vICAgIGVudGl0aWVzLkFkZChwYW5lbEVmZmVjdCk7XHJcbiAgICAgICAgICAgIC8vfVxyXG5cclxuICAgICAgICAgICAgUmVzZXQoKTtcclxuICAgICAgICAgICAgRXhlY3V0ZVBoYXNlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgQmF0dGxlRW50aXR5IE5ld0JhdHRsZUVudGl0eSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBCYXR0bGVFbnRpdHkgYmF0dGxlRW50aXR5ID0gbmV3IEJhdHRsZUVudGl0eSgpO1xyXG4gICAgICAgICAgICBlbnRpdGllcy5BZGQoYmF0dGxlRW50aXR5KTtcclxuICAgICAgICAgICAgcmV0dXJuIGJhdHRsZUVudGl0eTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgUmVzZXQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBlbnRpdGllcy5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBlbnRpdGllc1tpXS5saWZlID0gZW50aXRpZXNbaV0ubWF4TGlmZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBDaGFuZ2VQaGFzZShCYXR0bGVQaGFzZS5FbmVteU1vdmVDaG9pY2UpO1xyXG4gICAgICAgICAgICBiYXR0bGVTdGF0ZS50dXJuLlZhbCA9IDA7XHJcbiAgICAgICAgICAgIGJhdHRsZVN0YXRlLnRvdGFsVHVybnMgPSAwO1xyXG4gICAgICAgICAgICBiYXR0bGVTdGF0ZS5hY3RpbmdFbnRpdHkgPSAwO1xyXG4gICAgICAgICAgICBiYXR0bGVTdGF0ZS5tb3ZlVGlja19Ob3cuVmFsID0gMDtcclxuICAgICAgICAgICAgYmF0dGxlU3RhdGUubW92ZVRpY2tfVG90YWwgPSAxO1xyXG4gICAgICAgICAgICBiYXR0bGVSZXN1bHQucmVzdWx0ID0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIGJvb2wgSXNPdmVyKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBiYXR0bGVSZXN1bHQucmVzdWx0ICE9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBUaWNrKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEZpbmlzaFByZXZpb3VzVGljaygpO1xyXG4gICAgICAgICAgICBib29sIGhlcm9BbGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBib29sIGVuZW15QWxpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgYm9vbCBwaWNrdXBPYmxpZ2F0b3J5RXhpc3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGl0ZW0gaW4gZW50aXRpZXMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLlR5cGUgPT0gRW50aXR5VHlwZS5lbmVteSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5saWZlID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXlBbGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5UeXBlID09IEVudGl0eVR5cGUuaGVybylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5saWZlID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVyb0FsaXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRoaXMucGlja3VwQWNjZXNzb3IuTGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBwaWNrdXAgPSBwaWNrdXBBY2Nlc3Nvci5Db21wMihpKTtcclxuICAgICAgICAgICAgICAgIGlmIChwaWNrdXAubmVjZXNzYXJ5Rm9yVmljdG9yeSAmJiBwaWNrdXBBY2Nlc3Nvci5Db21wMShpKS5BbGl2ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBwaWNrdXBPYmxpZ2F0b3J5RXhpc3QgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChiYXR0bGVTdGF0ZS5CYXR0bGVFbmRFbmFibGUgJiYgIUJhdHRsZUNvbmZpZy5hdHRhY2tEZW1vbnN0cmF0aW9uTW9kZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFoZXJvQWxpdmUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmF0dGxlUmVzdWx0LnJlc3VsdCA9IDI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICgoIWVuZW15QWxpdmUgfHwgIUJhdHRsZUNvbmZpZy5uZWVkS2lsbEFsbEVuZW1pZXMpICYmICFwaWNrdXBPYmxpZ2F0b3J5RXhpc3QpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmF0dGxlUmVzdWx0LnJlc3VsdCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJhY2tCYXR0bGUuQmF0dGxlRW5kVmljdG9yeSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoYmF0dGxlUmVzdWx0LnJlc3VsdCA9PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBoYXBwTWFuYWdlci5UaWNrKCk7XHJcbiAgICAgICAgICAgICAgICB0aW1lU3RhbXAuQWR2YW5jZSgxKTtcclxuICAgICAgICAgICAgICAgIEV4ZWN1dGVQaGFzZSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgVXBkYXRlKGZsb2F0IGRlbHRhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHRpbWVUb0Nob29zZSA+IDAgJiYgYmF0dGxlU3RhdGUucGhhc2UgPT0gQmF0dGxlUGhhc2UuUGlja0hhbmRzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aW1lVG9DaG9vc2UgLT0gZGVsdGE7XHJcbiAgICAgICAgICAgICAgICBpZiAodGltZVRvQ2hvb3NlIDw9IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgVGljaygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgRmluaXNoUHJldmlvdXNUaWNrKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEJhdHRsZVBoYXNlIHByZXZpb3VzUGhhc2UgPSBiYXR0bGVTdGF0ZS5waGFzZTtcclxuICAgICAgICAgICAgc3dpdGNoIChwcmV2aW91c1BoYXNlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEJhdHRsZVBoYXNlLkVuZW15TW92ZUNob2ljZTpcclxuICAgICAgICAgICAgICAgICAgICBDaGFuZ2VQaGFzZShCYXR0bGVQaGFzZS5IYW5kUmVjaGFyZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vaWYgKEJhdHRsZUNvbmZpZy5hdHRhY2tEZW1vbnN0cmF0aW9uTW9kZSA9PSBmYWxzZSlcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICBDaGFuZ2VQaGFzZShCYXR0bGVQaGFzZS5IYW5kUmVjaGFyZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIENoYW5nZVBoYXNlKEJhdHRsZVBoYXNlLlBpY2tIYW5kcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEJhdHRsZVBoYXNlLkhhbmRSZWNoYXJnZTpcclxuICAgICAgICAgICAgICAgICAgICBDaGFuZ2VQaGFzZShCYXR0bGVQaGFzZS5QaWNrSGFuZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBCYXR0bGVQaGFzZS5QaWNrSGFuZHM6XHJcbiAgICAgICAgICAgICAgICAgICAgQ2hhbmdlUGhhc2UoQmF0dGxlUGhhc2UuRXhlY3V0ZU1vdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBCYXR0bGVQaGFzZS5FeGVjdXRlTW92ZTpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYmF0dGxlU3RhdGUubW92ZVRpY2tfTm93ID49IGJhdHRsZVN0YXRlLm1vdmVUaWNrX1RvdGFsIC0gMSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhdHRsZVN0YXRlLm1vdmVUaWNrX05vdy5WYWwgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXR0bGVTdGF0ZS5tb3ZlVGlja19Ub3RhbCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2wgbm9Nb3JlVW5pdHNUb0FjdFRoaXNUdXJuID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IGlfaW5pdGlhbCA9IGJhdHRsZVN0YXRlLmFjdGluZ0VudGl0eSArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpX2luaXRpYWwgPCBlbnRpdGllcy5Db3VudClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IGlfaW5pdGlhbDsgaSA8IGVudGl0aWVzLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVudGl0aWVzW2ldLkFsaXZlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmF0dGxlU3RhdGUuYWN0aW5nRW50aXR5ID0gaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9Nb3JlVW5pdHNUb0FjdFRoaXNUdXJuID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub01vcmVVbml0c1RvQWN0VGhpc1R1cm4pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXR0bGVTdGF0ZS50dXJuID49IGJhdHRsZVN0YXRlLnR1cm5zUGVyUGhhc2UgLSAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYW5nZVBoYXNlKEJhdHRsZVBoYXNlLkVuZW15TW92ZUNob2ljZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGUgaW4gZW50aXRpZXMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5yYW5kb21Qb3NpdGlvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShcIlJBTkRPTSBQT1MhIVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJhbmRvbVBvc2l0aW9uKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhdHRsZVN0YXRlLmFjdGluZ0VudGl0eSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmF0dGxlU3RhdGUudHVybiA9IGJhdHRsZVN0YXRlLnR1cm4gKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhdHRsZVN0YXRlLnRvdGFsVHVybnMgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXR0bGVTdGF0ZS5tb3ZlVGlja19Ob3cuVmFsICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBSYW5kb21Qb3NpdGlvbihCYXR0bGVFbnRpdHkgZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGUucG9zLlggPSBSYW5kb21TdXBwbGllci5SYW5nZSgwLCA1KTtcclxuICAgICAgICAgICAgZS5wb3MuWSA9IFJhbmRvbVN1cHBsaWVyLlJhbmdlKDAsIDIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIENoYW5nZVBoYXNlKEJhdHRsZVBoYXNlIHBoYXNlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQmF0dGxlUGhhc2UgcHJldmlvdXNQaGFzZSA9IGJhdHRsZVN0YXRlLnBoYXNlO1xyXG4gICAgICAgICAgICBpZiAocGhhc2UgPT0gcHJldmlvdXNQaGFzZSkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgaWYgKHBoYXNlID09IEJhdHRsZVBoYXNlLlBpY2tIYW5kcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdHJhY2tCYXR0bGUuUm91bmQoKTtcclxuICAgICAgICAgICAgICAgIGlmIChwcmV2aW91c1BoYXNlICE9IEJhdHRsZVBoYXNlLkNvbmZpcm1JbnB1dClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoQmF0dGxlQ29uZmlnLmhlcm9QcmVzZW50KVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVja01hbmFnZXIuUmVmcmVzaCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJIYW5kUG9vbC5DbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW92ZXMgPSBkZWNrTWFuYWdlci5zZWxlY3Rpb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbW92ZXMuQ291bnQ7IGkrKylcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVySGFuZFBvb2wuQWRkKChNb3ZlVHlwZSltb3Zlc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vcGxheWVySGFuZFBvb2wuU2h1ZmZsZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJIYW5kVW5maXhlZC5DbGVhcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnQgY29tbWFuZHNUb0FkZCA9IG1vdmVzLkNvdW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29tbWFuZHNUb0FkZCA+IHBsYXllckhhbmRQb29sLkNvdW50KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kc1RvQWRkID0gcGxheWVySGFuZFBvb2wuQ291bnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb21tYW5kc1RvQWRkOyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllckhhbmRVbmZpeGVkLkFkZChwbGF5ZXJIYW5kUG9vbFtpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lVG9DaG9vc2UgPSB0aW1lVG9DaG9vc2VNYXg7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocHJldmlvdXNQaGFzZSA9PSBCYXR0bGVQaGFzZS5FeGVjdXRlTW92ZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYmF0dGxlU3RhdGUudHVybi5WYWwgPSAwO1xyXG4gICAgICAgICAgICAgICAgYmF0dGxlU3RhdGUuYWN0aW5nRW50aXR5ID0gMDtcclxuICAgICAgICAgICAgICAgIGJhdHRsZVN0YXRlLm1vdmVUaWNrX05vdy5WYWwgPSAwO1xyXG4gICAgICAgICAgICAgICAgYmF0dGxlU3RhdGUubW92ZVRpY2tfVG90YWwgPSAxO1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGUgaW4gZW50aXRpZXMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBlLm1vdmVzLkxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5tb3Zlc1tpXSA9IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBiYXR0bGVTdGF0ZS5waGFzZSA9IHBoYXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBDb25maXJtSW5wdXRTdGFydCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBDaGFuZ2VQaGFzZShCYXR0bGVQaGFzZS5Db25maXJtSW5wdXQpO1xyXG4gICAgICAgICAgICBpbnB1dHMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgaW5wdXRzLkFkZChuZXcgVHVybmJhc2VkLklucHV0VW5pdChJbnB1dFR5cGUuTWlzY0JhdHRsZSwgTWlzY0JhdHRsZUlucHV0LkNvbmZpcm0pLCBJbnB1dFRhZ3MuTUlTQyk7XHJcbiAgICAgICAgICAgIGlucHV0cy5BZGQobmV3IFR1cm5iYXNlZC5JbnB1dFVuaXQoSW5wdXRUeXBlLk1pc2NCYXR0bGUsIE1pc2NCYXR0bGVJbnB1dC5DYW5jZWwpLCBJbnB1dFRhZ3MuTUlTQyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgRXhlY3V0ZVBoYXNlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBwaGFzZSA9IGJhdHRsZVN0YXRlLnBoYXNlO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHBoYXNlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEJhdHRsZVBoYXNlLkVuZW15TW92ZUNob2ljZTpcclxuICAgICAgICAgICAgICAgICAgICBlY3NJbnRlZy5TcGF3bkVuZW1pZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICBFbmVteUdlbmVyYXRlTW92ZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgQmF0dGxlUGhhc2UuSGFuZFJlY2hhcmdlOlxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBCYXR0bGVQaGFzZS5QaWNrSGFuZHM6XHJcbiAgICAgICAgICAgICAgICAgICAgUGlja0hhbmRJbnB1dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBCYXR0bGVQaGFzZS5FeGVjdXRlTW92ZTpcclxuICAgICAgICAgICAgICAgICAgICBlY3NJbnRlZy5TcGF3bkVuZW1pZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICBFeGVjdXRlTW92ZXMoKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBQaWNrSGFuZElucHV0KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vZGVja01hbmFnZXIuXHJcbiAgICAgICAgICAgIGlucHV0cy5DbGVhcigpO1xyXG4gICAgICAgICAgICBpbnB1dHMuaW5wdXRGb3JDb25maXJtYXRpb24gPSBuZXcgSW5wdXRVbml0KElucHV0VHlwZS5Ob25lLCAtMSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIUJhdHRsZUNvbmZpZy5hdHRhY2tEZW1vbnN0cmF0aW9uTW9kZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGhpIGluIHBsYXllckhhbmRGaXhlZClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnB1dHMuQWRkKG5ldyBUdXJuYmFzZWQuSW5wdXRVbml0KElucHV0VHlwZS5Nb3ZlLCAoaW50KWhpKSwgSW5wdXRUYWdzLk1PVkVGSVgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGhpIGluIHBsYXllckhhbmRVbmZpeGVkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChoaSAhPSBNb3ZlVHlwZS5Eb05vdGhpbmcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0cy5BZGQobmV3IFR1cm5iYXNlZC5JbnB1dFVuaXQoSW5wdXRUeXBlLk1vdmUsIChpbnQpaGkpLCBJbnB1dFRhZ3MuTU9WRVVORklYKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlucHV0cy5BZGQobmV3IFR1cm5iYXNlZC5JbnB1dFVuaXQoSW5wdXRUeXBlLk1pc2NCYXR0bGUsIE1pc2NCYXR0bGVJbnB1dC5SZWRvKSwgSW5wdXRUYWdzLk1JU0MpO1xyXG4gICAgICAgICAgICAgICAgaW5wdXRzLkFkZChuZXcgVHVybmJhc2VkLklucHV0VW5pdChJbnB1dFR5cGUuTWlzY0JhdHRsZSwgTWlzY0JhdHRsZUlucHV0LkRvbmUpLCBJbnB1dFRhZ3MuTUlTQyk7XHJcbiAgICAgICAgICAgICAgICBpbnB1dHMuQWRkKG5ldyBUdXJuYmFzZWQuSW5wdXRVbml0KElucHV0VHlwZS5NaXNjQmF0dGxlLCBNaXNjQmF0dGxlSW5wdXQuSGVscCksIElucHV0VGFncy5NSVNDKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlucHV0cy5BZGQobmV3IFR1cm5iYXNlZC5JbnB1dFVuaXQoSW5wdXRUeXBlLk1pc2NCYXR0bGUsIE1pc2NCYXR0bGVJbnB1dC5MZWF2ZUF0dGFja0RlbW9uc3RyYXRpb24pLCBJbnB1dFRhZ3MuTUlTQyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBib29sIGVuZW15RXhpc3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGl0ZW0gaW4gZW50aXRpZXMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLlR5cGUgPT0gRW50aXR5VHlwZS5lbmVteSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBlbmVteUV4aXN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2lmIChlbmVteUV4aXN0KVxyXG4gICAgICAgICAgICAvLyAgICBpbnB1dHMuQWRkKG5ldyBUdXJuYmFzZWQuSW5wdXQoSW5wdXRUeXBlLk1pc2NCYXR0bGUsIE1pc2NCYXR0bGVJbnB1dC5QcmV2aWV3KSwgSW5wdXRUYWdzLk1JU0MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgSW5wdXREb25lKElucHV0VW5pdCBpbnB1dClcclxuICAgICAgICB7XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIGlmIChiYXR0bGVTdGF0ZS5waGFzZSA9PSBCYXR0bGVQaGFzZS5Db25maXJtSW5wdXQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFByb2Nlc3NJbnB1dChpbnB1dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnB1dHMuaW5wdXRGb3JDb25maXJtYXRpb24gPSBpbnB1dDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIElucHV0Q29uZmlybWVkKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIENoYW5nZVBoYXNlKEJhdHRsZVBoYXNlLlBpY2tIYW5kcyk7XHJcbiAgICAgICAgICAgIElucHV0VW5pdCBpbnB1dCA9IGlucHV0cy5pbnB1dEZvckNvbmZpcm1hdGlvbjtcclxuICAgICAgICAgICAgaW5wdXRzLmlucHV0Rm9yQ29uZmlybWF0aW9uID0gbmV3IElucHV0VW5pdChJbnB1dFR5cGUuTm9uZSwgLTEpO1xyXG4gICAgICAgICAgICBQcm9jZXNzSW5wdXQoaW5wdXQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIFByb2Nlc3NJbnB1dChJbnB1dFVuaXQgaW5wdXQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGUoXCJJTlBVVFwiKTtcclxuICAgICAgICAgICAgaWYgKGlucHV0LnR5cGUgPT0gSW5wdXRUeXBlLk1vdmUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIE1vdmVUeXBlIGFyZzEgPSAoTW92ZVR5cGUpaW5wdXQuYXJnMTtcclxuICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZShcIklOUFVUVEVEMVwiKTtcclxuICAgICAgICAgICAgICAgIGlmIChwbGF5ZXJIYW5kRml4ZWQuQ29udGFpbnMoYXJnMSkgfHwgcGxheWVySGFuZFVuZml4ZWQuQ29udGFpbnMoYXJnMSkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVja01hbmFnZXIuSW5wdXRVc2VkKChpbnQpYXJnMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlKFwiSU5QVVRURUQyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIE1vdmVDaG9zZW4oYXJnMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoaW5wdXQudHlwZSA9PSBJbnB1dFR5cGUuTWlzY0JhdHRsZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgTWlzY0JhdHRsZUlucHV0IG1pc2MgPSAoTWlzY0JhdHRsZUlucHV0KWlucHV0LmFyZzE7XHJcbiAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGUoXCJJTlBVVFwiK21pc2MpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1pc2MgPT0gTWlzY0JhdHRsZUlucHV0LlJlZG8pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGUgaW4gZW50aXRpZXMpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZS5UeXBlID09IEVudGl0eVR5cGUuaGVybylcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBlLm1vdmVzLkxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLm1vdmVzW2ldID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLm1vdmVzW2ldID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCB2YWx1ZSA9IGUubW92ZXNbaV07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSAtMSB8fCBpID09IGJhdHRsZVN0YXRlLnR1cm5zUGVyUGhhc2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBsb3N0TW92ZSA9IGUubW92ZXNbaSAtIDFdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVja01hbmFnZXIuUmVjb3Zlcihsb3N0TW92ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLm1vdmVzW2kgLSAxXSA9IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKG1pc2MgPT0gTWlzY0JhdHRsZUlucHV0LkRvbmUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgVGljaygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKG1pc2MgPT0gTWlzY0JhdHRsZUlucHV0LkNvbmZpcm0pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgSW5wdXRDb25maXJtZWQoKTtcclxuICAgICAgICAgICAgICAgICAgICBQaWNrSGFuZElucHV0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAobWlzYyA9PSBNaXNjQmF0dGxlSW5wdXQuQ2FuY2VsKVxyXG4gICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChtaXNjID09IE1pc2NCYXR0bGVJbnB1dC5MZWF2ZUF0dGFja0RlbW9uc3RyYXRpb24pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmF0dGxlUmVzdWx0LnJlc3VsdCA9IDM7IC8vd2FubmEgbGVhdmVcclxuICAgICAgICAgICAgICAgICAgICAvL3dyaXRlIHRoaXNcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgYm9vbCBCYXR0bGVEZWNpZGVkKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBoZXJvZXMgPSAwO1xyXG4gICAgICAgICAgICBpbnQgZW5lbWllcyA9IDA7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBlIGluIGVudGl0aWVzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZS5UeXBlID09IEVudGl0eVR5cGUuaGVybylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS5BbGl2ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVyb2VzKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZS5UeXBlID09IEVudGl0eVR5cGUuZW5lbXkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUuQWxpdmUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZW1pZXMrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gaGVyb2VzID09IDAgfHwgZW5lbWllcyA9PSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgTW92ZUNob3NlbihNb3ZlVHlwZSBtb3ZlVHlwZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBlIGluIGVudGl0aWVzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZS5UeXBlID09IEVudGl0eVR5cGUuaGVybylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGUubW92ZXMuTGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IHZhbHVlID0gZS5tb3Zlc1tpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSAtMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUubW92ZXNbaV0gPSAoaW50KW1vdmVUeXBlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBFeGVjdXRlTW92ZXMoKVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZShcImJsYVwiICsgYmF0dGxlU3RhdGUudHVybi5WYWwpO1xyXG4gICAgICAgICAgICAvL0NvbnNvbGUuUmVhZCgpO1xyXG4gICAgICAgICAgICBCYXR0bGVFbnRpdHkgYXR0YWNrZXIgPSBlbnRpdGllc1tiYXR0bGVTdGF0ZS5hY3RpbmdFbnRpdHldO1xyXG4gICAgICAgICAgICBpbnQgdHVybiA9IGJhdHRsZVN0YXRlLnR1cm47XHJcbiAgICAgICAgICAgIEV4ZWN1dGVNb3ZlKGF0dGFja2VyLCB0dXJuKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEV4ZWN1dGVNb3ZlKEJhdHRsZUVudGl0eSBhY3RvciwgaW50IHR1cm4pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBNb3ZlRGF0YUV4ZWN1dGVyLkV4ZWN1dGVNb3ZlKGFjdG9yLCB0dXJuKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZmxvYXQgQ2FsY3VsYXRlQXR0YWNrTXVsdGlwbGllcihCYXR0bGVFbnRpdHkgYWN0b3IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgYmFzZUQgPSBhY3Rvci5kYW1hZ2VNdWx0aXBsaWVyO1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgZSBpbiBlbnRpdGllcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUgIT0gYWN0b3IpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUucG9zID09IGFjdG9yLnBvcylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLlR5cGUgPT0gRW50aXR5VHlwZS5wYW5lbGVmZmVjdClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZUQgKj0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYmFzZUQ7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIGZsb2F0IENhbGN1bGF0ZURlZmVuZGVyTXVsdGlwbGllcihCYXR0bGVFbnRpdHkgYWN0b3IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgYmFzZUQgPSAxO1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgZSBpbiBlbnRpdGllcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUgIT0gYWN0b3IpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUucG9zID09IGFjdG9yLnBvcylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLlR5cGUgPT0gRW50aXR5VHlwZS5wYW5lbGVmZmVjdClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZUQgKj0gMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYmFzZUQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgY2xhc3MgQmF0dGxlU3RhdGVcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHB1YmxpYyBWYWx1ZSB0dXJuID0gbmV3IFZhbHVlKCk7XHJcbiAgICAgICAgICAgIHB1YmxpYyBpbnQgdG90YWxUdXJucztcclxuICAgICAgICAgICAgcHVibGljIFZhbHVlIHR1cm5zUGVyUGhhc2UgPSBuZXcgVmFsdWUoKTtcclxuICAgICAgICAgICAgcHVibGljIFZhbHVlIG1vdmVUaWNrX05vdyA9IG5ldyBWYWx1ZSgpO1xyXG4gICAgICAgICAgICBwdWJsaWMgaW50IG1vdmVUaWNrX1RvdGFsID0gMDtcclxuICAgICAgICAgICAgcHVibGljIGludCBhY3RpbmdFbnRpdHkgPSAwO1xyXG4gICAgICAgICAgICBwdWJsaWMgQmF0dGxlUGhhc2UgcGhhc2U7XHJcbiAgICAgICAgICAgIHB1YmxpYyBib29sIEJhdHRsZUVuZEVuYWJsZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgY2xhc3MgQmF0dGxlRW50aXR5XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwdWJsaWMgaW50IGxpZmU7XHJcbiAgICAgICAgICAgIHB1YmxpYyBWZWN0b3IyRCBwb3MgPSBuZXcgVmVjdG9yMkQoKTtcclxuICAgICAgICAgICAgcHVibGljIFZlY3RvcjJEIG1pblBvcyA9IG5ldyBWZWN0b3IyRCgpO1xyXG4gICAgICAgICAgICBwdWJsaWMgVmVjdG9yMkQgbWF4UG9zID0gbmV3IFZlY3RvcjJEKCk7XHJcbiAgICAgICAgICAgIHB1YmxpYyBpbnRbXSBtb3ZlcyA9IG5ldyBpbnRbMTBdO1xyXG4gICAgICAgICAgICBwdWJsaWMgaW50IGdyYXBoaWM7XHJcbiAgICAgICAgICAgIHB1YmxpYyBpbnQgZ3JhcGhpY1JlcGVhdGVkSW5kZXg7XHJcbiAgICAgICAgICAgIHB1YmxpYyBmbG9hdCBkYW1hZ2VNdWx0aXBsaWVyID0gMTtcclxuICAgICAgICAgICAgcHVibGljIGJvb2wgZHJhd0xpZmUgPSB0cnVlO1xyXG4gICAgICAgICAgICBwdWJsaWMgYm9vbCBkcmF3VHVybiA9IHRydWU7XHJcbiAgICAgICAgICAgIHB1YmxpYyBib29sIHJhbmRvbVBvc2l0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHB1YmxpYyBFbGVtZW50IGVsZW1lbnQgPSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5FbGVtZW50Lk5vdGhpbmduZXNzO1xyXG4gICAgICAgICAgICBwdWJsaWMgaW50IG1heExpZmUgPSAzO1xyXG5cclxuICAgICAgICAgICAgcHVibGljIEVudGl0eVR5cGUgVHlwZSA9IFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVudGl0eVR5cGUuaGVybztcclxuICAgICAgICAgICAgcHVibGljIFZlY3RvcjJEIFBvc2l0aW9uVjJEIHsgZ2V0IHsgcmV0dXJuIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQocG9zLlgsIHBvcy5ZKTsgfSB9XHJcblxyXG4gICAgICAgICAgICBwdWJsaWMgYm9vbCBEZWFkIHsgZ2V0IHsgcmV0dXJuIGxpZmUgPD0gMDsgfSB9XHJcblxyXG4gICAgICAgICAgICBwdWJsaWMgYm9vbCBBbGl2ZSB7IGdldCB7IHJldHVybiAhdGhpcy5EZWFkOyB9IH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZW51bSBNb3ZlVHlwZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRG9Ob3RoaW5nLFxyXG4gICAgICAgICAgICBNb3ZlVXAsXHJcbiAgICAgICAgICAgIE1vdmVMZWZ0LFxyXG4gICAgICAgICAgICBNb3ZlRG93bixcclxuICAgICAgICAgICAgTW92ZVJpZ2h0LFxyXG4gICAgICAgICAgICBOb3JtYWxTaG90LFxyXG4gICAgICAgICAgICBGaXJlLFxyXG4gICAgICAgICAgICBJY2UsXHJcbiAgICAgICAgICAgIFRodW5kZXIsXHJcbiAgICAgICAgICAgIEljZUJvbWIsXHJcbiAgICAgICAgICAgIFRodW5kZXJCb21iLFxyXG4gICAgICAgICAgICBTdW1tb25FbnRpdHksXHJcbiAgICAgICAgICAgIERvd25GaXJlLFxyXG4gICAgICAgICAgICBUcmlwbGVGaXJlLFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGVudW0gSGFwcFRhZ1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQXR0YWNrSGl0LFxyXG4gICAgICAgICAgICBBdHRhY2tNaXNzLFxyXG4gICAgICAgICAgICBEYW1hZ2VUYWtlbixcclxuICAgICAgICAgICAgTW92ZW1lbnRGYWlsXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZW51bSBCYXR0bGVQaGFzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRW5lbXlNb3ZlQ2hvaWNlLFxyXG4gICAgICAgICAgICBIYW5kUmVjaGFyZ2UsXHJcbiAgICAgICAgICAgIFBpY2tIYW5kcyxcclxuICAgICAgICAgICAgQ29uZmlybUlucHV0LFxyXG4gICAgICAgICAgICBFeGVjdXRlTW92ZSxcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgZW51bSBFbnRpdHlUeXBlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBoZXJvLCBlbmVteSwgbmV1dHJhbCwgcGlja3VwLCBwYW5lbGVmZmVjdFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGVudW0gRWxlbWVudFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRmlyZSwgSWNlLCBUaHVuZGVyLFxyXG4gICAgICAgICAgICBOb3RoaW5nbmVzc1xyXG4gICAgICAgIH1cclxuXG4gICAgXG5wcml2YXRlIGludCBfX1Byb3BlcnR5X19Jbml0aWFsaXplcl9fQm9hcmRXaWR0aD02O3ByaXZhdGUgaW50IF9fUHJvcGVydHlfX0luaXRpYWxpemVyX19Cb2FyZEhlaWdodD0zO31cclxuXHJcblxyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBWYWx1ZVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBmbG9hdCBWYWwgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgRW51bSB2YWxBc0VudW0geyBzZXQgeyBWYWwgPSBDb252ZXJ0LlRvU2luZ2xlKHZhbHVlKTsgfSB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgU2V0KGludCB2KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVmFsID0gdjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVmFsdWUgb3BlcmF0b3IgKyhWYWx1ZSBjMSwgZmxvYXQgYzIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjMS5WYWwgKz0gYzI7XHJcbiAgICAgICAgICAgIHJldHVybiBjMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgZmxvYXQgb3BlcmF0b3IgLShWYWx1ZSBjMSwgZmxvYXQgYzIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gYzEuVmFsIC0gYzI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgb3BlcmF0b3IgPT0oVmFsdWUgYzEsIFZhbHVlIGMyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYm9vbCBjMm51bGwgPSBvYmplY3QuUmVmZXJlbmNlRXF1YWxzKGMyLCBudWxsKTtcclxuICAgICAgICAgICAgYm9vbCBjMW51bGwgPSBvYmplY3QuUmVmZXJlbmNlRXF1YWxzKGMxLCBudWxsKTtcclxuICAgICAgICAgICAgaWYgKGMybnVsbCAmJiBjMW51bGwpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKGMxbnVsbCB8fCBjMm51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYzEuVmFsID09IGMyLlZhbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgYm9vbCBvcGVyYXRvciAhPShWYWx1ZSBjMSwgVmFsdWUgYzIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBib29sIGMybnVsbCA9IG9iamVjdC5SZWZlcmVuY2VFcXVhbHMoYzIsIG51bGwpO1xyXG4gICAgICAgICAgICBib29sIGMxbnVsbCA9IG9iamVjdC5SZWZlcmVuY2VFcXVhbHMoYzEsIG51bGwpO1xyXG4gICAgICAgICAgICBpZiAoYzJudWxsICYmIGMxbnVsbClcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKGMxbnVsbCB8fCBjMm51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjMS5WYWwgIT0gYzIuVmFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBpbXBsaWNpdCBvcGVyYXRvciBmbG9hdChWYWx1ZSBkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIGQuVmFsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBpbXBsaWNpdCBvcGVyYXRvciBpbnQoVmFsdWUgZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiAoaW50KWQuVmFsO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgQmF0dGxlUmVzdWx0XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGludCByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0cnVjdCBJbnB1dFVuaXRcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgSW5wdXRUeXBlIHR5cGU7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IGludCBhcmcxO1xyXG5cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBJbnB1dFVuaXQoSW5wdXRUeXBlIHR5cGUsIGludCBhcmcxKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcclxuICAgICAgICAgICAgdGhpcy5hcmcxID0gYXJnMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBJbnB1dFVuaXQoSW5wdXRUeXBlIHR5cGUsIEVudW0gYXJnMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XHJcbiAgICAgICAgICAgIHRoaXMuYXJnMSA9IENvbnZlcnQuVG9JbnQzMihhcmcxKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGVudW0gSW5wdXRUeXBlXHJcbiAgICB7XHJcbiAgICAgICAgTm9uZSwgTW92ZSwgTWlzY0JhdHRsZVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBlbnVtIE1pc2NCYXR0bGVJbnB1dFxyXG4gICAge1xyXG4gICAgICAgIERvbmUsXHJcbiAgICAgICAgUmVkbyxcclxuICAgICAgICBQcmV2aWV3LFxyXG4gICAgICAgIENvbmZpcm0sXHJcbiAgICAgICAgQ2FuY2VsLFxyXG4gICAgICAgIEhlbHAsXHJcbiAgICAgICAgTGVhdmVBdHRhY2tEZW1vbnN0cmF0aW9uXHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBDb2xvclN0dWZmXHJcbiAgICB7XHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgc3RyaW5nIEdvb2RNYWluO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIG5ldXRyYWxEYXJrID0gXCIjMTkwMTNiXCI7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgbmV1dHJhbFN0cm9uZyA9IFwiIzJjM2U0M1wiO1xyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IHN0cmluZyBHb29kU3ViO1xyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IHN0cmluZyBFdmlsTWFpbjtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZ1tdIGNvbG9ycyA9IG5ldyBzdHJpbmdbMjVdO1xyXG5cclxuICAgICAgICBzdGF0aWMgQ29sb3JTdHVmZigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvbG9ycy5MZW5ndGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY29sb3JzW2ldID0gXCIjNDAwMDIwXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9jb2xvcnNbQ29sb3JzLkhlcm9dID0gXCIjMDA5YzhkXCI7XHJcbiAgICAgICAgICAgIC8vY29uc3Qgc3RyaW5nIGhlcm9TdWIgPSBcIiMwMDVmOTFcIjtcclxuICAgICAgICAgICAgLy9jb2xvcnNbQ29sb3JzLkhlcm9UdXJuXSA9IGhlcm9TdWI7XHJcbiAgICAgICAgICAgIC8vY29sb3JzW0NvbG9ycy5FbmVteV0gPSBcIiNmZjAzNTNcIjtcclxuICAgICAgICAgICAgLy9jb2xvcnNbQ29sb3JzLkdyaWRIZXJvXSA9IGhlcm9TdWI7XHJcbiAgICAgICAgICAgIC8vY29sb3JzW0JhdHRsZVJlbmRlci5Db2xvcnMuR3JpZEVuZW15XSA9IFwiIzhlMDA2MFwiO1xyXG4gICAgICAgICAgICAvL2NvbG9yc1tCYXR0bGVSZW5kZXIuQ29sb3JzLkVuZW15VHVybl0gPSBcIiM4ZTAwNjBcIjtcclxuICAgICAgICAgICAgLy9jb2xvcnNbQmF0dGxlUmVuZGVyLkNvbG9ycy5Cb2FyZF0gPSBcIiMxZTQ4NmVcIjtcclxuICAgICAgICAgICAgLy9jb2xvcnNbQmF0dGxlUmVuZGVyLkNvbG9ycy5pbnB1dEtleV0gPSBcIiM2ODg2OTBcIjtcclxuICAgICAgICAgICAgLy9jb2xvcnNbQmF0dGxlUmVuZGVyLkNvbG9ycy5XaW5kb3dMYWJlbF0gPSBcIiMxZTQ4NmVcIjtcclxuICAgICAgICAgICAgLy9jb2xvcnNbQmF0dGxlUmVuZGVyLkNvbG9ycy5GaXJlQXVyYV0gPSBcIiM3OTMxMDBcIjtcclxuICAgICAgICAgICAgLy9jb2xvcnNbQmF0dGxlUmVuZGVyLkNvbG9ycy5JY2VBdXJhXSA9IFwiIzAwNTU5MFwiO1xyXG4gICAgICAgICAgICAvL2NvbG9yc1tCYXR0bGVSZW5kZXIuQ29sb3JzLlRodW5kZXJBdXJhXSA9IFwiIzAwNTgzZFwiO1xyXG5cclxuICAgICAgICAgICAgY29sb3JzW1BpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkhlcm9dID0gXCIjOGFkODk2XCI7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0cmluZyBoZXJvU3ViID0gXCIjNGM2ZDUwXCI7XHJcbiAgICAgICAgICAgIGNvbG9yc1tQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5IZXJvVHVybl0gPSBoZXJvU3ViO1xyXG4gICAgICAgICAgICBjb2xvcnNbUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5Db2xvcnMuRW5lbXldID0gXCIjZmY3Njk0XCI7XHJcbiAgICAgICAgICAgIGNvbG9yc1tQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5HcmlkSGVyb10gPSBoZXJvU3ViO1xyXG4gICAgICAgICAgICBjb25zdCBzdHJpbmcgZW5lbXlzdWIgPSBcIiNhNzQ2NGZcIjtcclxuICAgICAgICAgICAgY29sb3JzW1BpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkdyaWRFbmVteV0gPSBlbmVteXN1YjtcclxuICAgICAgICAgICAgY29sb3JzW1BpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkVuZW15VHVybl0gPSBlbmVteXN1YjtcclxuICAgICAgICAgICAgY29sb3JzW0JhdHRsZVJlbmRlci5Db2xvcnMuQm9hcmRdID0gXCIjMWU0ODZlXCI7XHJcbiAgICAgICAgICAgIGNvbG9yc1tCYXR0bGVSZW5kZXIuQ29sb3JzLmlucHV0S2V5XSA9IFwiIzY4ODY5MFwiO1xyXG4gICAgICAgICAgICBjb2xvcnNbQmF0dGxlUmVuZGVyLkNvbG9ycy5XaW5kb3dMYWJlbF0gPSBcIiMxZTQ4NmVcIjtcclxuICAgICAgICAgICAgY29sb3JzW0JhdHRsZVJlbmRlci5Db2xvcnMuRmlyZUF1cmFdID0gXCIjNzkzMTAwXCI7XHJcbiAgICAgICAgICAgIGNvbG9yc1tCYXR0bGVSZW5kZXIuQ29sb3JzLkljZUF1cmFdID0gXCIjMDA1NTkwXCI7XHJcbiAgICAgICAgICAgIGNvbG9yc1tCYXR0bGVSZW5kZXIuQ29sb3JzLlRodW5kZXJBdXJhXSA9IFwiIzAwNTgzZFwiO1xyXG4gICAgICAgICAgICBjb2xvcnNbQmF0dGxlUmVuZGVyLkNvbG9ycy5GaXJlU2hvdF0gPSBcIiNmODJiMzZcIjtcclxuICAgICAgICAgICAgY29sb3JzW0JhdHRsZVJlbmRlci5Db2xvcnMuSWNlU2hvdF0gPSBcIiMwMDdlZmZcIjtcclxuICAgICAgICAgICAgY29sb3JzW0JhdHRsZVJlbmRlci5Db2xvcnMuVGh1bmRlclNob3RdID0gXCIjYTM3YzAwXCI7XHJcbiAgICAgICAgICAgIGNvbG9yc1tCYXR0bGVSZW5kZXIuQ29sb3JzLkJhY2tncm91bmRJbnB1dF0gPSBcIiMwODA4MDhcIjtcclxuXHJcblxyXG4gICAgICAgICAgICBjb2xvcnNbQmF0dGxlUmVuZGVyLkNvbG9ycy5pbnB1dEtleV0gPSBcIiM5RTg2NjRcIjtcclxuICAgICAgICAgICAgY29sb3JzW0JhdHRsZVJlbmRlci5Db2xvcnMuSW5wdXREZXNjcmlwdGlvbl0gPSBcIiM4MDgwODBcIjtcclxuICAgICAgICAgICAgY29sb3JzW0JhdHRsZVJlbmRlci5Db2xvcnMuQmFja0JhdHRsZV0gPSBcIiMwMDAwMDBcIjtcclxuICAgICAgICAgICAgY29sb3JzW0JhdHRsZVJlbmRlci5Db2xvcnMuQmFja2dyb3VuZElucHV0XSA9IFwiIzFBMUExQVwiO1xyXG4gICAgICAgICAgICBjb2xvcnNbUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5Db2xvcnMuSGVyb1R1cm5dID0gXCIjMDBCMkIyXCI7XHJcbiAgICAgICAgICAgIGNvbG9yc1tQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5FbmVteVR1cm5dID0gXCIjRkYwMDQwXCI7XHJcbiAgICAgICAgICAgIGNvbG9yc1tQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5HcmlkSGVyb10gPSBcIiMwMDQ2OENcIjtcclxuICAgICAgICAgICAgY29sb3JzW1BpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkdyaWRFbmVteV0gPSBcIiM4QzAwMjNcIjtcclxuICAgICAgICAgICAgY29sb3JzW1BpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkhlcm9dID0gXCIjNjZGRkZGXCI7XHJcbiAgICAgICAgICAgIGNvbG9yc1tQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5FbmVteV0gPSBcIiNEOTAwMzZcIjtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbG9yc1tQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5IZXJvXSA9IFwiI0JGQkZCRlwiO1xyXG4gICAgICAgICAgICBjb2xvcnNbUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5Db2xvcnMuRW5lbXldID0gY29sb3JzW1BpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkhlcm9dO1xyXG4gICAgICAgICAgICBjb2xvcnNbUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5Db2xvcnMuSGVyb1R1cm5dID0gY29sb3JzW1BpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkhlcm9dO1xyXG4gICAgICAgICAgICBjb2xvcnNbUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5Db2xvcnMuRW5lbXlUdXJuXSA9IGNvbG9yc1tQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5IZXJvXTtcclxuICAgICAgICAgICAgY29sb3JzW0JhdHRsZVJlbmRlci5Db2xvcnMuV2luZG93TGFiZWxdID0gXCIjNjY2NjY2XCI7XHJcbiAgICAgICAgICAgIGNvbG9yc1tCYXR0bGVSZW5kZXIuQ29sb3JzLkJhY2tDb21tYW5kXSA9IFwiIzMzMzMzM1wiO1xyXG5cclxuICAgICAgICAgICAgY29sb3JzW0JhdHRsZVJlbmRlci5Db2xvcnMuRmlyZUF1cmFdID0gXCIjRkY4QzY2XCI7XHJcbiAgICAgICAgICAgIGNvbG9yc1tCYXR0bGVSZW5kZXIuQ29sb3JzLkljZUF1cmFdID0gXCIjNjZGRkZGXCI7XHJcbiAgICAgICAgICAgIGNvbG9yc1tCYXR0bGVSZW5kZXIuQ29sb3JzLlRodW5kZXJBdXJhXSA9IFwiI0ZGRkY2NlwiO1xyXG5cclxuICAgICAgICAgICAgY29sb3JzW0JhdHRsZVJlbmRlci5Db2xvcnMuQmFja1N0cmlwZV0gPSBcIiMxQTE0MERcIjtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBQaWRyb2guQmFzZVV0aWxzO1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQ29udGVudENyZWF0b3Jcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFN0YWdlRGF0YVByb2NlZHVyYWxfQVxyXG4gICAge1xyXG4gICAgICAgIFN0YWdlRGF0YUNyZWF0b3Igc3RhZ2VEYXRhQ3JlYXRvcjtcclxuICAgICAgICBpbnRbXSBlbmVteUlkcyA9IG5ldyBpbnRbXSB7IDAsIDEsIDIsIDgsIDUsIH07XHJcbiAgICAgICAgaW50W10gYm9zc0lkcyA9IG5ldyBpbnRbXSB7IDMsIDksIDEwIH07XHJcbiAgICAgICAgTGlzdDxpbnQ+IGF0dGFja1ByaXplSWRzID0gbmV3IExpc3Q8aW50PigpO1xyXG4gICAgICAgIExpc3Q8UG9pbnQyRD4gcG9zaXRpb25Qb29sID0gbmV3IExpc3Q8UG9pbnQyRD4oKTtcclxuXHJcbiAgICAgICAgcHVibGljIFN0YWdlRGF0YVByb2NlZHVyYWxfQShTdGFnZURhdGFDcmVhdG9yIHNkYylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLnN0YWdlRGF0YUNyZWF0b3IgPSBzZGM7XHJcbiAgICAgICAgICAgIC8vZHNhZHNhZFxyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMTQ7IGkgPCAzODsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBhdHRhY2tQcml6ZUlkcy5BZGQoaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIG1hc3RlciA9IG5ldyBTdGFnZURhdGFHcm91cCgpO1xyXG4gICAgICAgICAgICBzZGMuQWRkR3JvdXAobWFzdGVyKTtcclxuICAgICAgICAgICAgbWFzdGVyLmNoaWxkSWRzLkFkZChzZGMuVHV0b3JpYWxHcm91cCgpKTtcclxuXHJcbiAgICAgICAgICAgIC8ve1xyXG4gICAgICAgICAgICAvLyAgICB2YXIgZGVidWcgPSBuZXcgU3RhZ2VEYXRhR3JvdXAoKTtcclxuICAgICAgICAgICAgLy8gICAgdmFyIGVEZWJ1ZyA9IHNkYy5BZGRHcm91cChkZWJ1Zyk7XHJcbiAgICAgICAgICAgIC8vICAgIG1hc3Rlci5jaGlsZElkcy5BZGQoZURlYnVnKTtcclxuXHJcbiAgICAgICAgICAgIC8vICAgIHNkYy5jdXJyZW50R3JvdXAgPSBkZWJ1ZztcclxuXHJcbiAgICAgICAgICAgIC8vICAgIHNkYy5BZGQobmV3IFN0YWdlRGF0YShcclxuICAgICAgICAgICAgLy8gICAgICAgIG5ldyBCYXR0bGVDb25maWcobmV3IGludFtdIHsgMCB9KSxcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgc2RjLkVuZW15KDMsIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoNSwgMSkpXHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICkpO1xyXG4gICAgICAgICAgICAvL31cclxuXHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMjsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2FtcGFpZ24gPSBuZXcgU3RhZ2VEYXRhR3JvdXAoKTtcclxuICAgICAgICAgICAgICAgIGNhbXBhaWduLmxldmVsID0gMTtcclxuICAgICAgICAgICAgICAgIHZhciBlQ2FtcCA9IHNkYy5BZGRHcm91cChjYW1wYWlnbik7XHJcbiAgICAgICAgICAgICAgICBtYXN0ZXIuY2hpbGRJZHMuQWRkKGVDYW1wKTtcclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgNDsgaisrKVxyXG4gICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgZ3JvdXAgPSBuZXcgU3RhZ2VEYXRhR3JvdXAoKTtcclxuICAgICAgICAgICAgICAgICAgICBncm91cC5sZXZlbCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVHcm91cCA9IHNkYy5BZGRHcm91cChncm91cCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FtcGFpZ24uY2hpbGRJZHMuQWRkKGVHcm91cCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2RjLmN1cnJlbnRHcm91cCA9IGdyb3VwO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpbnQgYXR0YWNrUHJpemUgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGJvb2wgbm9ybWFsU3RhZ2UgPSBqIDwgMztcclxuICAgICAgICAgICAgICAgICAgICBpbnQgbnVtYmVyT2ZTdGFnZXMgPSAzO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGwgPSAwOyBsIDwgbnVtYmVyT2ZTdGFnZXM7IGwrKylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaW50IHggPSAwOyB4IDwgMzsgeCsrKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGludCB5ID0gMDsgeSA8IDM7IHkrKylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblBvb2wuQWRkKG5ldyBQb2ludDJEKHgrMywgeSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBib29sIGZpbmFsU3RhZ2UgPSBsID09IG51bWJlck9mU3RhZ2VzIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGF0dGFja0luZGV4ID0gUmFuZG9tU3VwcGxpZXIuUmFuZ2UoMCwgYXR0YWNrUHJpemVJZHMuQ291bnQgLSAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFja1ByaXplID0gYXR0YWNrUHJpemVJZHNbYXR0YWNrSW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNrUHJpemVJZHMuUmVtb3ZlQXQoYXR0YWNrSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZCA9IG5ldyBTdGFnZURhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IG5FbmVtaWVzID0gUmFuZG9tU3VwcGxpZXIuUmFuZ2UoMSwgMyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludCBjdXJyZW5jeSA9IDMwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBib29sIGJvc3MgPSBmaW5hbFN0YWdlICYmICFub3JtYWxTdGFnZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJvc3MpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5ID0gODA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuRW5lbWllcyA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGVuZW15SSA9IDA7IGVuZW15SSA8IG5FbmVtaWVzOyBlbmVteUkrKylcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvc0kgPSBSYW5kb21TdXBwbGllci5SYW5nZSgwLCBwb3NpdGlvblBvb2wuQ291bnQtMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gcG9zaXRpb25Qb29sW3Bvc0ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25Qb29sLlJlbW92ZUF0KHBvc0kpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGVuZW15SWQgPSBSYW5kb21TdXBwbGllci5SYW5kb21FbGVtZW50PGludD4oZW5lbXlJZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJvc3MpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXlJZCA9IFJhbmRvbVN1cHBsaWVyLlJhbmRvbUVsZW1lbnQ8aW50Pihib3NzSWRzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNkLnNwYXduRGF0YXMuQWRkKHNkYy5FbmVteShlbmVteUlkLCBuZXcgVmVjdG9yMkQocG9zLlgsIHBvcy5ZKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNkYy5BZGRTdGFnZShzZCwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL25ldyBBdHRhY2tQcml6ZShhdHRhY2tQcml6ZSksIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEN1cnJlbmN5UHJpemUoY3VycmVuY3kpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8ve1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIGludCBhdHRhY2tJbmRleCA9IFJhbmRvbVN1cHBsaWVyLlJhbmdlKDAsIGF0dGFja1ByaXplSWRzLkNvdW50IC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgYXR0YWNrUHJpemUgPSBhdHRhY2tQcml6ZUlkc1thdHRhY2tJbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgYXR0YWNrUHJpemVJZHMuUmVtb3ZlQXQoYXR0YWNrSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vc2RjLkFkZFN0YWdlKG5ldyBTdGFnZURhdGEoXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICBzZGMuRW5lbXkoUmFuZG9tU3VwcGxpZXIuUmFuZG9tRWxlbWVudChlbmVteUlkcyksIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoMywgMikpLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgc2RjLkVuZW15KFJhbmRvbVN1cHBsaWVyLlJhbmRvbUVsZW1lbnQoZW5lbXlJZHMpLCBuZXcgQmFzZVV0aWxzLlZlY3RvcjJEKDUsIDEpKVxyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgKSwgbmV3IEF0dGFja1ByaXplKGF0dGFja1ByaXplKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8ve1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIGludCBhdHRhY2tJbmRleCA9IFJhbmRvbVN1cHBsaWVyLlJhbmdlKDAsIGF0dGFja1ByaXplSWRzLkNvdW50IC0gMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgYXR0YWNrUHJpemUgPSBhdHRhY2tQcml6ZUlkc1thdHRhY2tJbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgYXR0YWNrUHJpemVJZHMuUmVtb3ZlQXQoYXR0YWNrSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL3NkYy5BZGRTdGFnZShcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICBuZXcgU3RhZ2VEYXRhKFxyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBuZXcgQmF0dGxlQ29uZmlnKG5ldyBpbnRbXSB7IFJhbmRvbVN1cHBsaWVyLlJhbmRvbUVsZW1lbnQoZW5lbXlJZHMpIH0pLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIHNkYy5FbmVteShSYW5kb21TdXBwbGllci5SYW5kb21FbGVtZW50KGJvc3NJZHMpLCBuZXcgQmFzZVV0aWxzLlZlY3RvcjJEKDQsIDEpKSksXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgbmV3IEF0dGFja1ByaXplKGF0dGFja1ByaXplKVxyXG4gICAgICAgICAgICAgICAgICAgIC8vKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuRGVidWdFeHRyYVxyXG57XHJcbiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIERlYnVnRXhcclxuICAgIHtcclxuICAgICAgICBzdGF0aWMgTGlzdDxzdHJpbmc+IG1lc3NhZ2VzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgTG9nKHN0cmluZyB2KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbWVzc2FnZXMuQWRkKHYpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIFNob3coKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQ29uc29sZS5DbGVhcigpO1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiBtZXNzYWdlcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBDb25zb2xlLlJlYWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgUGlkcm9oLkJhc2VVdGlscztcclxudXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBEZWNrTWFuYWdlclxyXG4gICAge1xyXG4gICAgICAgIExpc3Q8aW50PltdIGRlY2tzID0gbmV3IExpc3Q8aW50PlszXTtcclxuICAgICAgICBMaXN0PGludD5bXSBkZWNrc1N0YXRpYyA9IG5ldyBMaXN0PGludD5bM107XHJcbiAgICAgICAgTGlzdDxpbnQ+W10gZGlzY2FyZHMgPSBuZXcgTGlzdDxpbnQ+WzNdO1xyXG4gICAgICAgIGJvb2xbXSBkZWNrc09rID0gbmV3IGJvb2xbM107XHJcbiAgICAgICAgaW50W10gZGVmYXVsdEF0dGFjayA9IG5ldyBpbnRbNF07XHJcbiAgICAgICAgcHVibGljIExpc3Q8aW50PiBzZWxlY3Rpb24gPSBuZXcgTGlzdDxpbnQ+KCk7XHJcbiAgICAgICAgTGlzdDxpbnQ+IGRlY2tzTm90RW1wdHkgPSBuZXcgTGlzdDxpbnQ+KCk7XHJcbiAgICAgICAgYm9vbCBkZWZhdWx0QXR0YWNrQWx3YXlzUHJlc2VudEF0U3RhcnQgPSB0cnVlO1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PGludD4gbW92ZXNUb1JlbW92ZSA9IG5ldyBMaXN0PGludD4oKTtcclxuXHJcbiAgICAgICAgcHVibGljIERlY2tNYW5hZ2VyKGludCBoYW5kU2l6ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaGFuZFNpemU7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0aW9uLkFkZCgwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGRlY2tzLkxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBkZWNrc1tpXSA9IG5ldyBMaXN0PGludD4oKTtcclxuICAgICAgICAgICAgICAgIGRlY2tzU3RhdGljW2ldID0gbmV3IExpc3Q8aW50PigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBSZWZyZXNoKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vcmVtb3ZlcyB1c2VkIG1vdmVzIGZyb20gaGFuZFxyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiBtb3Zlc1RvUmVtb3ZlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnQgaW5kZXggPSBzZWxlY3Rpb24uSW5kZXhPZihpdGVtKTtcclxuICAgICAgICAgICAgICAgIGlmIChpbmRleCAhPSAtMSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpb25baW5kZXhdID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtb3Zlc1RvUmVtb3ZlLkNsZWFyKCk7XHJcbiAgICAgICAgICAgIGlmIChkZWZhdWx0QXR0YWNrQWx3YXlzUHJlc2VudEF0U3RhcnQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZGVmYXVsdEF0dGFjay5MZW5ndGg7IGkrKylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpb25baV0gPSBkZWZhdWx0QXR0YWNrW2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFJlZnJlc2hEZWNrRW1wdHlTdGF0dXMoKTtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBkZWNrcy5MZW5ndGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZGVja3NPa1tpXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGlvbi5Db250YWlucyhkZWZhdWx0QXR0YWNrW2ldKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWNrc09rW2ldID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgZGVja3NTdGF0aWNbaV0uQ291bnQ7IGorKylcclxuICAgICAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGlvbi5Db250YWlucyhkZWNrc1N0YXRpY1tpXVtqXSkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWNrc09rW2ldID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc2VsZWN0aW9uLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChzZWxlY3Rpb25baV0gPiAwKSBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGJvb2wgYWRkZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgZGVja3NPay5MZW5ndGg7IGorKylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWRlY2tzT2tbal0pXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWNrc09rW2pdID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWRkZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnQgbW92ZSA9IGRlZmF1bHRBdHRhY2tbal07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZWNrc1tqXS5Db3VudCAhPSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3ZlID0gRHJhdyhqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uW2ldID0gbW92ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVmcmVzaERlY2tFbXB0eVN0YXR1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIWFkZGVkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkZWNrc05vdEVtcHR5LkNvdW50ID4gMClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludCBkZWNrID0gUGlkcm9oLkJhc2VVdGlscy5FeHRlbnNpb25zLlJhbmRvbUVsZW1lbnQ8aW50PihkZWNrc05vdEVtcHR5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IG1vdmUgPSBEcmF3KGRlY2spO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpb25baV0gPSBtb3ZlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBSZWZyZXNoRGVja0VtcHR5U3RhdHVzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIFNldERlZmF1bHRBdHRhY2soaW50IGRlY2tJZCwgaW50IG1vdmUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBkZWZhdWx0QXR0YWNrW2RlY2tJZF0gPSBtb3ZlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBpbnQgRHJhdyhpbnQgZGVja0lkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIG1vdmUgPSBQaWRyb2guQmFzZVV0aWxzLkV4dGVuc2lvbnMuUmFuZG9tRWxlbWVudDxpbnQ+KGRlY2tzW2RlY2tJZF0pO1xyXG4gICAgICAgICAgICBkZWNrc1tkZWNrSWRdLlJlbW92ZShtb3ZlKTtcclxuICAgICAgICAgICAgcmV0dXJuIG1vdmU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIEFkZChpbnQgZGVja0lkLCBpbnQgaXRlbSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGRlY2tzW2RlY2tJZF0uQWRkKGl0ZW0pO1xyXG4gICAgICAgICAgICBkZWNrc1N0YXRpY1tkZWNrSWRdLkFkZChpdGVtKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBSZWZyZXNoRGVja0VtcHR5U3RhdHVzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGRlY2tzTm90RW1wdHkuQ2xlYXIoKTtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBkZWNrcy5MZW5ndGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRlY2tzW2ldLkNvdW50ID4gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWNrc05vdEVtcHR5LkFkZChpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBJbnB1dFVzZWQoaW50IG1vdmUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBtb3Zlc1RvUmVtb3ZlLkFkZChtb3ZlKTtcclxuICAgICAgICAgICAgLy9pbnQgaW5kZXggPSBzZWxlY3Rpb24uSW5kZXhPZihtb3ZlKTtcclxuICAgICAgICAgICAgLy9pZiAoaW5kZXggIT0gLTEpXHJcbiAgICAgICAgICAgIC8ve1xyXG4gICAgICAgICAgICAvLyAgICBzZWxlY3Rpb25baW5kZXhdID0gMDtcclxuICAgICAgICAgICAgLy99XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBSZWNvdmVyKGludCBsb3N0TW92ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG1vdmVzVG9SZW1vdmUuUmVtb3ZlKGxvc3RNb3ZlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgUGlkcm9oLkVDUztcclxudXNpbmcgU3lzdGVtO1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZFxyXG57XHJcbiAgICBpbnRlcm5hbCBjbGFzcyBFQ1NJbnRlZ3JhdGlvblxyXG4gICAge1xyXG5cclxuICAgICAgICBTcGF3bkVudGl0eUZhY3RvcnkgZW5lbXlGYWN0b3J5O1xyXG4gICAgICAgIEVDU01hbmFnZXIgZWNzO1xyXG5cclxuICAgICAgICBwdWJsaWMgRUNTSW50ZWdyYXRpb24oU3Bhd25FbnRpdHlGYWN0b3J5IGVuZW15RmFjdG9yeSwgRUNTTWFuYWdlciBlY3MpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLmVuZW15RmFjdG9yeSA9IGVuZW15RmFjdG9yeTtcclxuICAgICAgICAgICAgdGhpcy5lY3MgPSBlY3M7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIEhlcm9DcmVhdGVkKEJhdHRsZU1haW4uQmF0dGxlRW50aXR5IGhlcm8pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBlY3MuQ3JlYXRlRW50aXR5V2l0aENvbXBvbmVudChoZXJvKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgU3Bhd25FbmVtaWVzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGVuZW15RmFjdG9yeS5TcGF3bigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZFxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgRW5lbXlBSVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBMaXN0PG9iamVjdD4gbW92ZXMgPSBuZXcgTGlzdDxvYmplY3Q+KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIEVuZW15QUlTdGF0ZVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBpbnQgcHJvZ3Jlc3M7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIE1vdmVVc2VcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgaW50IG1vdmU7XHJcblxyXG4gICAgICAgIHB1YmxpYyBNb3ZlVXNlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgTW92ZVVzZShpbnQgbW92ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMubW92ZSA9IG1vdmU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbn1cclxuIiwidXNpbmcgUGlkcm9oLkJhc2VVdGlscztcclxudXNpbmcgUGlkcm9oLkVDUztcclxudXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBTcGF3bkVudGl0eUZhY3RvcnlcclxuICAgIHtcclxuXHJcbiAgICAgICAgRUNTTWFuYWdlciBlY3M7XHJcbiAgICAgICAgTGlzdDxFbmVteURhdGE+IGVuZW15RGF0YXM7XHJcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBCYXR0bGVNYWluIGJhdHRsZU1haW47XHJcbiAgICAgICAgcHJpdmF0ZSBRdWlja0FjY2Vzc29yT25lPFNwYXduRGF0YT4gc3Bhd25zO1xyXG5cclxuICAgICAgICBwdWJsaWMgU3Bhd25FbnRpdHlGYWN0b3J5KEVDU01hbmFnZXIgZWNzLCBMaXN0PEVuZW15RGF0YT4gZW5lbXlEYXRhcywgQmF0dGxlTWFpbiBiYXR0bGVNYWluKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5lY3MgPSBlY3M7XHJcbiAgICAgICAgICAgIC8vZWNzLlF1aWNrQWNjZXNzb3IxPEVuZW15RGF0YT4oKTtcclxuICAgICAgICAgICAgc3Bhd25zID0gZWNzLlF1aWNrQWNjZXNzb3IxPFNwYXduRGF0YT4oKTtcclxuICAgICAgICAgICAgdGhpcy5lbmVteURhdGFzID0gZW5lbXlEYXRhcztcclxuICAgICAgICAgICAgdGhpcy5iYXR0bGVNYWluID0gYmF0dGxlTWFpbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNwYXduKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBzcGF3bmVkID0gMDtcclxuICAgICAgICAgICAgLy9mb3IgKGludCBpID0gMDsgaSA8IHNwYXducy5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICB3aGlsZSAoc3Bhd25zLkNvdW50ID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgU3Bhd25EYXRhIHNwYXduID0gc3Bhd25zLkNvbXAxKDApO1xyXG4gICAgICAgICAgICAgICAgc3Bhd25zLkVudGl0eSgwKS5SZW1vdmVDb21wb25lbnQoc3Bhd24pO1xyXG4gICAgICAgICAgICAgICAgdmFyIGlkID0gc3Bhd24uaWQ7XHJcbiAgICAgICAgICAgICAgICBCYXR0bGVNYWluLkVudGl0eVR5cGUgZW50VHlwZSA9IChCYXR0bGVNYWluLkVudGl0eVR5cGUpc3Bhd24uZW50aXR5VHlwZTtcclxuICAgICAgICAgICAgICAgIGlmKGVudFR5cGUgPT0gQmF0dGxlTWFpbi5FbnRpdHlUeXBlLnBpY2t1cClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYmUgPSBiYXR0bGVNYWluLk5ld0JhdHRsZUVudGl0eSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJlLlR5cGUgPSBlbnRUeXBlO1xyXG4gICAgICAgICAgICAgICAgICAgIFBpY2t1cEluZm8gcGlja3VwID0gbmV3IFBpY2t1cEluZm8odHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBpY2t1cEUgPSBlY3MuQ3JlYXRlRW50aXR5V2l0aENvbXBvbmVudChwaWNrdXApO1xyXG4gICAgICAgICAgICAgICAgICAgIHBpY2t1cEUuQWRkQ29tcG9uZW50KGJlKTtcclxuICAgICAgICAgICAgICAgICAgICBiZS5wb3MgPSBzcGF3bi5wb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICBiZS5saWZlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBiZS5tYXhMaWZlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBiZS5kcmF3TGlmZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJlLmRyYXdUdXJuID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgYmUuZ3JhcGhpYyA9IDQ7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZW50VHlwZSA9PSBCYXR0bGVNYWluLkVudGl0eVR5cGUubmV1dHJhbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYmUgPSBiYXR0bGVNYWluLk5ld0JhdHRsZUVudGl0eSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJlLlR5cGUgPSBlbnRUeXBlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBiZS5wb3MgPSBzcGF3bi5wb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICBiZS5saWZlID0gMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgYmUubWF4TGlmZSA9IDMwO1xyXG4gICAgICAgICAgICAgICAgICAgIGJlLmRyYXdMaWZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgYmUuZHJhd1R1cm4gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBiZS5ncmFwaGljID0gNTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZW50VHlwZSA9PSBCYXR0bGVNYWluLkVudGl0eVR5cGUuZW5lbXkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVuZW15QUkgPSBlbmVteURhdGFzW2lkXS5lbmVteUFJO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbmVteSA9IGVjcy5DcmVhdGVFbnRpdHlXaXRoQ29tcG9uZW50KGVuZW15QUkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiZSA9IGJhdHRsZU1haW4uTmV3QmF0dGxlRW50aXR5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYmUucG9zID0gc3Bhd24ucG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgYmUubGlmZSA9IGVuZW15RGF0YXNbaWRdLmhwO1xyXG4gICAgICAgICAgICAgICAgICAgIGJlLm1heExpZmUgPSBiZS5saWZlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJlLmdyYXBoaWMgPSBlbmVteURhdGFzW2lkXS5yZW5kZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVudGl0aWVzID0gYmF0dGxlTWFpbi5lbnRpdGllcztcclxuICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiBlbnRpdGllcylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtICE9IGJlICYmIGl0ZW0uZ3JhcGhpYyA9PSBiZS5ncmFwaGljKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZS5ncmFwaGljUmVwZWF0ZWRJbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJlLm1pblBvcyA9IG5ldyBWZWN0b3IyRCgzLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICBiZS5tYXhQb3MgPSBuZXcgVmVjdG9yMkQoNSwgMik7XHJcbiAgICAgICAgICAgICAgICAgICAgYmUuVHlwZSA9IEJhdHRsZU1haW4uRW50aXR5VHlwZS5lbmVteTtcclxuICAgICAgICAgICAgICAgICAgICBlbmVteS5BZGRDb21wb25lbnQoYmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIEVuZW15QUlTdGF0ZSBlbmVteUFpU3RhdGUgPSBuZXcgRW5lbXlBSVN0YXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZW5lbXlBaVN0YXRlLnByb2dyZXNzID0gc3Bhd25lZDtcclxuICAgICAgICAgICAgICAgICAgICBlbmVteS5BZGRDb21wb25lbnQoZW5lbXlBaVN0YXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGUoXCJTUEFXTlwiKTtcclxuICAgICAgICAgICAgICAgICAgICBzcGF3bmVkKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIFBpY2t1cEluZm9cclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgYm9vbCBuZWNlc3NhcnlGb3JWaWN0b3J5O1xyXG5cclxuICAgICAgICBwdWJsaWMgUGlja3VwSW5mbyhib29sIG5lY2Vzc2FyeUZvclZpY3RvcnkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLm5lY2Vzc2FyeUZvclZpY3RvcnkgPSBuZWNlc3NhcnlGb3JWaWN0b3J5O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIFBpY2t1cEluZm8oKVxyXG4gICAgICAgIHtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIEVuZW15RGF0YVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBFbmVteUFJIGVuZW15QUk7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IGludCBocDtcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgaW50IHJlbmRlcjtcclxuXHJcbiAgICAgICAgcHVibGljIEVuZW15RGF0YShFbmVteUFJIGVuZW15QUksIGludCBocCwgaW50IHJlbmRlcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuZW5lbXlBSSA9IGVuZW15QUk7XHJcbiAgICAgICAgICAgIHRoaXMuaHAgPSBocDtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIgPSByZW5kZXI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBFbmVteURhdGFDcmVhdG9yXHJcbiAgICB7XHJcbiAgICAgICAgTGlzdDxzdHJpbmc+IHJlbmRlclRleHRzO1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PEVuZW15RGF0YT4gZW5lbXlEYXRhcyA9IG5ldyBMaXN0PEVuZW15RGF0YT4oKTtcclxuICAgICAgICBNb3ZlQ3JlYXRvclByb2cgbW92ZUNyZWF0b3JQcm9nO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgc3RhcnRPZlR1dG9yaWFsRW5lbXk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBFbmVteURhdGFDcmVhdG9yKExpc3Q8c3RyaW5nPiByZW5kZXJUZXh0cywgTW92ZUNyZWF0b3JQcm9nIG1vdmVDcmVhdG9yUHJvZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJlbmRlclRleHRzLkFkZChcIkBcIik7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyVGV4dHMgPSByZW5kZXJUZXh0cztcclxuICAgICAgICAgICAgdGhpcy5tb3ZlQ3JlYXRvclByb2cgPSBtb3ZlQ3JlYXRvclByb2c7XHJcblxyXG4gICAgICAgICAgICAvL2NvbW1lbnRcclxuICAgICAgICAgICAgLy9BZGRFbmVteShhaTogQWN0aW9ucyhcclxuICAgICAgICAgICAgLy8gICAgU3BlY2lhbEVuZW15TW92ZXMuU21hcnRNb3ZlLCBNb3ZlVHlwZS5Nb3ZlTGVmdCwgTW92ZVR5cGUuTW92ZURvd25cclxuICAgICAgICAgICAgLy8gICAgKSwgaHA6IDIsIHJlbmRlclRleHQ6IFwiJVwiKTtcclxuXHJcbiAgICAgICAgICAgIEFkZEVuZW15KGFpOiBBY3Rpb25zKFxyXG4gICAgICAgICAgICAgICAgTW92ZXMoUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGUuTW92ZUxlZnQsUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGUuTW92ZURvd24sIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlLkZpcmUsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlLk1vdmVSaWdodCwgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGUuTW92ZVVwLCBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5Nb3ZlVHlwZS5UaHVuZGVyKVxyXG4gICAgICAgICAgICAgICAgKSwgaHA6MTIsIHJlbmRlclRleHQ6XCIlXCIpO1xyXG4gICAgICAgICAgICBBZGRFbmVteShhaTogQWN0aW9ucyhcclxuICAgICAgICAgICAgICAgIE1vdmVzKFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlLkljZUJvbWIsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlLkRvTm90aGluZywgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGUuRG9Ob3RoaW5nKVxyXG4gICAgICAgICAgICAgICAgKSwgaHA6IDE1LCByZW5kZXJUZXh0OiBcIiNcIik7XHJcbiAgICAgICAgICAgIEFkZEVuZW15KGFpOiBBY3Rpb25zKFxyXG4gICAgICAgICAgICAgICBNb3ZlcyhcclxuICAgICAgICAgICAgICAgICAgIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlLkljZUJvbWIsXHJcbiAgICAgICAgICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5Nb3ZlVHlwZS5Nb3ZlTGVmdCxcclxuICAgICAgICAgICAgICAgICAgIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlLlRodW5kZXJCb21iLFxyXG4gICAgICAgICAgICAgICAgICAgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGVcclxuLk1vdmVSaWdodFxyXG4gICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICApLCBocDogMTcsIHJlbmRlclRleHQ6IFwiJlwiKTtcclxuICAgICAgICAgICAgQWRkRW5lbXkoYWk6IEFjdGlvbnMoXHJcbiAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlLkljZUJvbWIsXHJcbiAgICAgICAgICAgICAgICAgICBcIlN1bW1vblwiLFxyXG4gICAgICAgICAgICAgICAgICAgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGUuTW92ZUxlZnQsXHJcbiAgICAgICAgICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5Nb3ZlVHlwZS5UaHVuZGVyQm9tYixcclxuICAgICAgICAgICAgICAgICAgIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlLk1vdmVSaWdodCxcclxuICAgICAgICAgICAgICAgICAgIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlXHJcbi5GaXJlXHJcblxyXG5cclxuICAgICAgICAgICAgICAgKSwgaHA6IDQ1MCwgcmVuZGVyVGV4dDogXCIkXCIpO1xyXG4gICAgICAgICAgICBBZGRFbmVteShhaTogQWN0aW9ucyhcclxuXHJcbiAgICAgICAgICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5Nb3ZlVHlwZS5Nb3ZlVXAsXHJcbiAgICAgICAgICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5Nb3ZlVHlwZS5Nb3ZlTGVmdCxcclxuICAgICAgICAgICAgICAgICAgIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlLk1vdmVSaWdodCxcclxuICAgICAgICAgICAgICAgICAgIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlLk1vdmVEb3duLFxyXG4gICAgICAgICAgICAgICAgICAgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGUuTW92ZUxlZnQsXHJcbiAgICAgICAgICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5Nb3ZlVHlwZS5Nb3ZlRG93bixcclxuICAgICAgICAgICAgICAgICAgIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlXHJcbi5Nb3ZlVXBcclxuXHJcblxyXG4gICAgICAgICAgICAgICApLCBocDogMjgsIHJlbmRlclRleHQ6IFwiSFwiKTtcclxuICAgICAgICAgICAgQWRkRW5lbXkoYWk6IEFjdGlvbnMoXHJcblxyXG4gICAgICAgICAgICAgICAgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGUuSWNlLFxyXG4gICAgICAgICAgICAgICAgICAgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGUuRG9Ob3RoaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGVcclxuLkRvTm90aGluZ1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICApLCBocDogMzAsIHJlbmRlclRleHQ6IFwiSlwiKTtcclxuICAgICAgICAgICAgQWRkRW5lbXkoYWk6IEFjdGlvbnMoXHJcbiAgICAgICAgICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5Nb3ZlVHlwZS5Eb05vdGhpbmcsXHJcbiAgICAgICAgICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5Nb3ZlVHlwZVxyXG4uRG9Ob3RoaW5nXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICksIGhwOiAzMCwgcmVuZGVyVGV4dDogXCJMXCIpO1xyXG4gICAgICAgICAgICBBZGRFbmVteShhaTogQWN0aW9ucyhcclxuXHJcbiAgICAgICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5Nb3ZlVHlwZS5GaXJlLFxyXG4gICAgICAgICAgICAgICAgICAgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGUuRG9Ob3RoaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGVcclxuLkRvTm90aGluZ1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICApLCBocDogMzAsIHJlbmRlclRleHQ6IFwiS1wiKTtcclxuICAgICAgICAgICAgQWRkRW5lbXkoYWk6IEFjdGlvbnMoXHJcblxyXG4gICAgICAgICAgICAgICAgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGUuRG93bkZpcmUsXHJcbiAgICAgICAgICAgICAgICBTcGVjaWFsRW5lbXlNb3Zlcy5TbWFydE1vdmUsXHJcbiAgICAgICAgICAgICAgICBTcGVjaWFsRW5lbXlNb3Zlcy5TbWFydE1vdmUsXHJcbiAgICAgICAgICAgICAgICBTcGVjaWFsRW5lbXlNb3Zlcy5TbWFydE1vdmVcclxuXHJcblxyXG4gICAgICAgICAgICAgICApLCBocDogMzAsIHJlbmRlclRleHQ6IFwiS1wiKTtcclxuICAgICAgICAgICAgQWRkRW5lbXkoYWk6IEFjdGlvbnMoXHJcblxyXG4gICAgICAgICAgICAgICAgICAgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGUuSWNlQm9tYixcclxuICAgICAgICAgICAgICAgICAgIFNwZWNpYWxFbmVteU1vdmVzLlNtYXJ0TW92ZSxcclxuICAgICAgICAgICAgICAgICAgIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlLlRodW5kZXJCb21iLFxyXG4gICAgICAgICAgICAgICAgICAgU3BlY2lhbEVuZW15TW92ZXMuU21hcnRNb3ZlLFxyXG4gICAgICAgICAgICAgICAgICAgU3BlY2lhbEVuZW15TW92ZXMuU21hcnRNb3ZlLFxyXG4gICAgICAgICAgICAgICAgICAgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGUuVGh1bmRlckJvbWIsXHJcbiAgICAgICAgICAgICAgICAgICBTcGVjaWFsRW5lbXlNb3Zlcy5TbWFydE1vdmVcclxuXHJcblxyXG4gICAgICAgICAgICAgICApLCBocDogMjUwLCByZW5kZXJUZXh0OiBcIiRcIik7XHJcbiAgICAgICAgICAgIEFkZEVuZW15KGFpOiBBY3Rpb25zKFxyXG5cclxuICAgICAgICAgICAgICAgICAgIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlLkZpcmUsXHJcbiAgICAgICAgICAgICAgICAgICBTcGVjaWFsRW5lbXlNb3Zlcy5TbWFydE1vdmUsXHJcbiAgICAgICAgICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5Nb3ZlVHlwZS5UaHVuZGVyLFxyXG4gICAgICAgICAgICAgICAgICAgU3BlY2lhbEVuZW15TW92ZXMuU21hcnRNb3ZlLFxyXG4gICAgICAgICAgICAgICAgICAgU3BlY2lhbEVuZW15TW92ZXMuU21hcnRNb3ZlLFxyXG4gICAgICAgICAgICAgICAgICAgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGUuVGh1bmRlcixcclxuICAgICAgICAgICAgICAgICAgIFNwZWNpYWxFbmVteU1vdmVzLlNtYXJ0TW92ZSxcclxuICAgICAgICAgICAgICAgICAgIFNwZWNpYWxFbmVteU1vdmVzLlNtYXJ0TW92ZSxcclxuICAgICAgICAgICAgICAgICAgIFNwZWNpYWxFbmVteU1vdmVzLlNtYXJ0TW92ZSxcclxuICAgICAgICAgICAgICAgICAgIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlLlRyaXBsZUZpcmUsXHJcbiAgICAgICAgICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5Nb3ZlVHlwZVxyXG4uVGh1bmRlclxyXG5cclxuICAgICAgICAgICAgICAgKSwgaHA6IDI1MCwgcmVuZGVyVGV4dDogXCIkXCIpO1xyXG5cclxuICAgICAgICAgICAgc3RhcnRPZlR1dG9yaWFsRW5lbXkgPSBlbmVteURhdGFzLkNvdW50O1xyXG4gICAgICAgICAgICB2YXIgbW92ZXMgPSAoQmF0dGxlTWFpbi5Nb3ZlVHlwZVtdKSBFbnVtLkdldFZhbHVlcyh0eXBlb2YoQmF0dGxlTWFpbi5Nb3ZlVHlwZSkpO1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG1vdmVzLkxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBZGRFbmVteShhaTogQWN0aW9ucyhcclxuXHJcbiAgICAgICAgICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5Nb3ZlVHlwZS5Eb05vdGhpbmcsXHJcbiAgICAgICAgICAgICAgICAgICBtb3Zlc1tpXSxcclxuICAgICAgICAgICAgICAgICAgIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlXHJcbi5Eb05vdGhpbmdcclxuXHJcbiAgICAgICAgICAgICAgICksIGhwOiA1LCByZW5kZXJUZXh0OiBcIkBcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9BZGRFbmVteShhaTogQWN0aW9ucygpLCBocDogMywgcmVuZGVyVGV4dDogXCIkXCIpO1xyXG4gICAgICAgICAgICAvL0FkZEVuZW15KGFpOiBBY3Rpb25zKCksIGhwOiA1LCByZW5kZXJUZXh0OiBcIiNcIik7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBFbmVteUFJIEFjdGlvbnMocGFyYW1zIG9iamVjdFtdIG9icylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBhaSA9IG5ldyBFbmVteUFJKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgbyBpbiBvYnMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChvIGlzIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGFpLm1vdmVzLkFkZChuZXcgTW92ZVVzZSgoaW50KW8pKTtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChvIGlzIHN0cmluZylcclxuICAgICAgICAgICAgICAgIHsgICBcclxuICAgICAgICAgICAgICAgICAgICBhaS5tb3Zlcy5BZGQobmV3IE1vdmVVc2UobW92ZUNyZWF0b3JQcm9nLkdldE1vdmVJZChvIGFzIHN0cmluZykpKTtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChvIGlzIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlW10pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGl0ZW0gaW4gbyBhcyBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5Nb3ZlVHlwZVtdKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWkubW92ZXMuQWRkKG5ldyBNb3ZlVXNlKChpbnQpaXRlbSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGFpLm1vdmVzLkFkZChvKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYWk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlW10gTW92ZXMocGFyYW1zIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlW10gbW92ZXMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbW92ZXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgQWRkRW5lbXkoRW5lbXlBSSBhaSwgaW50IGhwLCBzdHJpbmcgcmVuZGVyVGV4dClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCByZW5kZXIgPSByZW5kZXJUZXh0cy5Db3VudDtcclxuICAgICAgICAgICAgcmVuZGVyVGV4dHMuQWRkKHJlbmRlclRleHQpO1xyXG4gICAgICAgICAgICBlbmVteURhdGFzLkFkZChuZXcgRW5lbXlEYXRhKGFpLCBocCwgcmVuZGVyKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBTcGVjaWFsRW5lbXlNb3Zlc1xyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgU3BlY2lhbEVuZW15TW92ZXMgU21hcnRNb3ZlID0gbmV3IFNwZWNpYWxFbmVteU1vdmVzKDApO1xyXG4gICAgICAgIHByaXZhdGUgaW50IG51bWJlcjtcclxuXHJcbiAgICAgICAgcHVibGljIFNwZWNpYWxFbmVteU1vdmVzKGludCB2KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5udW1iZXIgPSB2O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuSGFwcHM7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQ7XHJcbnVzaW5nIFBpZHJvaC5CYXNlVXRpbHM7XHJcbnVzaW5nIFBpZHJvaC5FQ1M7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBNb3ZlRGF0YUV4ZWN1dGVyXHJcbiAgICB7XHJcbiAgICAgICAgQmF0dGxlTWFpbiBiYXR0bGVNYWluO1xyXG4gICAgICAgIExpc3Q8TW92ZURhdGE+IG1vdmVEYXRhcztcclxuICAgICAgICBwcml2YXRlIEhhcHBNYW5hZ2VyIGhhcHBNYW5hZ2VyO1xyXG4gICAgICAgIHByaXZhdGUgTGlzdDxCYXR0bGVNYWluLkJhdHRsZUVudGl0eT4gZW50aXRpZXM7XHJcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBFQ1NNYW5hZ2VyIGVjcztcclxuICAgICAgICBUaW1lU3RhbXAgdGltZVN0YW1wO1xyXG4gICAgICAgIExpc3Q8VmVjdG9yMkQ+IGF1eCA9IG5ldyBMaXN0PFZlY3RvcjJEPigpO1xyXG4gICAgICAgIGludGVybmFsIFRyYWNrQmF0dGxlIHRyYWNrQmF0dGxlO1xyXG5cclxuICAgICAgICBwdWJsaWMgTW92ZURhdGFFeGVjdXRlcihCYXR0bGVNYWluIHR1cm5CYXNlLCBMaXN0PE1vdmVEYXRhPiBtb3ZlRGF0YXMsIEVDU01hbmFnZXIgZWNzLCBUaW1lU3RhbXAgdGltZVN0YW1wKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5iYXR0bGVNYWluID0gdHVybkJhc2U7XHJcbiAgICAgICAgICAgIHRoaXMubW92ZURhdGFzID0gbW92ZURhdGFzO1xyXG4gICAgICAgICAgICB0aGlzLmVjcyA9IGVjcztcclxuICAgICAgICAgICAgdGhpcy50aW1lU3RhbXAgPSB0aW1lU3RhbXA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBFeGVjdXRlTW92ZShCYXR0bGVNYWluLkJhdHRsZUVudGl0eSBhY3RvciwgaW50IHR1cm4pXHJcbiAgICAgICAge1xyXG5cclxuXHJcbiAgICAgICAgICAgIHZhciBiYXR0bGVTdGF0ZSA9IHRoaXMuYmF0dGxlTWFpbi5iYXR0bGVTdGF0ZTtcclxuICAgICAgICAgICAgZW50aXRpZXMgPSB0aGlzLmJhdHRsZU1haW4uZW50aXRpZXM7XHJcbiAgICAgICAgICAgIGludCB1c2VySWQgPSBlbnRpdGllcy5JbmRleE9mKGFjdG9yKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBtb3ZlSWQgPSBhY3Rvci5tb3Zlc1t0dXJuXTtcclxuICAgICAgICAgICAgaWYgKG1vdmVJZCA8IDApIHJldHVybjtcclxuICAgICAgICAgICAgdmFyIG1kID0gbW92ZURhdGFzW21vdmVJZF07XHJcbiAgICAgICAgICAgIGlmIChtZCA9PSBudWxsKSByZXR1cm47XHJcbiAgICAgICAgICAgIGlmIChtZC51bml0cy5Db3VudCA9PSAwKSByZXR1cm47XHJcbiAgICAgICAgICAgIGJhdHRsZVN0YXRlLm1vdmVUaWNrX1RvdGFsID0gbWQudW5pdHMuQ291bnQ7XHJcbiAgICAgICAgICAgIGludCBtb3ZlVGljayA9IGJhdHRsZVN0YXRlLm1vdmVUaWNrX05vdztcclxuICAgICAgICAgICAgdmFyIGFjdGlvbnMgPSBtZC51bml0c1ttb3ZlVGlja10udGhpbmdzVG9IYXBwZW47XHJcbiAgICAgICAgICAgIGhhcHBNYW5hZ2VyID0gYmF0dGxlTWFpbi5oYXBwTWFuYWdlcjtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGEgaW4gYWN0aW9ucylcclxuICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChhIGlzIE1vdmVBY3Rpb24pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgTW92ZUFjdGlvbiBtYSA9IGEgYXMgTW92ZUFjdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IG1hLmRpc3RhbmNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGFjdG9yLnBvcyArPSBwO1xyXG4gICAgICAgICAgICAgICAgICAgIGJvb2wgaW52YWxpZE1vdmUgPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rvci5wb3MuWCA8IGFjdG9yLm1pblBvcy5YXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHx8IGFjdG9yLnBvcy5ZIDwgYWN0b3IubWluUG9zLllcclxuICAgICAgICAgICAgICAgICAgICAgICAgfHwgYWN0b3IucG9zLlkgPiBhY3Rvci5tYXhQb3MuWVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB8fCBhY3Rvci5wb3MuWCA+IGFjdG9yLm1heFBvcy5YO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciBlIGluIGVudGl0aWVzKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUgIT0gYWN0b3IgJiYgZS5BbGl2ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdG9yLnBvcyA9PSBlLnBvcylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnZhbGlkTW92ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUuVHlwZSA9PSBCYXR0bGVNYWluLkVudGl0eVR5cGUucGlja3VwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5saWZlID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0b3IuZGFtYWdlTXVsdGlwbGllciA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludmFsaWRNb3ZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLlR5cGUgPT0gQmF0dGxlTWFpbi5FbnRpdHlUeXBlLnBhbmVsZWZmZWN0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW52YWxpZE1vdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGludmFsaWRNb3ZlKSBicmVhaztcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnZhbGlkTW92ZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoXCJJbnZhbGlkIG1vdmUgZ2VuZXJhdGVcIiArIGJhdHRsZVN0YXRlLm1vdmVUaWNrX05vdy5WYWwpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IGFjdG9ySWQgPSBlbnRpdGllcy5JbmRleE9mKGFjdG9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVmVjdG9yMkQgbW92ZVRvID0gYWN0b3IucG9zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBWZWN0b3IyRCBtb3ZlRnJvbSA9IGFjdG9yLnBvcyAtIHA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIENyZWF0ZUhhcHAoKGludClNb3ZlRGF0YVRhZ3MuTW92ZW1lbnQsIG5ldyBIYXBwTW92ZURhdGEoYWN0b3JJZCksIG5ldyBIYXBwTW92ZW1lbnQobW92ZUZyb20sIG1vdmVUbywgZmFsc2UpKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2JhdHRsZU1haW4uaGFwcE1hbmFnZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgLkFkZChuZXcgSGFwcChCYXR0bGVNYWluLkhhcHBUYWcuTW92ZW1lbnRGYWlsKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgLkFkZEF0dHJpYnV0ZShuZXcgSGFwcC5BdHRyaWJ1dGUoKS5TZXRWYWx1ZShhY3RvcklkKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgLkFkZEF0dHJpYnV0ZShuZXcgSGFwcC5BdHRyaWJ1dGUoKS5TZXRWYWx1ZShhY3Rvci5wb3MuWCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIC5BZGRBdHRyaWJ1dGUobmV3IEhhcHAuQXR0cmlidXRlKCkuU2V0VmFsdWUoYWN0b3IucG9zLlkpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vYmF0dGxlU3RhdGUubW92ZVRpY2tfVG90YWwgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rvci5wb3MgLT0gcDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IGFjdG9ySWQgPSBlbnRpdGllcy5JbmRleE9mKGFjdG9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVmVjdG9yMkQgbW92ZVRvID0gYWN0b3IucG9zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBWZWN0b3IyRCBtb3ZlRnJvbSA9IGFjdG9yLnBvcyAtIHA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIENyZWF0ZUhhcHAoKGludClNb3ZlRGF0YVRhZ3MuTW92ZW1lbnQsIG5ldyBIYXBwTW92ZURhdGEoYWN0b3JJZCksIG5ldyBIYXBwTW92ZW1lbnQobW92ZUZyb20sIG1vdmVUbywgdHJ1ZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKFwiTU9WRSBIQVBQIFNVQ0NFU1NcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGEgaXMgRGVhbERhbWFnZUFjdGlvbilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGRhID0gYSBhcyBEZWFsRGFtYWdlQWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdHRhY2tFbGVtZW50ID0gZGRhLmVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRkYS50YXJnZXQgPT0gVGFyZ2V0LkFyZWEpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYXJlYSA9IGRkYS5hcmVhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVmZXJlbmNlVXNlck9mQXJlYSA9IFJlc29sdmVUYXJnZXQoYWN0b3IsIGVudGl0aWVzLCBhcmVhLnRhcmdldCwgbmV3IFZlY3RvcjJEKDAsMCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnQgbWlycm9yaW5nWCA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3Rvci5UeXBlID09IEJhdHRsZU1haW4uRW50aXR5VHlwZS5lbmVteSkgLy9lbmVtaWVzIGFjdCBvbiBvcHBvc2l0ZSBzaWRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pcnJvcmluZ1ggPSAtMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgcG9pbnQgaW4gYXJlYS5wb2ludHMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZWFyY2hQb3MgPSBwb2ludCAqIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQobWlycm9yaW5nWCwgMSkgKyByZWZlcmVuY2VVc2VyT2ZBcmVhLnBvcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoXCJTZWFyY2ggcG9pbnQgXCIrc2VhcmNoUG9zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZW50aXRpZXMuQ291bnQ7IGkrKylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW50aXRpZXNbaV0ucG9zID09IHNlYXJjaFBvcyAmJiBlbnRpdGllc1tpXS5BbGl2ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWFsRGFtYWdlKGFjdG9yLCBkZGEsIGVudGl0aWVzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZmluZCB0YXJnZXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgQmF0dGxlTWFpbi5CYXR0bGVFbnRpdHkgdGFyZ2V0ID0gUmVzb2x2ZVRhcmdldChhY3RvciwgZW50aXRpZXMsIGRkYS50YXJnZXQsIGRkYS51c2VyUmVmT2Zmc2V0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWFsRGFtYWdlKGFjdG9yLCBkZGEsIHRhcmdldCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGEgaXMgU3VtbW9uRW50aXR5KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbnRpdGllcyA9IGJhdHRsZU1haW4uZW50aXRpZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgaW50IGJhdHRsZXJzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiBlbnRpdGllcylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmRyYXdMaWZlICYmIGl0ZW0ubGlmZSA+MClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmF0dGxlcnMrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoYmF0dGxlcnMgPCA0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZSA9IGEgYXMgU3VtbW9uRW50aXR5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZW5lbXlXaGljaCA9IHNlLmVuZW15V2hpY2g7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmVteUlkID0gYmF0dGxlTWFpbi5CYXR0bGVDb25maWcuZW5lbWllc1RvU3VtbW9uW2VuZW15V2hpY2hdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9ucyA9IEdldEVtcHR5U3BvdHMoc2lkZTogMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3NpdGlvbnMuQ291bnQgPT0gMCkgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgVmVjdG9yMkQgc3VtbW9uUG9zID0gc2UucHJlZmVyZW50aWFsUm93Q29sdW1uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBvc2l0aW9ucy5Db250YWlucyhzdW1tb25Qb3MpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdW1tb25Qb3MgPSBwb3NpdGlvbnNbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWNzLkNyZWF0ZUVudGl0eVdpdGhDb21wb25lbnQobmV3IFNwYXduRGF0YShlbmVteUlkLCBzdW1tb25Qb3MsIChpbnQpQmF0dGxlTWFpbi5FbnRpdHlUeXBlLmVuZW15KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGEgaXMgQW5pbWF0aW9uKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhbmltID0gYSBhcyBBbmltYXRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgQmF0dGxlTWFpbi5CYXR0bGVFbnRpdHkgdGFyZ2V0ID0gUmVzb2x2ZVRhcmdldChhY3RvciwgZW50aXRpZXMsIGFuaW0udGFyZ2V0LCBhbmltLnVzZXJSZWZPZmZzZXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhcmVhID0gYW5pbS5hcmVhO1xyXG4gICAgICAgICAgICAgICAgICAgIEhhcHBBcmVhIGhhcHBBcmVhID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXJlYSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlZmVyZW5jZVVzZXJPZkFyZWEgPSBSZXNvbHZlVGFyZ2V0KGFjdG9yLCBlbnRpdGllcywgYXJlYS50YXJnZXQsIFZlY3RvcjJELlplcm8pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IG1pcnJvcmluZ1ggPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0b3IuVHlwZSA9PSBCYXR0bGVNYWluLkVudGl0eVR5cGUuZW5lbXkpIC8vZW5lbWllcyBhY3Qgb24gb3Bwb3NpdGUgc2lkZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaXJyb3JpbmdYID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaGFwcEFyZWEgPSBuZXcgSGFwcEFyZWEoYXJlYSwgcmVmZXJlbmNlVXNlck9mQXJlYS5wb3MsIG1pcnJvcmluZ1gpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpbnQgdGFyZ2V0SWQgPSAtMTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0ICE9IG51bGwpIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRJZCA9IGVudGl0aWVzLkluZGV4T2YodGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgICAgICBDcmVhdGVIYXBwKG1kLCBoYXBwQXJlYSwgbmV3IEhhcHBNb3ZlRGF0YSh1c2VySWQsIHRhcmdldElkLCBhbmltLmVsZW1lbnQpKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYW5pbS50YXJnZXQgIT0gVGFyZ2V0Lk5vbmUpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBWZWN0b3IyRCBpbml0aWFsUG9zID0gYWN0b3IucG9zICsgYW5pbS51c2VyUmVmT2Zmc2V0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBWZWN0b3IyRCBmaW5hbFBvcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbFBvcyA9IHRhcmdldC5wb3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsUG9zID0gaW5pdGlhbFBvcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsUG9zLlggPSA3O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdG9yLlR5cGUgPT0gQmF0dGxlTWFpbi5FbnRpdHlUeXBlLmVuZW15KSAvL2VuZW1pZXMgYWN0IG9uIG9wcG9zaXRlIHNpZGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbFBvcy5YID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgQ3JlYXRlSGFwcCgoaW50KU1vdmVEYXRhVGFncy5TaG9vdCwgbmV3IEhhcHBTaG9vdChpbml0aWFsUG9zLCBmaW5hbFBvcyksIG5ldyBIYXBwTW92ZURhdGEodXNlcklkLCB0YXJnZXRJZCwgYW5pbS5lbGVtZW50KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vaWYgKGFuaW0udGFyZ2V0ICE9IFRhcmdldC5Ob25lKVxyXG4gICAgICAgICAgICAgICAgICAgIC8ve1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIGhhcHBNYW5hZ2VyXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgLkFkZChuZXcgSGFwcChCYXR0bGVNYWluLkhhcHBUYWcuQXR0YWNrSGl0KSlcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICAuQWRkQXR0cmlidXRlKG5ldyBIYXBwLkF0dHJpYnV0ZSgpLlNldFZhbHVlKGVudGl0aWVzLkluZGV4T2YodGFyZ2V0KSkpXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgLkFkZEF0dHJpYnV0ZShuZXcgSGFwcC5BdHRyaWJ1dGUoKS5TZXRWYWx1ZSh1c2VySWQpKVxyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIC5BZGRBdHRyaWJ1dGUobmV3IEhhcHAuQXR0cmlidXRlKCkuU2V0VmFsdWUoKGludClhbmltLmVsZW1lbnQpKTtcclxuICAgICAgICAgICAgICAgICAgICAvL31cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAobW92ZVRpY2sgPT0gbWQudW5pdHMuQ291bnQgLSAxKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiBtZC51bml0cylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgYWN0IGluIGl0ZW0udGhpbmdzVG9IYXBwZW4pXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0IGlzIERlYWxEYW1hZ2VBY3Rpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYW5nZUVsZW1lbnQoYWN0b3IsIChhY3QgYXMgRGVhbERhbWFnZUFjdGlvbikuZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIExpc3Q8VmVjdG9yMkQ+IEdldEVtcHR5U3BvdHMoaW50IHNpZGUgPSAtMSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGF1eC5DbGVhcigpO1xyXG4gICAgICAgICAgICBpbnQgb2ZmWCA9IDA7XHJcbiAgICAgICAgICAgIGlmIChzaWRlID09IDEpIG9mZlggPSAzO1xyXG4gICAgICAgICAgICBpbnQgd2lkdGggPSBiYXR0bGVNYWluLkJvYXJkV2lkdGggLyAyO1xyXG4gICAgICAgICAgICBpZiAoc2lkZSA9PSAtMSlcclxuICAgICAgICAgICAgICAgIHdpZHRoID0gYmF0dGxlTWFpbi5Cb2FyZFdpZHRoO1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHdpZHRoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgYmF0dGxlTWFpbi5Cb2FyZEhlaWdodDsgaisrKVxyXG4gICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBhdXguQWRkKG5ldyBWZWN0b3IyRChpK29mZlgsaikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBlbnRpdGllcyA9IGJhdHRsZU1haW4uZW50aXRpZXM7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBlIGluIGVudGl0aWVzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZS5BbGl2ZSAmJiBhdXguQ29udGFpbnMoZS5wb3MpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1eC5SZW1vdmUoZS5wb3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBhdXg7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIENoYW5nZUVsZW1lbnQoQmF0dGxlTWFpbi5CYXR0bGVFbnRpdHkgYWN0b3IsIEJhdHRsZU1haW4uRWxlbWVudCBlbGVtZW50KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKGFjdG9yLmVsZW1lbnQgPT0gZWxlbWVudCkgcmV0dXJuO1xyXG4gICAgICAgICAgICBhY3Rvci5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgICAgICAgICAgdmFyIHRoID0gbmV3IEhhcHBUYWdzKChpbnQpTWlzY0hhcHBUYWdzLkNoYW5nZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICBlY3MuQ3JlYXRlRW50aXR5V2l0aENvbXBvbmVudCh0aCwgbmV3IEhhcHBNb3ZlRGF0YShlbnRpdGllcy5JbmRleE9mKGFjdG9yKSwgLTEsIGVsZW1lbnQpKS5BZGRDb21wb25lbnQodGltZVN0YW1wLkdldFNuYXAoKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgQ3JlYXRlSGFwcChNb3ZlRGF0YSBtZCwgb2JqZWN0IGNvbXAxLCBvYmplY3QgY29tcDIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgdGggPSBuZXcgSGFwcFRhZ3MobWQudGFncyk7XHJcbiAgICAgICAgICAgIHZhciBlID0gZWNzLkNyZWF0ZUVudGl0eVdpdGhDb21wb25lbnQodGgsIHRpbWVTdGFtcC5HZXRTbmFwKCkpO1xyXG4gICAgICAgICAgICBpZiAoY29tcDEgIT0gbnVsbCkgZS5BZGRDb21wb25lbnQoY29tcDEpO1xyXG4gICAgICAgICAgICBpZiAoY29tcDIgIT0gbnVsbCkgZS5BZGRDb21wb25lbnQoY29tcDIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIENyZWF0ZUhhcHAoaW50IHRhZywgb2JqZWN0IGNvbXAxLCBvYmplY3QgY29tcDIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgdGggPSBuZXcgSGFwcFRhZ3ModGFnKTtcclxuICAgICAgICAgICAgdmFyIGUgPSBlY3MuQ3JlYXRlRW50aXR5V2l0aENvbXBvbmVudCh0aCwgdGltZVN0YW1wLkdldFNuYXAoKSk7XHJcbiAgICAgICAgICAgIGlmIChjb21wMSAhPSBudWxsKSBlLkFkZENvbXBvbmVudChjb21wMSk7XHJcbiAgICAgICAgICAgIGlmIChjb21wMiAhPSBudWxsKSBlLkFkZENvbXBvbmVudChjb21wMik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgRGVhbERhbWFnZShCYXR0bGVNYWluLkJhdHRsZUVudGl0eSBhY3RvciwgRGVhbERhbWFnZUFjdGlvbiBkZGEsIEJhdHRsZU1haW4uQmF0dGxlRW50aXR5IHRhcmdldClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEJhdHRsZU1haW4uRWxlbWVudCBhdHRhY2tFbGVtZW50ID0gZGRhLmVsZW1lbnQ7XHJcbiAgICAgICAgICAgIGJvb2wgZWxlbWVudGFsQmxvY2sgPSBhdHRhY2tFbGVtZW50ID09IHRhcmdldC5lbGVtZW50ICYmIGF0dGFja0VsZW1lbnQgIT0gQmF0dGxlTWFpbi5FbGVtZW50Lk5vdGhpbmduZXNzO1xyXG4gICAgICAgICAgICBib29sIHN1cGVyRWZmZWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGludCBkYW1hZ2UgPSAwO1xyXG4gICAgICAgICAgICBpbnQgdGFyZ2V0SWQgPSBlbnRpdGllcy5JbmRleE9mKHRhcmdldCk7XHJcbiAgICAgICAgICAgIGlmIChlbGVtZW50YWxCbG9jaylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICghZWxlbWVudGFsQmxvY2spXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG11bCA9IGJhdHRsZU1haW4uQ2FsY3VsYXRlQXR0YWNrTXVsdGlwbGllcihhY3Rvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgbXVsICo9IGJhdHRsZU1haW4uQ2FsY3VsYXRlRGVmZW5kZXJNdWx0aXBsaWVyKHRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF0dGFja0VsZW1lbnQgPT0gQmF0dGxlTWFpbi5FbGVtZW50LkZpcmUgJiYgdGFyZ2V0LmVsZW1lbnQgPT0gQmF0dGxlTWFpbi5FbGVtZW50LkljZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB8fCBhdHRhY2tFbGVtZW50ID09IEJhdHRsZU1haW4uRWxlbWVudC5UaHVuZGVyICYmIHRhcmdldC5lbGVtZW50ID09IEJhdHRsZU1haW4uRWxlbWVudC5GaXJlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHx8IGF0dGFja0VsZW1lbnQgPT0gQmF0dGxlTWFpbi5FbGVtZW50LkljZSAmJiB0YXJnZXQuZWxlbWVudCA9PSBCYXR0bGVNYWluLkVsZW1lbnQuVGh1bmRlcilcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG11bCAqPSAzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdXBlckVmZmVjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZGFtYWdlID0gZGRhLmRhbWFnZSAqIChpbnQpbXVsO1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5saWZlIC09IGRhbWFnZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LlR5cGUgPT0gQmF0dGxlTWFpbi5FbnRpdHlUeXBlLmhlcm8pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrQmF0dGxlLkhlcm9EYW1hZ2UoZGFtYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBhY3Rvci5kYW1hZ2VNdWx0aXBsaWVyID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBoYXBwTWFuYWdlci5BZGQobmV3IEhhcHAoQmF0dGxlTWFpbi5IYXBwVGFnLkRhbWFnZVRha2VuKSlcclxuICAgICAgICAgICAgICAgICAgICAuQWRkQXR0cmlidXRlKG5ldyBIYXBwLkF0dHJpYnV0ZSgpLlNldFZhbHVlKHRhcmdldElkKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5DcmVhdGVIYXBwKChpbnQpTWlzY0hhcHBUYWdzLkRhbWFnZSwgbmV3IEhhcHBEYW1hZ2VEYXRhKHRhcmdldC5lbGVtZW50LCBkZGEuZWxlbWVudCwgZW50aXRpZXMuSW5kZXhPZih0YXJnZXQpLCBkYW1hZ2UsIHN1cGVyRWZmZWN0aXZlLCBlbGVtZW50YWxCbG9jayksIG51bGwpO1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmxpZmUgPD0gMCAmJiAhc3VwZXJFZmZlY3RpdmUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIENyZWF0ZUhhcHAoKGludClNaXNjSGFwcFRhZ3MuRGVhdGgsIG5ldyBIYXBwTW92ZURhdGEodGFyZ2V0SWQpLCBudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgQmF0dGxlTWFpbi5CYXR0bGVFbnRpdHkgUmVzb2x2ZVRhcmdldChCYXR0bGVNYWluLkJhdHRsZUVudGl0eSBhY3RvciwgTGlzdDxCYXR0bGVNYWluLkJhdHRsZUVudGl0eT4gZW50aXRpZXMsIFRhcmdldCB0YXJnZXRUeXBlLCBWZWN0b3IyRCBvZmZzZXRSZWZlcmVuY2VVc2VyUG9zaXRpb24pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0VHlwZSA9PSBUYXJnZXQuU2VsZikgcmV0dXJuIGFjdG9yO1xyXG4gICAgICAgICAgICBCYXR0bGVNYWluLkJhdHRsZUVudGl0eSB0YXJnZXQgPSBudWxsO1xyXG4gICAgICAgICAgICBmbG9hdCBtaW5EaXMgPSAxMDtcclxuICAgICAgICAgICAgVmVjdG9yMkQgcmVmZXJlbmNlVXNlclBvc2l0aW9uID0gYWN0b3IucG9zO1xyXG4gICAgICAgICAgICByZWZlcmVuY2VVc2VyUG9zaXRpb24gKz0gb2Zmc2V0UmVmZXJlbmNlVXNlclBvc2l0aW9uO1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgZTIgaW4gZW50aXRpZXMpXHJcbiAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZTIuRGVhZCkgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWN0b3IuVHlwZSAhPSBlMi5UeXBlXHJcbiAgICAgICAgICAgICAgICAgICAgJiYgZTIuVHlwZSAhPSBCYXR0bGVNYWluLkVudGl0eVR5cGUucGFuZWxlZmZlY3RcclxuICAgICAgICAgICAgICAgICAgICAmJiBlMi5UeXBlICE9IEJhdHRsZU1haW4uRW50aXR5VHlwZS5waWNrdXApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgYm9vbCBzYW1lSGVpZ2h0ID0gcmVmZXJlbmNlVXNlclBvc2l0aW9uLlkgPT0gZTIucG9zLlk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzYW1lSGVpZ2h0KVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmxvYXQgZGlzID0gcmVmZXJlbmNlVXNlclBvc2l0aW9uLlggLSBlMi5wb3MuWDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpcyA8IDApIGRpcyAqPSAtMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpcyA8IG1pbkRpcylcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluRGlzID0gZGlzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gZTI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgSGFwcFRhZ3NcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgTGlzdDxpbnQ+IHRhZ3MgPSBuZXcgTGlzdDxpbnQ+KCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBIYXBwVGFncyhMaXN0PGludD4gdGFncylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMudGFncy5BZGRSYW5nZSh0YWdzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBIYXBwVGFncyhpbnQgaSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRhZ3MuQWRkKGkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEhhcHBUYWdzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZW51bSBNaXNjSGFwcFRhZ3N7XHJcbiAgICAgICAgQ2hhbmdlRWxlbWVudCA9IDUwMCxcclxuICAgICAgICBEYW1hZ2UgPSA1MDEsXHJcbiAgICAgICAgRGVhdGggPSA1MDJcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgSGFwcERhbWFnZURhdGFcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgQmF0dGxlTWFpbi5FbGVtZW50IHRhcmdldEUsIGRhbWFnZUU7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IGludCB0YXJnZXQ7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IGludCBhbW91bnQ7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IGJvb2wgc3VwZXJFZmZlY3RpdmU7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IGJvb2wgZWxlbWVudGFsQmxvY2s7XHJcblxyXG4gICAgICAgIHB1YmxpYyBIYXBwRGFtYWdlRGF0YSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEhhcHBEYW1hZ2VEYXRhKEJhdHRsZU1haW4uRWxlbWVudCB0YXJnZXRFLCBCYXR0bGVNYWluLkVsZW1lbnQgZGFtYWdlRSwgaW50IHRhcmdldCwgaW50IGFtb3VudCwgYm9vbCBzdXBlckVmZmVjdGl2ZSwgYm9vbCBlbGVtZW50YWxCbG9jaylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0RSA9IHRhcmdldEU7XHJcbiAgICAgICAgICAgIHRoaXMuZGFtYWdlRSA9IGRhbWFnZUU7XHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xyXG4gICAgICAgICAgICB0aGlzLmFtb3VudCA9IGFtb3VudDtcclxuICAgICAgICAgICAgdGhpcy5zdXBlckVmZmVjdGl2ZSA9IHN1cGVyRWZmZWN0aXZlO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRhbEJsb2NrID0gZWxlbWVudGFsQmxvY2s7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBIYXBwTW92ZURhdGFcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgaW50IHVzZXI7XHJcbiAgICAgICAgcHVibGljIHJlYWRvbmx5IGludCB0YXJnZXQgPSAtMTtcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgQmF0dGxlTWFpbi5FbGVtZW50IGVsZW1lbnQgPSBCYXR0bGVNYWluLkVsZW1lbnQuTm90aGluZ25lc3M7XHJcblxyXG4gICAgICAgIHB1YmxpYyBIYXBwTW92ZURhdGEoKVxyXG4gICAgICAgIHtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBIYXBwTW92ZURhdGEoaW50IHVzZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnVzZXIgPSB1c2VyO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEhhcHBNb3ZlRGF0YShpbnQgdXNlciwgaW50IHRhcmdldCwgQmF0dGxlTWFpbi5FbGVtZW50IGVsZW1lbnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnVzZXIgPSB1c2VyO1xyXG4gICAgICAgICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgXHJcblxyXG4gICAgcHVibGljIGNsYXNzIEhhcHBNb3ZlbWVudFxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBWZWN0b3IyRCBtb3ZlRnJvbTtcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgVmVjdG9yMkQgbW92ZVRvO1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBib29sIHN1Y2Nlc3M7XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgSGFwcE1vdmVtZW50KClcclxuICAgICAgICB7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgSGFwcE1vdmVtZW50KFZlY3RvcjJEIG1vdmVGcm9tLCBWZWN0b3IyRCBtb3ZlVG8sIGJvb2wgc3VjY2VzcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMubW92ZUZyb20gPSBtb3ZlRnJvbTtcclxuICAgICAgICAgICAgdGhpcy5tb3ZlVG8gPSBtb3ZlVG87XHJcbiAgICAgICAgICAgIHRoaXMuc3VjY2VzcyA9IHN1Y2Nlc3M7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBIYXBwQXJlYVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBBcmVhIGFyZWE7XHJcbiAgICAgICAgcHVibGljIFZlY3RvcjJEIG9mZnNldCA9IG5ldyBWZWN0b3IyRCgpO1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBpbnQgbWlycm9yaW5nWDtcclxuXHJcbiAgICAgICAgcHVibGljIEhhcHBBcmVhKEFyZWEgYXJlYSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuYXJlYSA9IGFyZWE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgSGFwcEFyZWEoKVxyXG4gICAgICAgIHtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBIYXBwQXJlYShBcmVhIGFyZWEsIFZlY3RvcjJEIG9mZnNldCwgaW50IG1pcnJvcmluZ1gpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLmFyZWEgPSBhcmVhO1xyXG4gICAgICAgICAgICB0aGlzLm9mZnNldCA9IG9mZnNldDtcclxuICAgICAgICAgICAgdGhpcy5taXJyb3JpbmdYID0gbWlycm9yaW5nWDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIEhhcHBTaG9vdFxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBWZWN0b3IyRCBzdGFydDtcclxuICAgICAgICBwdWJsaWMgcmVhZG9ubHkgVmVjdG9yMkQgZW5kO1xyXG5cclxuICAgICAgICBwdWJsaWMgSGFwcFNob290KClcclxuICAgICAgICB7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgSGFwcFNob290KFZlY3RvcjJEIHN0YXJ0LCBWZWN0b3IyRCBlbmQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXJ0ID0gc3RhcnQ7XHJcbiAgICAgICAgICAgIHRoaXMuZW5kID0gZW5kO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn1cclxuIiwidXNpbmcgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkRlYnVnRXh0cmE7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuSGFwcHNcclxue1xyXG5cclxuICAgIC8vbGVnYWN5IGhhcHBzXHJcbiAgICAvL2JldHRlciBzeXN0ZW0gb24gaGFwcGhhbmRsaW5nXHJcbiAgICAvL3N0aWxsIHVzZWQgaW4gc29tZSBzaXR1YXRpb25zIHRob3VnaC4uLlxyXG4gICAgcHVibGljIGNsYXNzIEhhcHBNYW5hZ2VyXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGludCBDdXJyZW50VGltZSB7IGdldDsgcHJpdmF0ZSBzZXQ7IH1cclxuICAgICAgICBMaXN0PEhhcHA+IEhhcHBzID0gbmV3IExpc3Q8SGFwcD4oKTtcclxuICAgICAgICBMaXN0PEhhcHBIYW5kbGVyPiBoYW5kbGVycyA9IG5ldyBMaXN0PEhhcHBIYW5kbGVyPigpO1xyXG4gICAgICAgIGludCBsYXRlc3RIYW5kbGVkID0gLTE7XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFkZEhhbmRsZXIoSGFwcEhhbmRsZXIgaGgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBoYW5kbGVycy5BZGQoaGgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgVHJ5SGFuZGxlKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmKGxhdGVzdEhhbmRsZWQgIT0gQ3VycmVudFRpbWUpXHJcbiAgICAgICAgICAgICAgICBIYW5kbGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBIYW5kbGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbGF0ZXN0SGFuZGxlZCA9IEN1cnJlbnRUaW1lO1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgaCBpbiBoYW5kbGVycylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IEhhcHBzLkNvdW50IC0gMTsgaSA+PSAwOyBpLS0pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy90aGlzIGNoZWNrIGFzc3VtZXMgaGFwcHMgYXJlIG9yZGVyZWQgYnkgdGltZSBzdGFtcFxyXG4gICAgICAgICAgICAgICAgICAgIC8vd2hpY2ggdGhleSBzaG91bGQgYmUgYXV0b21hdGljYWxseVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChIYXBwc1tpXS5UaW1lU3RhbXAgIT0gQ3VycmVudFRpbWUpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Z0V4LkxvZyhcIkhhcHBlbmluZyBub3QgZXF1YWwgdG8gY3VycmVudCB0aW1lXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYm9vbCBoYXNUYWdzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgdGFnc05lZWRlZCBpbiBoLm5lY2Vzc2FyeVRhZ3MpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIUhhcHBzW2ldLkhhc1RhZyh0YWdzTmVlZGVkKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzVGFncyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc1RhZ3MpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Z0V4LkxvZyhcIkhhcHBlbmluZyBoYW5kbGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoLkhhbmRsZShIYXBwc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnRXguTG9nKFwiSGFwcGVuaW5nIHRhZyBpcyBkaWZmZXJlbnRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgSGFwcCBBZGQoSGFwcCBoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaC5UaW1lU3RhbXAgPSBDdXJyZW50VGltZTtcclxuICAgICAgICAgICAgSGFwcHMuQWRkKGgpO1xyXG4gICAgICAgICAgICByZXR1cm4gaDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFRpY2soKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQ3VycmVudFRpbWUrKztcclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIEhhcHBcclxuICAgIHtcclxuICAgICAgICAvL3B1YmxpYyBzdHJpbmcgTWFpblRhZztcclxuICAgICAgICBwdWJsaWMgTGlzdDxpbnQ+IHRhZ3MgPSBuZXcgTGlzdDxpbnQ+KCk7XHJcbiAgICAgICAgcHVibGljIGludCBUaW1lU3RhbXA7XHJcbiAgICAgICAgTGlzdDxBdHRyaWJ1dGU+IGF0dHJzID0gbmV3IExpc3Q8QXR0cmlidXRlPigpO1xyXG5cclxuICAgICAgICAvL3B1YmxpYyBIYXBwKElDb252ZXJ0aWJsZSBjKVxyXG4gICAgICAgIC8ve1xyXG4gICAgICAgIC8vICAgIHRhZ3MuQWRkKENvbnZlcnQuVG9JbnQzMihjKSk7XHJcbiAgICAgICAgLy99XHJcblxyXG4gICAgICAgIHB1YmxpYyBIYXBwKG9iamVjdCBtYWluVGFnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9NYWluVGFnID0gbWFpblRhZy5Ub1N0cmluZygpO1xyXG4gICAgICAgICAgICB0YWdzLkFkZChDb252ZXJ0LlRvSW50MzIobWFpblRhZykpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGNsYXNzIEF0dHJpYnV0ZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcHVibGljIGZsb2F0IFZhbHVlIHsgZ2V0OyBwcml2YXRlIHNldDsgfVxyXG4gICAgICAgICAgICBwdWJsaWMgQXR0cmlidXRlIFNldFZhbHVlKGZsb2F0IGYpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFZhbHVlID0gZjtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHB1YmxpYyBUYWdIb2xkZXIgdGFncyA9IG5ldyBUYWdIb2xkZXIoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBIYXBwIEFkZEF0dHJpYnV0ZShBdHRyaWJ1dGUgYSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGF0dHJzLkFkZChhKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCBpbnQgR2V0QXR0cmlidXRlX0ludChpbnQgaW5kZXgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gKGludClhdHRyc1tpbmRleF0uVmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCBib29sIEhhc1RhZyhpbnQgdGFnc05lZWRlZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiB0YWdzLkNvbnRhaW5zKHRhZ3NOZWVkZWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgSGFwcEhhbmRsZXJcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgTGlzdDxpbnQ+IG5lY2Vzc2FyeVRhZ3MgPSBuZXcgTGlzdDxpbnQ+KCk7XHJcbiAgICAgICAgcHVibGljIEFjdGlvbjxIYXBwPiBIYW5kbGU7XHJcblxyXG4gICAgICAgIHB1YmxpYyBIYXBwSGFuZGxlcihvYmplY3QgbWFpblRhZywgQWN0aW9uPEhhcHA+IGhhbmRsZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMubmVjZXNzYXJ5VGFncy5BZGQoQ29udmVydC5Ub0ludDMyKG1haW5UYWcpKTtcclxuICAgICAgICAgICAgSGFuZGxlID0gaGFuZGxlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgVGFnSG9sZGVyXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIExpc3Q8b2JqZWN0PiBUYWdzIHsgZ2V0OyBwcml2YXRlIHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBIYXNUYWcob2JqZWN0IHQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gVGFncy5Db250YWlucyh0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgQWRkKG9iamVjdCB2KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVGFncy5BZGQodik7XHJcbiAgICAgICAgfVxyXG5cbiAgICBcbnByaXZhdGUgTGlzdDxvYmplY3Q+IF9fUHJvcGVydHlfX0luaXRpYWxpemVyX19UYWdzPW5ldyBMaXN0PG9iamVjdD4oKTt9XHJcblxyXG5cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWRcclxue1xyXG4gICAgcHVibGljIGNsYXNzIElucHV0SG9sZGVyXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIExpc3Q8SW5wdXRVbml0PiBpbnB1dHMgPSBuZXcgTGlzdDxJbnB1dFVuaXQ+KCk7XHJcbiAgICAgICAgTGlzdDxJbnB1dFRhZ3M+IHRhZ3MgPSBuZXcgTGlzdDxJbnB1dFRhZ3M+KCk7XHJcbiAgICAgICAgcHVibGljIElucHV0VW5pdCBpbnB1dEZvckNvbmZpcm1hdGlvbjtcclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBDbGVhcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnB1dHMuQ2xlYXIoKTtcclxuICAgICAgICAgICAgdGFncy5DbGVhcigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBBZGQoSW5wdXRVbml0IGlucHV0LCBJbnB1dFRhZ3MgdGFnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW5wdXRzLkFkZChpbnB1dCk7XHJcbiAgICAgICAgICAgIHRhZ3MuQWRkKHRhZyk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgVGFnSXMoaW50IGkyLCBJbnB1dFRhZ3MgdGFnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHRhZ3MuQ291bnQgPD0gaTIpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgcmV0dXJuIHRhZ3NbaTJdID09IHRhZztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIENvbnRhaW5zKElucHV0VW5pdCBrZXkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgaSBpbiBpbnB1dHMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChpLmFyZzEgPT0ga2V5LmFyZzEgJiYgaS50eXBlID09IGtleS50eXBlKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGVudW0gSW5wdXRUYWdze1xyXG4gICAgICAgIE5PTkUsIE1PVkVGSVgsIE1PVkVVTkZJWCwgTUlTQ1xyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFBpZHJvaC5CYXNlVXRpbHM7XHJcbnVzaW5nIFBpZHJvaC5FQ1M7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZFxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgTW92ZUNyZWF0b3JQcm9nXHJcbiAgICB7XHJcbiAgICAgICAgaW50ZXJuYWwgTGlzdDxNb3ZlRGF0YT4gbW92ZURhdGFzID0gbmV3IExpc3Q8TW92ZURhdGE+KCk7XHJcbiAgICAgICAgcHVibGljIExpc3Q8TW92ZU1ldGFEYXRhPiBtb3ZlUmVuZGVycyA9IG5ldyBMaXN0PE1vdmVNZXRhRGF0YT4oKTtcclxuICAgICAgICBBcmVhQ3JlYXRpb25VdGlscyBhcmVhVXRpbHMgPSBuZXcgQXJlYUNyZWF0aW9uVXRpbHMoKTtcclxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IEVDU01hbmFnZXIgZWNzO1xyXG5cclxuICAgICAgICBCYXR0bGVNYWluLkVsZW1lbnRbXSBlbGVtZW50cyA9IG5ldyBCYXR0bGVNYWluLkVsZW1lbnRbXVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQmF0dGxlTWFpbi5FbGVtZW50LkZpcmUsIEJhdHRsZU1haW4uRWxlbWVudC5JY2UsIEJhdHRsZU1haW4uRWxlbWVudC5UaHVuZGVyXHJcbiAgICAgICAgfTtcclxuICAgICAgICBzdHJpbmdbXSBlbGVtZW50TGFiZWxzID0gbmV3IHN0cmluZ1tdXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcIkZpcmVcIiwgXCJJY2VcIiwgXCJCb2x0XCJcclxuICAgICAgICB9O1xyXG4gICAgICAgIHN0cmluZ1tdIGVsZW1lbnRMZXR0ZXIgPSBuZXcgc3RyaW5nW11cclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiRlwiLCBcIklcIiwgXCJCXCJcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBwdWJsaWMgTW92ZUNyZWF0b3JQcm9nKEVDU01hbmFnZXIgZWNzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5lY3MgPSBlY3M7XHJcbiAgICAgICAgICAgIE1vdmVEYXRhIGl0ZW0gPSBuZXcgTW92ZURhdGEoXCJcIik7XHJcbiAgICAgICAgICAgIG1vdmVEYXRhcy5BZGQoaXRlbSk7IC8vZG8gbm90aGluZ1xyXG4gICAgICAgICAgICBtb3ZlUmVuZGVycy5BZGQobmV3IE1vdmVNZXRhRGF0YShcIlwiLCBcIlwiLCBCYXR0bGVNYWluLkVsZW1lbnQuTm90aGluZ25lc3MpKTtcclxuICAgICAgICAgICAgZWNzLkNyZWF0ZUVudGl0eVdpdGhDb21wb25lbnQoaXRlbSk7XHJcbiAgICAgICAgICAgIEJhc2VVdGlscy5WZWN0b3IyRFtdIGRpcmVjdGlvbnMgPSBuZXcgQmFzZVV0aWxzLlZlY3RvcjJEW10ge1xyXG5cclxuICAgICAgICAgICAgICAgIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoMCwgMSksXHJcbiAgICAgICAgICAgICAgICBuZXcgQmFzZVV0aWxzLlZlY3RvcjJEKC0xLCAwKSxcclxuICAgICAgICAgICAgICAgIG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoMCwgLTEpLFxyXG4gICAgICAgICAgICAgICAgbmV3IEJhc2VVdGlscy5WZWN0b3IyRCgxLCAwKSxcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgc3RyaW5nW10gbW92ZUxhYmVscyA9IG5ldyBzdHJpbmdbXSB7XHJcbiAgICAgICAgICAgICAgICBcIk1vdmUgVXBcIixcclxuICAgICAgICAgICAgICAgIFwiTW92ZSBMZWZ0XCIsXHJcbiAgICAgICAgICAgICAgICBcIk1vdmUgRG93blwiLFxyXG4gICAgICAgICAgICAgICAgXCJNb3ZlIFJpZ2h0XCIsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHN0cmluZ1tdIG1vdmVBYnJldiA9IG5ldyBzdHJpbmdbXSB7XHJcbiAgICAgICAgICAgICAgICBcIl5cIixcclxuICAgICAgICAgICAgICAgIFwiPFwiLFxyXG4gICAgICAgICAgICAgICAgXCJ2XCIsXHJcbiAgICAgICAgICAgICAgICBcIj5cIixcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBkaXJlY3Rpb25zLkxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBOZXdNb3ZlRGF0YShsYWJlbDogbW92ZUxhYmVsc1tpXSwgY29uZGl0aW9uOiBuZXcgQ29uZGl0aW9uKENvbmRpdGlvblR5cGUuQ2FuTW92ZSwgVGFyZ2V0LlNlbGYsIGRpcmVjdGlvbnNbaV0pLCBhY3Rpb246IG5ldyBNb3ZlQWN0aW9uKFRhcmdldC5TZWxmLCBkaXJlY3Rpb25zW2ldKSwgdGFnczogVGFnQXJyYXkoTW92ZURhdGFUYWdzLk1vdmVtZW50LCBNb3ZlRGF0YVRhZ3MuSGVyb0luaXRpYWwpKTtcclxuICAgICAgICAgICAgICAgIE5ld01vdmVUZXh0UmVuZGVyRGF0YShuYW1lOiBtb3ZlTGFiZWxzW2ldLCBhYnJldjogbW92ZUFicmV2W2ldLCBkZXNjcmlwdGlvbjogbW92ZUxhYmVsc1tpXSwgZGFtYWdlOiAwKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaW50IGJhc2VEYW1hZ2UgPSAxMDtcclxuXHJcbiAgICAgICAgICAgIE5ld01vdmVEYXRhKFwiR3VuXCIsIHRpY2tzOiBPbmVUaWNrUGVyQWN0aW9uKG5ldyBBbmltYXRpb24oVGFyZ2V0LkNsb3Nlc3RUYXJnZXRYKSwgbmV3IERlYWxEYW1hZ2VBY3Rpb24oVGFyZ2V0LkNsb3Nlc3RUYXJnZXRYLCBiYXNlRGFtYWdlLCBCYXR0bGVNYWluLkVsZW1lbnQuTm90aGluZ25lc3MpKSwgdGFnczogVGFnQXJyYXkoTW92ZURhdGFUYWdzLlNob290KSk7XHJcbiAgICAgICAgICAgIE5ld01vdmVUZXh0UmVuZGVyRGF0YShcIkd1blwiLCBcIkdcIiwgXCJTaG9vdHMgZm9yd2FyZFwiLGJhc2VEYW1hZ2UpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIE5ld01vdmVEYXRhKFwiRmlyZWd1blwiLCB0aWNrczogT25lVGlja1BlckFjdGlvbihuZXcgQW5pbWF0aW9uKFRhcmdldC5DbG9zZXN0VGFyZ2V0WCwgQmF0dGxlTWFpbi5FbGVtZW50LkZpcmUpLCBuZXcgRGVhbERhbWFnZUFjdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIGJhc2VEYW1hZ2UsIEJhdHRsZU1haW4uRWxlbWVudC5GaXJlKSksIHRhZ3M6IFRhZ0FycmF5KE1vdmVEYXRhVGFncy5TaG9vdCkpO1xyXG4gICAgICAgICAgICBOZXdNb3ZlVGV4dFJlbmRlckRhdGEoXCJGaXJlZ3VuXCIsIFwiRkdcIiwgXCJTaG9vdHMgZm9yd2FyZFwiLCBiYXNlRGFtYWdlLCBCYXR0bGVNYWluLkVsZW1lbnQuRmlyZSk7XHJcblxyXG4gICAgICAgICAgICBOZXdNb3ZlRGF0YShcIkljZWd1blwiLCB0aWNrczogT25lVGlja1BlckFjdGlvbihuZXcgQW5pbWF0aW9uKFRhcmdldC5DbG9zZXN0VGFyZ2V0WCwgQmF0dGxlTWFpbi5FbGVtZW50LkljZSksIG5ldyBEZWFsRGFtYWdlQWN0aW9uKFRhcmdldC5DbG9zZXN0VGFyZ2V0WCwgYmFzZURhbWFnZSwgQmF0dGxlTWFpbi5FbGVtZW50LkljZSkpLCB0YWdzOiBUYWdBcnJheShNb3ZlRGF0YVRhZ3MuU2hvb3QpKTtcclxuICAgICAgICAgICAgTmV3TW92ZVRleHRSZW5kZXJEYXRhKFwiSWNlZ3VuXCIsIFwiSUdcIiwgXCJTaG9vdHMgZm9yd2FyZFwiLCBiYXNlRGFtYWdlLCBCYXR0bGVNYWluLkVsZW1lbnQuSWNlKTtcclxuXHJcbiAgICAgICAgICAgIE5ld01vdmVEYXRhKFwiQm9sdGd1blwiLCB0aWNrczogT25lVGlja1BlckFjdGlvbihuZXcgQW5pbWF0aW9uKFRhcmdldC5DbG9zZXN0VGFyZ2V0WCwgQmF0dGxlTWFpbi5FbGVtZW50LlRodW5kZXIpLCBuZXcgRGVhbERhbWFnZUFjdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIGJhc2VEYW1hZ2UsIEJhdHRsZU1haW4uRWxlbWVudC5UaHVuZGVyKSksIHRhZ3M6IFRhZ0FycmF5KE1vdmVEYXRhVGFncy5TaG9vdCkpO1xyXG4gICAgICAgICAgICBOZXdNb3ZlVGV4dFJlbmRlckRhdGEoXCJCb2x0Z3VuXCIsIFwiQkdcIixcIlNob290cyBmb3J3YXJkXCIsIGJhc2VEYW1hZ2UsIEJhdHRsZU1haW4uRWxlbWVudC5UaHVuZGVyKTtcclxuXHJcbiAgICAgICAgICAgIEFyZWEgYXJlYUJvbWIgPSBBcmVhVXNlcigpLlJvd0ZvcndhcmQod2lkdGg6IDEsIFhEaXM6IDMpO1xyXG4gICAgICAgICAgICBOZXdNb3ZlRGF0YShcIkljZWJvbWJcIiwgdGlja3M6IE9uZVRpY2tQZXJBY3Rpb24obmV3IEFuaW1hdGlvbihhcmVhQm9tYiwgQmF0dGxlTWFpbi5FbGVtZW50LkljZSksIG5ldyBEZWFsRGFtYWdlQWN0aW9uKGFyZWFCb21iLCBiYXNlRGFtYWdlLCBCYXR0bGVNYWluLkVsZW1lbnQuSWNlKSksIHRhZ3M6IFRhZ0FycmF5KE1vdmVEYXRhVGFncy5Cb21iKSk7XHJcbiAgICAgICAgICAgIE5ld01vdmVUZXh0UmVuZGVyRGF0YShcIkljZWJvbWJcIiwgXCJJQlwiLCBcIkF0dGFja3Mgcm93IHRocmVlIHNxdWFyZXMgZm9yd2FyZFwiLCBiYXNlRGFtYWdlLCBCYXR0bGVNYWluLkVsZW1lbnQuSWNlKTtcclxuXHJcbiAgICAgICAgICAgIE5ld01vdmVEYXRhKFwiQm9sdGJvbWJcIiwgdGlja3M6IE9uZVRpY2tQZXJBY3Rpb24obmV3IEFuaW1hdGlvbihhcmVhQm9tYiwgQmF0dGxlTWFpbi5FbGVtZW50LlRodW5kZXIpLCBuZXcgRGVhbERhbWFnZUFjdGlvbihhcmVhQm9tYiwgYmFzZURhbWFnZSwgQmF0dGxlTWFpbi5FbGVtZW50LlRodW5kZXIpKSwgdGFnczogVGFnQXJyYXkoTW92ZURhdGFUYWdzLkJvbWIpKTtcclxuICAgICAgICAgICAgTmV3TW92ZVRleHRSZW5kZXJEYXRhKFwiQm9sdGJvbWJcIiwgXCJCQlwiLFwiQXR0YWNrcyByb3cgdGhyZWUgc3F1YXJlcyBmb3J3YXJkXCIsYmFzZURhbWFnZSwgQmF0dGxlTWFpbi5FbGVtZW50LlRodW5kZXIpO1xyXG5cclxuICAgICAgICAgICAgTmV3TW92ZURhdGEoXCJTdW1tb25cIiwgdGlja3M6IE9uZVRpY2tQZXJBY3Rpb24oU3VtbW9uRW50aXR5LkVuZW15KDAsIG5ldyBWZWN0b3IyRCg1LCAwKSkpLCB0YWdzOiBUYWdBcnJheShNb3ZlRGF0YVRhZ3MuU3VtbW9uKSk7XHJcbiAgICAgICAgICAgIE5ld01vdmVUZXh0UmVuZGVyRGF0YShcIlN1bW1vblwiLFwiU1VcIiwgXCJTdW1tb25zIGFuIGVuZW15XCIsIDApO1xyXG5cclxuICAgICAgICAgICAgVmVjdG9yMkQgZGlyZWN0aW9uTW92ZSA9IG5ldyBWZWN0b3IyRCgwLCAtMSk7XHJcbiAgICAgICAgICAgIGludCBkYW1hZ2VMb3cyID0gKGludCkoYmFzZURhbWFnZSAqIDAuNzVmKTtcclxuICAgICAgICAgICAgaW50IGRhbWFnZUhpZ2ggPSAoaW50KShiYXNlRGFtYWdlICogM2YpO1xyXG4gICAgICAgICAgICBOZXdNb3ZlRGF0YShcIkRvd25maXJlXCIsXHJcbiAgICAgICAgICAgICAgICB0aWNrczogVGlja0FycmF5KFxyXG4gICAgICAgICAgICAgICAgICAgIFRpY2tVbml0KG5ldyBBbmltYXRpb24oVGFyZ2V0LkNsb3Nlc3RUYXJnZXRYLCBCYXR0bGVNYWluLkVsZW1lbnQuRmlyZSkpLFxyXG5cclxuICAgICAgICAgICAgICAgICAgICBUaWNrVW5pdChuZXcgRGVhbERhbWFnZUFjdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIGRhbWFnZUxvdzIsIEJhdHRsZU1haW4uRWxlbWVudC5GaXJlKSksXHJcbiAgICAgICAgICAgICAgICAgICAgVGlja1VuaXRDb25kaXRpb24oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBDb25kaXRpb24oQ29uZGl0aW9uVHlwZS5DYW5Nb3ZlLCBUYXJnZXQuU2VsZiwgZGlyZWN0aW9uTW92ZSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBNb3ZlQWN0aW9uKFRhcmdldC5TZWxmLCBkaXJlY3Rpb25Nb3ZlKSksXHJcbiAgICAgICAgICAgICAgICAgICAgVGlja1VuaXQobmV3IEFuaW1hdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIEJhdHRsZU1haW4uRWxlbWVudC5GaXJlKSksXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFRpY2tVbml0KG5ldyBEZWFsRGFtYWdlQWN0aW9uKFRhcmdldC5DbG9zZXN0VGFyZ2V0WCwgMSwgQmF0dGxlTWFpbi5FbGVtZW50LkZpcmUpKSksXHJcbiAgICAgICAgICAgICAgICB0YWdzOiBUYWdBcnJheShNb3ZlRGF0YVRhZ3MuU2hvb3QpKTtcclxuICAgICAgICAgICAgTmV3TW92ZVRleHRSZW5kZXJEYXRhKFwiRG93bmZpcmVcIiwgXCJERlwiLCBcIlNob290LCBkb3duLCBzaG9vdFwiLGJhc2VEYW1hZ2UsIEJhdHRsZU1haW4uRWxlbWVudC5GaXJlKTtcclxuXHJcbiAgICAgICAgICAgIE5ld01vdmVEYXRhKFwiVHJpcGxlRmlyZVwiLCB0aWNrczpcclxuICAgICAgICAgICAgICAgIFRpY2tBcnJheShcclxuICAgICAgICAgICAgICAgICAgICBUaWNrVW5pdChcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEFuaW1hdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIEJhdHRsZU1haW4uRWxlbWVudC5GaXJlLCBuZXcgVmVjdG9yMkQoMCwgLTEpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEFuaW1hdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIEJhdHRsZU1haW4uRWxlbWVudC5GaXJlKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEFuaW1hdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIEJhdHRsZU1haW4uRWxlbWVudC5GaXJlLCBuZXcgVmVjdG9yMkQoMCwgMSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICAgICAgVGlja1VuaXQoXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgRGVhbERhbWFnZUFjdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIDEsIEJhdHRsZU1haW4uRWxlbWVudC5GaXJlLCBuZXcgVmVjdG9yMkQoMCwgLTEpKSxcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBEZWFsRGFtYWdlQWN0aW9uKFRhcmdldC5DbG9zZXN0VGFyZ2V0WCwgMSwgQmF0dGxlTWFpbi5FbGVtZW50LkZpcmUpLFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IERlYWxEYW1hZ2VBY3Rpb24oVGFyZ2V0LkNsb3Nlc3RUYXJnZXRYLCAxLCBCYXR0bGVNYWluLkVsZW1lbnQuRmlyZSwgbmV3IFZlY3RvcjJEKDAsIDEpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICwgdGFnczogVGFnQXJyYXkoTW92ZURhdGFUYWdzLlNob290KSk7XHJcbiAgICAgICAgICAgIE5ld01vdmVUZXh0UmVuZGVyRGF0YShcIlRyaXBsZUZpcmVcIiwgXCJURlwiLFwiU2hvb3RzIGluIHRoZSB0aHJlZSByb3dzXCIsIGJhc2VEYW1hZ2UsQmF0dGxlTWFpbi5FbGVtZW50LkZpcmUpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIEFyZWEgYXJlYVB1bmNoID0gQXJlYVVzZXIoKS5TcXVhcmVGb3J3YXJkKFhEaXM6IDEpO1xyXG4gICAgICAgICAgICBBcmVhIGFyZWFTbGFzaCA9IEFyZWFVc2VyKCkuUm93Rm9yd2FyZCh3aWR0aDogMSwgWERpczogMSk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGVsZW1lbnRzLkxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgTmV3TW92ZURhdGEoZWxlbWVudExhYmVsc1tpXSArIFwiYm9tYlwiLCB0aWNrczogT25lVGlja1BlckFjdGlvbihuZXcgQW5pbWF0aW9uKGFyZWFCb21iLCBlbGVtZW50c1tpXSksIG5ldyBEZWFsRGFtYWdlQWN0aW9uKGFyZWFCb21iLCAoaW50KShiYXNlRGFtYWdlICogMWYpLCBlbGVtZW50c1tpXSkpLCB0YWdzOiBUYWdBcnJheShNb3ZlRGF0YVRhZ3MuQm9tYikpO1xyXG4gICAgICAgICAgICAgICAgTmV3TW92ZVRleHRSZW5kZXJEYXRhKGVsZW1lbnRMYWJlbHNbaV0gKyBcImJvbWJcIiwgZWxlbWVudExldHRlcltpXSArIFwiQlwiLCBcIkF0dGFja3Mgcm93IHRocmVlIHNxdWFyZXMgZm9yd2FyZFwiLGJhc2VEYW1hZ2UsIGVsZW1lbnRzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGVsZW1lbnRzLkxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBOZXdNb3ZlRGF0YShlbGVtZW50TGFiZWxzW2ldICsgXCJwdW5jaFwiLCB0aWNrczogT25lVGlja1BlckFjdGlvbihuZXcgQW5pbWF0aW9uKGFyZWFQdW5jaCwgZWxlbWVudHNbaV0pLCBuZXcgRGVhbERhbWFnZUFjdGlvbihhcmVhUHVuY2gsIGRhbWFnZUhpZ2gsIGVsZW1lbnRzW2ldKSksIHRhZ3M6IFRhZ0FycmF5KE1vdmVEYXRhVGFncy5Cb21iKSk7XHJcbiAgICAgICAgICAgICAgICBOZXdNb3ZlVGV4dFJlbmRlckRhdGEoZWxlbWVudExhYmVsc1tpXSArIFwicHVuY2hcIiwgZWxlbWVudExldHRlcltpXSArIFwiUFwiLCBcIkF0dGFja3MgZW5lbXkgZm9yd2FyZFwiLGRhbWFnZUhpZ2gsIGVsZW1lbnRzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGVsZW1lbnRzLkxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgaW50IGRhbWFnZUhpZ2gyID0gKGludCkoYmFzZURhbWFnZSAqIDJmKTtcclxuICAgICAgICAgICAgICAgIE5ld01vdmVEYXRhKGVsZW1lbnRMYWJlbHNbaV0gKyBcInNsYXNoXCIsIHRpY2tzOiBPbmVUaWNrUGVyQWN0aW9uKG5ldyBBbmltYXRpb24oYXJlYVNsYXNoLCBlbGVtZW50c1tpXSksIG5ldyBEZWFsRGFtYWdlQWN0aW9uKGFyZWFTbGFzaCwgZGFtYWdlSGlnaDIsIGVsZW1lbnRzW2ldKSksIHRhZ3M6IFRhZ0FycmF5KE1vdmVEYXRhVGFncy5Cb21iKSk7XHJcbiAgICAgICAgICAgICAgICBOZXdNb3ZlVGV4dFJlbmRlckRhdGEoZWxlbWVudExhYmVsc1tpXSArIFwic2xhc2hcIiwgZWxlbWVudExldHRlcltpXSArIFwiU1wiLCBcIkF0dGFja3MgYSByb3cgZm9yd2FyZFwiLGRhbWFnZUhpZ2gyLCBlbGVtZW50c1tpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBlbGVtZW50cy5MZW5ndGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgIFZlY3RvcjJEIHVzZXJSZWZPZmZzZXQgPSBuZXcgVmVjdG9yMkQoMCwgMSk7XHJcbiAgICAgICAgICAgICAgICBOZXdNb3ZlRGF0YShcIlVwc2lkZVwiK2VsZW1lbnRMYWJlbHNbaV0sIHRpY2tzOlxyXG4gICAgICAgICAgICAgICAgVGlja0FycmF5KFxyXG4gICAgICAgICAgICAgICAgICAgIFRpY2tVbml0KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgQW5pbWF0aW9uKFRhcmdldC5DbG9zZXN0VGFyZ2V0WCwgZWxlbWVudHNbaV0sIHVzZXJSZWZPZmZzZXQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICAgICAgVGlja1VuaXQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBEZWFsRGFtYWdlQWN0aW9uKFRhcmdldC5DbG9zZXN0VGFyZ2V0WCwgKGludCkoYmFzZURhbWFnZSAqIDFmKSwgZWxlbWVudHNbaV0sIHVzZXJSZWZPZmZzZXQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIClcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgLCB0YWdzOiBUYWdBcnJheShNb3ZlRGF0YVRhZ3MuU2hvb3QpKTtcclxuICAgICAgICAgICAgICAgIE5ld01vdmVUZXh0UmVuZGVyRGF0YShcIlVwc2lkZVwiICsgZWxlbWVudExhYmVsc1tpXSwgXCJVXCIrZWxlbWVudExldHRlcltpXSwgXCJTaG9vdHMgZnJvbSBBYm92ZVwiLGJhc2VEYW1hZ2UsIGVsZW1lbnRzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGVsZW1lbnRzLkxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgVmVjdG9yMkQgdXNlclJlZk9mZnNldCA9IG5ldyBWZWN0b3IyRCgwLCAtMSk7XHJcbiAgICAgICAgICAgICAgICBOZXdNb3ZlRGF0YShcIkRvd25zaWRlXCIgKyBlbGVtZW50TGFiZWxzW2ldLCB0aWNrczpcclxuICAgICAgICAgICAgICAgIFRpY2tBcnJheShcclxuICAgICAgICAgICAgICAgICAgICBUaWNrVW5pdChcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEFuaW1hdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIGVsZW1lbnRzW2ldLCB1c2VyUmVmT2Zmc2V0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICAgICAgICAgIFRpY2tVbml0KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgRGVhbERhbWFnZUFjdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIChpbnQpKGJhc2VEYW1hZ2UgKiAxZiksIGVsZW1lbnRzW2ldLCB1c2VyUmVmT2Zmc2V0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICwgdGFnczogVGFnQXJyYXkoTW92ZURhdGFUYWdzLlNob290KSk7XHJcbiAgICAgICAgICAgICAgICBOZXdNb3ZlVGV4dFJlbmRlckRhdGEoXCJEb3duc2lkZVwiICsgZWxlbWVudExhYmVsc1tpXSwgXCJEXCIgKyBlbGVtZW50TGV0dGVyW2ldLCBcIlNob290cyBmcm9tIGJlbG93XCIsYmFzZURhbWFnZSwgZWxlbWVudHNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZWxlbWVudHMuTGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICBWZWN0b3IyRCB1c2VyUmVmT2Zmc2V0ID0gbmV3IFZlY3RvcjJEKDAsIC0xKTtcclxuICAgICAgICAgICAgICAgIFZlY3RvcjJEIHVzZXJSZWZPZmZzZXQyID0gbmV3IFZlY3RvcjJEKDAsIDEpO1xyXG4gICAgICAgICAgICAgICAgTmV3TW92ZURhdGEoXCJTaWRlc1wiICsgZWxlbWVudExhYmVsc1tpXSwgdGlja3M6XHJcbiAgICAgICAgICAgICAgICBUaWNrQXJyYXkoXHJcbiAgICAgICAgICAgICAgICAgICAgVGlja1VuaXQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBBbmltYXRpb24oVGFyZ2V0LkNsb3Nlc3RUYXJnZXRYLCBlbGVtZW50c1tpXSwgdXNlclJlZk9mZnNldCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBBbmltYXRpb24oVGFyZ2V0LkNsb3Nlc3RUYXJnZXRYLCBlbGVtZW50c1tpXSwgdXNlclJlZk9mZnNldDIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICksXHJcbiAgICAgICAgICAgICAgICAgICAgVGlja1VuaXQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBEZWFsRGFtYWdlQWN0aW9uKFRhcmdldC5DbG9zZXN0VGFyZ2V0WCwgZGFtYWdlTG93MiwgZWxlbWVudHNbaV0sIHVzZXJSZWZPZmZzZXQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgRGVhbERhbWFnZUFjdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIGRhbWFnZUxvdzIsIGVsZW1lbnRzW2ldLCB1c2VyUmVmT2Zmc2V0MilcclxuICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG5cclxuICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAsIHRhZ3M6IFRhZ0FycmF5KE1vdmVEYXRhVGFncy5TaG9vdCkpO1xyXG4gICAgICAgICAgICAgICAgTmV3TW92ZVRleHRSZW5kZXJEYXRhKFwiU2lkZXNcIiArIGVsZW1lbnRMYWJlbHNbaV0sIFwiU1wiICsgZWxlbWVudExldHRlcltpXSwgXCJBdHRhY2tzIGZyb20gdGhlIHNpZGVzXCIsZGFtYWdlTG93MiwgZWxlbWVudHNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZWxlbWVudHMuTGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCBkYW1hZ2VMb3czID0gKGludCkoYmFzZURhbWFnZSAqIDAuNGYpO1xyXG4gICAgICAgICAgICAgICAgTmV3TW92ZURhdGEoXCJEb3VibGVcIiArIGVsZW1lbnRMYWJlbHNbaV0sXHJcbiAgICAgICAgICAgICAgICB0aWNrczogVGlja0FycmF5KFxyXG4gICAgICAgICAgICAgICAgICAgIFRpY2tVbml0KG5ldyBBbmltYXRpb24oVGFyZ2V0LkNsb3Nlc3RUYXJnZXRYLCBlbGVtZW50c1tpXSkpLFxyXG5cclxuICAgICAgICAgICAgICAgICAgICBUaWNrVW5pdChuZXcgRGVhbERhbWFnZUFjdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIGRhbWFnZUxvdzMsIGVsZW1lbnRzW2ldKSksXHJcbiAgICAgICAgICAgICAgICAgICAgVGlja1VuaXQobmV3IEFuaW1hdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIGVsZW1lbnRzW2ldKSksXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFRpY2tVbml0KG5ldyBEZWFsRGFtYWdlQWN0aW9uKFRhcmdldC5DbG9zZXN0VGFyZ2V0WCwgZGFtYWdlTG93MywgZWxlbWVudHNbaV0pKSksXHJcbiAgICAgICAgICAgICAgICB0YWdzOiBUYWdBcnJheShNb3ZlRGF0YVRhZ3MuU2hvb3QpKTtcclxuICAgICAgICAgICAgICAgIE5ld01vdmVUZXh0UmVuZGVyRGF0YShcIkRvdWJsZVwiICsgZWxlbWVudExhYmVsc1tpXSwgXCJEXCIrZWxlbWVudExldHRlcltpXSxcIlNob290cyB0d28gdGltZXNcIixkYW1hZ2VMb3czLCBlbGVtZW50c1tpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBlbGVtZW50cy5MZW5ndGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW50IGRhbWFnZUxvdzQgPSAoaW50KShiYXNlRGFtYWdlICogMC4yZik7XHJcbiAgICAgICAgICAgICAgICBOZXdNb3ZlRGF0YShcIlRyaXBsZVwiICsgZWxlbWVudExhYmVsc1tpXSxcclxuICAgICAgICAgICAgICAgIHRpY2tzOiBUaWNrQXJyYXkoXHJcbiAgICAgICAgICAgICAgICAgICAgVGlja1VuaXQobmV3IEFuaW1hdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIGVsZW1lbnRzW2ldKSksXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFRpY2tVbml0KG5ldyBEZWFsRGFtYWdlQWN0aW9uKFRhcmdldC5DbG9zZXN0VGFyZ2V0WCwgZGFtYWdlTG93NCwgZWxlbWVudHNbaV0pKSxcclxuICAgICAgICAgICAgICAgICAgICBUaWNrVW5pdChuZXcgQW5pbWF0aW9uKFRhcmdldC5DbG9zZXN0VGFyZ2V0WCwgZWxlbWVudHNbaV0pKSxcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgVGlja1VuaXQobmV3IERlYWxEYW1hZ2VBY3Rpb24oVGFyZ2V0LkNsb3Nlc3RUYXJnZXRYLCBkYW1hZ2VMb3c0LCBlbGVtZW50c1tpXSkpLFxyXG4gICAgICAgICAgICAgICAgICAgIFRpY2tVbml0KG5ldyBBbmltYXRpb24oVGFyZ2V0LkNsb3Nlc3RUYXJnZXRYLCBlbGVtZW50c1tpXSkpLFxyXG5cclxuICAgICAgICAgICAgICAgICAgICBUaWNrVW5pdChuZXcgRGVhbERhbWFnZUFjdGlvbihUYXJnZXQuQ2xvc2VzdFRhcmdldFgsIGRhbWFnZUxvdzQsIGVsZW1lbnRzW2ldKSkpLFxyXG4gICAgICAgICAgICAgICAgdGFnczogVGFnQXJyYXkoTW92ZURhdGFUYWdzLlNob290KSk7XHJcbiAgICAgICAgICAgICAgICBOZXdNb3ZlVGV4dFJlbmRlckRhdGEoXCJUcmlwbGVcIiArIGVsZW1lbnRMYWJlbHNbaV0sIFwiVFwiICsgZWxlbWVudExldHRlcltpXSxcIlNob290cyB0aHJlZSB0aW1lc1wiLGRhbWFnZUxvdzQsIGVsZW1lbnRzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgaW50IEdldE1vdmVJZChzdHJpbmcgdilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBNb3ZlRGF0YS5GaW5kQnlMYWJlbChtb3ZlRGF0YXMsIHYpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBBcmVhQ3JlYXRpb25VdGlscyBBcmVhVXNlcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBhcmVhVXRpbHMudGFyZ2V0ID0gVGFyZ2V0LlNlbGY7XHJcbiAgICAgICAgICAgIHJldHVybiBhcmVhVXRpbHM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgY2xhc3MgQXJlYUNyZWF0aW9uVXRpbHNcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHB1YmxpYyBUYXJnZXQgdGFyZ2V0O1xyXG4gICAgICAgICAgICBpbnQgaGVpZ2h0ID0gMztcclxuXHJcbiAgICAgICAgICAgIGludGVybmFsIEFyZWEgUm93Rm9yd2FyZChpbnQgd2lkdGgsIGludCBYRGlzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmEgPSBuZXcgQXJlYSh0YXJnZXQpO1xyXG4gICAgICAgICAgICAgICAgaW50IG9mZnNldFkgPSAoaW50KU1hdGguRmxvb3IoKGZsb2F0KWhlaWdodCAvIDJmKTtcclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgd2lkdGg7IGkrKylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IGhlaWdodDsgaisrKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhLnBvaW50cy5BZGQobmV3IFZlY3RvcjJEKGkgKyBYRGlzLCBqIC0gb2Zmc2V0WSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiByYTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaW50ZXJuYWwgQXJlYSBTcXVhcmVGb3J3YXJkKGludCBYRGlzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmEgPSBuZXcgQXJlYSh0YXJnZXQpO1xyXG4gICAgICAgICAgICAgICAgcmEucG9pbnRzLkFkZChuZXcgVmVjdG9yMkQoWERpcywgMCkpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIE5ld01vdmVUZXh0UmVuZGVyRGF0YShzdHJpbmcgbmFtZSwgc3RyaW5nIGFicmV2LCBzdHJpbmcgZGVzY3JpcHRpb24sIGludCBkYW1hZ2UsIEJhdHRsZU1haW4uRWxlbWVudCBlID0gQmF0dGxlTWFpbi5FbGVtZW50Lk5vdGhpbmduZXNzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgTW92ZU1ldGFEYXRhIGl0ZW0gPSBuZXcgTW92ZU1ldGFEYXRhKG5hbWUsIGFicmV2LCBlKTtcclxuICAgICAgICAgICAgaXRlbS5EZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xyXG4gICAgICAgICAgICBpdGVtLmRhbWFnZSA9IGRhbWFnZTtcclxuICAgICAgICAgICAgbW92ZVJlbmRlcnMuQWRkKGl0ZW0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBNb3ZlRGF0YSBOZXdNb3ZlRGF0YShzdHJpbmcgbGFiZWwsIFRpY2tbXSB0aWNrcywgb2JqZWN0W10gdGFncylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBtdiA9IG5ldyBNb3ZlRGF0YShsYWJlbCk7XHJcbiAgICAgICAgICAgIG12LnVuaXRzLkFkZFJhbmdlKHRpY2tzKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGl0ZW0gaW4gdGFncylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbXYudGFncy5BZGQoQ29udmVydC5Ub0ludDMyKGl0ZW0pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlY3MuQ3JlYXRlRW50aXR5V2l0aENvbXBvbmVudChtdik7XHJcbiAgICAgICAgICAgIG1vdmVEYXRhcy5BZGQobXYpO1xyXG4gICAgICAgICAgICByZXR1cm4gbXY7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIE1vdmVEYXRhIE5ld01vdmVEYXRhKHN0cmluZyBsYWJlbCwgQ29uZGl0aW9uIGNvbmRpdGlvbiwgb2JqZWN0IGFjdGlvbiwgb2JqZWN0W10gdGFncylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBtdiA9IG5ldyBNb3ZlRGF0YShsYWJlbCk7XHJcbiAgICAgICAgICAgIFRpY2sgdGljayA9IG5ldyBUaWNrKCk7XHJcbiAgICAgICAgICAgIHRpY2suY29uZGl0aW9uID0gY29uZGl0aW9uO1xyXG4gICAgICAgICAgICB0aWNrLnRoaW5nc1RvSGFwcGVuLkFkZChhY3Rpb24pO1xyXG4gICAgICAgICAgICBtdi51bml0cy5BZGQodGljayk7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBpdGVtIGluIHRhZ3MpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG12LnRhZ3MuQWRkKENvbnZlcnQuVG9JbnQzMihpdGVtKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWNzLkNyZWF0ZUVudGl0eVdpdGhDb21wb25lbnQobXYpO1xyXG4gICAgICAgICAgICBtb3ZlRGF0YXMuQWRkKG12KTtcclxuICAgICAgICAgICAgcmV0dXJuIG12O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBUaWNrW10gT25lVGlja1BlckFjdGlvbihwYXJhbXMgb2JqZWN0W10gYWN0aW9ucylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFRpY2tbXSB0aWNrcyA9IG5ldyBUaWNrW2FjdGlvbnMuTGVuZ3RoXTtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0aWNrcy5MZW5ndGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGlja3NbaV0gPSBuZXcgVGljayhhY3Rpb25zW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGlja3M7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIFRpY2sgVGlja1VuaXRDb25kaXRpb24oQ29uZGl0aW9uIGNvbmRpdGlvbiwgcGFyYW1zIE9iamVjdFtdIGFjdGlvbnMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUaWNrIHRpY2sgPSBuZXcgVGljayhhY3Rpb25zKTtcclxuICAgICAgICAgICAgdGljay5jb25kaXRpb24gPSBjb25kaXRpb247XHJcbiAgICAgICAgICAgIHJldHVybiB0aWNrO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHByaXZhdGUgVGljayBUaWNrVW5pdChwYXJhbXMgT2JqZWN0W10gYWN0aW9ucylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVGljayhhY3Rpb25zKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgVGlja1tdIFRpY2tBcnJheShwYXJhbXMgVGlja1tdIHRpY2tzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRpY2tzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBvYmplY3RbXSBUYWdBcnJheShwYXJhbXMgb2JqZWN0W10gYXJncylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBhcmdzO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgTW92ZU1ldGFEYXRhXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0cmluZyBMYWJlbDtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nIEFicmV2O1xyXG4gICAgICAgIHB1YmxpYyByZWFkb25seSBCYXR0bGVNYWluLkVsZW1lbnQgZWxlbWVudDtcclxuICAgICAgICBwdWJsaWMgaW50IGRhbWFnZTtcclxuXHJcbiAgICAgICAgcHVibGljIE1vdmVNZXRhRGF0YShzdHJpbmcgbGFiZWwsIHN0cmluZyBhYnJldiwgQmF0dGxlTWFpbi5FbGVtZW50IGVsZW1lbnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBMYWJlbCA9IGxhYmVsO1xyXG4gICAgICAgICAgICBBYnJldiA9IGFicmV2O1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9wdWJsaWMgTW92ZU1ldGFEYXRhKHN0cmluZyBsYWJlbCwgc3RyaW5nIGFicmV2KVxyXG4gICAgICAgIC8ve1xyXG4gICAgICAgIC8vICAgIHRoaXMuTGFiZWwgPSBsYWJlbDtcclxuICAgICAgICAvLyAgICB0aGlzLkFicmV2ID0gYWJyZXY7XHJcbiAgICAgICAgLy99XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgRGVzY3JpcHRpb24geyBnZXQ7IGludGVybmFsIHNldDsgfVxyXG4gICAgfVxyXG5cclxuXHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBUcmFja0JhdHRsZVxyXG4gICAge1xyXG5cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgVHJhY2tJbmZvU3RhZ2Ugc3RhZ2VJbmZvO1xyXG5cclxuICAgICAgICBwdWJsaWMgU3RhZ2VCYXR0bGVNZXRyaWNzIG1ldHJpY3MgPSBuZXcgU3RhZ2VCYXR0bGVNZXRyaWNzKHRydWUpO1xyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIEhlcm9EYW1hZ2UoaW50IGRhbWFnZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChkYW1hZ2UgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBtZXRyaWNzLmRhbWFnZSArPSBkYW1hZ2U7XHJcbiAgICAgICAgICAgICAgICBtZXRyaWNzLmRhbWFnZVRpbWVzKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFByZXZpZXcoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbWV0cmljcy5wcmV2aWV3VGltZXMrKztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgUm91bmQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbWV0cmljcy5yb3VuZCsrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBCYXR0bGVFbmRWaWN0b3J5KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG1ldHJpY3MucmFuayA9IENhbGN1bGF0ZVJhbmsoKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgICAqIFJhbmsgZm9ybXVsYVxyXG4gICAgICAgICAqIEdvZXMgZnJvbSAxIHRvIDEwMCwgd2hlcmUgMTAwIGlzIFMuIENhbiBnbyBhYm92ZSBTLlxyXG4gICAgICAgICAqIGdvb2QgdHVybnMsIG5vIGRhbWFnZSBhbmQgbm8gcHJldmlldyBnaXZlIHlvdSBTXHJcbiAgICAgICAgICovXHJcblxyXG4gICAgICAgIGludGVybmFsIGludCBDYWxjdWxhdGVSYW5rKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChzdGFnZUluZm8gPT0gbnVsbCkgcmV0dXJuIC0xO1xyXG4gICAgICAgICAgICBpbnQgcmFuayA9IDEwMDtcclxuICAgICAgICAgICAgaW50IGRpZmYgPSBzdGFnZUluZm8udGFyZ2V0Um91bmRzIC0gbWV0cmljcy5yb3VuZDtcclxuICAgICAgICAgICAgaWYgKGRpZmYgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByYW5rICs9IGRpZmYgKiAoZGlmZikgKiAzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmFuayAtPSBkaWZmICogKGRpZmYpICogMztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKG1ldHJpY3MuZGFtYWdlVGltZXMgPiAzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByYW5rIC09IDEwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChtZXRyaWNzLmRhbWFnZVRpbWVzID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmFuayAtPSAxMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2lmIChtZXRyaWNzLnByZXZpZXdUaW1lcyA+IDEpXHJcbiAgICAgICAgICAgIC8ve1xyXG4gICAgICAgICAgICAvLyAgICByYW5rIC09IDU7XHJcbiAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAvL2lmIChtZXRyaWNzLnByZXZpZXdUaW1lcyA+IDMpXHJcbiAgICAgICAgICAgIC8ve1xyXG4gICAgICAgICAgICAvLyAgICByYW5rIC09IDU7XHJcbiAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICByZXR1cm4gcmFuaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgY2xhc3MgU3RhZ2VCYXR0bGVNZXRyaWNzXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGludCBkYW1hZ2UgPSAtMTtcclxuICAgICAgICBwdWJsaWMgaW50IGRhbWFnZVRpbWVzID0gLTE7XHJcbiAgICAgICAgcHVibGljIGludCBwcmV2aWV3VGltZXMgPSAtMTtcclxuICAgICAgICBwdWJsaWMgaW50IHJvdW5kID0gLTE7XHJcbiAgICAgICAgcHVibGljIGludCByYW5rID0gLTE7XHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIHB1YmxpYyBTdGFnZUJhdHRsZU1ldHJpY3MoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBTdGFnZUJhdHRsZU1ldHJpY3MoYm9vbCBpbml0VmFsdWVzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5kYW1hZ2UgPSAwO1xyXG4gICAgICAgICAgICB0aGlzLmRhbWFnZVRpbWVzID0gMDtcclxuICAgICAgICAgICAgdGhpcy5wcmV2aWV3VGltZXMgPSAwO1xyXG4gICAgICAgICAgICB0aGlzLnJhbmsgPSAwO1xyXG4gICAgICAgICAgICB0aGlzLnJvdW5kID0gMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgQ29weVZhbHVlcyhTdGFnZUJhdHRsZU1ldHJpY3MgbWV0cmljcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuZGFtYWdlID0gbWV0cmljcy5kYW1hZ2U7XHJcbiAgICAgICAgICAgIHRoaXMuZGFtYWdlVGltZXMgPSBtZXRyaWNzLmRhbWFnZVRpbWVzO1xyXG4gICAgICAgICAgICB0aGlzLnByZXZpZXdUaW1lcyA9IG1ldHJpY3MucHJldmlld1RpbWVzO1xyXG4gICAgICAgICAgICB0aGlzLnJvdW5kID0gbWV0cmljcy5yb3VuZDtcclxuICAgICAgICAgICAgdGhpcy5yYW5rID0gbWV0cmljcy5yYW5rO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgU3RhZ2VQcm9ncmVzc1BlcnNpc3RlbmNlXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGludCBzdGFnZUlkO1xyXG4gICAgICAgIHB1YmxpYyBTdGFnZUJhdHRsZU1ldHJpY3MgYmVzdEJhdHRsZU1ldHJpY3MgPSBuZXcgU3RhZ2VCYXR0bGVNZXRyaWNzKCk7XHJcbiAgICAgICAgcHVibGljIGJvb2wgYXZhaWxhYmxlID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHB1YmxpYyBTdGFnZVByb2dyZXNzUGVyc2lzdGVuY2UoKVxyXG4gICAgICAgIHtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBTdGFnZVByb2dyZXNzUGVyc2lzdGVuY2UoaW50IGlkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgc3RhZ2VJZCA9IGlkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBQaWRyb2guRUNTO1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWRcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFN0YWdlR3JvdXBOYXZpZ2F0b3JcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgTGlzdDxFbnRpdHk+IGJhY2tUcmFja1BpbGUgPSBuZXcgTGlzdDxFbnRpdHk+KCk7XHJcbiAgICAgICAgcHVibGljIEVudGl0eSBjdXJyZW50R3JvdXBFO1xyXG4gICAgICAgIHB1YmxpYyBTdGFnZURhdGFHcm91cCBjdXJyZW50U0RHO1xyXG5cclxuICAgICAgICBwdWJsaWMgU3RhZ2VHcm91cE5hdmlnYXRvcihFQ1NNYW5hZ2VyIGVjcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBzZGdzID0gZWNzLlF1aWNrQWNjZXNzb3IxPFN0YWdlRGF0YUdyb3VwPigpO1xyXG4gICAgICAgICAgICB2YXIgZmlyc3RHcm91cCA9IHNkZ3MuQ29tcDEoMCk7XHJcbiAgICAgICAgICAgIEVudGl0eSBuZXdDdXJyZW50ID0gc2Rncy5FbnRpdHkoMCk7XHJcbiAgICAgICAgICAgIENoYW5nZUN1cnJlbnQobmV3Q3VycmVudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgQ2hhbmdlQ3VycmVudChFbnRpdHkgbmV3Q3VycmVudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRHcm91cEUgPSBuZXdDdXJyZW50O1xyXG4gICAgICAgICAgICBjdXJyZW50U0RHID0gY3VycmVudEdyb3VwRS5HZXRDb21wb25lbnQ8U3RhZ2VEYXRhR3JvdXA+KCk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRW50ZXIoaW50IGNoaWxkSWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiYWNrVHJhY2tQaWxlLkFkZChjdXJyZW50R3JvdXBFKTtcclxuICAgICAgICAgICAgQ2hhbmdlQ3VycmVudChjdXJyZW50R3JvdXBFLkdldENvbXBvbmVudDxTdGFnZURhdGFHcm91cD4oKS5jaGlsZElkc1tjaGlsZElkXSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBCYWNrdHJhY2soKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IGxhc3RFbGVtZW50ID0gYmFja1RyYWNrUGlsZS5Db3VudCAtIDE7XHJcbiAgICAgICAgICAgIGlmIChsYXN0RWxlbWVudCA8IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBDaGFuZ2VDdXJyZW50KGJhY2tUcmFja1BpbGVbbGFzdEVsZW1lbnRdKTtcclxuICAgICAgICAgICAgYmFja1RyYWNrUGlsZS5SZW1vdmVBdChsYXN0RWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFBpZHJvaC5FQ1M7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZFxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgU3RhZ2VUb0JhdHRsZVxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBFbnRpdHkgc3RhZ2VUb1VubG9jaztcclxuICAgICAgICBwdWJsaWMgRW50aXR5IEN1cnJlbnRTdGFnZTtcclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgVmljdG9yeSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZihzdGFnZVRvVW5sb2NrLkV4aXN0KCkpXHJcbiAgICAgICAgICAgICAgICBzdGFnZVRvVW5sb2NrLkdldENvbXBvbmVudDxTdGFnZVByb2dyZXNzUGVyc2lzdGVuY2U+KCkuYXZhaWxhYmxlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEJhdHRsZU1ldHJpY3NVcGRhdGUoU3RhZ2VCYXR0bGVNZXRyaWNzIG1ldHJpY3MpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBTdGFnZVByb2dyZXNzUGVyc2lzdGVuY2Ugc3RhZ2VQcm9ncmVzc1BlcnNpc3RlbmNlID0gQ3VycmVudFN0YWdlLkdldENvbXBvbmVudDxTdGFnZVByb2dyZXNzUGVyc2lzdGVuY2U+KCk7XHJcbiAgICAgICAgICAgIHN0YWdlUHJvZ3Jlc3NQZXJzaXN0ZW5jZS5iZXN0QmF0dGxlTWV0cmljcy5Db3B5VmFsdWVzKG1ldHJpY3MpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWRcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFRhZ0NvbXBvbmVudFxyXG4gICAge1xyXG4gICAgICAgIExpc3Q8c3RyaW5nPiB0YWdzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgVGFnQ29tcG9uZW50KClcclxuICAgICAgICB7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVGFnQ29tcG9uZW50KHN0cmluZyB2KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGFncy5BZGQodik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCBib29sIENvbnRhaW5zKHN0cmluZyB2KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRhZ3MuQ29udGFpbnModik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5FQ1Ncclxue1xyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBBY2Nlc3NvclxyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBpbnQgTGVuZ3RoIHsgZ2V0IHsgcmV0dXJuIFNlbGVjdGVkRW50aXRpZXMuQ291bnQ7IH0gfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCBUeXBlW10gVHlwZXNQcm9oaWJpdGVkIHsgZ2V0OyBzZXQ7IH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgVHlwZVtdIFR5cGVzTmVjZXNzYXJ5O1xyXG4gICAgICAgIGludGVybmFsIExpc3Q8RW50aXR5PiBTZWxlY3RlZEVudGl0aWVzID0gbmV3IExpc3Q8RW50aXR5PigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgQWNjZXNzb3IocGFyYW1zIFR5cGVbXSBzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVHlwZXNOZWNlc3NhcnkgPSBzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgYm9vbCBFbnRpdHlBZGRlZChFbnRpdHkgZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBTZWxlY3RlZEVudGl0aWVzLkNvbnRhaW5zKGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEVudGl0eSBHZXQoaW50IGkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gU2VsZWN0ZWRFbnRpdGllc1tpXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIFF1aWNrQWNjZXNzb3JPbmU8VDE+XHJcbiAgICB7XHJcblxyXG4gICAgICAgIHB1YmxpYyBRdWlja0FjY2Vzc29yT25lKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGFjY2Vzc29yID0gbmV3IEFjY2Vzc29yKHR5cGVvZihUMSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgQWNjZXNzb3IgYWNjZXNzb3I7XHJcbiAgICAgICAgcHVibGljIGludCBDb3VudCB7IGdldCB7IHJldHVybiBhY2Nlc3Nvci5MZW5ndGg7IH0gfVxyXG4gICAgICAgIFxyXG5cclxuICAgICAgICBwdWJsaWMgVDEgQ29tcDEoaW50IGkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gYWNjZXNzb3IuU2VsZWN0ZWRFbnRpdGllc1tpXS5HZXRDb21wb25lbnQ8VDE+KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgRW50aXR5IEVudGl0eShpbnQgaSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBhY2Nlc3Nvci5TZWxlY3RlZEVudGl0aWVzW2ldO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHB1YmxpYyBjbGFzcyBRdWlja0FjY2Vzc29yVHdvPFQxLCBUMj4gXHJcbiAgICB7XHJcblxyXG4gICAgICAgIGludGVybmFsIEFjY2Vzc29yIGFjY2Vzc29yO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgTGVuZ3RoIHsgZ2V0IHsgcmV0dXJuIGFjY2Vzc29yLkxlbmd0aDsgfSB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBUMSBDb21wMShpbnQgaSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBhY2Nlc3Nvci5TZWxlY3RlZEVudGl0aWVzW2ldLkdldENvbXBvbmVudDxUMT4oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBFbnRpdHkgRW50aXR5KGludCBpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFjY2Vzc29yLlNlbGVjdGVkRW50aXRpZXNbaV07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgUXVpY2tBY2Nlc3NvclR3bygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBhY2Nlc3NvciA9IG5ldyBBY2Nlc3Nvcih0eXBlb2YoVDEpLCB0eXBlb2YoVDIpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIFxyXG5cclxuICAgICAgICBwdWJsaWMgVDIgQ29tcDIoaW50IGkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gYWNjZXNzb3IuU2VsZWN0ZWRFbnRpdGllc1tpXS5HZXRDb21wb25lbnQ8VDI+KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBcclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guRUNTXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBDbG9uZWRTdGF0ZVxyXG4gICAge1xyXG4gICAgICAgIGludGVybmFsIERpY3Rpb25hcnk8VHlwZSwgb2JqZWN0W10+IGNvbXBzID0gbmV3IERpY3Rpb25hcnk8VHlwZSwgb2JqZWN0W10+KCk7XHJcbiAgICB9XHJcblxyXG5cclxufVxyXG4iLCJ1c2luZyBQaWRyb2guQmFzZVV0aWxzO1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guRUNTXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBFQ1NNYW5hZ2VyXHJcbiAgICB7XHJcblxyXG4gICAgICAgIHByaXZhdGUgc3RhdGljIEVDU01hbmFnZXJbXSBtYW5hZ2VycyA9IG5ldyBFQ1NNYW5hZ2VyWzgwMDBdO1xyXG4gICAgICAgIERpY3Rpb25hcnk8VHlwZSwgb2JqZWN0W10+IGNvbXBzID0gbmV3IERpY3Rpb25hcnk8VHlwZSwgb2JqZWN0W10+KCk7XHJcbiAgICAgICAgcHJpdmF0ZSBpbnQgRUNTSWQ7XHJcbiAgICAgICAgaW50IGVudGl0eUlkTWF4ID0gLTE7XHJcbiAgICAgICAgTGlzdDxBY2Nlc3Nvcj4gYWNjZXNzb3JzID0gbmV3IExpc3Q8QWNjZXNzb3I+KCk7XHJcblxyXG4gICAgICAgIERpY3Rpb25hcnk8VHlwZSwgQWN0aW9uPE9iamVjdCwgT2JqZWN0Pj4gQ29weU1ldGhvZHMgPSBuZXcgRGljdGlvbmFyeTxUeXBlLCBBY3Rpb248b2JqZWN0LCBvYmplY3Q+PigpO1xyXG5cclxuICAgICAgICBwcml2YXRlIEVDU01hbmFnZXIoKSB7IH1cclxuXHJcbiAgICAgICAgcHVibGljIFByb2Nlc3NvckFjY2Vzc29yIENyZWF0ZVByb2Nlc3NvcihBY2Nlc3NvciBhY2Nlc3NvciwgQWN0aW9uPEFjY2Vzc29yPiBhY3Rpb24pXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9jZXNzb3JBY2Nlc3NvcihhY3Rpb24sIGFjY2Vzc29yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFkZENvcHlNZXRob2QoVHlwZSB0eXBlLCBBY3Rpb248b2JqZWN0LCBvYmplY3Q+IGNvcHlNZXRobylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIENvcHlNZXRob2RzLkFkZCh0eXBlLCAoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uPG9iamVjdCwgb2JqZWN0Piljb3B5TWV0aG8pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIEFjY2Vzc29yIENyZWF0ZUFjY2Vzc29yKFR5cGVbXSBuZWNlc3NhcnksIFR5cGVbXSBub3QpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgYWNjID0gbmV3IEFjY2Vzc29yKG5lY2Vzc2FyeSk7XHJcbiAgICAgICAgICAgIGFjYy5UeXBlc1Byb2hpYml0ZWQgPSBub3Q7XHJcbiAgICAgICAgICAgIEFkZEFjY2Vzc29yKGFjYyk7XHJcbiAgICAgICAgICAgIHJldHVybiBhY2M7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIFF1aWNrQWNjZXNzb3JUd288VDEsIFQyPiBRdWlja0FjY2Vzc29yMjxUMSwgVDI+KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFF1aWNrQWNjZXNzb3JUd288VDEsIFQyPiBhY2Nlc3NvciA9IG5ldyBRdWlja0FjY2Vzc29yVHdvPFQxLCBUMj4oKTtcclxuICAgICAgICAgICAgQWRkQWNjZXNzb3IoYWNjZXNzb3IuYWNjZXNzb3IpO1xyXG4gICAgICAgICAgICByZXR1cm4gYWNjZXNzb3I7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgUXVpY2tBY2Nlc3Nvck9uZTxUMT4gUXVpY2tBY2Nlc3NvcjE8VDE+KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFF1aWNrQWNjZXNzb3JPbmU8VDE+IGFjY2Vzc29yID0gbmV3IFF1aWNrQWNjZXNzb3JPbmU8VDE+KCk7XHJcbiAgICAgICAgICAgIEFkZEFjY2Vzc29yKGFjY2Vzc29yLmFjY2Vzc29yKTtcclxuICAgICAgICAgICAgcmV0dXJuIGFjY2Vzc29yO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICNyZWdpb24gc3RhdGljIG1ldGhvZHNcclxuXHJcblxyXG4gICAgICAgIGludGVybmFsIHN0YXRpYyBFQ1NNYW5hZ2VyIEdldEluc3RhbmNlKEVudGl0eSBlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG1hbmFnZXJzW2UuZWNzXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgRUNTTWFuYWdlciBDcmVhdGUoKVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWFuYWdlcnMuTGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChtYW5hZ2Vyc1tpXSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG1hbmFnZXJzW2ldID0gbmV3IEVDU01hbmFnZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICBtYW5hZ2Vyc1tpXS5FQ1NJZCA9IGk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hbmFnZXJzW2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAjZW5kcmVnaW9uXHJcblxyXG4gICAgICAgIHB1YmxpYyBFbnRpdHkgQ3JlYXRlRW50aXR5V2l0aENvbXBvbmVudChvYmplY3QgdilcclxuICAgICAgICB7XHJcbkVudGl0eSBlO1xuICAgICAgICAgICAgQ3JlYXRlRW50aXR5KG91dCBlKTtcclxuICAgICAgICAgICAgQWRkQ29tcG9uZW50KGUsIHYpO1xyXG4gICAgICAgICAgICByZXR1cm4gZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBFbnRpdHkgQ3JlYXRlRW50aXR5V2l0aENvbXBvbmVudChvYmplY3Qgdiwgb2JqZWN0IHYyKVxyXG4gICAgICAgIHtcclxuRW50aXR5IGU7XG4gICAgICAgICAgICBDcmVhdGVFbnRpdHkob3V0IGUpO1xyXG4gICAgICAgICAgICBBZGRDb21wb25lbnQoZSwgdik7XHJcbiAgICAgICAgICAgIEFkZENvbXBvbmVudChlLCB2Mik7XHJcbiAgICAgICAgICAgIHJldHVybiBlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRGVsZXRlQWxsRW50aXRpZXNUaGF0RG9Ob3RIYXZlKFR5cGVbXSBjb21wb25lbnRUeXBlcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBhY3MgPSBuZXcgQWNjZXNzb3IoKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgRW50aXR5IENyZWF0ZUVudGl0eShvdXQgRW50aXR5IGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBlbnRpdHlJZE1heCsrO1xyXG4gICAgICAgICAgICBFbnRpdHkgZW50aXR5ID0gbmV3IEVudGl0eSh0aGlzLkVDU0lkLCBlbnRpdHlJZE1heCk7XHJcbiAgICAgICAgICAgIGUgPSBlbnRpdHk7XHJcbiAgICAgICAgICAgIHJldHVybiBlbnRpdHk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgRW50aXR5IENyZWF0ZUVudGl0eSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBlbnRpdHlJZE1heCsrO1xyXG4gICAgICAgICAgICBFbnRpdHkgZW50aXR5ID0gbmV3IEVudGl0eSh0aGlzLkVDU0lkLCBlbnRpdHlJZE1heCk7XHJcbiAgICAgICAgICAgIHJldHVybiBlbnRpdHk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIFByb2Nlc3NvckZsZXg8VDEsIFQyPiBRdWlja1Byb2Nlc3NvckZsZXg8VDEsIFQyPihBY3Rpb248UXVpY2tBY2Nlc3NvclR3bzxUMSwgVDI+PiBwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgUHJvY2Vzc29yRmxleDxUMSwgVDI+IHByb2Nlc3NvckZsZXggPSBuZXcgUHJvY2Vzc29yRmxleDxUMSwgVDI+KHApO1xyXG4gICAgICAgICAgICBRdWlja0FjY2Vzc29yVHdvPFQxLCBUMj4gYWNjZXNzb3IgPSBwcm9jZXNzb3JGbGV4LmFjY2Vzc29yO1xyXG4gICAgICAgICAgICBBY2Nlc3NvciBhY2Nlc3NvcjEgPSBhY2Nlc3Nvci5hY2Nlc3NvcjtcclxuICAgICAgICAgICAgQWRkQWNjZXNzb3IoYWNjZXNzb3IxKTtcclxuICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NvckZsZXg7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgQWRkQWNjZXNzb3IoQWNjZXNzb3IgYWNjZXNzb3IxKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYWNjZXNzb3JzLkFkZChhY2Nlc3NvcjEpO1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8PSBlbnRpdHlJZE1heDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBVcGRhdGVBY2Nlc3NvckVudGl0eShhY2Nlc3NvcjEsIGkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIFVwZGF0ZUFjY2Vzc29yRW50aXR5KEFjY2Vzc29yIGFjY2Vzc29yLCBpbnQgZW50aXR5SWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBFbnRpdHkgZW50aXR5ID0gbmV3IEVudGl0eShFQ1NJZCwgZW50aXR5SWQpO1xyXG4gICAgICAgICAgICBib29sIGJlbG9uZyA9IEhhc0FsbENvbXBzKGFjY2Vzc29yLlR5cGVzTmVjZXNzYXJ5LCBlbnRpdHlJZCkgJiYgSGFzTm9uZU9mVGhlc2VDb21wcyhhY2Nlc3Nvci5UeXBlc1Byb2hpYml0ZWQsIGVudGl0eUlkKTtcclxuICAgICAgICAgICAgYm9vbCBtZW1iZXIgPSBhY2Nlc3Nvci5FbnRpdHlBZGRlZChlbnRpdHkpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGJlbG9uZyAhPSBtZW1iZXIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChiZWxvbmcpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWNjZXNzb3IuU2VsZWN0ZWRFbnRpdGllcy5BZGQoZW50aXR5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKFwiUkVNT1ZFRCBFTlRJVFkgXCIrYWNjZXNzb3IuVHlwZXNOZWNlc3NhcnlbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGFjY2Vzc29yLlNlbGVjdGVkRW50aXRpZXMuUmVtb3ZlKGVudGl0eSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShhY2Nlc3Nvci5FbnRpdHlBZGRlZChlbnRpdHkpK1wiIEJFTE9OR1wiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENsb25lU3RhdGUoQ2xvbmVkU3RhdGUgY3MpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgY29tcHMgPSB0aGlzLmNvbXBzO1xyXG4gICAgICAgICAgICBEaWN0aW9uYXJ5PFR5cGUsIG9iamVjdFtdPiBjb21wczIgPSBjcy5jb21wcztcclxuICAgICAgICAgICAgQ29weShjb21wcywgY29tcHMyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlc3RvcmVTdGF0ZShDbG9uZWRTdGF0ZSBjcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBjb21wcyA9IHRoaXMuY29tcHM7XHJcbiAgICAgICAgICAgIERpY3Rpb25hcnk8VHlwZSwgb2JqZWN0W10+IGNvbXBzMiA9IGNzLmNvbXBzO1xyXG4gICAgICAgICAgICBDb3B5KGNvbXBzMiwgY29tcHMpO1xyXG5cclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPD1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgZW50aXR5SWRNYXg7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGl0ZW0gaW4gYWNjZXNzb3JzKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFVwZGF0ZUFjY2Vzc29yRW50aXR5KGl0ZW0sIGkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgTGlzdDxUeXBlPiBhdXggPSBuZXcgTGlzdDxUeXBlPigpO1xyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgQ29weShEaWN0aW9uYXJ5PFR5cGUsIG9iamVjdFtdPiBmcm9tLCBEaWN0aW9uYXJ5PFR5cGUsIG9iamVjdFtdPiB0bylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGF1eC5DbGVhcigpO1xyXG5cclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGMgaW4gZnJvbSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVHlwZSB0eXBlID0gYy5LZXk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9VTkNPTU1FTlQgVEhJUyBUTyBDSEVDSyBGT1IgUEFSQU1FVEVSTEVTUyBDT05TVFJVQ1RPUlNcclxuICAgICAgICAgICAgICAgIC8vaWYgKHR5cGUuR2V0Q29uc3RydWN0b3IoVHlwZS5FbXB0eVR5cGVzKSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgLy97XHJcbiAgICAgICAgICAgICAgICAvLyAgICBDb25zb2xlLldyaXRlTGluZShcIk5PIFBBUkFNRVRFUkxFU1MgXCIgKyB0eXBlKTtcclxuICAgICAgICAgICAgICAgIC8vfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBhdXguQWRkKHR5cGUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0by5Db250YWluc0tleSh0eXBlKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0by5BZGQodHlwZSwgbmV3IG9iamVjdFszMDBdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciB0b0FycmF5ID0gdG9bdHlwZV07XHJcbiAgICAgICAgICAgICAgICB2YXIgb3JpZ2luID0gYy5WYWx1ZTtcclxuICAgICAgICAgICAgICAgIENvcHkodG8sIHR5cGUsIHRvQXJyYXksIG9yaWdpbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGMgaW4gdG8pIC8vY2hlY2tzIHR5cGVzIGluIHRvLCBzbyBpdCBjYW4gYmUgdGhyb3VnaFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUeXBlIHR5cGUgPSBjLktleTtcclxuICAgICAgICAgICAgICAgIGlmICghYXV4LkNvbnRhaW5zKHR5cGUpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1eC5BZGQodHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvQXJyYXkgPSBjLlZhbHVlOyAvL2FjY2VzcyBpbnZlcnRlZCB3aGVuIGNvbXBhcmVkIHRvIHByZXZpb3VzXHJcbiAgICAgICAgICAgICAgICAgICAgLy92YXIgb3JpZ2luID0gZnJvbVt0eXBlXTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRvQXJyYXkuTGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b0FycmF5W2ldID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShcIlJlbW92aW5nIGVudGl0eVwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgQ29weShEaWN0aW9uYXJ5PFR5cGUsIG9iamVjdFtdPiB0bywgVHlwZSB0eXBlLCBvYmplY3RbXSB0b0FycmF5LCBvYmplY3RbXSBvcmlnaW4pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBBY3Rpb248T2JqZWN0LCBPYmplY3Q+IGNvcHlNZXRob2QgPSBudWxsO1xyXG4gICAgICAgICAgICBDb3B5TWV0aG9kcy5UcnlHZXRWYWx1ZSh0eXBlLCBvdXQgY29weU1ldGhvZCk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG9yaWdpbi5MZW5ndGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9yaWdpbltpXSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0b0FycmF5W2ldICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKFwiUmVtb3ZpbmcgZW50aXR5XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b0FycmF5W2ldID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUodHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRvQXJyYXlbaV0gPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9BcnJheVtpXSA9IEFjdGl2YXRvci5DcmVhdGVJbnN0YW5jZSh0eXBlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29weU1ldGhvZCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3B5TWV0aG9kKG9yaWdpbltpXSwgdG9BcnJheVtpXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vRGVlcENsb25lSGVscGVyLkRlZXBDb3B5UGFydGlhbChvcmlnaW5baV0sIHRvQXJyYXlbaV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCBUIEFkZENvbXBvbmVudDxUPihFbnRpdHkgZSkgd2hlcmUgVCA6IG5ldygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUIHQgPSBuZXcgVCgpO1xyXG4gICAgICAgICAgICBBZGRDb21wb25lbnQoZSwgdCk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFkZENvbXBvbmVudChFbnRpdHkgZSwgb2JqZWN0IHQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUeXBlIHR5cGUgPSB0LkdldFR5cGUoKTtcclxuICAgICAgICAgICAgaWYgKCFjb21wcy5Db250YWluc0tleSh0eXBlKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY29tcHMuQWRkKHR5cGUsIG5ldyBvYmplY3RbMzAwXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29tcHNbdHlwZV1bZS5pZF0gPSB0O1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiBhY2Nlc3NvcnMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFVwZGF0ZUFjY2Vzc29yRW50aXR5KGl0ZW0sIGUuaWQpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVtb3ZlQ29tcG9uZW50KEVudGl0eSBlLCBvYmplY3QgdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFR5cGUgdHlwZSA9IHQuR2V0VHlwZSgpO1xyXG4gICAgICAgICAgICBpZiAoIWNvbXBzLkNvbnRhaW5zS2V5KHR5cGUpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjb21wcy5BZGQodHlwZSwgbmV3IG9iamVjdFszMDBdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb21wc1t0eXBlXVtlLmlkXSA9IG51bGw7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBpdGVtIGluIGFjY2Vzc29ycylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVXBkYXRlQWNjZXNzb3JFbnRpdHkoaXRlbSwgZS5pZCk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGJvb2wgSGFzQWxsQ29tcG9uZW50cyhFbnRpdHkgZSwgVHlwZVtdIHR5cGVzTmVjZXNzYXJ5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IGlkID0gZS5pZDtcclxuICAgICAgICAgICAgcmV0dXJuIEhhc0FsbENvbXBzKHR5cGVzTmVjZXNzYXJ5LCBpZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGJvb2wgSGFzQWxsQ29tcHMoVHlwZVtdIHR5cGVzTmVjZXNzYXJ5LCBpbnQgaWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgdHlwZSBpbiB0eXBlc05lY2Vzc2FyeSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjb21wcy5Db250YWluc0tleSh0eXBlKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNvbXBzW3R5cGVdW2lkXSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgYm9vbCBIYXNOb25lT2ZUaGVzZUNvbXBzKFR5cGVbXSB0eXBlc1Byb2hpYml0ZWQsIGludCBpZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlc1Byb2hpYml0ZWQgPT0gbnVsbCkgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciB0eXBlIGluIHR5cGVzUHJvaGliaXRlZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbXBzLkNvbnRhaW5zS2V5KHR5cGUpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb21wc1t0eXBlXVtpZF0gIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgVCBHZXRDb21wb25lbnQ8VD4oRW50aXR5IGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUeXBlIHR5cGUgPSB0eXBlb2YoVCk7XHJcbiAgICAgICAgICAgIGlmICghY29tcHMuQ29udGFpbnNLZXkodHlwZSkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vY29tcHMuQWRkKHR5cGUsIG5ldyBvYmplY3RbMzAwXSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmYXVsdChUKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gKFQpY29tcHNbdHlwZV1bZS5pZF07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5FQ1Ncclxue1xyXG4gICAgcHVibGljIHN0cnVjdCBFbnRpdHkgOiBJRXF1YXRhYmxlPEVudGl0eT5cclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIEVudGl0eSBOb25lID0gbmV3IEVudGl0eSgtMSwtMSk7XHJcbiAgICAgICAgcmVhZG9ubHkgaW50ZXJuYWwgaW50IGVjcztcclxuICAgICAgICByZWFkb25seSBpbnRlcm5hbCBpbnQgaWQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyBFbnRpdHkoaW50IGVjcywgaW50IGlkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5lY3MgPSBlY3M7XHJcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIEV4aXN0KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBpZCAhPSAtMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIEVxdWFscyhFbnRpdHkgb3RoZXIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gb3RoZXIuaWQgPT0gdGhpcy5pZCAmJiBvdGhlci5lY3MgPT0gdGhpcy5lY3M7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBjbGFzcyBFeHRlbnNpb25NZXRob2RzXHJcbiAgICB7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBSZW1vdmVDb21wb25lbnQodGhpcyBFbnRpdHkgZSwgb2JqZWN0IGNvbXApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBFQ1NNYW5hZ2VyLkdldEluc3RhbmNlKGUpLlJlbW92ZUNvbXBvbmVudChlLCBjb21wKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgVCBBZGRDb21wb25lbnQ8VD4odGhpcyBFbnRpdHkgZSkgd2hlcmUgVDogbmV3KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBFQ1NNYW5hZ2VyLkdldEluc3RhbmNlKGUpLkFkZENvbXBvbmVudDxUPihlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIEFkZENvbXBvbmVudCh0aGlzIEVudGl0eSBlLCBvYmplY3QgY29tcClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIEVDU01hbmFnZXIuR2V0SW5zdGFuY2UoZSkuQWRkQ29tcG9uZW50KGUsIGNvbXApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwdWJsaWMgc3RhdGljIFQgR2V0Q29tcG9uZW50PFQ+KHRoaXMgRW50aXR5IGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gRUNTTWFuYWdlci5HZXRJbnN0YW5jZShlKS5HZXRDb21wb25lbnQ8VD4oZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5FQ1Ncclxue1xyXG4gICAgcHVibGljIGNsYXNzIFByb2Nlc3NvckZsZXg8VDEsIFQyPlxyXG4gICAge1xyXG4gICAgICAgIHByaXZhdGUgQWN0aW9uPFF1aWNrQWNjZXNzb3JUd288VDEsIFQyPj4gcDtcclxuICAgICAgICBpbnRlcm5hbCBRdWlja0FjY2Vzc29yVHdvPFQxLCBUMj4gYWNjZXNzb3I7XHJcblxyXG4gICAgICAgIHB1YmxpYyBQcm9jZXNzb3JGbGV4KEFjdGlvbjxRdWlja0FjY2Vzc29yVHdvPFQxLCBUMj4+IHApXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnAgPSBwO1xyXG4gICAgICAgICAgICBhY2Nlc3NvciA9IG5ldyBRdWlja0FjY2Vzc29yVHdvPFQxLCBUMj4oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJ1bigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwKGFjY2Vzc29yKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIFByb2Nlc3NvckFjY2Vzc29yXHJcbiAgICB7XHJcbiAgICAgICAgcHJpdmF0ZSBBY3Rpb248QWNjZXNzb3I+IHA7XHJcblxyXG4gICAgICAgIEFjY2Vzc29yIGE7XHJcblxyXG4gICAgICAgIHB1YmxpYyBQcm9jZXNzb3JBY2Nlc3NvcihBY3Rpb248QWNjZXNzb3I+IHAsIEFjY2Vzc29yIGEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnAgPSBwO1xyXG4gICAgICAgICAgICB0aGlzLmEgPSBhO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgUnVuKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHAoYSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFBpZHJvaC5CYXNlVXRpbHM7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5UZXh0UmVuZGVyaW5nXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBUZXh0V29ybGRcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgUGFsZXR0ZSBwYWxldHRlID0gRGVmYXVsdFBhbGV0dGVzLkM0S2lyb0themU7XHJcbiAgICAgICAgTGlzdDxUZXh0RW50aXR5PiBhY3RpdmVBZ2VudHMgPSBuZXcgTGlzdDxUZXh0RW50aXR5PigpO1xyXG4gICAgICAgIExpc3Q8VGV4dEVudGl0eT4gZnJlZUJvYXJkcyA9IG5ldyBMaXN0PFRleHRFbnRpdHk+KCk7XHJcbiAgICAgICAgTGlzdDxUZXh0QW5pbWF0aW9uPiBhbmltYXRpb25zID0gbmV3IExpc3Q8VGV4dEFuaW1hdGlvbj4oKTtcclxuICAgICAgICBwdWJsaWMgVGV4dEJvYXJkIG1haW5Cb2FyZDtcclxuICAgICAgICBpbnQgbGF0ZXN0SWQgPSAtMTtcclxuXHJcbiAgICAgICAgcHVibGljIFQgQWRkQW5pbWF0aW9uPFQ+KFQgdGEpIHdoZXJlIFQgOiBUZXh0QW5pbWF0aW9uXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBhbmltYXRpb25zLkFkZCh0YSk7XHJcbiAgICAgICAgICAgIHRhLlJlZ2lzdGVyTGlzdHMoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRhO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgSW5pdChpbnQgd2lkdGgsIGludCBoZWlnaHQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBtYWluQm9hcmQgPSBuZXcgVGV4dEJvYXJkKHdpZHRoLCBoZWlnaHQpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXcoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbWFpbkJvYXJkLlJlc2V0KCk7XHJcbiAgICAgICAgICAgIERyYXdDaGlsZHJlbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhd0NoaWxkcmVuKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYWN0aXZlQWdlbnRzLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGFjdGl2ZUFnZW50c1tpXS5SZXNldEFuaW1hdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGFuaW0gaW4gYW5pbWF0aW9ucylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBhbmltLk1vZGlmeShhY3RpdmVBZ2VudHNbaV0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGFjdGl2ZUFnZW50c1tpXS5mcmVlSWZJZGxlICYmICFhY3RpdmVBZ2VudHNbaV0uYW5pbWF0aW5nKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGZyZWVCb2FyZHMuQWRkKGFjdGl2ZUFnZW50c1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlQWdlbnRzLlJlbW92ZShhY3RpdmVBZ2VudHNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBtYWluQm9hcmQuSW5zZXJ0KGFjdGl2ZUFnZW50c1tpXS5BbmltYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIFRleHRFbnRpdHkgR2V0RnJlZUVudGl0eShpbnQgdywgaW50IGgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBUZXh0RW50aXR5IHRlO1xyXG4gICAgICAgICAgICBpZiAoZnJlZUJvYXJkcy5Db3VudCA+IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRlID0gZnJlZUJvYXJkc1tmcmVlQm9hcmRzLkNvdW50IC0gMV07XHJcbiAgICAgICAgICAgICAgICBmcmVlQm9hcmRzLlJlbW92ZUF0KGZyZWVCb2FyZHMuQ291bnQgLSAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRlID0gbmV3IFRleHRFbnRpdHkoKTtcclxuICAgICAgICAgICAgICAgIHRlLmlkID0gKytsYXRlc3RJZDtcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGFjdGl2ZUFnZW50cy5BZGQodGUpO1xyXG4gICAgICAgICAgICB0ZS5mcmVlSWZJZGxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRlLlNldFNpemUodywgaCk7XHJcbiAgICAgICAgICAgIHRlLlJlc2V0RnVsbCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVGV4dEVudGl0eSBHZXRUZW1wRW50aXR5KGludCB3LCBpbnQgaClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciB0ZSA9IEdldEZyZWVFbnRpdHkodywgaCk7XHJcbiAgICAgICAgICAgIHRlLmZyZWVJZklkbGUgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm4gdGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBBZHZhbmNlVGltZShmbG9hdCB2KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGFuaW0gaW4gYW5pbWF0aW9ucylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYW5pbS5VcGRhdGUodik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFRyeUVuZEFuaW1hdGlvbnMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGFuaW0gaW4gYW5pbWF0aW9ucylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYW5pbS5UcnlFbmQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBGcmVlKExpc3Q8VGV4dEVudGl0eT4gZW50aXRpZXMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZnJlZUJvYXJkcy5BZGRSYW5nZShlbnRpdGllcyk7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBpdGVtIGluIGVudGl0aWVzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBhY3RpdmVBZ2VudHMuUmVtb3ZlKGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgYm9vbCBJc0RvbmUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGFuaW0gaW4gYW5pbWF0aW9ucylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFhbmltLklzRG9uZSgpKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBUZXh0RW50aXR5XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGludCBpZDtcclxuICAgICAgICBwdWJsaWMgVGV4dEJvYXJkIE9yaWdpbjtcclxuICAgICAgICBwdWJsaWMgVGV4dEJvYXJkIEFuaW1hdGlvbjtcclxuICAgICAgICBwdWJsaWMgYm9vbCBmcmVlSWZJZGxlID0gZmFsc2U7XHJcbiAgICAgICAgaW50ZXJuYWwgYm9vbCBhbmltYXRpbmc7XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgSGVpZ2h0IHsgZ2V0IHsgcmV0dXJuIE9yaWdpbi5IZWlnaHQ7IH0gfVxyXG4gICAgICAgIHB1YmxpYyBpbnQgV2lkdGggeyBnZXQgeyByZXR1cm4gT3JpZ2luLldpZHRoOyB9IH1cclxuXHJcbiAgICAgICAgcHVibGljIFRleHRBbmltYXRpb24uQmFzZURhdGEgQW5pbUJhc2UoZmxvYXQgbGVuZ3RoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBUZXh0QW5pbWF0aW9uLkJhc2VEYXRhKGxlbmd0aCwgMCwgaWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgVmVjdG9yMkQgR2V0UG9zaXRpb24oKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIE9yaWdpbi5Qb3NpdGlvbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgUmVzZXRBbmltYXRpb24oKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYW5pbWF0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIEFuaW1hdGlvbi5TZXQoT3JpZ2luKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgUmVzZXRGdWxsKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE9yaWdpbi5SZXNldEludmlzaWJsZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBTZXRQb3NpdGlvbihpbnQgeCwgaW50IHkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBPcmlnaW4uUG9zaXRpb24gPSBuZXcgVmVjdG9yMkQoeCx5KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgU2V0UG9zaXRpb24oVmVjdG9yMkQgdmVjdG9yMkQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBPcmlnaW4uUG9zaXRpb24gPSB2ZWN0b3IyRDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgU2V0UG9zaXRpb24oUG9pbnQyRCBwb2ludClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE9yaWdpbi5Qb3NpdGlvbiA9IG5ldyBWZWN0b3IyRChwb2ludC5YLCBwb2ludC5ZKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgU2V0U2l6ZShpbnQgdywgaW50IGgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoT3JpZ2luID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIE9yaWdpbiA9IG5ldyBUZXh0Qm9hcmQodywgaCk7XHJcbiAgICAgICAgICAgICAgICBBbmltYXRpb24gPSBuZXcgVGV4dEJvYXJkKHcsIGgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIE9yaWdpbi5SZXNpemUodywgaCk7XHJcbiAgICAgICAgICAgIEFuaW1hdGlvbi5SZXNpemUodywgaCk7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgRGVsYXlzQW5pbWF0aW9uIDogVGV4dEFuaW1hdGlvblxyXG4gICAge1xyXG4gICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSB2b2lkIFJlcXVlc3RSZWdpc3Rlckxpc3RzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBEZWxheShmbG9hdCB2KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgQWRkKG5ldyBCYXNlRGF0YSh2LCAwLCAtMSkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgcHVibGljIGNsYXNzIFBvc2l0aW9uQW5pbWF0aW9uIDogVGV4dEFuaW1hdGlvbjxQb3NpdGlvbkFuaW1hdGlvbi5Qb3NpdGlvbkRhdGE+XHJcbiAgICB7XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIE1vZGlmeShUZXh0RW50aXR5IGVudGl0eSwgUG9zaXRpb25EYXRhIG1haW5EYXRhLCBmbG9hdCBwcm9ncmVzcywgZmxvYXQgbGVuZ3RoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5Nb2RpZnkoZW50aXR5LCBtYWluRGF0YSwgcHJvZ3Jlc3MsIGxlbmd0aCk7XHJcbiAgICAgICAgICAgIFRleHRCb2FyZCB0YXJnZXQgPSBlbnRpdHkuQW5pbWF0aW9uO1xyXG4gICAgICAgICAgICBpZiAobWFpbkRhdGEucGVybWFuZW50KVxyXG4gICAgICAgICAgICAgICAgdGFyZ2V0ID0gZW50aXR5Lk9yaWdpbjtcclxuICAgICAgICAgICAgdGFyZ2V0LlBvc2l0aW9uID0gVmVjdG9yMkQuSW50ZXJwb2xhdGVSb3VuZGVkKG1haW5EYXRhLnN0YXJ0UG9zaXRpb24sIG1haW5EYXRhLmVuZFBvc2l0aW9uLCBwcm9ncmVzcyAvIGxlbmd0aCk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0cnVjdCBQb3NpdGlvbkRhdGFcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHB1YmxpYyByZWFkb25seSBib29sIHBlcm1hbmVudDtcclxuICAgICAgICAgICAgcHVibGljIHJlYWRvbmx5IFZlY3RvcjJEIHN0YXJ0UG9zaXRpb24sIGVuZFBvc2l0aW9uO1xyXG5cclxuICAgICAgICAgICAgcHVibGljIFBvc2l0aW9uRGF0YShWZWN0b3IyRCBzdGFydFBvc2l0aW9uLCBWZWN0b3IyRCBlbmRQb3NpdGlvbiwgYm9vbCBwZXJtID0gZmFsc2UpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRQb3NpdGlvbiA9IHN0YXJ0UG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVuZFBvc2l0aW9uID0gZW5kUG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBlcm1hbmVudCA9IHBlcm07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFic3RyYWN0IGNsYXNzIFRleHRBbmltYXRpb248VD4gOiBUZXh0QW5pbWF0aW9uXHJcbiAgICB7XHJcbiAgICAgICAgcHJvdGVjdGVkIExpc3Q8VD4gbWFpbkRhdGEgPSBuZXcgTGlzdDxUPigpO1xyXG4gICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSB2b2lkIFJlcXVlc3RSZWdpc3Rlckxpc3RzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuUmVnaXN0ZXJMaXN0KG1haW5EYXRhKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEFkZChCYXNlRGF0YSBiYXNlRGF0YSwgVCBtYWluRClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuQWRkKGJhc2VEYXRhKTtcclxuICAgICAgICAgICAgbWFpbkRhdGEuQWRkKG1haW5EKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBvdmVycmlkZSB2b2lkIE1vZGlmeShUZXh0RW50aXR5IGVudGl0eSwgaW50IGluZGV4LCBmbG9hdCBwcm9ncmVzcywgZmxvYXQgbGVuZ3RoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgTW9kaWZ5KGVudGl0eSwgbWFpbkRhdGFbaW5kZXhdLCBwcm9ncmVzcywgbGVuZ3RoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgTW9kaWZ5KFRleHRFbnRpdHkgZW50aXR5LCBUIG1haW5EYXRhLCBmbG9hdCBwcm9ncmVzcywgZmxvYXQgbGVuZ3RoKVxyXG4gICAgICAgIHtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vaW50ZXJuYWwgb3ZlcnJpZGUgdm9pZCBFeGVjdXRlKGludCBpbmRleCwgQmFzZURhdGEgYmFzZURhdGEpXHJcbiAgICAgICAgLy97XHJcbiAgICAgICAgLy8gICAgdGhpcy5FeGVjdXRlKG1haW5EYXRhW2luZGV4XSwgYmFzZURhdGEpO1xyXG4gICAgICAgIC8vfVxyXG5cclxuICAgICAgICAvL3B1YmxpYyBhYnN0cmFjdCB2b2lkIEV4ZWN1dGUoVCBtYWluRGF0YSwgQmFzZURhdGEgYmFzZURhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhYnN0cmFjdCBjbGFzcyBUZXh0QW5pbWF0aW9uXHJcbiAgICB7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdHJ1Y3QgQmFzZURhdGFcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHB1YmxpYyByZWFkb25seSBmbG9hdCBsZW5ndGg7XHJcbiAgICAgICAgICAgIHB1YmxpYyByZWFkb25seSBmbG9hdCBwcm9ncmVzcztcclxuICAgICAgICAgICAgcHVibGljIHJlYWRvbmx5IGludCB0YXJnZXQ7XHJcblxyXG4gICAgICAgICAgICBwdWJsaWMgQmFzZURhdGEoZmxvYXQgbGVuZ3RoLCBmbG9hdCBwcm9ncmVzcywgaW50IHRhcmdldClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sZW5ndGggPSBsZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByb2dyZXNzID0gcHJvZ3Jlc3M7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBMaXN0PGZsb2F0PiBsZW5ndGggPSBuZXcgTGlzdDxmbG9hdD4oKTtcclxuICAgICAgICBMaXN0PGZsb2F0PiBwcm9ncmVzcyA9IG5ldyBMaXN0PGZsb2F0PigpO1xyXG4gICAgICAgIExpc3Q8aW50PiB0YXJnZXRzID0gbmV3IExpc3Q8aW50PigpO1xyXG4gICAgICAgIExpc3Q8SUxpc3Q+IGxpc3RzID0gbmV3IExpc3Q8SUxpc3Q+KCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlZ2lzdGVyTGlzdHMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbGlzdHMuQWRkKGxlbmd0aCk7XHJcbiAgICAgICAgICAgIGxpc3RzLkFkZChwcm9ncmVzcyk7XHJcbiAgICAgICAgICAgIGxpc3RzLkFkZCh0YXJnZXRzKTtcclxuICAgICAgICAgICAgUmVxdWVzdFJlZ2lzdGVyTGlzdHMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByb3RlY3RlZCBhYnN0cmFjdCB2b2lkIFJlcXVlc3RSZWdpc3Rlckxpc3RzKCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVwZGF0ZShmbG9hdCBkZWx0YSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgcHJvZ3Jlc3MuQ291bnQ7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcHJvZ3Jlc3NbaV0gKz0gZGVsdGE7XHJcbiAgICAgICAgICAgICAgICBpZiAocHJvZ3Jlc3NbaV0gPj0gbGVuZ3RoW2ldKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb2dyZXNzW2ldID0gbGVuZ3RoW2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vRXhlY3V0ZShpLCBuZXcgQmFzZURhdGEobGVuZ3RoW2ldLHByb2dyZXNzW2ldLCB0YXJnZXRzW2ldKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vaW50ZXJuYWwgYWJzdHJhY3Qgdm9pZCBFeGVjdXRlKGludCBpbmRleCwgQmFzZURhdGEgYmFzZURhdGEpO1xyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIEFkZChCYXNlRGF0YSBiZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHByb2dyZXNzLkFkZChiZC5wcm9ncmVzcyk7XHJcbiAgICAgICAgICAgIHRhcmdldHMuQWRkKGJkLnRhcmdldCk7XHJcbiAgICAgICAgICAgIGxlbmd0aC5BZGQoYmQubGVuZ3RoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBib29sIElzRG9uZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiBsaXN0cylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uQ291bnQgIT0gcHJvZ3Jlc3MuQ291bnQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHMgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIHMuVHJpbSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBwcm9ncmVzcy5Db3VudCA9PSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBFbmRUYXNrKGludCBpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGwgaW4gbGlzdHMpXHJcbiAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICBsLlJlbW92ZUF0KGkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIFJlZ2lzdGVyTGlzdChJTGlzdCBtYWluRGF0YSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGxpc3RzLkFkZChtYWluRGF0YSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIE1vZGlmeShUZXh0RW50aXR5IGEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHByb2dyZXNzLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChhLmlkID09IHRhcmdldHNbaV0pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgTW9kaWZ5KGEsIGksIHByb2dyZXNzW2ldLCBsZW5ndGhbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGEuYW5pbWF0aW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZpcnR1YWwgdm9pZCBNb2RpZnkoVGV4dEVudGl0eSBlbnRpdHksIGludCBpbmRleCwgZmxvYXQgcHJvZ3Jlc3MsIGZsb2F0IGxlbmd0aClcclxuICAgICAgICB7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIFRyeUVuZCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHByb2dyZXNzLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChwcm9ncmVzc1tpXSA+PSBsZW5ndGhbaV0pXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgRW5kVGFzayhpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLlRleHRSZW5kZXJpbmdcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFBhbGV0dGVcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgc3RyaW5nW10gSHRtbENvbG9ycztcclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyBQYWxldHRlKHBhcmFtcyBzdHJpbmdbXSBjb2xvcnMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBIdG1sQ29sb3JzID0gY29sb3JzO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgRGVmYXVsdFBhbGV0dGVzXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBQYWxldHRlIEM0S2lyb0themUgPSBuZXcgUGFsZXR0ZShcIiMzMzJjNTBcIiwgXCIjNDY4NzhmXCIsIFwiIzk0ZTM0NFwiLCBcIiNlMmYzZTRcIik7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBQYWxldHRlIEM0UmVhZGVyID0gbmV3IFBhbGV0dGUoXCIjMjYyNjI2XCIsIFwiIzhiOGNiYVwiLCBcIiM4YmJhOTFcIiwgXCIjNjQ5ZjhkXCIpO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgUGFsZXR0ZSBDNE5vdmVsID0gbmV3IFBhbGV0dGUoXCIjMjYyNjI2XCIsIFwiIzM0MmQ0MVwiLCBcIiNiOGI4YjhcIiwgXCIjOGI4Y2JhXCIpO1xyXG4gICAgICAgIHB1YmxpYyBjb25zdCBpbnQgQzRCbGFjayA9IDA7XHJcbiAgICAgICAgcHVibGljIGNvbnN0IGludCBDNEJsYWNrTmV1dHJhbCA9IDE7XHJcbiAgICAgICAgcHVibGljIGNvbnN0IGludCBDNFdoaXRlTmV1dHJhbCA9IDI7XHJcbiAgICAgICAgcHVibGljIGNvbnN0IGludCBDNFdoaXRlID0gMztcclxuXHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLlRleHRSZW5kZXJpbmcuR2FtZVNjcmVlblxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgS2V5Ym9hcmRJT1xyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PGludD4gZG93blVuaWNvZGVzID0gbmV3IExpc3Q8aW50PigpO1xyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFBpZHJvaC5CYXNlVXRpbHM7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5UZXh0UmVuZGVyaW5nLkdhbWVTY3JlZW5cclxue1xyXG4gICAgcHVibGljIHN0cnVjdCBNb3VzZUhvdmVyXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIFJlY3QgcmVjdDtcclxuICAgICAgICBwdWJsaWMgaW50IHR5cGU7XHJcbiAgICAgICAgcHVibGljIGludCBpZDtcclxuXHJcbiAgICAgICAgcHVibGljIE1vdXNlSG92ZXIoUmVjdCByZWN0LCBpbnQgdHlwZSwgaW50IGlkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5yZWN0ID0gcmVjdDtcclxuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcclxuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgTW91c2VIb3Zlck1hbmFnZXJcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgTGlzdDxNb3VzZUhvdmVyPiBtb3VzZUhvdmVycyA9IG5ldyBMaXN0PE1vdXNlSG92ZXI+KCk7XHJcbiAgICAgICAgcHVibGljIExpc3Q8TW91c2VIb3Zlcj4gbW91c2VIb3ZlcnNBY3RpdmUgPSBuZXcgTGlzdDxNb3VzZUhvdmVyPigpO1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PE1vdXNlSG92ZXI+IG1vdXNlSG92ZXJzQ2xpY2tEb3duID0gbmV3IExpc3Q8TW91c2VIb3Zlcj4oKTtcclxuICAgICAgICBwdWJsaWMgTW91c2VJTyBtb3VzZUlPO1xyXG5cclxuICAgICAgICBwdWJsaWMgTW91c2VIb3Zlck1hbmFnZXIoTW91c2VJTyBtb3VzZUlPKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5tb3VzZUlPID0gbW91c2VJTztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVwZGF0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBtb3VzZUhvdmVyc0FjdGl2ZS5DbGVhcigpO1xyXG4gICAgICAgICAgICBtb3VzZUhvdmVyc0NsaWNrRG93bi5DbGVhcigpO1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiBtb3VzZUhvdmVycylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0ucmVjdC5Db250YWlucyhtb3VzZUlPLnBvcykpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW91c2VIb3ZlcnNBY3RpdmUuQWRkKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtb3VzZUlPLm1vdXNlQ2xpY2tIYXBwZW4pXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb3VzZUhvdmVyc0NsaWNrRG93bi5BZGQoaXRlbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbn1cclxuIiwidXNpbmcgUGlkcm9oLkJhc2VVdGlscztcclxudXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLlRleHRSZW5kZXJpbmcuR2FtZVNjcmVlblxyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgVW5pY29kZVJlbWFwXHJcbiAgICB7XHJcblxyXG4gICAgICAgIERpY3Rpb25hcnk8aW50LCBpbnQ+IHJlbWFwcyA9IG5ldyBEaWN0aW9uYXJ5PGludCwgaW50PigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgVW5pY29kZVJlbWFwKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJlbWFwcy5BZGQoVW5pY29kZS5rZXlVcCwgJ3cnKTtcclxuICAgICAgICAgICAgcmVtYXBzLkFkZChVbmljb2RlLmtleURvd24sICdzJyk7XHJcbiAgICAgICAgICAgIHJlbWFwcy5BZGQoVW5pY29kZS5rZXlMZWZ0LCAnYScpO1xyXG4gICAgICAgICAgICByZW1hcHMuQWRkKFVuaWNvZGUua2V5UmlnaHQsICdkJyk7XHJcblxyXG4gICAgICAgICAgICByZW1hcHMuQWRkKFVuaWNvZGUuRW50ZXIsIFVuaWNvZGUuU3BhY2UpO1xyXG5cclxuICAgICAgICAgICAgcmVtYXBzLkFkZCgnaScsICcxJyk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGludCBSZW1hcChpbnQgdW5pY29kZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCByZXN1bHQ7XHJcbiAgICAgICAgICAgIGlmIChyZW1hcHMuVHJ5R2V0VmFsdWUodW5pY29kZSwgb3V0IHJlc3VsdCkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHVuaWNvZGU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFBpZHJvaC5CYXNlVXRpbHM7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guVGV4dFJlbmRlcmluZ1xyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgVGV4dEJvYXJkXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGNvbnN0IGNoYXIgTk9DSEFOR0VDSEFSID0gKGNoYXIpMTtcclxuICAgICAgICBwdWJsaWMgY29uc3QgY2hhciBJTlZJU0lCTEVDSEFSID0gKGNoYXIpMjtcclxuICAgICAgICBwdWJsaWMgY29uc3QgaW50IE5PQ0hBTkdFQ09MT1IgPSAtMjtcclxuICAgICAgICBwdWJsaWMgY29uc3QgaW50IElOVklTSUJMRUNPTE9SID0gLTE7XHJcbiAgICAgICAgY2hhclssXSBjaGFycztcclxuICAgICAgICBwdWJsaWMgaW50WyxdIFRleHRDb2xvciB7IGdldDsgcHJpdmF0ZSBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgaW50WyxdIEJhY2tDb2xvciB7IGdldDsgcHJpdmF0ZSBzZXQ7IH1cclxuICAgICAgICAvL1N0cmluZ0J1aWxkZXIgc3RyaW5nQnVpbGRlciA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7XHJcbiAgICAgICAgaW50IGN1cnNvclggPSAwO1xyXG4gICAgICAgIGludCBjdXJzb3JZID0gMDtcclxuICAgICAgICBwdWJsaWMgVmVjdG9yMkQgUG9zaXRpb24geyBnZXQ7IHNldDsgfVxyXG5cclxuXHJcbiAgICAgICAgcHVibGljIFRleHRCb2FyZChpbnQgd2lkdGgsIGludCBoZWlnaHQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL1NldE1heFNpemUod2lkdGgsIGhlaWdodCk7XHJcbiAgICAgICAgICAgIFJlc2l6ZSh3aWR0aCwgaGVpZ2h0KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXdPbkNlbnRlcihzdHJpbmcgbWVzc2FnZSwgaW50IGNvbG9yLCBpbnQgeE9mZiA9IDAsIGludCB5T2ZmID0gMCwgYm9vbCBhbGlnblN0cmluZyA9IHRydWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgeCA9IChXaWR0aCkgLyAyO1xyXG4gICAgICAgICAgICBpZiAoYWxpZ25TdHJpbmcpIHggLT0gbWVzc2FnZS5MZW5ndGggLyAyO1xyXG4gICAgICAgICAgICBpbnQgeSA9IEhlaWdodCAvIDI7XHJcbiAgICAgICAgICAgIERyYXcobWVzc2FnZSwgeCArIHhPZmYsIHkgKyB5T2ZmLCBjb2xvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3T25DZW50ZXJIb3Jpem9udGFsKHN0cmluZyBtZXNzYWdlLCBpbnQgY29sb3IsIGludCB4T2ZmID0gMCwgaW50IHkgPSAwLCBib29sIGFsaWduU3RyaW5nID0gdHJ1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCB4ID0gKFdpZHRoKSAvIDI7XHJcbiAgICAgICAgICAgIGlmIChhbGlnblN0cmluZykgeCAtPSBtZXNzYWdlLkxlbmd0aCAvIDI7XHJcbiAgICAgICAgICAgIERyYXcobWVzc2FnZSwgeCArIHhPZmYsIHksIGNvbG9yKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgU2V0TWF4U2l6ZShpbnQgd2lkdGgsIGludCBoZWlnaHQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjaGFycyA9IG5ldyBjaGFyW3dpZHRoLCBoZWlnaHRdO1xyXG4gICAgICAgICAgICBUZXh0Q29sb3IgPSBuZXcgaW50W3dpZHRoLCBoZWlnaHRdO1xyXG4gICAgICAgICAgICBCYWNrQ29sb3IgPSBuZXcgaW50W3dpZHRoLCBoZWlnaHRdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgUmVzZXQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRHJhd1JlcGVhdGVkKCcgJywgMCwgMCwgV2lkdGgsIEhlaWdodCwgMCwgMCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBSZXNldEludmlzaWJsZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBEcmF3UmVwZWF0ZWQoSU5WSVNJQkxFQ0hBUiwgMCwgMCwgV2lkdGgsIEhlaWdodCwgSU5WSVNJQkxFQ09MT1IsIElOVklTSUJMRUNPTE9SKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgaW50IFdpZHRoIHsgZ2V0OyBwcml2YXRlIHNldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBJbnNlcnQoVGV4dEJvYXJkIHNlY29uZEJvYXJkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzZWNvbmRCb2FyZC5XaWR0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IHNlY29uZEJvYXJkLkhlaWdodDsgaisrKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGludCB4ID0gKGludClzZWNvbmRCb2FyZC5Qb3NpdGlvbi5YICsgaTtcclxuICAgICAgICAgICAgICAgICAgICBpbnQgeSA9IChpbnQpc2Vjb25kQm9hcmQuUG9zaXRpb24uWSArIGo7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHggPCAwIHx8IHkgPCAwKSBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoeCA+PSBXaWR0aCB8fCB5ID49IEhlaWdodCkgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlY29uZEJvYXJkLmNoYXJzW2ksIGpdICE9IElOVklTSUJMRUNIQVIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJzW3gsIHldID0gc2Vjb25kQm9hcmQuY2hhcnNbaSwgal07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlY29uZEJvYXJkLlRleHRDb2xvcltpLCBqXSAhPSBJTlZJU0lCTEVDT0xPUilcclxuICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yW3gsIHldID0gc2Vjb25kQm9hcmQuVGV4dENvbG9yW2ksIGpdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWNvbmRCb2FyZC5CYWNrQ29sb3JbaSwgal0gIT0gSU5WSVNJQkxFQ09MT1IpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tDb2xvclt4LCB5XSA9IHNlY29uZEJvYXJkLkJhY2tDb2xvcltpLCBqXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBEcmF3SG9yaXpvbnRhbExpbmUoY2hhciBjLCBpbnQgeSwgaW50IGNvbG9yKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRHJhd1JlcGVhdGVkKGMsIDAsIHksIFdpZHRoLCAxLCBjb2xvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIERyYXdSZWN0KGNoYXIgYywgaW50IHgsIGludCB5LCBpbnQgdywgaW50IGgsIGludCB0ZXh0Q29sb3IsIGludCBiYWNrQ29sb3IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBEcmF3UmVwZWF0ZWQoYywgeCwgICAgICB5LCAgIDEsIGgsIHRleHRDb2xvciwgYmFja0NvbG9yKTtcclxuICAgICAgICAgICAgRHJhd1JlcGVhdGVkKGMsIHgrdy0xLCAgeSwgICAxLCBoLCB0ZXh0Q29sb3IsIGJhY2tDb2xvcik7XHJcbiAgICAgICAgICAgIERyYXdSZXBlYXRlZChjLCB4LCAgICAgIHksICAgdywgMSwgdGV4dENvbG9yLCBiYWNrQ29sb3IpO1xyXG4gICAgICAgICAgICBEcmF3UmVwZWF0ZWQoYywgeCwgICAgICB5K2gtMSwgdywgMSwgdGV4dENvbG9yLCBiYWNrQ29sb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGludCBIZWlnaHQgeyBnZXQ7IHByaXZhdGUgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGludCBDdXJzb3JYXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBnZXQgeyByZXR1cm4gY3Vyc29yWDsgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY3Vyc29yWCA9IHZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHB1YmxpYyBpbnQgQ3Vyc29yWSB7IGdldCB7IHJldHVybiBjdXJzb3JZOyB9XHJcbiAgICAgICAgICAgIHNldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjdXJzb3JZID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXdPbmVEaWdpdChpbnQgaSwgaW50IHgsIGludCB5LCBpbnQgY29sb3IgPSBOT0NIQU5HRUNPTE9SLCBpbnQgYmFja2dyb3VuZCA9IE5PQ0hBTkdFQ09MT1IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjaGFyIGMgPSAoY2hhcikoaSArICcwJyk7XHJcbiAgICAgICAgICAgIERyYXdDaGFyKGMsIHgsIHksIGNvbG9yLCBiYWNrZ3JvdW5kKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXdUd29EaWdpdHMoaW50IGksIGludCB4LCBpbnQgeSwgaW50IGNvbG9yID0gTk9DSEFOR0VDT0xPUiwgaW50IGJhY2tncm91bmQgPSBOT0NIQU5HRUNPTE9SKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRHJhd09uZURpZ2l0KGkvMTAseCx5LGNvbG9yLGJhY2tncm91bmQpO1xyXG4gICAgICAgICAgICBEcmF3T25lRGlnaXQoaSAlMTAsIHgrMSwgeSwgY29sb3IsIGJhY2tncm91bmQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgYm9vbCBTYW1lQXMoVGV4dEJvYXJkIHRleHRCb2FyZCwgaW50IHgsIGludCB5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hhcnNbeCwgeV0gPT0gdGV4dEJvYXJkLmNoYXJzW3gsIHldXHJcbiAgICAgICAgICAgICAgICAmJiB0aGlzLkJhY2tDb2xvclt4LHldID09IHRleHRCb2FyZC5CYWNrQ29sb3JbeCx5XVxyXG4gICAgICAgICAgICAgICAgJiYgdGhpcy5UZXh0Q29sb3JbeCx5XSA9PSB0ZXh0Qm9hcmQuVGV4dENvbG9yW3gseV07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIENvcHkoVGV4dEJvYXJkIHRleHRCb2FyZCwgaW50IHgsIGludCB5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5jaGFyc1t4LCB5XSA9IHRleHRCb2FyZC5jaGFyc1t4LCB5XTtcclxuICAgICAgICAgICAgdGhpcy5UZXh0Q29sb3JbeCwgeV0gPSB0ZXh0Qm9hcmQuVGV4dENvbG9yW3gsIHldO1xyXG4gICAgICAgICAgICB0aGlzLkJhY2tDb2xvclt4LCB5XSA9IHRleHRCb2FyZC5CYWNrQ29sb3JbeCwgeV07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIERyYXdfQ3Vyc29yX1VuaWNvZGVMYWJlbChpbnQgdiwgaW50IGNvbG9yKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IGxlbiA9IERyYXdVbmljb2RlTGFiZWwodiwgY3Vyc29yWCwgY3Vyc29yWSwgY29sb3IpO1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxlbjsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBBZHZhbmNlQ3Vyc29yKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCBpbnQgRHJhd1VuaWNvZGVMYWJlbChpbnQgdW5pY29kZSwgaW50IHgsIGludCB5LCBpbnQgY29sb3IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAodW5pY29kZSA+PSAnYScgJiYgdW5pY29kZSA8PSAneicpIHtcclxuICAgICAgICAgICAgICAgIERyYXdDaGFyKChjaGFyKSh1bmljb2RlICsgJ0EnIC0gJ2EnKSwgeCwgeSwgY29sb3IpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHVuaWNvZGUgPj0gJzAnICYmIHVuaWNvZGUgPD0gJzknKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBEcmF3Q2hhcigoY2hhcikodW5pY29kZSksIHgsIHksIGNvbG9yKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHN0cmluZyBsYWJlbCA9IFwiXCI7XHJcbiAgICAgICAgICAgIGlmICh1bmljb2RlID09IDMyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBsYWJlbCA9IFwiU1BBQ0VcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodW5pY29kZSA9PSBVbmljb2RlLkVzY2FwZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbGFiZWwgPSBcIkVTQ0FQRVwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIERyYXcobGFiZWwsIHgsIHksIGNvbG9yKTtcclxuICAgICAgICAgICAgcmV0dXJuIGxhYmVsLkxlbmd0aDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgU2V0KFRleHRCb2FyZCBvcmlnaW4pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLlBvc2l0aW9uID0gb3JpZ2luLlBvc2l0aW9uO1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IFdpZHRoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgSGVpZ2h0OyBqKyspXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFyc1tpLCBqXSA9IG9yaWdpbi5jaGFyc1tpLCBqXTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLkJhY2tDb2xvcltpLCBqXSA9IG9yaWdpbi5CYWNrQ29sb3JbaSwgal07XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5UZXh0Q29sb3JbaSwgal0gPSBvcmlnaW4uVGV4dENvbG9yW2ksIGpdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIFJlc2l6ZShpbnQgdywgaW50IGgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoY2hhcnMgPT0gbnVsbCB8fCB3ID4gY2hhcnMuR2V0TGVuZ3RoKDApIHx8IGggPiBjaGFycy5HZXRMZW5ndGgoMSkpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFNldE1heFNpemUodywgaCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgV2lkdGggPSB3O1xyXG4gICAgICAgICAgICBIZWlnaHQgPSBoO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBjaGFyIENoYXJBdChpbnQgaSwgaW50IGopXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gY2hhcnNbaSwgal07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTZXRDdXJzb3JBdChpbnQgeCwgaW50IHkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjdXJzb3JYID0geDtcclxuICAgICAgICAgICAgY3Vyc29yWSA9IHk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3X0N1cnNvcihzdHJpbmcgdilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBjIGluIHYpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIERyYXdfQ3Vyc29yKGMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3X0N1cnNvcihzdHJpbmcgdiwgaW50IGNvbG9yLCBpbnQgYmFja0NvbG9yID0gTk9DSEFOR0VDT0xPUilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBjIGluIHYpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIERyYXdfQ3Vyc29yKGMsIGNvbG9yLCBiYWNrQ29sb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCBib29sIENhbkRyYXdfQ3Vyc29yX1NtYXJ0TGluZUJyZWFrKHN0cmluZyB2KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IGN1cnJlbnRYID0gY3Vyc29yWDtcclxuICAgICAgICAgICAgaW50IGN1cnJlbnRZID0gY3Vyc29yWTtcclxuXHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdi5MZW5ndGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYm9vbCBsaW5lQnJlYWsgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGJvb2wgc2hvdWxkQ2hlY2tGb3JMaW5lQnJlYWtzID0gKGkgPT0gMCB8fCB2W2ldID09ICcgJykgJiYgaSAhPSB2Lkxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkQ2hlY2tGb3JMaW5lQnJlYWtzKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAxOyBqIDwgdi5MZW5ndGggLSBpOyBqKyspXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaiArIGN1cnJlbnRYID49IFdpZHRoKSAvL3JlYWNoIGVuZCBvZiB0aGUgbGluZSB3aXRob3V0IGVuZGluZyB0aGUgd29yZCwgc2hvdWxkIGxpbmUgYnJlYWtcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZbaV0gPT0gJyAnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkrKzsgLy9za2lwIHRocm91Z2ggdGhlIHNwYWNlIGlmIGl0J3MgYSBuZXcgbGluZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluZUJyZWFrID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2W2kgKyBqXSA9PSAnICcpIC8vbmV3IHdvcmQgYmVnaW5zIHNvIG5vIG5lZWQgdG8gbGluZSBicmVha1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChsaW5lQnJlYWspXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFkrKztcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50WCA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50WCsrO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRYID49IFdpZHRoKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRZKys7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFggPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRYID49IFdpZHRoIHx8IGN1cnJlbnRZID49IEhlaWdodCkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBEcmF3Q3Vyc29yUmVzdWx0IERyYXdfQ3Vyc29yX1NtYXJ0TGluZUJyZWFrKHN0cmluZyB2LCBpbnQgY29sb3IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgb2ZmU3RhcnQgPSAwO1xyXG4gICAgICAgICAgICBpbnQgb2ZmRW5kID0gdi5MZW5ndGggLSAxO1xyXG4gICAgICAgICAgICByZXR1cm4gRHJhd19DdXJzb3JfU21hcnRMaW5lQnJlYWsodiwgY29sb3IsIG9mZlN0YXJ0LCBvZmZFbmQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIERyYXdDdXJzb3JSZXN1bHQgRHJhd19DdXJzb3JfU21hcnRMaW5lQnJlYWsoc3RyaW5nIHYsIGludCBjb2xvciwgaW50IG9mZlN0YXJ0LCBpbnQgb2ZmRW5kLCBpbnQgeE5ld2xpbmUgPSAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFZlY3RvcjJEIHN0YXJ0ID0gbmV3IFZlY3RvcjJEKEN1cnNvclgsIEN1cnNvclkpO1xyXG4gICAgICAgICAgICBpbnQgZW5kSW5kZXggPSBvZmZFbmQgKyAxO1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gb2ZmU3RhcnQ7IGkgPCBlbmRJbmRleDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnQgb3JpZ2luWCA9IGN1cnNvclg7XHJcbiAgICAgICAgICAgICAgICBib29sIGxpbmVCcmVhayA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgYm9vbCBzaG91bGRDaGVja0ZvckxpbmVCcmVha3MgPSAoaSA9PSAwIHx8IHZbaV0gPT0gJyAnKSAmJiBpICE9IGVuZEluZGV4IC0gMTtcclxuICAgICAgICAgICAgICAgIGlmIChzaG91bGRDaGVja0ZvckxpbmVCcmVha3MpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDE7IGogPCBlbmRJbmRleCAtIGk7IGorKylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqICsgb3JpZ2luWCA+PSBXaWR0aCkgLy9yZWFjaCBlbmQgb2YgdGhlIGxpbmUgd2l0aG91dCBlbmRpbmcgdGhlIHdvcmQsIHNob3VsZCBsaW5lIGJyZWFrXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2W2ldID09ICcgJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpKys7IC8vc2tpcCB0aHJvdWdoIHRoZSBzcGFjZSBpZiBpdCdzIGEgbmV3IGxpbmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVCcmVhayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodltpICsgal0gPT0gJyAnKSAvL25ldyB3b3JkIGJlZ2lucyBzbyBubyBuZWVkIHRvIGxpbmUgYnJlYWtcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAobGluZUJyZWFrKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIEN1cnNvck5ld0xpbmUoeE5ld2xpbmUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgRHJhd19DdXJzb3IodltpXSwgY29sb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFZlY3RvcjJEIGVuZCA9IG5ldyBWZWN0b3IyRChDdXJzb3JYLCBDdXJzb3JZKTtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBEcmF3Q3Vyc29yUmVzdWx0KFBvc2l0aW9uVG9JbmRleChzdGFydCksIFBvc2l0aW9uVG9JbmRleChlbmQpLCBzdGFydCwgZW5kKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgQXV0b0ZpeEdyaWRkaW5nKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgV2lkdGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBIZWlnaHQ7IGorKylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoSXNHcmlkKGksIGopKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IG1hc2sgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoSXNHcmlkKGkgLSAxLCBqKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFzayArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChJc0dyaWQoaSArIDEsIGopKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXNrICs9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKElzR3JpZChpLCBqIC0gMSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hc2sgKz0gNDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoSXNHcmlkKGksIGogKyAxKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFzayArPSA4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAobWFzaylcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJzW2ksIGpdID0gVW5pY29kZS5Bc2NpaUdyaWRIb3I7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDg6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEyOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJzW2ksIGpdID0gVW5pY29kZS5Bc2NpaUdyaWRWZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDU6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnNbaSwgal0gPSBVbmljb2RlLkFzY2lpR3JpZFVwTGVmdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFyc1tpLCBqXSA9IFVuaWNvZGUuQXNjaWlHcmlkVXBSaWdodDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFyc1tpLCBqXSA9IFVuaWNvZGUuQXNjaWlHcmlkVXBSaWdodExlZnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDk6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhcnNbaSwgal0gPSBVbmljb2RlLkFzY2lpR3JpZERvd25MZWZ0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFyc1tpLCBqXSA9IFVuaWNvZGUuQXNjaWlHcmlkRG93blJpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFyc1tpLCBqXSA9IFVuaWNvZGUuQXNjaWlHcmlkRG93blJpZ2h0TGVmdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGJvb2wgSXNHcmlkKGludCB4LCBpbnQgeSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmKHggPDAgfHwgeSA8MCB8fCB4Pj0gV2lkdGggfHwgeT49IEhlaWdodCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2hhciBjID0gY2hhcnNbeCwgeV07XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBpdGVtIGluIFVuaWNvZGUuZ3JpZHMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChjID09IGl0ZW0pIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgRHJhd0xpbmVzKGludCBoZXJvLCBwYXJhbXMgVmVjdG9yMkRbXSBwb2ludHMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHBvaW50cy5MZW5ndGgtMTsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBEcmF3TGluZShwb2ludHNbaV0sIHBvaW50c1tpKzFdLCBoZXJvKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBEcmF3TGluZShWZWN0b3IyRCBwb3MxLCBWZWN0b3IyRCBwb3MyLCBpbnQgY29sb3IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjaGFyIGMgPSBVbmljb2RlLkFzY2lpR3JpZEhvcjtcclxuICAgICAgICAgICAgaWYgKHBvczEuWSAhPSBwb3MyLlkpIGMgPSBVbmljb2RlLkFzY2lpR3JpZFZlcjtcclxuICAgICAgICAgICAgaW50IGhlaWdodCA9IHBvczIuWUludCAtIHBvczEuWUludDtcclxuICAgICAgICAgICAgLy9pZiAoaGVpZ2h0IDw9IDApIGhlaWdodCA9IDE7XHJcbiAgICAgICAgICAgIGludCB3aWR0aCA9IHBvczIuWEludCAtIHBvczEuWEludDtcclxuICAgICAgICAgICAgLy9pZiAod2lkdGggPD0gMCkgd2lkdGggPSAxO1xyXG4gICAgICAgICAgICBEcmF3UmVwZWF0ZWQoYywgcG9zMS5YSW50LCBwb3MxLllJbnQsIHdpZHRoKzEsIGhlaWdodCsxLCBjb2xvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGludCBQb3NpdGlvblRvSW5kZXgoVmVjdG9yMkQgc3RhcnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gKGludCkoc3RhcnQuWCArIHN0YXJ0LlkgKiBXaWR0aCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3T25lRGlnaXRfQ3Vyc29yKGludCBpKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRHJhd19DdXJzb3IoKGNoYXIpKGkgKyAnMCcpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXdfQ3Vyc29yKGNoYXIgYylcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICBEcmF3Q2hhcihjLCBjdXJzb3JYLCBjdXJzb3JZKTtcclxuICAgICAgICAgICAgQWR2YW5jZUN1cnNvcigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhd19DdXJzb3IoY2hhciBjLCBpbnQgY29sb3IsIGludCBiYWNrQ29sb3I9IE5PQ0hBTkdFQ09MT1IpXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgRHJhd0NoYXIoYywgY3Vyc29yWCwgY3Vyc29yWSwgY29sb3IsIGJhY2tDb2xvcik7XHJcbiAgICAgICAgICAgIEFkdmFuY2VDdXJzb3IoKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBBZHZhbmNlQ3Vyc29yKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGN1cnNvclgrKztcclxuICAgICAgICAgICAgaWYgKGN1cnNvclggPj0gV2lkdGgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGN1cnNvclggPSAwO1xyXG4gICAgICAgICAgICAgICAgY3Vyc29yWSsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBDdXJzb3JOZXdMaW5lKGludCB4KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgY3Vyc29yWSsrO1xyXG4gICAgICAgICAgICBjdXJzb3JYID0geDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXdDaGFyKGNoYXIgdiwgaW50IHgsIGludCB5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICh2ICE9IE5PQ0hBTkdFQ0hBUikge1xyXG4gICAgICAgICAgICAgICAgY2hhcnNbeCwgeV0gPSB2O1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3Q2hhcihjaGFyIHYsIGludCB4LCBpbnQgeSwgaW50IGNvbG9yLCBpbnQgYmFja0NvbG9yID0gTk9DSEFOR0VDT0xPUilcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICBEcmF3Q2hhcih2LCB4LCB5KTtcclxuICAgICAgICAgICAgU2V0Q29sb3IoY29sb3IsIHgsIHkpO1xyXG4gICAgICAgICAgICBTZXRCYWNrQ29sb3IoYmFja0NvbG9yLCB4LCB5KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgU2V0QWxsKGNoYXIgdGV4dCwgaW50IHRleHRDb2xvciA9IE5PQ0hBTkdFQ09MT1IsIGludCBiYWNrQ29sb3I9IE5PQ0hBTkdFQ09MT1IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBEcmF3UmVwZWF0ZWQodGV4dCwgMCwgMCwgV2lkdGgsIEhlaWdodCwgdGV4dENvbG9yLCBiYWNrQ29sb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBTZXRBbGxJZlZpc2libGUoY2hhciB0ZXh0LCBpbnQgdGV4dENvbG9yID0gTk9DSEFOR0VDT0xPUiwgaW50IGJhY2tDb2xvciA9IE5PQ0hBTkdFQ09MT1IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBEcmF3UmVwZWF0ZWRJZlZpc2libGUodGV4dCwgMCwgMCwgV2lkdGgsIEhlaWdodCwgdGV4dENvbG9yLCBiYWNrQ29sb3IpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3V2l0aEdyaWQoc3RyaW5nIHRleHQsIGludCB4LCBpbnQgeSwgaW50IGdyaWRDb2xvciwgaW50IHRleHRDb2xvcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCB3aWR0aCA9IHRleHQuTGVuZ3RoO1xyXG4gICAgICAgICAgICBEcmF3R3JpZCh4LCB5LCB3aWR0aCArIDIsIDMsIGdyaWRDb2xvcik7XHJcbiAgICAgICAgICAgIERyYXcodGV4dCwgeCArIDEsIHkgKyAxLCB0ZXh0Q29sb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhdyhzdHJpbmcgdiwgaW50IHgsIGludCB5LCBpbnQgY29sb3IsIGludCBiYWNrQ29sb3IgPSBOT0NIQU5HRUNPTE9SKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB2Lkxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnQgeDIgPSB4ICsgaTtcclxuICAgICAgICAgICAgICAgIGludCB5MiA9IHk7XHJcbiAgICAgICAgICAgICAgICBpZih4MiA+PSBXaWR0aClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB4MiAtPSBXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICB5MisrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgRHJhd0NoYXIodltpXSwgeDIsIHkyLCBjb2xvciwgYmFja0NvbG9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhd1dpdGhMaW5lYnJlYWtzKHN0cmluZyB2LCBpbnQgeCwgaW50IHksIGludCBuZXdsaW5lWCwgaW50IGNvbG9yLCBpbnQgYmFja0NvbG9yID0gTk9DSEFOR0VDT0xPUilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBsaW5lYnJlYWtzID0gMDtcclxuICAgICAgICAgICAgaW50IHhPZmZzZXRuZXdsaW5lcyA9IDA7XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdi5MZW5ndGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW50IHgyID0geCArIGkrIHhPZmZzZXRuZXdsaW5lcztcclxuICAgICAgICAgICAgICAgIGludCB5MiA9IHk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHdoaWxlICh4MiA+PSBXaWR0aClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB4MiA9IHgyLVdpZHRoK25ld2xpbmVYO1xyXG4gICAgICAgICAgICAgICAgICAgIHkyKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIGlmICh2W2ldID09ICdcXG4nKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGxpbmVicmVha3MrKztcclxuICAgICAgICAgICAgICAgICAgICB4T2Zmc2V0bmV3bGluZXMgKz0gbmV3bGluZVggLSB4Mi0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBEcmF3Q2hhcih2W2ldLCB4MiwgeTIgKyBsaW5lYnJlYWtzLCBjb2xvciwgYmFja0NvbG9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXcoSUVudW1lcmFibGU8Y2hhcj4gdiwgaW50IHgsIGludCB5LCBpbnQgY29sb3IsIGludCBiYWNrQ29sb3IgPSBOT0NIQU5HRUNPTE9SKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBTeXN0ZW0uTGlucS5FbnVtZXJhYmxlLkNvdW50PGNoYXI+KHYpOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIERyYXdDaGFyKFN5c3RlbS5MaW5xLkVudW1lcmFibGUuRWxlbWVudEF0PGNoYXI+KHYsaSksIHggKyBpLCB5LCBjb2xvciwgYmFja0NvbG9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhd0dyaWQoaW50IHgsIGludCB5LCBpbnQgd2lkdGgsIGludCBoZWlnaHQsIGludCBjb2xvcilcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICBEcmF3UmVwZWF0ZWQoVW5pY29kZS5Bc2NpaUdyaWRWZXIsIHgsIHksIDEsIGhlaWdodCwgY29sb3IpO1xyXG4gICAgICAgICAgICBEcmF3UmVwZWF0ZWQoVW5pY29kZS5Bc2NpaUdyaWRWZXIsIHggKyB3aWR0aCAtIDEsIHksIDEsIGhlaWdodCwgY29sb3IpO1xyXG4gICAgICAgICAgICBEcmF3UmVwZWF0ZWQoVW5pY29kZS5Bc2NpaUdyaWRIb3IsIHgsIHksIHdpZHRoLCAxLCBjb2xvcik7XHJcbiAgICAgICAgICAgIERyYXdSZXBlYXRlZChVbmljb2RlLkFzY2lpR3JpZEhvciwgeCwgeSArIGhlaWdodCAtIDEsIHdpZHRoLCAxLCBjb2xvcik7XHJcblxyXG4gICAgICAgICAgICBEcmF3UmVwZWF0ZWQoKGNoYXIpMjE4LCB4LCB5LCAxLCAxLCBjb2xvcik7XHJcbiAgICAgICAgICAgIERyYXdSZXBlYXRlZCgoY2hhcikxOTIsIHgsICAgICAgICAgICAgICB5K2hlaWdodC0xLCAxLCAxLCBjb2xvcik7XHJcbiAgICAgICAgICAgIERyYXdSZXBlYXRlZCgoY2hhcikyMTcsIHgrd2lkdGgtMSwgICAgICB5KyBoZWlnaHQgLSAxLCAxLCAxLCBjb2xvcik7XHJcbiAgICAgICAgICAgIERyYXdSZXBlYXRlZCgoY2hhcikxOTEsIHggKyB3aWR0aCAtIDEsICB5LCAxLCAxLCBjb2xvcik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3UmVwZWF0ZWQoY2hhciBjLCBpbnQgeCwgaW50IHksIGludCB3aWR0aCwgaW50IGhlaWdodCwgaW50IGNvbG9yLCBpbnQgYmFja0NvbG9yID0gTk9DSEFOR0VDT0xPUilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSB4OyBpIDwgeCArIHdpZHRoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSB5OyBqIDwgeSArIGhlaWdodDsgaisrKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIERyYXdDaGFyKGMsIGksIGosIGNvbG9yKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgU2V0QmFja0NvbG9yKGJhY2tDb2xvciwgaSwgaik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXdSZXBlYXRlZElmVmlzaWJsZShjaGFyIGMsIGludCB4LCBpbnQgeSwgaW50IHdpZHRoLCBpbnQgaGVpZ2h0LCBpbnQgY29sb3IsIGludCBiYWNrQ29sb3IgPSBOT0NIQU5HRUNPTE9SKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IHg7IGkgPCB4ICsgd2lkdGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IHk7IGogPCB5ICsgaGVpZ2h0OyBqKyspXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoYXJzW2ksIGpdICE9IFRleHRCb2FyZC5JTlZJU0lCTEVDSEFSIHx8IFRleHRDb2xvcltpLGpdICE9IElOVklTSUJMRUNPTE9SKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBEcmF3Q2hhcihjLCBpLCBqLCBjb2xvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoQmFja0NvbG9yW2ksal0gIT0gVGV4dEJvYXJkLklOVklTSUJMRUNPTE9SKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBTZXRCYWNrQ29sb3IoYmFja0NvbG9yLCBpLCBqKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0Q29sb3IoaW50IGNvbG9yLCBpbnQgeCwgaW50IHkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoY29sb3IgIT0gTk9DSEFOR0VDT0xPUilcclxuICAgICAgICAgICAgICAgIFRleHRDb2xvclt4LCB5XSA9IGNvbG9yO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2V0QmFja0NvbG9yKGludCBjb2xvciwgaW50IHgsIGludCB5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKGNvbG9yICE9IE5PQ0hBTkdFQ09MT1IpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIEJhY2tDb2xvclt4LCB5XSA9IGNvbG9yO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3KHN0cmluZyB2LCBpbnQgeDIsIGludCB5Miwgb2JqZWN0IGlucHV0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3R3JpZChpbnQgdjEsIGludCB2MiwgaW50IHYzLCBpbnQgdjQsIG9iamVjdCBib2FyZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBOb3RJbXBsZW1lbnRlZEV4Y2VwdGlvbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0cnVjdCBEcmF3Q3Vyc29yUmVzdWx0XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwdWJsaWMgaW50IFN0YXJ0SW5kZXg7XHJcbiAgICAgICAgICAgIHB1YmxpYyBpbnQgRW5kSW5kZXg7XHJcbiAgICAgICAgICAgIHB1YmxpYyBWZWN0b3IyRCBTdGFydFBvc2l0aW9uO1xyXG4gICAgICAgICAgICBwdWJsaWMgVmVjdG9yMkQgRW5kUG9zaXRpb247XHJcblxyXG4gICAgICAgICAgICBwdWJsaWMgRHJhd0N1cnNvclJlc3VsdChpbnQgc3RhcnRJbmRleCwgaW50IGVuZEluZGV4LCBWZWN0b3IyRCBzdGFydFBvc2l0aW9uLCBWZWN0b3IyRCBlbmRQb3NpdGlvbilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgU3RhcnRJbmRleCA9IHN0YXJ0SW5kZXg7XHJcbiAgICAgICAgICAgICAgICBFbmRJbmRleCA9IGVuZEluZGV4O1xyXG4gICAgICAgICAgICAgICAgU3RhcnRQb3NpdGlvbiA9IHN0YXJ0UG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICBFbmRQb3NpdGlvbiA9IGVuZFBvc2l0aW9uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFBpZHJvaC5UZXh0UmVuZGVyaW5nO1xyXG51c2luZyBQaWRyb2guVGV4dFJlbmRlcmluZy5HYW1lU2NyZWVuO1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guVGV4dFJlbmRlcmluZ1xyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgVGV4dFNjcmVlbk4gOiBJVGV4dFNjcmVlbiwgSU1vdXNlSW5wdXQsIElLZXlib2FyZElucHV0XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIFRleHRXb3JsZCBUZXh0V29ybGQ7XHJcblxyXG4gICAgICAgIHB1YmxpYyB2aXJ0dWFsIHZvaWQgVXBkYXRlKGZsb2F0IGYpIHsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVGV4dFNjcmVlbk4oKVxyXG4gICAgICAgIHtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBUZXh0U2NyZWVuTihUZXh0V29ybGQgdGV4dFdvcmxkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVGV4dFdvcmxkID0gdGV4dFdvcmxkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljICB2b2lkIEluaXQoaW50IHcsIGludCBoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVGV4dFdvcmxkID0gbmV3IFRleHRXb3JsZCgpO1xyXG4gICAgICAgICAgICBUZXh0V29ybGQuSW5pdCh3LCBoKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVGV4dEJvYXJkIEdldEJvYXJkKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBUZXh0V29ybGQubWFpbkJvYXJkO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBNb3VzZUV2ZW50KE1vdXNlRXZlbnRzIG1vdXNlRG93biwgaW50IHYxLCBpbnQgdjIpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgSW5wdXRVbmljb2RlIHsgc2V0OyBnZXQ7IH1cclxuICAgICAgICBwdWJsaWMgaW50IElucHV0QXNOdW1iZXJcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gSW5wdXRVbmljb2RlIC0gNDg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBNb3VzZUlPIG1vdXNlSU8geyBnZXQ7IHByaXZhdGUgc2V0OyB9XHJcblxuICAgIFxucHJpdmF0ZSBNb3VzZUlPIF9fUHJvcGVydHlfX0luaXRpYWxpemVyX19tb3VzZUlPPW5ldyBNb3VzZUlPKCk7fVxyXG5cclxuICAgIHB1YmxpYyBpbnRlcmZhY2UgSVRleHRTY3JlZW5cclxuICAgIHtcclxuICAgICAgICBcclxuICAgICAgICBUZXh0Qm9hcmQgR2V0Qm9hcmQoKTtcclxuICAgICAgICBcclxuICAgICAgICB2b2lkIFVwZGF0ZShmbG9hdCBmKTtcclxuICAgICAgICBcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaW50ZXJmYWNlIElNb3VzZUlucHV0XHJcbiAgICB7XHJcbiAgICAgICAgdm9pZCBNb3VzZUV2ZW50KE1vdXNlRXZlbnRzIGV2ZW50VHlwZSwgaW50IHYxLCBpbnQgdjIpO1xyXG4gICAgICAgIE1vdXNlSU8gbW91c2VJTyB7IGdldDsgcHJpdmF0ZSBzZXQ7IH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaW50ZXJmYWNlIElLZXlib2FyZElucHV0XHJcbiAgICB7XHJcbiAgICAgICAgaW50IElucHV0VW5pY29kZSB7IHNldDsgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBlbnVtIE1vdXNlRXZlbnRzXHJcbiAgICB7IFxyXG4gICAgICAgIE1vdXNlRG93bixcclxuICAgICAgICBOb25lXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIFRleHRTY3JlZW5Ib2xkZXJcclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgSVRleHRTY3JlZW4gU2NyZWVuIHsgZ2V0OyBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgSU1vdXNlSW5wdXQgTW91c2UgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBJS2V5Ym9hcmRJbnB1dCBLZXkgeyBnZXQ7IHNldDsgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIFNldEFsbChvYmplY3QgZG5zKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgU2NyZWVuID0gZG5zIGFzIElUZXh0U2NyZWVuO1xyXG4gICAgICAgICAgICBNb3VzZSA9IGRucyBhcyBJTW91c2VJbnB1dDtcclxuICAgICAgICAgICAgS2V5ID0gZG5zIGFzIElLZXlib2FyZElucHV0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBQaWRyb2guQmFzZVV0aWxzO1xyXG51c2luZyBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQ7XHJcbnVzaW5nIFBpZHJvaC5FQ1M7XHJcbnVzaW5nIFBpZHJvaC5UZXh0UmVuZGVyaW5nO1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guVHVybkJhc2VkLlRleHRSZW5kZXJpbmdcclxue1xyXG4gICAgY2xhc3MgQXR0YWNrUHJldmlld1xyXG4gICAge1xyXG4gICAgICAgIEVDU01hbmFnZXIgZWNzO1xyXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgQmF0dGxlUmVuZGVyIHJlbmRlcjtcclxuICAgICAgICBwcml2YXRlIFF1aWNrQWNjZXNzb3JPbmU8TW92ZURhdGE+IG1vdmVEYXRhcztcclxuICAgICAgICBMaXN0PFRleHRFbnRpdHk+IGVudGl0aWVzID0gbmV3IExpc3Q8VGV4dEVudGl0eT4oKTtcclxuICAgICAgICBwcml2YXRlIGludCBjdXJyZW50TW92ZUlkO1xyXG5cclxuICAgICAgICBwdWJsaWMgQXR0YWNrUHJldmlldyhFQ1NNYW5hZ2VyIGVjcywgQmF0dGxlUmVuZGVyIHJlbmRlcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuZWNzID0gZWNzO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlciA9IHJlbmRlcjtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXIuYXR0YWNrUHJldmlldyA9IHRoaXM7XHJcbiAgICAgICAgICAgIG1vdmVEYXRhcyA9IGVjcy5RdWlja0FjY2Vzc29yMTxNb3ZlRGF0YT4oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTaG93UHJldmlldyhpbnQgdXNlciwgaW50IG1vdmVJZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChtb3ZlSWQgPT0gY3VycmVudE1vdmVJZCkgcmV0dXJuO1xyXG4gICAgICAgICAgICBFbmQoKTtcclxuICAgICAgICAgICAgY3VycmVudE1vdmVJZCA9IG1vdmVJZDtcclxuICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShcIlNUQVJUXCIpO1xyXG5cclxuICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShcIm1vdmUgXCIrbW92ZUlkKTtcclxuICAgICAgICAgICAgdmFyIG1vdmVEYXRhID0gbW92ZURhdGFzLkNvbXAxKG1vdmVJZCk7XHJcbiAgICAgICAgICAgIFZlY3RvcjJEIHBvcyA9IHJlbmRlci5FbnRpdHlTY3JlZW5Qb3NpdGlvbih1c2VyKTtcclxuICAgICAgICAgICAgUmVjdCBncmlkUmVjdCA9IHJlbmRlci5HZXRHcmlkUmVjdCgpO1xyXG5cclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGl0ZW0gaW4gbW92ZURhdGEudW5pdHMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9IGl0ZW0udGhpbmdzVG9IYXBwZW47XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgdGhpbmcgaW4gaXRlbXMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaW5nIGlzIERlYWxEYW1hZ2VBY3Rpb24pXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGEgPSB0aGluZyBhcyBEZWFsRGFtYWdlQWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZGEudGFyZ2V0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRhcmdldClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUYXJnZXQuTm9uZTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVGFyZ2V0LlNlbGY6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRhcmdldC5DbG9zZXN0VGFyZ2V0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUYXJnZXQuQ2xvc2VzdFRhcmdldFg6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZyZWVFbnRpdHkgPSByZW5kZXIudGV4dFdvcmxkLkdldEZyZWVFbnRpdHkoZ3JpZFJlY3QuWCtncmlkUmVjdC5XaWR0aCAtIHBvcy5YSW50LDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudGl0aWVzLkFkZChmcmVlRW50aXR5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmVlRW50aXR5LlNldFBvc2l0aW9uKHBvcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJlZUVudGl0eS5PcmlnaW4uU2V0QWxsKFRleHRCb2FyZC5JTlZJU0lCTEVDSEFSLCBUZXh0Qm9hcmQuSU5WSVNJQkxFQ09MT1IsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUYXJnZXQuQXJlYTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgRW5kKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoY3VycmVudE1vdmVJZCA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKFwiRU5EXCIpO1xyXG4gICAgICAgICAgICAgICAgY3VycmVudE1vdmVJZCA9IC0xO1xyXG4gICAgICAgICAgICAgICAgcmVuZGVyLnRleHRXb3JsZC5GcmVlKGVudGl0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBQaWRyb2guQmFzZVV0aWxzO1xyXG51c2luZyBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQ7XHJcbnVzaW5nIFBpZHJvaC5FQ1M7XHJcbnVzaW5nIFBpZHJvaC5UZXh0UmVuZGVyaW5nO1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guVHVybkJhc2VkLlRleHRSZW5kZXJpbmdcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEhhcHBIYW5kbGluZ1xyXG4gICAge1xyXG4gICAgICAgIEJhdHRsZVJlbmRlciBiYXR0bGVSZW5kZXI7XHJcbiAgICAgICAgRUNTTWFuYWdlciBlY3M7XHJcbiAgICAgICAgcHVibGljIEFjdGlvbiBIYW5kbGU7XHJcbiAgICAgICAgTGlzdDxIYXBwSGFuZGxlcj4gaGFuZGxlcnMgPSBuZXcgTGlzdDxIYXBwSGFuZGxlcj4oKTtcclxuICAgICAgICBwcml2YXRlIFF1aWNrQWNjZXNzb3JUd288SGFwcFRhZ3MsIFRpbWVTdGFtcFNuYXA+IGhhcHBzO1xyXG4gICAgICAgIHByaXZhdGUgZmxvYXQgaGlnaGVzdEhhbmRsZWRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldCB7IHJldHVybiBoYW5kbGVTdGF0ZS5oaWdoZXN0SGFuZGxlZDsgfVxyXG4gICAgICAgICAgICBzZXQgeyBoYW5kbGVTdGF0ZS5oaWdoZXN0SGFuZGxlZCA9IHZhbHVlOyB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByaXZhdGUgSGFwcEhhbmRsZVN0YXRlIGhhbmRsZVN0YXRlID0gbmV3IEhhcHBIYW5kbGVTdGF0ZSgpO1xyXG5cclxuICAgICAgICBwdWJsaWMgSGFwcEhhbmRsaW5nKEJhdHRsZVJlbmRlciBiYXR0bGVSZW5kZXIsIEJhdHRsZVNldHVwIGJhdHRsZVNldHVwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5iYXR0bGVSZW5kZXIgPSBiYXR0bGVSZW5kZXI7XHJcbiAgICAgICAgICAgIHZhciB3b3JsZCA9IGJhdHRsZVJlbmRlci50ZXh0V29ybGQ7XHJcbiAgICAgICAgICAgIHZhciBwb3NBbmltID0gd29ybGQuQWRkQW5pbWF0aW9uPGdsb2JhbDo6UGlkcm9oLlRleHRSZW5kZXJpbmcuUG9zaXRpb25BbmltYXRpb24+KG5ldyBQb3NpdGlvbkFuaW1hdGlvbigpKTtcclxuICAgICAgICAgICAgdmFyIGJsaW5rQW5pbSA9IHdvcmxkLkFkZEFuaW1hdGlvbjxnbG9iYWw6OlBpZHJvaC5UZXh0UmVuZGVyaW5nLkJsaW5rQW5pbT4obmV3IEJsaW5rQW5pbSgpKTtcclxuICAgICAgICAgICAgdmFyIGRlbGF5QW5pbSA9IHdvcmxkLkFkZEFuaW1hdGlvbjxnbG9iYWw6OlBpZHJvaC5UZXh0UmVuZGVyaW5nLkRlbGF5c0FuaW1hdGlvbj4obmV3IERlbGF5c0FuaW1hdGlvbigpKTtcclxuICAgICAgICAgICAgdGhpcy5lY3MgPSBiYXR0bGVTZXR1cC5lY3M7XHJcbiAgICAgICAgICAgIHRoaXMuZWNzLkNyZWF0ZUVudGl0eVdpdGhDb21wb25lbnQoaGFuZGxlU3RhdGUpO1xyXG4gICAgICAgICAgICB2YXIgYmF0dGxlTWFpbiA9IGJhdHRsZVNldHVwLmJhdHRsZU1haW47XHJcbiAgICAgICAgICAgIHZhciB0aW1lID0gYmF0dGxlU2V0dXAudGltZVN0YW1wO1xyXG4gICAgICAgICAgICBiYXR0bGVSZW5kZXIuSGFwcEhhbmRsaW5nID0gdGhpcztcclxuICAgICAgICAgICAgaGFwcHMgPSBlY3MuUXVpY2tBY2Nlc3NvcjI8SGFwcFRhZ3MsIFRpbWVTdGFtcFNuYXA+KCk7XHJcbiAgICAgICAgICAgIGhpZ2hlc3RIYW5kbGVkID0gLTE7XHJcblxyXG5cclxuICAgICAgICAgICAgaGFuZGxlcnMuQWRkKG5ldyBIYXBwSGFuZGxlcigoZSkgPT5cclxuICAgICAgICAgICAge1xyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRhbWFnZSA9IGUuR2V0Q29tcG9uZW50PEhhcHBEYW1hZ2VEYXRhPigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBhbW91bnQgPSBkYW1hZ2UuYW1vdW50O1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgc3RyaW5nIG1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGFtYWdlLmVsZW1lbnRhbEJsb2NrKVxyXG4gICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyB0ZXh0ID0gZGFtYWdlLmRhbWFnZUUuVG9TdHJpbmcoKS5Ub1VwcGVyKCkgKyBcIiBCTE9DSyBcIiArIGRhbWFnZS50YXJnZXRFLlRvU3RyaW5nKCkuVG9VcHBlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZTIgPSBiYXR0bGVSZW5kZXIudGV4dFdvcmxkLkdldFRlbXBFbnRpdHkodGV4dC5MZW5ndGgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnQgY29sb3JFID0gQmF0dGxlUmVuZGVyLkVsZW1lbnRUb1Byb2pDb2xvcihkYW1hZ2UuZGFtYWdlRSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UyLk9yaWdpbi5EcmF3KHRleHQsIDAsIDAsIGNvbG9yRSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBibGlua0FuaW0uQWRkKG1lc3NhZ2UyLkFuaW1CYXNlKDAuNmYpLCBCbGlua0FuaW0uQmxpbmtEYXRhLkZyb250Q29sb3IoY29sb3JFLCAwLjJmKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludCBvZmZzZXQgPSAoaW50KU1hdGguRmxvb3IoLXRleHQuTGVuZ3RoIC8gMmYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlMi5TZXRQb3NpdGlvbihiYXR0bGVSZW5kZXIuYmF0dGxlclJlbmRlcnNbZGFtYWdlLnRhcmdldF0uR2V0UG9zaXRpb24oKSArIG5ldyBWZWN0b3IyRCgrMSArIG9mZnNldCwgLTMpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXlBbmltLkRlbGF5KDAuNjVmKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gYmF0dGxlUmVuZGVyLkJhdHRsZUVudGl0eVRvU2NyZWVuUG9zaXRpb24oYmF0dGxlTWFpbi5lbnRpdGllc1tkYW1hZ2UudGFyZ2V0XS5wb3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmxhc3QgPSBiYXR0bGVSZW5kZXIudGV4dFdvcmxkLkdldFRlbXBFbnRpdHkoNSwgNSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsYXN0LlNldFBvc2l0aW9uKHBvcyArIG5ldyBWZWN0b3IyRCgtMiwgLTIpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsYXN0Lk9yaWdpbi5EcmF3UmVjdCgnICcsIDAsIDAsIDUsIDUsIFRleHRCb2FyZC5JTlZJU0lCTEVDT0xPUiwgQmF0dGxlUmVuZGVyLkVsZW1lbnRUb1Byb2pDb2xvcihkYW1hZ2UuZGFtYWdlRSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2JsYXN0Lk9yaWdpbi5EcmF3UmVwZWF0ZWQoJyAnLCAxLCAxLCAzLCAzLCBUZXh0Qm9hcmQuSU5WSVNJQkxFQ09MT1IsIEJhdHRsZVJlbmRlci5FbGVtZW50VG9Qcm9qQ29sb3IoZGFtYWdlLmRhbWFnZUUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmxpbmtBbmltLkFkZChibGFzdC5BbmltQmFzZSgwLjJmKSwgQmxpbmtBbmltLkJsaW5rRGF0YS5CYWNrQ29sb3IoQmF0dGxlUmVuZGVyLkNvbG9ycy5pbnB1dEtleSwgMC4wNWYsIGZhbHNlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBkYW1hZ2UuZGFtYWdlRSArIFwiIGFic29yYnMgXCIgKyBkYW1hZ2UudGFyZ2V0RSArIFwiXFxuXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSArPSBiYXR0bGVSZW5kZXIuR2V0RW50aXR5TmFtZShkYW1hZ2UudGFyZ2V0KSArIFwiIGlzIHVuYWZlY3R0ZWQuXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vbWVzc2FnZSA9IGJhdHRsZVJlbmRlci5HZXRFbnRpdHlOYW1lKGRhbWFnZS50YXJnZXQpICsgXCIgZ2V0cyBoaXQhXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhbWFnZS5zdXBlckVmZmVjdGl2ZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgdGV4dCA9IGRhbWFnZS5kYW1hZ2VFLlRvU3RyaW5nKCkuVG9VcHBlcigpICsgXCIgQlJFQUsgXCIgKyBkYW1hZ2UudGFyZ2V0RS5Ub1N0cmluZygpLlRvVXBwZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlMiA9IGJhdHRsZVJlbmRlci50ZXh0V29ybGQuR2V0VGVtcEVudGl0eSh0ZXh0Lkxlbmd0aCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgY29sb3JFID0gQmF0dGxlUmVuZGVyLkVsZW1lbnRUb1Byb2pDb2xvcihkYW1hZ2UuZGFtYWdlRSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlMi5PcmlnaW4uRHJhdyh0ZXh0LCAwLCAwLCBjb2xvckUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsaW5rQW5pbS5BZGQobWVzc2FnZTIuQW5pbUJhc2UoMC40NWYpLCBCbGlua0FuaW0uQmxpbmtEYXRhLkZyb250Q29sb3IoY29sb3JFLCAwLjJmKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgb2Zmc2V0ID0gKGludClNYXRoLkZsb29yKC10ZXh0Lkxlbmd0aCAvIDJmKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UyLlNldFBvc2l0aW9uKGJhdHRsZVJlbmRlci5iYXR0bGVyUmVuZGVyc1tkYW1hZ2UudGFyZ2V0XS5HZXRQb3NpdGlvbigpICsgbmV3IFZlY3RvcjJEKCsxICsgb2Zmc2V0LCAtMikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXlBbmltLkRlbGF5KDAuNjVmKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vbWVzc2FnZSA9IGRhbWFnZS5kYW1hZ2VFICsgXCIgcmF2YWdlcyBcIiArIGRhbWFnZS50YXJnZXRFICsgXCJcXG5cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9tZXNzYWdlICs9IGJhdHRsZVJlbmRlci5HZXRFbnRpdHlOYW1lKGRhbWFnZS50YXJnZXQpK1wiIHRha2VzIGEgaGVhdnkgaGl0IVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gYmF0dGxlUmVuZGVyLkJhdHRsZUVudGl0eVRvU2NyZWVuUG9zaXRpb24oYmF0dGxlTWFpbi5lbnRpdGllc1tkYW1hZ2UudGFyZ2V0XS5wb3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJsYXN0ID0gYmF0dGxlUmVuZGVyLnRleHRXb3JsZC5HZXRUZW1wRW50aXR5KDUsIDUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxhc3QuU2V0UG9zaXRpb24ocG9zICsgbmV3IFZlY3RvcjJEKC0yLCAtMikpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsYXN0Lk9yaWdpbi5EcmF3UmVwZWF0ZWQoJyAnLCAxLCAxLCAzLCAzLCBUZXh0Qm9hcmQuSU5WSVNJQkxFQ09MT1IsIEJhdHRsZVJlbmRlci5Db2xvcnMuRW5lbXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxpbmtBbmltLkFkZChibGFzdC5BbmltQmFzZSgwLjJmKSwgQmxpbmtBbmltLkJsaW5rRGF0YS5CYWNrQ29sb3IoQmF0dGxlUmVuZGVyLkVsZW1lbnRUb1Byb2pDb2xvcihkYW1hZ2UuZGFtYWdlRSksIDAuMDVmKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9tZXNzYWdlID0gYmF0dGxlUmVuZGVyLkdldEVudGl0eU5hbWUoZGFtYWdlLnRhcmdldCkgKyBcIiBnZXRzIGh1cnRcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gYmF0dGxlUmVuZGVyLkJhdHRsZUVudGl0eVRvU2NyZWVuUG9zaXRpb24oYmF0dGxlTWFpbi5lbnRpdGllc1tkYW1hZ2UudGFyZ2V0XS5wb3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBudW1iZXIgPSBiYXR0bGVSZW5kZXIudGV4dFdvcmxkLkdldFRlbXBFbnRpdHkoMiwgMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFZlY3RvcjJEIGluaXRpYWxQb3MgPSBwb3MgKyBuZXcgVmVjdG9yMkQoMCwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbnVtYmVyLlNldFBvc2l0aW9uKGluaXRpYWxQb3MpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL251bWJlci5PcmlnaW4uRHJhd09uZURpZ2l0KGFtb3VudCwgMCwgMCwgQmF0dGxlUmVuZGVyLkNvbG9ycy5IZXJvKTtcclxuICAgICAgICAgICAgICAgICAgICBpZihhbW91bnQgPj0gMTApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlci5PcmlnaW4uRHJhd1R3b0RpZ2l0cyhhbW91bnQsIDAsIDAsIEJhdHRsZVJlbmRlci5Db2xvcnMuSGVybyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1iZXIuT3JpZ2luLkRyYXdPbmVEaWdpdChhbW91bnQsIDAsIDAsIEJhdHRsZVJlbmRlci5Db2xvcnMuSGVybyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9zQW5pbS5BZGQobnVtYmVyLkFuaW1CYXNlKDAuNmYpLCBuZXcgUG9zaXRpb25BbmltYXRpb24uUG9zaXRpb25EYXRhKGluaXRpYWxQb3MsIGluaXRpYWxQb3MgKyBuZXcgVmVjdG9yMkQoMCwgLTMpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9ibGlua0FuaW0uQWRkKG51bWJlci5BbmltQmFzZSgxZiksIEJsaW5rQW5pbS5CbGlua0RhdGEuQ2hhcignICcsIDVmKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICBiYXR0bGVSZW5kZXIuU2hvd01lc3NhZ2UobWVzc2FnZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVuZGVyID0gYmF0dGxlUmVuZGVyLmJhdHRsZXJSZW5kZXJzW2RhbWFnZS50YXJnZXRdO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vdmFyIGZlID0gYmF0dGxlUmVuZGVyLnRleHRXb3JsZC5HZXRUZW1wRW50aXR5KGRlZmVuZGVyLldpZHRoLCBkZWZlbmRlci5IZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFkYW1hZ2Uuc3VwZXJFZmZlY3RpdmUgJiYgIWRhbWFnZS5lbGVtZW50YWxCbG9jayBcclxuICAgICAgICAgICAgICAgIC8vJiYgYmF0dGxlTWFpbi5lbnRpdGllc1tkYW1hZ2UudGFyZ2V0XS5BbGl2ZVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmZSA9IGJhdHRsZVJlbmRlci50ZXh0V29ybGQuR2V0VGVtcEVudGl0eSgzLCAzKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYmFja0NvbG9yID0gQmF0dGxlUmVuZGVyLkVsZW1lbnRUb1Byb2pDb2xvcihkYW1hZ2UuZGFtYWdlRSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYmFja0NvbG9yID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBpbnQgeENvbG9yID0gQmF0dGxlUmVuZGVyLkVsZW1lbnRUb1Byb2pDb2xvcihkYW1hZ2UuZGFtYWdlRSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhciBkYW1hZ2VDaGFyID0gJ1gnO1xyXG4gICAgICAgICAgICAgICAgICAgIGZlLk9yaWdpbi5EcmF3Q2hhcihkYW1hZ2VDaGFyLCAxLCAwLCB4Q29sb3IsIGJhY2tDb2xvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgZmUuT3JpZ2luLkRyYXdDaGFyKGRhbWFnZUNoYXIsIDEsIDEsIHhDb2xvciwgYmFja0NvbG9yKTtcclxuICAgICAgICAgICAgICAgICAgICBmZS5PcmlnaW4uRHJhd0NoYXIoZGFtYWdlQ2hhciwgMSwgMiwgeENvbG9yLCBiYWNrQ29sb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZlLk9yaWdpbi5EcmF3Q2hhcihkYW1hZ2VDaGFyLCAwLCAxLCB4Q29sb3IsIGJhY2tDb2xvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgZmUuT3JpZ2luLkRyYXdDaGFyKGRhbWFnZUNoYXIsIDIsIDEsIHhDb2xvciwgYmFja0NvbG9yKTtcclxuICAgICAgICAgICAgICAgICAgICAvL2ZlLk9yaWdpbi5EcmF3Q2hhcihUZXh0Qm9hcmQuTk9DSEFOR0VDSEFSLCAwLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICBmZS5PcmlnaW4uUG9zaXRpb24gPSBkZWZlbmRlci5HZXRQb3NpdGlvbigpICsgbmV3IFZlY3RvcjJEKC0xLCAtMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGJsaW5rQW5pbS5BZGQoZmUuQW5pbUJhc2UoMC4zNWYpLCBCbGlua0FuaW0uQmxpbmtEYXRhLkNoYXIoJ1onLCAwLjA1ZikpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vYmxpbmtBbmltLkFkZChmZS5BbmltQmFzZSgwLjM1ZiksIEJsaW5rQW5pbS5CbGlua0RhdGEuQmFja0NvbG9yKEJhdHRsZVJlbmRlci5Db2xvcnMuSGVybywgMC4wNWYpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGUoXCJDSEFOR0UgRUxFXCIpO1xyXG5cclxuICAgICAgICAgICAgfSwgTWlzY0hhcHBUYWdzLkRhbWFnZSkpO1xyXG4gICAgICAgICAgICBoYW5kbGVycy5BZGQobmV3IEhhcHBIYW5kbGVyKChlKSA9PlxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaG1kID0gZS5HZXRDb21wb25lbnQ8SGFwcE1vdmVEYXRhPigpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBzdHJpbmcgdGV4dCA9IGhtZC5lbGVtZW50LlRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IGJhdHRsZVJlbmRlci50ZXh0V29ybGQuR2V0VGVtcEVudGl0eSh0ZXh0Lkxlbmd0aCwgMSk7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLk9yaWdpbi5EcmF3KHRleHQsIDAsIDAsIEJhdHRsZVJlbmRlci5Db2xvcnMuSGVybyk7XHJcbiAgICAgICAgICAgICAgICBibGlua0FuaW0uQWRkKG1lc3NhZ2UuQW5pbUJhc2UoMC41ZiksIEJsaW5rQW5pbS5CbGlua0RhdGEuRnJvbnRDb2xvcihCYXR0bGVSZW5kZXIuQ29sb3JzLklucHV0RGVzY3JpcHRpb24sIDAuMTVmKSk7XHJcbiAgICAgICAgICAgICAgICBpbnQgb2Zmc2V0ID0gKGludClNYXRoLkZsb29yKC10ZXh0Lkxlbmd0aCAvIDJmKTtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2UuU2V0UG9zaXRpb24oYmF0dGxlUmVuZGVyLmJhdHRsZXJSZW5kZXJzW2htZC51c2VyXS5HZXRQb3NpdGlvbigpICsgbmV3IFZlY3RvcjJEKCsxICsgb2Zmc2V0LCAtMSkpO1xyXG5cclxuICAgICAgICAgICAgfSwgTWlzY0hhcHBUYWdzLkNoYW5nZUVsZW1lbnQpKTtcclxuICAgICAgICAgICAgaGFuZGxlcnMuQWRkKG5ldyBIYXBwSGFuZGxlcigoZSkgPT5cclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIGhtZCA9IGUuR2V0Q29tcG9uZW50PEhhcHBNb3ZlRGF0YT4oKTtcclxuICAgICAgICAgICAgICAgIC8vdmFyIGRlZmVuZGVyID0gYmF0dGxlUmVuZGVyLmJhdHRsZXJSZW5kZXJzW2htZC50YXJnZXRdO1xyXG4gICAgICAgICAgICAgICAgdmFyIHBvcyA9IGJhdHRsZVJlbmRlci5CYXR0bGVFbnRpdHlUb1NjcmVlblBvc2l0aW9uKGJhdHRsZU1haW4uZW50aXRpZXNbaG1kLnVzZXJdLnBvcyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmxhc3QgPSBiYXR0bGVSZW5kZXIudGV4dFdvcmxkLkdldFRlbXBFbnRpdHkoMywgMyk7XHJcbiAgICAgICAgICAgICAgICBibGFzdC5TZXRQb3NpdGlvbihwb3MgKyBuZXcgVmVjdG9yMkQoLTEsIC0xKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgYmxhc3QuT3JpZ2luLkRyYXdSZXBlYXRlZCgnICcsIDEsIDEsIDEsIDEsIFRleHRCb2FyZC5JTlZJU0lCTEVDT0xPUiwgQmF0dGxlUmVuZGVyLkNvbG9ycy5FbmVteSk7XHJcbiAgICAgICAgICAgICAgICBibGlua0FuaW0uQWRkKGJsYXN0LkFuaW1CYXNlKDAuMmYpLCBCbGlua0FuaW0uQmxpbmtEYXRhLkJhY2tDb2xvcihCYXR0bGVSZW5kZXIuQ29sb3JzLkhlcm8sIDAuMDVmKSk7XHJcbiAgICAgICAgICAgICAgICAvL2RlbGF5QW5pbS5EZWxheSg1KTtcclxuICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZShcIkRFQVRIXCIpO1xyXG4gICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlKFwiQ0hBTkdFIEVMRVwiKTtcclxuXHJcbiAgICAgICAgICAgIH0sIE1pc2NIYXBwVGFncy5EZWF0aCkpO1xyXG4gICAgICAgICAgICBBY3Rpb248RW50aXR5PiBtb3ZlSGFuZGxlID0gKGUpID0+XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoXCJIQU5ETEUhM1wiKTtcclxuICAgICAgICAgICAgICAgIHZhciBobWQgPSBlLkdldENvbXBvbmVudDxIYXBwTW92ZURhdGE+KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgaG1mID0gZS5HZXRDb21wb25lbnQ8SGFwcE1vdmVtZW50PigpO1xyXG4gICAgICAgICAgICAgICAgaW50IGVJZCA9IGhtZC51c2VyO1xyXG4gICAgICAgICAgICAgICAgdmFyIG1vdmVyID0gYmF0dGxlTWFpbi5lbnRpdGllc1tlSWRdO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBwb3MgPSBtb3Zlci5Qb3NpdGlvblYyRDtcclxuICAgICAgICAgICAgICAgIHZhciBwb3MyID0gaG1mLm1vdmVUbztcclxuICAgICAgICAgICAgICAgIHZhciBwb3NGID0gKHBvcyArIHBvczIpIC8gMjtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZmUgPSBiYXR0bGVSZW5kZXIuYmF0dGxlclJlbmRlcnNbZUlkXTtcclxuICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoXCJNb3ZlIGZhaWxcIik7XHJcbiAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKFwiSEFQUCBNT1ZFIEhBTkRMRVwiKTtcclxuICAgICAgICAgICAgICAgIGlmIChobWYuc3VjY2VzcylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBWZWN0b3IyRCBmaW5hbFBvc1NjcmVlbiA9IGJhdHRsZVJlbmRlci5CYXR0bGVFbnRpdHlUb1NjcmVlblBvc2l0aW9uKGhtZi5tb3ZlVG8pO1xyXG4gICAgICAgICAgICAgICAgICAgIHBvc0FuaW0uQWRkKGZlLkFuaW1CYXNlKDAuMmYpLCBuZXcgUG9zaXRpb25BbmltYXRpb24uUG9zaXRpb25EYXRhKFxyXG4gICAgICAgICAgICAgICAgICAgIGJhdHRsZVJlbmRlci5CYXR0bGVFbnRpdHlUb1NjcmVlblBvc2l0aW9uKGhtZi5tb3ZlRnJvbSksXHJcbiAgICAgICAgICAgICAgICAgICAgZmluYWxQb3NTY3JlZW4pKTtcclxuICAgICAgICAgICAgICAgICAgICBmZS5TZXRQb3NpdGlvbihmaW5hbFBvc1NjcmVlbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9zQW5pbS5BZGQoZmUuQW5pbUJhc2UoMC4yZiksIG5ldyBQb3NpdGlvbkFuaW1hdGlvbi5Qb3NpdGlvbkRhdGEoXHJcbiAgICAgICAgICAgICAgICAgICAgYmF0dGxlUmVuZGVyLkJhdHRsZUVudGl0eVRvU2NyZWVuUG9zaXRpb24oaG1mLm1vdmVGcm9tKSxcclxuICAgICAgICAgICAgICAgICAgICBiYXR0bGVSZW5kZXIuQmF0dGxlRW50aXR5VG9TY3JlZW5Qb3NpdGlvbihwb3NGKSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGhhbmRsZXJzLkFkZChuZXcgSGFwcEhhbmRsZXIobW92ZUhhbmRsZSwgTW92ZURhdGFUYWdzLk1vdmVtZW50KSk7XHJcblxyXG4gICAgICAgICAgICBoYW5kbGVycy5BZGQobmV3IEhhcHBIYW5kbGVyKChlKSA9PlxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaGEgPSBlLkdldENvbXBvbmVudDxIYXBwQXJlYT4oKTtcclxuICAgICAgICAgICAgICAgIHZhciBobWQgPSBlLkdldENvbXBvbmVudDxIYXBwTW92ZURhdGE+KCk7XHJcbiAgICAgICAgICAgICAgICBpbnQgZUlkID0gaG1kLnVzZXI7XHJcbiAgICAgICAgICAgICAgICB2YXIgbW92ZXIgPSBiYXR0bGVNYWluLmVudGl0aWVzW2VJZF07XHJcbiAgICAgICAgICAgICAgICAvL3ZhciB1c2VyUmVuZGVyID0gYmF0dGxlUmVuZGVyLmJhdHRsZXJFbnRpdGllc1tlSWRdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFyZWEgPSBoYS5hcmVhO1xyXG4gICAgICAgICAgICAgICAgdmFyIHBvaW50cyA9IGFyZWEucG9pbnRzO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciB1c2VFZmZlY3QgPSB3b3JsZC5HZXRUZW1wRW50aXR5KDEsIDEpO1xyXG4gICAgICAgICAgICAgICAgdXNlRWZmZWN0LlNldFBvc2l0aW9uKGJhdHRsZVJlbmRlci5CYXR0bGVFbnRpdHlUb1NjcmVlblBvc2l0aW9uKG1vdmVyLnBvcykpO1xyXG4gICAgICAgICAgICAgICAgYmxpbmtBbmltLkFkZCh1c2VFZmZlY3QuQW5pbUJhc2UoMC41ZiksIEJsaW5rQW5pbS5CbGlua0RhdGEuQmFja0NvbG9yKEJhdHRsZVJlbmRlci5FbGVtZW50VG9Qcm9qQ29sb3IoaG1kLmVsZW1lbnQpLCAwLjE1ZikpO1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGl0ZW0gaW4gcG9pbnRzKVxyXG4gICAgICAgICAgICAgICAgeyAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbnRpdHkgPSB3b3JsZC5HZXRUZW1wRW50aXR5KDEsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaW5hbFBvcyA9IGl0ZW0gKiBuZXcgVmVjdG9yMkQoaGEubWlycm9yaW5nWCwgMSkgKyBoYS5vZmZzZXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbmFsUG9zLlggPCAwKSBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmluYWxQb3MuWSA8IDApIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaW5hbFBvcy5YID4gNSkgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbmFsUG9zLlkgPiAyKSBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGUoZmluYWxQb3MuWEludCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlKGZpbmFsUG9zLllJbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3MgPSBiYXR0bGVSZW5kZXIuQmF0dGxlRW50aXR5VG9TY3JlZW5Qb3NpdGlvbihmaW5hbFBvcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZW50aXR5LlNldFBvc2l0aW9uKHBvcy5YSW50LCBwb3MuWUludCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYmxpbmtBbmltLkFkZChlbnRpdHkuQW5pbUJhc2UoMC41ZiksIEJsaW5rQW5pbS5CbGlua0RhdGEuQmFja0NvbG9yKEJhdHRsZVJlbmRlci5FbGVtZW50VG9Qcm9qQ29sb3IoaG1kLmVsZW1lbnQpLCAwLjE1ZikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBNb3ZlRGF0YVRhZ3MuQm9tYikpO1xyXG4gICAgICAgICAgICBoYW5kbGVycy5BZGQobmV3IEhhcHBIYW5kbGVyKChlKSA9PlxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaGEgPSBlLkdldENvbXBvbmVudDxIYXBwU2hvb3Q+KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWQgPSBlLkdldENvbXBvbmVudDxIYXBwTW92ZURhdGE+KCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaGEgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBCYXR0bGVNYWluLkVsZW1lbnQgZWxlbWVudCA9IG1kLmVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgVGV4dEVudGl0eSBmZSA9IGJhdHRsZVJlbmRlci5HZXRQcm9qVGV4dEVudGl0eShlbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gaGEuc3RhcnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBvczIgPSBoYS5lbmQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHhEaXMgPSBNYXRoLkFicyhwb3MuWCAtIHBvczIuWCk7ICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGZsb2F0IHRpbWVWID0gKGZsb2F0KXhEaXMgKiAwLjFmO1xyXG4gICAgICAgICAgICAgICAgICAgIHBvc0FuaW0uQWRkKGZlLkFuaW1CYXNlKHRpbWVWKSwgbmV3IFBvc2l0aW9uQW5pbWF0aW9uLlBvc2l0aW9uRGF0YShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhdHRsZVJlbmRlci5CYXR0bGVFbnRpdHlUb1NjcmVlblBvc2l0aW9uKHBvcyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXR0bGVSZW5kZXIuQmF0dGxlRW50aXR5VG9TY3JlZW5Qb3NpdGlvbihwb3MyKSkpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9LCBNb3ZlRGF0YVRhZ3MuU2hvb3QpKTtcclxuXHJcbiAgICAgICAgICAgIEhhbmRsZSA9ICgpID0+XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoXCJIQU5ETEUhXCIpO1xyXG4gICAgICAgICAgICAgICAgZmxvYXQgbmV3SGlnaGVzdEhhbmRsZWQgPSBoaWdoZXN0SGFuZGxlZDtcclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaGFwcHMuTGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlKFwiQURWXCIrYmF0dGxlUmVuZGVyLkNhbkFkdmFuY2VHcmFwaGljcygpKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWJhdHRsZVJlbmRlci5DYW5BZHZhbmNlR3JhcGhpY3MoKSkgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhZ3MgPSBoYXBwcy5Db21wMShpKTtcclxuICAgICAgICAgICAgICAgICAgICAvL2lmIChoYXBwcy5Db21wMihpKS5UaW1lU25hcCA+IGhpZ2hlc3RIYW5kbGVkKVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpID4gaGlnaGVzdEhhbmRsZWQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL25ld0hpZ2hlc3RIYW5kbGVkID0gaGFwcHMuQ29tcDIoaSkuVGltZVNuYXA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0hpZ2hlc3RIYW5kbGVkID0gaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlKFwiSGFuZGxlZFwiK2kpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKFwiSEFORExFIVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYm9vbCBoYW5kbGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKHZhciBoYW4gaW4gaGFuZGxlcnMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoXCJIQU5ETEUheFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYW4uQ2FuSGFuZGxlKHRhZ3MudGFncykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlKFwiSGFuZGxlZFhcIiArIGkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoaGFwcHMuQ29tcDIoaSkuVGltZVNuYXAgKyBcIiAtIFwiICsgdGltZS5DdXJyZW50U25hcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShcIkhBTkRMRSEyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbi5IYW5kbGVyKGhhcHBzLkVudGl0eShpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFoYW5kbGVkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgdCBpbiB0YWdzLnRhZ3MpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShcIk5vdCBoYW5kbGVkIHRhZyBcIiArIHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoaGFwcHMuQ29tcDIoaSkuVGltZVNuYXArXCIgLSBcIisgdGltZS5DdXJyZW50U25hcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaGlnaGVzdEhhbmRsZWQgPSBuZXdIaWdoZXN0SGFuZGxlZDtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgY2xhc3MgSGFwcEhhbmRsZVN0YXRlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwdWJsaWMgZmxvYXQgaGlnaGVzdEhhbmRsZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgY2xhc3MgSGFwcEhhbmRsZXJcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludGVybmFsIExpc3Q8aW50PiBuZWNlc3NhcnlUYWdzID0gbmV3IExpc3Q8aW50PigpO1xyXG4gICAgICAgICAgICBpbnRlcm5hbCBBY3Rpb248RW50aXR5PiBIYW5kbGVyO1xyXG5cclxuICAgICAgICAgICAgcHVibGljIEhhcHBIYW5kbGVyKEFjdGlvbjxFbnRpdHk+IGhhbmRsZXIsIHBhcmFtcyBvYmplY3RbXSB0YWdzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgdCBpbiB0YWdzKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG5lY2Vzc2FyeVRhZ3MuQWRkKENvbnZlcnQuVG9JbnQzMih0KSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLkhhbmRsZXIgPSBoYW5kbGVyO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpbnRlcm5hbCBib29sIENhbkhhbmRsZShMaXN0PGludD4gdGFncylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIGl0ZW0gaW4gbmVjZXNzYXJ5VGFncylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRhZ3MuQ29udGFpbnMoaXRlbSkpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIGJvb2wgSXNEb25lKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBoaWdoZXN0SGFuZGxlZCA+PSBoYXBwcy5MZW5ndGggLSAxO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQ7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5UdXJuQmFzZWQuVGV4dFJlbmRlcmluZ1xyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgSGVscFNjcmVlbkludGVncmF0aW9uXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIGJvb2wgc2hvd1JlcXVlc3Q7XHJcbiAgICAgICAgaW50ZXJuYWwgSVRleHRTY3JlZW5fIGNhbGxlcjtcclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBTaG93KElUZXh0U2NyZWVuXyBzY3JlZW4pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBzaG93UmVxdWVzdCA9IHRydWU7XHJcbiAgICAgICAgICAgIGNhbGxlciA9IHNjcmVlbjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgUGlkcm9oLkJhc2VVdGlscztcclxudXNpbmcgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkO1xyXG51c2luZyBQaWRyb2guVGV4dFJlbmRlcmluZztcclxudXNpbmcgUGlkcm9oLlRleHRSZW5kZXJpbmcuR2FtZVNjcmVlbjtcclxudXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLlR1cm5CYXNlZC5UZXh0UmVuZGVyaW5nXHJcbntcclxuICAgIGNsYXNzIEhlbHBTY3JlZW4gOiBJVGV4dFNjcmVlbl9cclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgaW50IElucHV0IHsgc2V0OyBnZXQ7IH1cclxuICAgICAgICBwdWJsaWMgaW50IGtleURvd25Vbmljb2RlIHsgc2V0OyBnZXQ7IH1cclxuICAgICAgICBwdWJsaWMgS2V5Ym9hcmRJTyBLZXlib2FyZCB7IHNldDsgZ2V0OyB9XHJcbiAgICAgICAgcHVibGljIE1vdXNlSU8gTW91c2UgeyBzZXQ7IGdldDsgfVxyXG4gICAgICAgIFRleHRXb3JsZCB0ZXh0V29ybGQ7XHJcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBIZWxwU2NyZWVuTW9kZWwgbW9kZWw7XHJcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBMaXN0PE1vdmVNZXRhRGF0YT4gbW92ZVJlbmRlcnM7XHJcbiAgICAgICAgcHJpdmF0ZSByZWFkb25seSBMaXN0PE1vdmVEYXRhPiBtb3ZlRGF0YXM7XHJcbiAgICAgICAgY2hhciBMZWF2ZUJ1dHRvbjtcclxuICAgICAgICBwdWJsaWMgYm9vbCB3YW5uYUxlYXZlO1xyXG4gICAgICAgIHByaXZhdGUgVGV4dEVudGl0eSBleHBsYW5hdGlvbkVudGl0eTtcclxuXHJcbiAgICAgICAgcHVibGljIEhlbHBTY3JlZW4oSGVscFNjcmVlbk1vZGVsIGhlbHBNb2RlbCwgTGlzdDxNb3ZlTWV0YURhdGE+IG1vdmVSZW5kZXJzLCBMaXN0PE1vdmVEYXRhPiBtb3ZlRGF0YXMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLnRleHRXb3JsZCA9IG5ldyBUZXh0V29ybGQoKTtcclxuICAgICAgICAgICAgdGV4dFdvcmxkLkluaXQoR2FtZU1haW4uV2lkdGgsIEdhbWVNYWluLkhlaWdodCk7XHJcbiAgICAgICAgICAgIG1vZGVsID0gaGVscE1vZGVsO1xyXG4gICAgICAgICAgICB0aGlzLm1vdmVSZW5kZXJzID0gbW92ZVJlbmRlcnM7XHJcbiAgICAgICAgICAgIHRoaXMubW92ZURhdGFzID0gbW92ZURhdGFzO1xyXG4gICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLlNldEFsbChUZXh0Qm9hcmQuSU5WSVNJQkxFQ0hBUiwgQmF0dGxlUmVuZGVyLkNvbG9ycy5CYWNrQ29tbWFuZCwgQmF0dGxlUmVuZGVyLkNvbG9ycy5CYWNrQ29tbWFuZCk7XHJcbiAgICAgICAgICAgIGV4cGxhbmF0aW9uRW50aXR5ID0gdGV4dFdvcmxkLkdldEZyZWVFbnRpdHkoR2FtZU1haW4uV2lkdGggLSA0LCAzNSk7XHJcbiAgICAgICAgICAgIGV4cGxhbmF0aW9uRW50aXR5LlNldFBvc2l0aW9uKDIsIDQpO1xyXG4gICAgICAgICAgICAvL3RleHRXb3JsZC5HZXRGcmVlRW50aXR5KEdhbWVNYWluLldpZHRoIC0gNCk7XHJcbiAgICAgICAgICAgIC8vZXhwbGFuYXRpb25FbnRpdHkuT3JpZ2luLkRyYXcoXCJTU1NfX1NTU1NEQVNEQVNEQVNcIiwgMCwwLCBCYXR0bGVSZW5kZXIuQ29sb3JzLklucHV0RGVzY3JpcHRpb24pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhdyhmbG9hdCBmKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGlucHV0ID0ga2V5RG93blVuaWNvZGU7XHJcbiAgICAgICAgICAgIGlmIChpbnB1dCA9PSBMZWF2ZUJ1dHRvbikgd2FubmFMZWF2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmIChpbnB1dCA9PSAnSCcpIHdhbm5hTGVhdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAoaW5wdXQgPT0gJ2gnKSB3YW5uYUxlYXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKGlucHV0ID09IFVuaWNvZGUuRXNjYXBlKSB3YW5uYUxlYXZlID0gdHJ1ZTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgLy90ZXh0V29ybGQubWFpbkJvYXJkLlJlc2V0KCk7XHJcbiAgICAgICAgICAgIGludCBwb3MgPSAwO1xyXG4gICAgICAgICAgICAvL3RleHRXb3JsZC5tYWluQm9hcmQuRHJhd1dpdGhMaW5lYnJlYWtzKFwiSW5wdXQgeW91ciBjb21tYW5kcyBhbmQgd2F0Y2ggdGhlIHR1cm4gcGxheSBvdXQuIFlvdSBjYW4gc2VlIGV2ZXJ5dGhpbmcgeW91ciBlbmVtaWVzIHdpbGwgZG9cXG5cXG5BdHRhY2tzIGhhdmUgdGhyZWUgZWxlbWVudHMsIEZpcmUsIFRodW5kZXIgYW5kIEljZS4gRmlyZSBiZWF0cyBJY2UsIEljZSBiZWF0cyBUaHVuZGVyLCBUaHVuZGVyIGJlYXRzIEZpcmUuXFxuVGhlIGVsZW1lbnQgb2YgdGhlIGF0dGFja2VyIGNoYW5nZXMgdXBvbiBhdHRhY2tpbmcuIEF0dGFja2VycyBhcmUgaW1tdW5lIHRvIGF0dGFja3Mgb2YgdGhlIHNhbWUgZWxlbWVudCFcIiwgMiwgcG9zLCAwLCBCYXR0bGVSZW5kZXIuQ29sb3JzLmlucHV0S2V5LCBUZXh0Qm9hcmQuSU5WSVNJQkxFQ09MT1IpO1xyXG4gICAgICAgICAgICBleHBsYW5hdGlvbkVudGl0eS5PcmlnaW4uU2V0Q3Vyc29yQXQoMCwgMCk7XHJcbiAgICAgICAgICAgIC8vaWYgKCFtb2RlbC5iYXR0bGVJbnRyb01vZGUpe1xyXG4gICAgICAgICAgICBpZiAoZmFsc2UpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGV4cGxhbmF0aW9uRW50aXR5Lk9yaWdpbi5EcmF3X0N1cnNvcl9TbWFydExpbmVCcmVhayhcIklucHV0IHlvdXIgY29tbWFuZHMgYW5kIHdhdGNoIHRoZSB0dXJuIHBsYXkgb3V0LiBQbGFuIHlvdXIgbW92ZXMgYmFzZWQgb24gd2hhdCB0aGUgZW5lbXkgd2lsbCBkbyFcIiwgQmF0dGxlUmVuZGVyLkNvbG9ycy5JbnB1dERlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgICAgIGV4cGxhbmF0aW9uRW50aXR5Lk9yaWdpbi5DdXJzb3JOZXdMaW5lKDApO1xyXG4gICAgICAgICAgICAgICAgZXhwbGFuYXRpb25FbnRpdHkuT3JpZ2luLkN1cnNvck5ld0xpbmUoMCk7XHJcbiAgICAgICAgICAgICAgICBleHBsYW5hdGlvbkVudGl0eS5PcmlnaW4uRHJhd19DdXJzb3JfU21hcnRMaW5lQnJlYWsoXCJBdHRhY2tzIGhhdmUgdGhyZWUgZWxlbWVudHMsIEZpcmUsIFRodW5kZXIgYW5kIEljZS4gRmlyZSBiZWF0cyBJY2UsIEljZSBiZWF0cyBUaHVuZGVyLCBUaHVuZGVyIGJlYXRzIEZpcmUuXCIsIEJhdHRsZVJlbmRlci5Db2xvcnMuSW5wdXREZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgICAgICBleHBsYW5hdGlvbkVudGl0eS5PcmlnaW4uQ3Vyc29yTmV3TGluZSgwKTtcclxuICAgICAgICAgICAgICAgIGV4cGxhbmF0aW9uRW50aXR5Lk9yaWdpbi5DdXJzb3JOZXdMaW5lKDApO1xyXG5cclxuICAgICAgICAgICAgICAgIGV4cGxhbmF0aW9uRW50aXR5Lk9yaWdpbi5EcmF3X0N1cnNvcl9TbWFydExpbmVCcmVhayhcIlRoZSBlbGVtZW50IG9mIHRoZSBhdHRhY2tlciBjaGFuZ2VzIHVwb24gYXR0YWNraW5nLiBBdHRhY2tlcnMgYXJlIGltbXVuZSB0byBhdHRhY2tzIG9mIHRoZSBzYW1lIGVsZW1lbnQhXCIsIEJhdHRsZVJlbmRlci5Db2xvcnMuSW5wdXREZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgICAgICBwb3MgKz0gMTg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwb3MgPSA1O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAobW9kZWwuYXR0YWNrRGVtbylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZXhwbGFuYXRpb25FbnRpdHkuT3JpZ2luLkRyYXdfQ3Vyc29yX1NtYXJ0TGluZUJyZWFrKFwiQSBiYXR0bGUgc2ltdWxhdGlvbiBzbyB5b3UgY2FuIGV4YW1pbmUgZW5lbXkgYXR0YWNrcyBiZWZvcmVoYW5kXCIsIEJhdHRsZVJlbmRlci5Db2xvcnMuSW5wdXREZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBleHBsYW5hdGlvbkVudGl0eS5PcmlnaW4uRHJhd19DdXJzb3JfU21hcnRMaW5lQnJlYWsoXCJQaWNrIHlvdXIgbW92ZXMgYW5kIGV4ZWN1dGUgdGhlbSFcIiwgQmF0dGxlUmVuZGVyLkNvbG9ycy5JbnB1dERlc2NyaXB0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICBwb3MgKz0gNjtcclxuICAgICAgICAgICAgICAgIGV4cGxhbmF0aW9uRW50aXR5Lk9yaWdpbi5DdXJzb3JOZXdMaW5lKDApO1xyXG4gICAgICAgICAgICAgICAgZXhwbGFuYXRpb25FbnRpdHkuT3JpZ2luLkN1cnNvck5ld0xpbmUoMCk7XHJcbiAgICAgICAgICAgICAgICBpZiAobW9kZWwua2lsbEFsbEVuZW1pZXMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgZXhwbGFuYXRpb25FbnRpdHkuT3JpZ2luLkRyYXdfQ3Vyc29yX1NtYXJ0TGluZUJyZWFrKFwiRGVmZWF0IGFsbCBlbmVtaWVzIVwiLCBCYXR0bGVSZW5kZXIuQ29sb3JzLklucHV0RGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGV4cGxhbmF0aW9uRW50aXR5Lk9yaWdpbi5EcmF3X0N1cnNvcl9TbWFydExpbmVCcmVhayhcIkNvbGxlY3QgYWxsIG9iamVjdHNcIiwgQmF0dGxlUmVuZGVyLkNvbG9ycy5JbnB1dERlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5TZXRBbGwoJyAnLCBUZXh0Qm9hcmQuTk9DSEFOR0VDT0xPUiwgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5Db2xvcnMuQmFja2dyb3VuZElucHV0KTtcclxuICAgICAgICAgICAgdGV4dFdvcmxkLkRyYXcoKTtcclxuICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAvL3RleHRXb3JsZC5tYWluQm9hcmQuRHJhd1dpdGhMaW5lYnJlYWtzKFwiSW5wdXQgeW91ciBjb21tYW5kcyBhbmQgd2F0Y2ggdGhlIHR1cm4gcGxheSBvdXQuIFlvdSBjYW4gc2VlIGV2ZXJ5dGhpbmcgeW91ciBlbmVtaWVzIHdpbGwgZG9cXG5cIiwgMiwgcG9zLCAyLCBCYXR0bGVSZW5kZXIuQ29sb3JzLklucHV0RGVzY3JpcHRpb24pO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHN0cmluZyBtZW51VGl0bGUgPSBcIkhFTFBcIjtcclxuICAgICAgICAgICAgc3RyaW5nIGxlYXZlTGFiZWwgPSBcIkVYSVRcIjtcclxuICAgICAgICAgICAgaWYgKG1vZGVsLmJhdHRsZUludHJvTW9kZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbGVhdmVMYWJlbCA9IFwiU1RBUlRcIjtcclxuICAgICAgICAgICAgICAgIG1lbnVUaXRsZSA9IFwiQkFUVExFIElOVFJPXCI7XHJcbiAgICAgICAgICAgICAgICBMZWF2ZUJ1dHRvbiA9IChjaGFyKVVuaWNvZGUuU3BhY2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBMZWF2ZUJ1dHRvbiA9ICd4JztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobW9kZWwuYXR0YWNrRGVtbylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbWVudVRpdGxlID0gXCJBVFRBQ0sgU0lNVUxBVElPTlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhd09uQ2VudGVySG9yaXpvbnRhbChtZW51VGl0bGUsIEJhdHRsZVJlbmRlci5Db2xvcnMuV2luZG93TGFiZWwsIDAsIDEpO1xyXG4gICAgICAgICAgICBib29sIGhlcm9Db21tYW5kRXhpc3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtb2RlbC5jb21tYW5kc0hlcm8uQ291bnQ7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKENoZWNrRHJhd0NvbW1hbmQobW9kZWwuY29tbWFuZHNIZXJvW2ldKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBoZXJvQ29tbWFuZEV4aXN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBib29sIGVuZW15Q29tbWFuZEV4aXN0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbW9kZWwuY29tbWFuZHNFbmVteS5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoQ2hlY2tEcmF3Q29tbWFuZChtb2RlbC5jb21tYW5kc0VuZW15W2ldKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBlbmVteUNvbW1hbmRFeGlzdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG1vZGVsLmF0dGFja0RlbW8pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vdGV4dFdvcmxkLm1haW5Cb2FyZC5EcmF3X0N1cnNvcl9TbWFydExpbmVCcmVhayhcIkEgYmF0dGxlIHNpbXVsYXRpb24gd2hlcmUgeW91IGNhbiBwcmV2aWV3IGVuZW15IGF0dGFja3MgYmVmb3JlaGFuZFwiLCAyLCBwb3MsIDIsIEJhdHRsZVJlbmRlci5Db2xvcnMuV2luZG93TGFiZWwpO1xyXG4gICAgICAgICAgICAgICAgcG9zICs9IDQ7XHJcbiAgICAgICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXcoXCJTSU1VTEFURUQgQVRUQUNLXCIsIDIsIHBvcywgQmF0dGxlUmVuZGVyLkNvbG9ycy5XaW5kb3dMYWJlbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaGVyb0NvbW1hbmRFeGlzdCAmJiBmYWxzZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXcoXCJZT1VSIENPTU1BTkRTXCIsIDIsIHBvcyAtIDIsIEJhdHRsZVJlbmRlci5Db2xvcnMuV2luZG93TGFiZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIExpc3Q8aW50PiBjb21tYW5kTGlzdCA9IG1vZGVsLmNvbW1hbmRzSGVybztcclxuICAgICAgICAgICAgICAgICAgICBwb3MgPSBTaG93Q29tbWFuZHMocG9zLCBjb21tYW5kTGlzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9zICs9IDQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmKGVuZW15Q29tbWFuZEV4aXN0KVxyXG4gICAgICAgICAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhdyhcIkVORU1ZIENPTU1BTkRTXCIsIDIsIHBvcywgQmF0dGxlUmVuZGVyLkNvbG9ycy5XaW5kb3dMYWJlbCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBpZiAoZW5lbXlDb21tYW5kRXhpc3QpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHBvcyArPSAyO1xyXG4gICAgICAgICAgICAgICAgcG9zID0gU2hvd0NvbW1hbmRzKHBvcywgbW9kZWwuY29tbWFuZHNFbmVteSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgR2FtZU1haW4uRHJhd0lucHV0KDEsIHBvcyArIDMsIExlYXZlQnV0dG9uLCBsZWF2ZUxhYmVsLCB0ZXh0V29ybGQubWFpbkJvYXJkKTtcclxuXHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBpbnQgU2hvd0NvbW1hbmRzKGludCBwb3MsIExpc3Q8aW50PiBjb21tYW5kTGlzdClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY29tbWFuZExpc3QuQ291bnQ7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlKFwiRFJBV1dXXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgIGludCBjb21tYW5kID0gY29tbWFuZExpc3RbaV07XHJcbiAgICAgICAgICAgICAgICBib29sIGRyYXdGbGFnID0gQ2hlY2tEcmF3Q29tbWFuZChjb21tYW5kKTtcclxuICAgICAgICAgICAgICAgIGlmIChkcmF3RmxhZylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXcobW92ZVJlbmRlcnNbY29tbWFuZF0uQWJyZXYsIDIsIHBvcywgQmF0dGxlUmVuZGVyLkNvbG9ycy5IZXJvVHVybik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5EcmF3KG1vdmVSZW5kZXJzW2NvbW1hbmRdLkxhYmVsLlRvVXBwZXIoKSwgNSwgcG9zLCBCYXR0bGVSZW5kZXIuQ29sb3JzLkhlcm9UdXJuKTtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLlNldEN1cnNvckF0KDMsIHBvcyArIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhd19DdXJzb3JfU21hcnRMaW5lQnJlYWsobW92ZVJlbmRlcnNbY29tbWFuZF0uRGVzY3JpcHRpb24sIEJhdHRsZVJlbmRlci5Db2xvcnMuSW5wdXREZXNjcmlwdGlvbiwgMCwgbW92ZVJlbmRlcnNbY29tbWFuZF0uRGVzY3JpcHRpb24uTGVuZ3RoIC0gMSwgMyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy90ZXh0V29ybGQubWFpbkJvYXJkLkRyYXcobW92ZVJlbmRlcnNbY29tbWFuZF0uRGVzY3JpcHRpb24sIDMsIHBvcyArIDEsIEJhdHRsZVJlbmRlci5Db2xvcnMuSW5wdXREZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9zICs9IDM7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcG9zO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBib29sIElzU2hvd2luZ0NvbW1hbmRJbkxpc3QoTGlzdDxpbnQ+IGNvbW1hbmRMaXN0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb21tYW5kTGlzdC5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGUoXCJEUkFXV1dcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgaW50IGNvbW1hbmQgPSBjb21tYW5kTGlzdFtpXTtcclxuICAgICAgICAgICAgICAgIGlmIChDaGVja0RyYXdDb21tYW5kKGNvbW1hbmQpKSByZXR1cm4gdHJ1ZTtcclxuXHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGJvb2wgQ2hlY2tEcmF3Q29tbWFuZChpbnQgY29tbWFuZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJvb2wgZHJhd0ZsYWcgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKGNvbW1hbmQgPj0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShjb21tYW5kKTtcclxuICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoKTtcclxuICAgICAgICAgICAgICAgIHZhciBtZCA9IG1vdmVEYXRhc1tjb21tYW5kXTtcclxuICAgICAgICAgICAgICAgIGlmICghbWQuSGFzVGFnKChpbnQpTW92ZURhdGFUYWdzLk1vdmVtZW50KSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBkcmF3RmxhZyA9IG1vdmVSZW5kZXJzW2NvbW1hbmRdLkxhYmVsLkxlbmd0aCAhPSAwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkcmF3RmxhZztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBUZXh0Qm9hcmQgR2V0Qm9hcmQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRleHRXb3JsZC5tYWluQm9hcmQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIFNob3coKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbW9kZWwuUmVmcmVzaERhdGEoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgSGVscE1vZGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbW9kZWwuYmF0dGxlSW50cm9Nb2RlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCBib29sIElzV2FubmFTaG93SW50cm8oKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbW9kZWwuUmVmcmVzaERhdGEoKTtcclxuICAgICAgICAgICAgcmV0dXJuIElzU2hvd2luZ0NvbW1hbmRJbkxpc3QobW9kZWwuY29tbWFuZHNFbmVteSkgfHwgSXNTaG93aW5nQ29tbWFuZEluTGlzdChtb2RlbC5jb21tYW5kc0hlcm8pO1xyXG4gICAgICAgICAgICAvL3JldHVybiBtb2RlbC5jb21tYW5kc0VuZW15LkNvdW50ICE9IDAgfHwgbW9kZWwuY29tbWFuZHNIZXJvLkNvdW50ICE9IDA7XHJcbiAgICAgICAgfVxyXG5cbiAgICBcbnByaXZhdGUgTW91c2VJTyBfX1Byb3BlcnR5X19Jbml0aWFsaXplcl9fTW91c2U9bmV3IE1vdXNlSU8oKTt9XHJcblxyXG4gICAgcHVibGljIGNsYXNzIEhlbHBTY3JlZW5Nb2RlbFxyXG4gICAge1xyXG4gICAgICAgIEJhdHRsZU1haW4gYmF0dGxlTWFpbjtcclxuICAgICAgICBwdWJsaWMgTGlzdDxpbnQ+IGNvbW1hbmRzSGVybyA9IG5ldyBMaXN0PGludD4oKTtcclxuICAgICAgICBwdWJsaWMgTGlzdDxpbnQ+IGNvbW1hbmRzRW5lbXkgPSBuZXcgTGlzdDxpbnQ+KCk7XHJcbiAgICAgICAgcHVibGljIGJvb2wgYmF0dGxlSW50cm9Nb2RlID0gZmFsc2U7XHJcbiAgICAgICAgcHVibGljIGJvb2wgYXR0YWNrRGVtbztcclxuICAgICAgICBwdWJsaWMgYm9vbCBraWxsQWxsRW5lbWllcztcclxuXHJcbiAgICAgICAgcHVibGljIEhlbHBTY3JlZW5Nb2RlbChCYXR0bGVNYWluIGJhdHRsZU1haW4pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLmJhdHRsZU1haW4gPSBiYXR0bGVNYWluO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFJlZnJlc2hEYXRhKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGNvbW1hbmRzSGVyby5DbGVhcigpO1xyXG4gICAgICAgICAgICBBZGRBbGwoYmF0dGxlTWFpbi5wbGF5ZXJIYW5kRml4ZWQsIGNvbW1hbmRzSGVybyk7XHJcbiAgICAgICAgICAgIEFkZEFsbChiYXR0bGVNYWluLnBsYXllckhhbmRVbmZpeGVkLCBjb21tYW5kc0hlcm8pO1xyXG4gICAgICAgICAgICBBZGRBbGwoYmF0dGxlTWFpbi5wbGF5ZXJIYW5kUG9vbCwgY29tbWFuZHNIZXJvKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGl0ZW0gaW4gYmF0dGxlTWFpbi5lbnRpdGllcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQWRkQWxsQXJyYXkoaXRlbS5tb3ZlcywgY29tbWFuZHNFbmVteSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYXR0YWNrRGVtbyA9IGJhdHRsZU1haW4uQmF0dGxlQ29uZmlnLmF0dGFja0RlbW9uc3RyYXRpb25Nb2RlO1xyXG4gICAgICAgICAgICBraWxsQWxsRW5lbWllcyA9IGJhdHRsZU1haW4uQmF0dGxlQ29uZmlnLm5lZWRLaWxsQWxsRW5lbWllcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBBZGRBbGwoTGlzdDxCYXR0bGVNYWluLk1vdmVUeXBlPiBtb3ZlcywgTGlzdDxpbnQ+IGNvbW1hbmRzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIG0gaW4gbW92ZXMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCBhID0gKGludCltO1xyXG4gICAgICAgICAgICAgICAgaWYgKGEgPCAwKSBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGlmICghY29tbWFuZHMuQ29udGFpbnMoYSkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29tbWFuZHMuQWRkKGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgQWRkQWxsQXJyYXkoaW50W10gbW92ZXMsIExpc3Q8aW50PiBjb21tYW5kcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBhIGluIG1vdmVzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYSA8IDApIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjb21tYW5kcy5Db250YWlucyhhKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjb21tYW5kcy5BZGQoYSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxufVxyXG4iLCJ1c2luZyBQaWRyb2guQmFzZVV0aWxzO1xyXG51c2luZyBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQ7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5UdXJuQmFzZWQuVGV4dFJlbmRlcmluZ1xyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgSW5wdXRIYW5kbGluZ1xyXG4gICAge1xyXG4gICAgICAgIGludFtdIHVuZml4ZWRDb21tYW5kS2V5cyA9IHsnMScsICcyJywnMycsJzQnLCAnNScgfTtcclxuICAgICAgICBEaWN0aW9uYXJ5PElucHV0VW5pdCwgaW50PiBmaXhlZE1vdmVCdXR0b25zID0gZ2xvYmFsOjpCcmlkZ2UuU2NyaXB0LkNhbGxGb3IobmV3IERpY3Rpb25hcnk8SW5wdXRVbml0LCBpbnQ+KCksKF9vMSk9PntfbzEuQWRkKG5ldyBJbnB1dFVuaXQoSW5wdXRUeXBlLk1vdmUsIEJhdHRsZU1haW4uTW92ZVR5cGUuTm9ybWFsU2hvdCksJ2cnKTtfbzEuQWRkKG5ldyBJbnB1dFVuaXQoSW5wdXRUeXBlLk1vdmUsIEJhdHRsZU1haW4uTW92ZVR5cGUuRmlyZSksJ2YnKTtfbzEuQWRkKG5ldyBJbnB1dFVuaXQoSW5wdXRUeXBlLk1vdmUsIEJhdHRsZU1haW4uTW92ZVR5cGUuSWNlKSwnaScpO19vMS5BZGQobmV3IElucHV0VW5pdChJbnB1dFR5cGUuTW92ZSwgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5JY2VCb21iKSwnYicpO19vMS5BZGQobmV3IElucHV0VW5pdChJbnB1dFR5cGUuTW92ZSwgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5UaHVuZGVyQm9tYiksJ3knKTtfbzEuQWRkKG5ldyBJbnB1dFVuaXQoSW5wdXRUeXBlLk1vdmUsIEJhdHRsZU1haW4uTW92ZVR5cGUuVGh1bmRlciksJ3QnKTtfbzEuQWRkKG5ldyBJbnB1dFVuaXQoSW5wdXRUeXBlLk1vdmUsIEJhdHRsZU1haW4uTW92ZVR5cGUuTW92ZVJpZ2h0KSwnZCcpO19vMS5BZGQobmV3IElucHV0VW5pdChJbnB1dFR5cGUuTW92ZSwgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5Nb3ZlVXApLCd3Jyk7X28xLkFkZChuZXcgSW5wdXRVbml0KElucHV0VHlwZS5Nb3ZlLCBCYXR0bGVNYWluLk1vdmVUeXBlLk1vdmVEb3duKSwncycpO19vMS5BZGQobmV3IElucHV0VW5pdChJbnB1dFR5cGUuTW92ZSwgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5Nb3ZlTGVmdCksJ2EnKTtfbzEuQWRkKG5ldyBJbnB1dFVuaXQoSW5wdXRUeXBlLk1pc2NCYXR0bGUsIE1pc2NCYXR0bGVJbnB1dC5Eb25lKSxVbmljb2RlLlNwYWNlKTtfbzEuQWRkKG5ldyBJbnB1dFVuaXQoSW5wdXRUeXBlLk1pc2NCYXR0bGUsIE1pc2NCYXR0bGVJbnB1dC5SZWRvKSwncicpO19vMS5BZGQobmV3IElucHV0VW5pdChJbnB1dFR5cGUuTWlzY0JhdHRsZSwgTWlzY0JhdHRsZUlucHV0LlByZXZpZXcpLCdwJyk7X28xLkFkZChuZXcgSW5wdXRVbml0KElucHV0VHlwZS5NaXNjQmF0dGxlLCBNaXNjQmF0dGxlSW5wdXQuSGVscCksJ2gnKTtfbzEuQWRkKG5ldyBJbnB1dFVuaXQoSW5wdXRUeXBlLk1pc2NCYXR0bGUsIE1pc2NCYXR0bGVJbnB1dC5DYW5jZWwpLCdyJyk7X28xLkFkZChuZXcgSW5wdXRVbml0KElucHV0VHlwZS5NaXNjQmF0dGxlLCBNaXNjQmF0dGxlSW5wdXQuQ29uZmlybSksVW5pY29kZS5TcGFjZSk7X28xLkFkZChuZXcgSW5wdXRVbml0KElucHV0VHlwZS5NaXNjQmF0dGxlLCBNaXNjQmF0dGxlSW5wdXQuTGVhdmVBdHRhY2tEZW1vbnN0cmF0aW9uKSxVbmljb2RlLkVzY2FwZSk7cmV0dXJuIF9vMTt9KTtcclxuXHJcbiAgICAgICAgTGlzdDxLZXlWYWx1ZVBhaXI8SW5wdXRVbml0LCBpbnQ+PiBmaXhlZE1vdmVCdXR0b25BbHRlcm5hdGl2ZSA9IGdsb2JhbDo6QnJpZGdlLlNjcmlwdC5DYWxsRm9yKG5ldyBMaXN0PEtleVZhbHVlUGFpcjxJbnB1dFVuaXQsIGludD4+KCksKF9vMik9PntfbzIuQWRkKG5ldyBLZXlWYWx1ZVBhaXI8SW5wdXRVbml0LCBpbnQ+KG5ldyBJbnB1dFVuaXQoSW5wdXRUeXBlLk1pc2NCYXR0bGUsIE1pc2NCYXR0bGVJbnB1dC5SZWRvKSxVbmljb2RlLkJhY2tzcGFjZSkpO3JldHVybiBfbzI7fSk7XHJcblxyXG4gICAgICAgIC8vTGlzdDxJbnB1dFVuaXQ+IGJ1dHRvbkVxdWl2YWxlbmNlID0gbmV3IExpc3Q8SW5wdXRVbml0PigpO1xyXG4gICAgICAgIC8vTGlzdDxpbnQ+IGJ1dHRvbkVxdWl2YWxlbmNlS2V5ID0gbmV3IExpc3Q8aW50PigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IEdldEZpeGVkTW92ZVVuaWNvZGUoSW5wdXRVbml0IGlucHV0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IHZhbHVlO1xyXG4gICAgICAgICAgICBpZiAoZml4ZWRNb3ZlQnV0dG9ucy5UcnlHZXRWYWx1ZShpbnB1dCwgb3V0IHZhbHVlKSlcclxuICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhbHVlID0gLTE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIElucHV0VW5pdCBJbnB1dHRlZChpbnQgdW5pY29kZUtleSwgSW5wdXRIb2xkZXIgaW5wdXQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKFwiIGlucHV0ICsgXCIrKGNoYXIpdW5pY29kZUtleSk7XHJcbiAgICAgICAgICAgIGZvcmVhY2ggKHZhciBpdGVtIGluIGZpeGVkTW92ZUJ1dHRvbnMpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLlZhbHVlID09IHVuaWNvZGVLZXkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoaW5wdXQuQ29udGFpbnMoaXRlbS5LZXkpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5LZXk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGl0ZW0gaW4gZml4ZWRNb3ZlQnV0dG9uQWx0ZXJuYXRpdmUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLlZhbHVlID09IHVuaWNvZGVLZXkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0LkNvbnRhaW5zKGl0ZW0uS2V5KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uS2V5O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdW5maXhlZENvbW1hbmRLZXlzLkxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAodW5maXhlZENvbW1hbmRLZXlzW2ldID09IHVuaWNvZGVLZXkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW50IHVuZml4ZWRDb21tYW5kUG9zID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpMiA9IDA7IGkyIDwgaW5wdXQuaW5wdXRzLkNvdW50OyBpMisrKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0LlRhZ0lzKGkyLCBJbnB1dFRhZ3MuTU9WRVVORklYKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVuZml4ZWRDb21tYW5kUG9zID09IGkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlucHV0LmlucHV0c1tpMl07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmZpeGVkQ29tbWFuZFBvcysrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0KElucHV0VW5pdCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFBpZHJvaC5CYXNlVXRpbHM7XHJcbnVzaW5nIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZDtcclxudXNpbmcgUGlkcm9oLlRleHRSZW5kZXJpbmc7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5UdXJuQmFzZWQuVGV4dFJlbmRlcmluZ1xyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgTWVzc2FnZU9uUG9zaXRpb25cclxuICAgIHtcclxuICAgICAgICBCYXR0bGVSZW5kZXIgYmF0dGxlUmVuZGVyO1xyXG4gICAgICAgIHByaXZhdGUgVGV4dFdvcmxkIHRleHRXb3JsZDtcclxuICAgICAgICBwcml2YXRlIEJsaW5rQW5pbSBibGlua0FuaW07XHJcblxyXG4gICAgICAgIHB1YmxpYyBNZXNzYWdlT25Qb3NpdGlvbihCYXR0bGVSZW5kZXIgYmF0dGxlUmVuZGVyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGV4dFdvcmxkID0gYmF0dGxlUmVuZGVyLnRleHRXb3JsZDtcclxuICAgICAgICAgICAgYmxpbmtBbmltID0gdGV4dFdvcmxkLkFkZEFuaW1hdGlvbjxnbG9iYWw6OlBpZHJvaC5UZXh0UmVuZGVyaW5nLkJsaW5rQW5pbT4obmV3IEJsaW5rQW5pbSgpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIE1lc3NhZ2VPblBvcyhWZWN0b3IyRCBwb3MsIHN0cmluZyB2KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGVudGl0eSA9IHRleHRXb3JsZC5HZXRUZW1wRW50aXR5KHYuTGVuZ3RoICsgMiwgNik7XHJcbiAgICAgICAgICAgIGJsaW5rQW5pbS5BZGQoZW50aXR5LkFuaW1CYXNlKDJmKSwgbmV3IEJsaW5rQW5pbS5CbGlua0RhdGEoVGV4dEJvYXJkLk5PQ0hBTkdFQ0hBUiwgVGV4dEJvYXJkLk5PQ0hBTkdFQ09MT1IsIFRleHRCb2FyZC5OT0NIQU5HRUNPTE9SLCAwLjM1ZiwgMC4zNWYpKTtcclxuICAgICAgICAgICAgdmFyIHhPZmYgPSAodi5MZW5ndGggLSAzKSAvIDI7XHJcbiAgICAgICAgICAgIGlmICh4T2ZmIDwgMCkgeE9mZiA9IDA7XHJcbiAgICAgICAgICAgIHZhciBsaW5lU3RhcnQgPSBuZXcgVmVjdG9yMkQoeE9mZiwgMCk7XHJcbiAgICAgICAgICAgIGVudGl0eS5TZXRQb3NpdGlvbihwb3MgKyBuZXcgVmVjdG9yMkQoMSAtIHhPZmYsIDApKTtcclxuICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlKHBvcyk7XHJcbiAgICAgICAgICAgIC8vZW50aXR5Lk9yaWdpbi5EcmF3KHYsIDEsIDUpO1xyXG4gICAgICAgICAgICBlbnRpdHkuT3JpZ2luLkRyYXdXaXRoR3JpZCh2LCAwLCAzLCBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5IZXJvLCBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5IZXJvKTtcclxuXHJcbiAgICAgICAgICAgIGVudGl0eS5PcmlnaW4uRHJhd0xpbmVzKFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkhlcm8sIGxpbmVTdGFydCwgbGluZVN0YXJ0ICsgbmV3IFZlY3RvcjJEKDIsIDApLCBsaW5lU3RhcnQgKyBuZXcgVmVjdG9yMkQoMiwgMikpO1xyXG4gICAgICAgICAgICBlbnRpdHkuT3JpZ2luLkF1dG9GaXhHcmlkZGluZygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQ7XHJcbnVzaW5nIFBpZHJvaC5UZXh0UmVuZGVyaW5nO1xyXG51c2luZyBQaWRyb2guVGV4dFJlbmRlcmluZy5HYW1lU2NyZWVuO1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guVHVybkJhc2VkLlRleHRSZW5kZXJpbmdcclxue1xyXG4gICAgcHVibGljIGNsYXNzIE1vdXNlSG92ZXJUZXh0XHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0cmluZ1tdW10gdGV4dHMgPSBuZXcgc3RyaW5nWzNdW107XHJcbiAgICAgICAgcHVibGljIE1vdXNlSG92ZXJNYW5hZ2VyIGhvdmVyTWFuYWdlcjtcclxuICAgICAgICBwdWJsaWMgVGV4dEVudGl0eSBlbnRpdHk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBNb3VzZUhvdmVyVGV4dChNb3VzZUhvdmVyTWFuYWdlciBob3Zlck1hbmFnZXIsIFRleHRFbnRpdHkgZW50aXR5LCBzdHJpbmdbXSBtb3ZlRGVzY3JpcHRpb25zKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGhpcy5ob3Zlck1hbmFnZXIgPSBob3Zlck1hbmFnZXI7XHJcbiAgICAgICAgICAgIHRoaXMuZW50aXR5ID0gZW50aXR5O1xyXG4gICAgICAgICAgICAvL3RleHRzWzBdID0gbmV3IHN0cmluZ1tFbnVtLkdldFZhbHVlcyh0eXBlb2YoQmF0dGxlTWFpbi5Nb3ZlVHlwZSkpLkxlbmd0aF07XHJcblxyXG4gICAgICAgICAgICB0ZXh0c1swXSA9IG1vdmVEZXNjcmlwdGlvbnM7XHJcbiAgICAgICAgICAgIC8vRG9uZSxcclxuICAgICAgICAvLyAgICBSZWRvLFxyXG4gICAgICAgIC8vUHJldmlldyxcclxuICAgICAgICAvL0NvbmZpcm0sXHJcbiAgICAgICAgLy9DYW5jZWxcclxuICAgICAgICAgICAgdGV4dHNbMV0gPSBuZXcgc3RyaW5nW10ge1xyXG4gICAgICAgICAgICAgICAgXCJTdGFydHMgY29tbWFuZCBleGVjdXRpb25cIixcclxuICAgICAgICAgICAgICAgIFwiUmVtb3ZlcyB0aGUgbGFzdCBpbnB1dHRlZCBjb21tYW5kXCIsXHJcbiAgICAgICAgICAgICAgICBcIlByZXZpZXcgbW92ZXMgb2YgdGhlIG9wcG9uZW50c1wiLFxyXG4gICAgICAgICAgICAgICAgXCJJbnB1dHMgbW92ZVwiLFxyXG4gICAgICAgICAgICAgICAgXCJSZXR1cm5zXCIsXHJcbiAgICAgICAgICAgICAgICBcIlNob3dzIGhlbHBmdWwgaW5mb3JtYXRpb25cIixcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGV4dHNbMl0gPSBuZXcgc3RyaW5nW10ge1xyXG4gICAgICAgICAgICAgICAgXCJNb3ZlcyBpbiB0aGUgY29ycmVzcG9uZGluZyBkaXJlY3Rpb25cIixcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBVcGRhdGUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZW50aXR5LlJlc2V0RnVsbCgpO1xyXG4gICAgICAgICAgICBob3Zlck1hbmFnZXIuVXBkYXRlKCk7XHJcbiAgICAgICAgICAgIHZhciBhY3RpdmUgPSBob3Zlck1hbmFnZXIubW91c2VIb3ZlcnNBY3RpdmU7XHJcbiAgICAgICAgICAgIGlmIChhY3RpdmUuQ291bnQgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGUoXCJIT1ZFUlwiKTtcclxuICAgICAgICAgICAgICAgIGludCBpZCA9IGFjdGl2ZVswXS5pZDtcclxuICAgICAgICAgICAgICAgIGlmKGlkID49IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHRleHQgPSB0ZXh0c1thY3RpdmVbMF0udHlwZV1baWRdO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vZW50aXR5Lk9yaWdpbi5EcmF3KHRleHQsIDAsIDAsIDIsIEJhdHRsZVJlbmRlci5Db2xvcnMuQmFja0JhdHRsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZW50aXR5Lk9yaWdpbi5TZXRDdXJzb3JBdCgwLDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGVudGl0eS5PcmlnaW4uRHJhd19DdXJzb3JfU21hcnRMaW5lQnJlYWsodGV4dCwgMik7XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaW50IHggPSBhY3RpdmVbMF0ucmVjdC5YICsgMSAtIHRleHQuTGVuZ3RoLzI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHggPCAwKSB4ID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBlbnRpdHkuU2V0UG9zaXRpb24oeCwgYWN0aXZlWzBdLnJlY3QuWSAtMik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgUGlkcm9oLkJhc2VVdGlscztcclxudXNpbmcgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkO1xyXG51c2luZyBQaWRyb2guVGV4dFJlbmRlcmluZztcclxudXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLlR1cm5CYXNlZC5UZXh0UmVuZGVyaW5nXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBOYXZpZ2F0aW9uS2V5Ym9hcmRcclxuICAgIHtcclxuICAgICAgICBMaXN0PFBvaW50MkQ+IHBvaW50cyA9IG5ldyBMaXN0PFBvaW50MkQ+KCk7XHJcbiAgICAgICAgcHVibGljIGludCBjdXJyZW50UG9pbnQgPSAwO1xyXG4gICAgICAgIHByaXZhdGUgVGV4dFdvcmxkIHRleHRXb3JsZDtcclxuICAgICAgICBwcml2YXRlIFRleHRFbnRpdHkgY3Vyc29yO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgY2hvc2VuT3B0aW9uID0gLTE7XHJcbiAgICAgICAgcHVibGljIGJvb2wgc2hvd0VzY2FwZSA9IHRydWU7XHJcbiAgICAgICAgcHVibGljIGJvb2wgd2FudFRvRXNjYXBlID0gZmFsc2U7XHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIHB1YmxpYyBOYXZpZ2F0aW9uS2V5Ym9hcmQoVGV4dFdvcmxkIHRleHRXb3JsZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMudGV4dFdvcmxkID0gdGV4dFdvcmxkO1xyXG4gICAgICAgICAgICBjdXJzb3IgPSB0ZXh0V29ybGQuR2V0RnJlZUVudGl0eSgxLCAxKTtcclxuICAgICAgICAgICAgY3Vyc29yLk9yaWdpbi5EcmF3Q2hhcignQCcsIDAsIDAsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkhlcm8pO1xyXG4gICAgICAgICAgICAvL1VwZGF0ZVBvaW50KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL2ludCBpbnB1dFVuaWNvZGU7XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIENoZWNrSW5wdXQoaW50IGlucHV0VW5pY29kZSlcclxuICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKGlucHV0VW5pY29kZSk7XHJcbiAgICAgICAgICAgIGlmIChpbnB1dFVuaWNvZGUgPT0gVW5pY29kZS5TcGFjZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY2hvc2VuT3B0aW9uID0gY3VycmVudFBvaW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpbnB1dFVuaWNvZGUgPT0gJ3MnIHx8IGlucHV0VW5pY29kZSA9PSAnZCcpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIE1vdmUoMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGlucHV0VW5pY29kZSA9PSAndycgfHwgaW5wdXRVbmljb2RlID09ICdhJylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgTW92ZSgtMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoaW5wdXRVbmljb2RlID09IFVuaWNvZGUuRXNjYXBlICYmIHNob3dFc2NhcGUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHdhbnRUb0VzY2FwZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBNb3ZlKGludCB2KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgY3VycmVudFBvaW50ICs9IHY7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50UG9pbnQgPj0gcG9pbnRzLkNvdW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50UG9pbnQgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50UG9pbnQgPCAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50UG9pbnQgPSBwb2ludHMuQ291bnQgLSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFVwZGF0ZVBvaW50KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgVXBkYXRlUG9pbnQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRQb2ludCA8IHBvaW50cy5Db3VudClcclxuICAgICAgICAgICAgICAgIGN1cnNvci5TZXRQb3NpdGlvbihwb2ludHNbY3VycmVudFBvaW50XSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3Q29udHJvbHMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IHkgPSAzMDtcclxuICAgICAgICAgICAgVUlSZXVzYWJsZS5EcmF3Q29udHJvbHNMYWJlbCh0ZXh0V29ybGQsIHkpO1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZm9yY2VJbnB1dExhYmVsID0gVUlSZXVzYWJsZS5XQVNEO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZvcmNlQ29tbWFuZExhYmVsID0gVUlSZXVzYWJsZS5hcnJvd3M7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIEJhdHRsZVJlbmRlci5EcmF3SW5wdXQoNywgeSsyLCBmb3JjZUlucHV0TGFiZWwsIGZvcmNlQ29tbWFuZExhYmVsLCB0ZXh0V29ybGQubWFpbkJvYXJkKTtcclxuICAgICAgICAgICAgICAgIEdhbWVNYWluLkRyYXdJbnB1dCg3LCB5KzQsIFVuaWNvZGUuU3BhY2UsIFwiU0VMRUNUXCIsIHRleHRXb3JsZC5tYWluQm9hcmQpO1xyXG4gICAgICAgICAgICAgICAgaWYoc2hvd0VzY2FwZSlcclxuICAgICAgICAgICAgICAgICAgICBHYW1lTWFpbi5EcmF3SW5wdXQoNywgeSs2LCBVbmljb2RlLkVzY2FwZSwgXCJSRVRVUk5cIiwgdGV4dFdvcmxkLm1haW5Cb2FyZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBDbGVhcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwb2ludHMuQ2xlYXIoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgUmVzZXRDaG9pY2UoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9jdXJyZW50UG9pbnQgPSAwO1xyXG4gICAgICAgICAgICBjaG9zZW5PcHRpb24gPSAtMTtcclxuICAgICAgICAgICAgd2FudFRvRXNjYXBlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIEFkZChpbnQgeCwgaW50IHkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwb2ludHMuQWRkKG5ldyBQb2ludDJEKHgsIHkpKTtcclxuICAgICAgICAgICAgVXBkYXRlUG9pbnQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgU2hvd0N1cnNvcihib29sIHYpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAodilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY3Vyc29yLk9yaWdpbi5EcmF3Q2hhcignQCcsIDAsIDAsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkhlcm8pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY3Vyc29yLk9yaWdpbi5SZXNldCgpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBSZXNldEN1cnNvcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBNb3ZlKC1jdXJyZW50UG9pbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxudXNpbmcgUGlkcm9oLkJhc2VVdGlscztcclxudXNpbmcgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkO1xyXG51c2luZyBQaWRyb2guRUNTO1xyXG5cclxubmFtZXNwYWNlIFBpZHJvaC5UdXJuQmFzZWQuVGV4dFJlbmRlcmluZ1xyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgUHJldmlld1N5c3RlbVxyXG4gICAge1xyXG4gICAgICAgIHByaXZhdGUgRUNTTWFuYWdlciBlY3M7XHJcbiAgICAgICAgcHJpdmF0ZSBCYXR0bGVNYWluIGJhdHRsZU1haW47XHJcbiAgICAgICAgcHVibGljIGJvb2wgcHJldmlld0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIHByaXZhdGUgQ2xvbmVkU3RhdGUgY2xvbmVkU3RhdGU7XHJcbiAgICAgICAgcHJpdmF0ZSBRdWlja0FjY2Vzc29yT25lPEJhdHRsZU1haW4uQmF0dGxlRW50aXR5PiBiYXR0bGVFbnRpdHk7XHJcbiAgICAgICAgRGVidWdnZXIgZGVidWcgPSBuZXcgRGVidWdnZXIodHJ1ZSk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBQcmV2aWV3U3lzdGVtKEVDU01hbmFnZXIgZWNzLCBCYXR0bGVNYWluIGJhdHRsZU1haW4pXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0aGlzLmVjcyA9IGVjcztcclxuICAgICAgICAgICAgZWNzLkFkZENvcHlNZXRob2QodHlwZW9mKEJhdHRsZU1haW4uQmF0dGxlRW50aXR5KSwgKGdsb2JhbDo6U3lzdGVtLkFjdGlvbjxvYmplY3QsIG9iamVjdD4pKChvMSwgbzIpPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRvID0gbzIgYXMgQmF0dGxlTWFpbi5CYXR0bGVFbnRpdHk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZnJvbSA9IG8xIGFzIEJhdHRsZU1haW4uQmF0dGxlRW50aXR5O1xyXG4gICAgICAgICAgICAgICAgdG8ucG9zID0gZnJvbS5wb3M7XHJcbiAgICAgICAgICAgICAgICB0by5saWZlID0gZnJvbS5saWZlO1xyXG4gICAgICAgICAgICAgICAgdG8ubWF4TGlmZSA9IGZyb20ubWF4TGlmZTtcclxuICAgICAgICAgICAgICAgIHRvLmVsZW1lbnQgPSBmcm9tLmVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRvLm1vdmVzLkxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvLm1vdmVzW2ldID0gZnJvbS5tb3Zlc1tpXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICBlY3MuQWRkQ29weU1ldGhvZCh0eXBlb2YoQmF0dGxlTWFpbi5CYXR0bGVTdGF0ZSksIChnbG9iYWw6OlN5c3RlbS5BY3Rpb248b2JqZWN0LCBvYmplY3Q+KSgobzEsIG8yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG8gPSBvMiBhcyBCYXR0bGVNYWluLkJhdHRsZVN0YXRlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZyb20gPSBvMSBhcyBCYXR0bGVNYWluLkJhdHRsZVN0YXRlO1xyXG4gICAgICAgICAgICAgICAgdG8uYWN0aW5nRW50aXR5ID0gZnJvbS5hY3RpbmdFbnRpdHk7XHJcbiAgICAgICAgICAgICAgICB0by5CYXR0bGVFbmRFbmFibGUgPSBmcm9tLkJhdHRsZUVuZEVuYWJsZTtcclxuICAgICAgICAgICAgICAgIHRvLm1vdmVUaWNrX05vdyA9IGZyb20ubW92ZVRpY2tfTm93O1xyXG4gICAgICAgICAgICAgICAgdG8ubW92ZVRpY2tfVG90YWwgPSBmcm9tLm1vdmVUaWNrX1RvdGFsO1xyXG4gICAgICAgICAgICAgICAgdG8ucGhhc2UgPSBmcm9tLnBoYXNlO1xyXG4gICAgICAgICAgICAgICAgdG8udHVybiA9IGZyb20udHVybjtcclxuICAgICAgICAgICAgICAgIHRvLnR1cm5zUGVyUGhhc2UgPSBmcm9tLnR1cm5zUGVyUGhhc2U7XHJcbiAgICAgICAgICAgICAgICB0by50b3RhbFR1cm5zID0gZnJvbS50b3RhbFR1cm5zO1xyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIGVjcy5BZGRDb3B5TWV0aG9kKHR5cGVvZihUaW1lU3RhbXApLCAoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uPG9iamVjdCwgb2JqZWN0PikoKG8xLCBvMikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRvID0gbzIgYXMgVGltZVN0YW1wO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZyb20gPSBvMSBhcyBUaW1lU3RhbXA7XHJcbiAgICAgICAgICAgICAgICB0by5DdXJyZW50U25hcCA9IGZyb20uQ3VycmVudFNuYXA7XHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgZWNzLkFkZENvcHlNZXRob2QodHlwZW9mKEhhcHBIYW5kbGluZy5IYXBwSGFuZGxlU3RhdGUpLCAoZ2xvYmFsOjpTeXN0ZW0uQWN0aW9uPG9iamVjdCwgb2JqZWN0PikoKG8xLCBvMikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRvID0gbzIgYXMgSGFwcEhhbmRsaW5nLkhhcHBIYW5kbGVTdGF0ZTtcclxuICAgICAgICAgICAgICAgIHZhciBmcm9tID0gbzEgYXMgSGFwcEhhbmRsaW5nLkhhcHBIYW5kbGVTdGF0ZTtcclxuICAgICAgICAgICAgICAgIHRvLmhpZ2hlc3RIYW5kbGVkID0gZnJvbS5oaWdoZXN0SGFuZGxlZDtcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICB0aGlzLmJhdHRsZU1haW4gPSBiYXR0bGVNYWluO1xyXG4gICAgICAgICAgICBjbG9uZWRTdGF0ZSA9IG5ldyBDbG9uZWRTdGF0ZSgpO1xyXG4gICAgICAgICAgICBiYXR0bGVFbnRpdHkgPSBlY3MuUXVpY2tBY2Nlc3NvcjE8QmF0dGxlTWFpbi5CYXR0bGVFbnRpdHk+KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIFN0YXJ0UHJldmlldygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiYXR0bGVNYWluLnRyYWNrQmF0dGxlLlByZXZpZXcoKTtcclxuICAgICAgICAgICAgZm9yZWFjaCAodmFyIGl0ZW0gaW4gYmF0dGxlTWFpbi5lbnRpdGllcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBkZWJ1Zy5QcmludChcIkFMTCBFTlRJVElFUyBCRUZPUkUgUFJFVklFV1wiKTtcclxuICAgICAgICAgICAgICAgIGRlYnVnLlByaW50KGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgZGVidWcuUHJpbnQoaXRlbS5yYW5kb21Qb3NpdGlvbiArIFwiIFJBTkRPTSBQT1NcIik7XHJcbiAgICAgICAgICAgICAgICBkZWJ1Zy5QcmludChpdGVtLlR5cGUgKyBcIiB0eXBlXCIpO1xyXG4gICAgICAgICAgICAgICAgZGVidWcuUHJpbnQoaXRlbS5kcmF3VHVybiArIFwiIGRyYXcgdHVyblwiKTtcclxuICAgICAgICAgICAgICAgIGRlYnVnLlByaW50KFwiRU5EXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVjcy5DbG9uZVN0YXRlKGNsb25lZFN0YXRlKTtcclxuICAgICAgICAgICAgYmF0dGxlTWFpbi5iYXR0bGVTdGF0ZS5CYXR0bGVFbmRFbmFibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgcHJldmlld0FjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgaXRlbSBpbiBiYXR0bGVNYWluLmVudGl0aWVzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbS5UeXBlID09IEJhdHRsZU1haW4uRW50aXR5VHlwZS5oZXJvKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0ubGlmZSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBpdGVtLm1vdmVzLkxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5tb3Zlc1tpXSA9IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBiYXR0bGVNYWluLlRpY2soKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIEVuZFByZXZpZXcoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlKFwiRW5kIHByZXZpZXdcIik7XHJcbiAgICAgICAgICAgIC8vICAgQ29uc29sZS5SZWFkS2V5KCk7XHJcbiAgICAgICAgICAgIHByZXZpZXdBY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShiYXR0bGVNYWluLmVudGl0aWVzLkNvbnRhaW5zKGJhdHRsZUVudGl0eS5Db21wMSgwKSkrXCJYWFhTXCIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZWNzLlJlc3RvcmVTdGF0ZShjbG9uZWRTdGF0ZSk7XHJcbiAgICAgICAgICAgIGJhdHRsZU1haW4uYmF0dGxlU3RhdGUucGhhc2UgPSBCYXR0bGVNYWluLkJhdHRsZVBoYXNlLlBpY2tIYW5kcztcclxuXHJcbiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgYmF0dGxlTWFpbi5lbnRpdGllcy5Db3VudDsgaisrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBCYXR0bGVNYWluLkJhdHRsZUVudGl0eSBpdGVtID0gYmF0dGxlTWFpbi5lbnRpdGllc1tqXTtcclxuICAgICAgICAgICAgICAgIGJvb2wgZXhpc3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYmF0dGxlRW50aXR5LkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0gPT0gYmF0dGxlRW50aXR5LkNvbXAxKGkpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3QgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIWV4aXN0KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGJhdHRsZU1haW4uZW50aXRpZXMuUmVtb3ZlKGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGotLTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGRlYnVnLlByaW50KFwiQUxMIEVOVElUSUVTIEFGVEVSIFBSRVZJRVdcIik7XHJcbiAgICAgICAgICAgICAgICBkZWJ1Zy5QcmludChpdGVtKTtcclxuICAgICAgICAgICAgICAgIGRlYnVnLlByaW50KGl0ZW0ucmFuZG9tUG9zaXRpb24rXCIgUkFORE9NIFBPU1wiKTtcclxuICAgICAgICAgICAgICAgIGRlYnVnLlByaW50KGl0ZW0uVHlwZSArIFwiIHR5cGVcIik7XHJcbiAgICAgICAgICAgICAgICBkZWJ1Zy5QcmludChpdGVtLmRyYXdUdXJuICsgXCIgZHJhdyB0dXJuXCIpO1xyXG4gICAgICAgICAgICAgICAgZGVidWcuUHJpbnQoXCJFTkRcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgUGlkcm9oLkJhc2VVdGlscztcclxudXNpbmcgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkO1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guVHVybkJhc2VkLlRleHRSZW5kZXJpbmdcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFJlZmxlY3Rpb25UZXN0XHJcbiAgICB7XHJcblxyXG4gICAgICAgIHB1YmxpYyBSZWZsZWN0aW9uVGVzdCgpIHtcclxuICAgICAgICAgICAgdmFyIGRlYnVnID0gbmV3IERlYnVnZ2VyKHRydWUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgQmF0dGxlTWFpbi5CYXR0bGVFbnRpdHkgYmUgPSBuZXcgQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5CYXR0bGVFbnRpdHkoKTtcclxuICAgICAgICAgICAgdmFyIHR5cGUgPSBiZS5HZXRUeXBlKCk7XHJcbiAgICAgICAgICAgIEJhdHRsZU1haW4uQmF0dGxlRW50aXR5IGJlMiA9IG5ldyBCYXR0bGVNYWluLkJhdHRsZUVudGl0eSgpO1xyXG4gICAgICAgICAgICBiZTIucmFuZG9tUG9zaXRpb24gPSB0cnVlO1xyXG4gICAgICAgICAgICBkZWJ1Zy5QcmludCh0eXBlLkdldEZpZWxkKFwicmFuZG9tUG9zaXRpb25cIikuR2V0VmFsdWUoYmUyKS5Ub1N0cmluZygpKTtcclxuICAgICAgICAgICAgZGVidWcuUHJpbnQoYmUyLnJhbmRvbVBvc2l0aW9uICsgXCJcIik7XHJcbiAgICAgICAgICAgIGRlYnVnLlByaW50KGJlKTtcclxuICAgICAgICAgICAgRGVlcENsb25lSGVscGVyLkRlZXBDb3B5UGFydGlhbChiZSwgYmUyKTtcclxuICAgICAgICAgICAgRGVlcENsb25lSGVscGVyLkRlZXBDb3B5UGFydGlhbChiZTIsIGJlKTtcclxuICAgICAgICAgICAgZGVidWcuUHJpbnQoYmUpO1xyXG4gICAgICAgICAgICBkZWJ1Zy5QcmludChiZTIpO1xyXG4gICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIGRlYnVnLlByaW50KHR5cGUuR2V0RmllbGQoXCJyYW5kb21Qb3NpdGlvblwiKS5HZXRWYWx1ZShiZTIpLlRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICBkZWJ1Zy5QcmludChiZTIucmFuZG9tUG9zaXRpb24rXCJcIik7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBQaWRyb2guQmFzZVV0aWxzO1xyXG51c2luZyBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQ7XHJcbnVzaW5nIFBpZHJvaC5UZXh0UmVuZGVyaW5nO1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guVHVybkJhc2VkLlRleHRSZW5kZXJpbmdcclxue1xyXG5cclxuICAgIFxyXG5cclxuICAgIHB1YmxpYyBjbGFzcyBVSVJldXNhYmxlXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgV0FTRCA9IFwiV0FTRFwiO1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIGFycm93cyA9IFwiXCIgKyBVbmljb2RlLlVwYXJyb3cyICsgVW5pY29kZS5MZWZ0YXJyb3cyICsgVW5pY29kZS5Eb3duYXJyb3cyICsgVW5pY29kZS5SaWdodGFycm93MjtcclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgRHJhd0NvbnRyb2xzTGFiZWwoVGV4dFdvcmxkIHRleHRXb3JsZCwgaW50IHkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXdPbkNlbnRlckhvcml6b250YWwoXCJDb250cm9sc1wiLCBCYXR0bGVSZW5kZXIuQ29sb3JzLldpbmRvd0xhYmVsLCAwLCB5KTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFBpZHJvaC5CYXNlVXRpbHM7XHJcbnVzaW5nIFBpZHJvaC5UZXh0UmVuZGVyaW5nO1xyXG51c2luZyBQaWRyb2guVGV4dFJlbmRlcmluZy5HYW1lU2NyZWVuO1xyXG51c2luZyBQaWRyb2guVHVybkJhc2VkLlRleHRSZW5kZXJpbmc7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWRcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEJhdHRsZVJlbmRlciA6IElUZXh0U2NyZWVuX1xyXG4gICAge1xyXG4gICAgICAgIGludGVybmFsIEF0dGFja1ByZXZpZXcgYXR0YWNrUHJldmlldztcclxuICAgICAgICBwdWJsaWMgS2V5Ym9hcmRJTyBLZXlib2FyZCB7IHNldDsgZ2V0OyB9XHJcbiAgICAgICAgcHJpdmF0ZSBCYXR0bGVNYWluIHR1cm5CYXNlVHJ5O1xyXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgU3RhZ2VEYXRhIHN0YWdlRGF0YTtcclxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IFByZXZpZXdTeXN0ZW0gcHJldmlld1N5c3RlbTtcclxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IExpc3Q8TW92ZU1ldGFEYXRhPiBtb3ZlUmVuZGVycztcclxuICAgICAgICBwcml2YXRlIFBvc2l0aW9uQW5pbWF0aW9uIHBvc0FuaW07XHJcbiAgICAgICAgcHJpdmF0ZSBDaGFyQnlDaGFyQW5pbWF0aW9uIGNoYXJCeUNoYXJBbmltO1xyXG4gICAgICAgIHByaXZhdGUgRGVsYXlzQW5pbWF0aW9uIGRlbGF5QW5pbTtcclxuXHJcbiAgICAgICAgcHVibGljIFRleHRXb3JsZCB0ZXh0V29ybGQ7XHJcbiAgICAgICAgcHVibGljIFRleHRCb2FyZCBUZXh0Qm9hcmQgeyBnZXQ7IHNldDsgfVxyXG4gICAgICAgIExpc3Q8UGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uQmF0dGxlUGhhc2U+IGlucHV0UGhhc2VzID0gZ2xvYmFsOjpCcmlkZ2UuU2NyaXB0LkNhbGxGb3IobmV3IExpc3Q8UGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uQmF0dGxlUGhhc2U+KCksKF9vMSk9PntfbzEuQWRkKFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkJhdHRsZVBoYXNlLlBpY2tIYW5kcyk7X28xLkFkZChQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5CYXR0bGVQaGFzZSAuQ29uZmlybUlucHV0KTtyZXR1cm4gX28xO30pO1xyXG5cclxuICAgICAgICBpbnRlcm5hbCBWZWN0b3IyRCBFbnRpdHlTY3JlZW5Qb3NpdGlvbihpbnQgdXNlcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBCYXR0bGVFbnRpdHlUb1NjcmVlblBvc2l0aW9uKHR1cm5CYXNlVHJ5LmVudGl0aWVzW3VzZXJdLnBvcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCBSZWN0IEdldEdyaWRSZWN0KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmVjdChncmlkT2Zmc2V0eCwgZ3JpZE9mZnNldHksIGdyaWRTY2FsZSAqIDYsIGdyaWRTY2FsZSAqIDMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50IGlucHV0O1xyXG4gICAgICAgIHB1YmxpYyBpbnQgSW5wdXRcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGdldCB7IHJldHVybiBpbnB1dDsgfVxyXG4gICAgICAgICAgICBzZXRcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW5wdXQgPSB2YWx1ZTsgLy9Db25zb2xlLldyaXRlTGluZSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBIYXBwSGFuZGxpbmcgSGFwcEhhbmRsaW5nIHsgZ2V0OyBpbnRlcm5hbCBzZXQ7IH1cclxuICAgICAgICBwdWJsaWMgaW50IGtleURvd25Vbmljb2RlIHsgc2V0OyBnZXQ7IH1cclxuICAgICAgICBwdWJsaWMgTW91c2VJTyBNb3VzZSB7IHNldDsgZ2V0OyB9XHJcbiAgICAgICAgcHVibGljIE1vdXNlSG92ZXJNYW5hZ2VyIG1vdXNlSG92ZXI7XHJcblxyXG4gICAgICAgIC8vcHVibGljIExpc3Q8RGVsYXllZEFjdGlvbnM+IHRhc2tzID0gbmV3IExpc3Q8RGVsYXllZEFjdGlvbnM+KCk7XHJcbiAgICAgICAgLy9EaWN0aW9uYXJ5PG9iamVjdCwgc3RyaW5nPiBtb3ZlQ2hhcnM7XHJcbiAgICAgICAgLy9EaWN0aW9uYXJ5PG9iamVjdCwgc3RyaW5nPiBtb3ZlRGVzY3JpcHRpb25zID0gbmV3IERpY3Rpb25hcnk8b2JqZWN0LCBzdHJpbmc+KCk7XHJcbiAgICAgICAgRGljdGlvbmFyeTxNaXNjQmF0dGxlSW5wdXQsIHN0cmluZz4gbWlzY0Rlc2NyaXB0aW9ucyA9IGdsb2JhbDo6QnJpZGdlLlNjcmlwdC5DYWxsRm9yKG5ldyBEaWN0aW9uYXJ5PE1pc2NCYXR0bGVJbnB1dCwgc3RyaW5nPigpLChfbzIpPT57X28yLkFkZChNaXNjQmF0dGxlSW5wdXQuRG9uZSxcIkRPTkVcIik7X28yLkFkZChNaXNjQmF0dGxlSW5wdXQuUmVkbyxcIlJFRE9cIik7X28yLkFkZChNaXNjQmF0dGxlSW5wdXQuSGVscCxcIkhFTFBcIik7X28yLkFkZChNaXNjQmF0dGxlSW5wdXQuUHJldmlldyxcIlBSRVZJRVdcIik7X28yLkFkZChNaXNjQmF0dGxlSW5wdXQuQ29uZmlybSxcIkNPTkZJUk1cIik7X28yLkFkZChNaXNjQmF0dGxlSW5wdXQuQ2FuY2VsLFwiQ0FOQ0VMXCIpO19vMi5BZGQoTWlzY0JhdHRsZUlucHV0LkxlYXZlQXR0YWNrRGVtb25zdHJhdGlvbixcIkVORCBQUkVWSUVXXCIpO3JldHVybiBfbzI7fSk7XHJcbiAgICAgICAgcHJpdmF0ZSBEaWN0aW9uYXJ5PElucHV0VW5pdCwgc3RyaW5nPiBtb3ZlQnV0dG9ucztcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBib29sIGRlYnVnT24gPSB0cnVlO1xyXG4gICAgICAgIHByaXZhdGUgaW50IGdyaWRTY2FsZSA9IDU7XHJcbiAgICAgICAgcHJpdmF0ZSBpbnQgZ3JpZE9mZnNldHggPSAyO1xyXG4gICAgICAgIHByaXZhdGUgaW50IGdyaWRPZmZzZXR5ID0gMTtcclxuICAgICAgICBpbnRlcm5hbCBMaXN0PFRleHRFbnRpdHk+IGJhdHRsZXJSZW5kZXJzO1xyXG5cclxuICAgICAgICBjaGFyW11bXSBlbnRpdGllc0NoYXJzO1xyXG4gICAgICAgIHByaXZhdGUgYm9vbCBNZXNzYWdlRG9Ob3RIaWRlO1xyXG4gICAgICAgIHN0cmluZyBtZXNzYWdlID0gbnVsbDtcclxuICAgICAgICBwcml2YXRlIGJvb2wgd2FpdGluZ0Zvck1lc3NhZ2VJbnB1dDtcclxuICAgICAgICBwcml2YXRlIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkJhdHRsZVBoYXNlIGxhc3RQaGFzZTtcclxuICAgICAgICBwcml2YXRlIFRleHRFbnRpdHkgbWVzc2FnZUVudDtcclxuXHJcbiAgICAgICAgcHVibGljIElucHV0SGFuZGxpbmcgaW5wdXRIID0gbmV3IElucHV0SGFuZGxpbmcoKTtcclxuICAgICAgICAvL3B1YmxpYyBib29sIGhlbHBWaXN1YWxpemVSZXF1ZXN0O1xyXG4gICAgICAgIHB1YmxpYyBIZWxwU2NyZWVuSW50ZWdyYXRpb24gaGVscDtcclxuICAgICAgICBwcml2YXRlIGJvb2wgYXR0YWNrTWVudSA9IGZhbHNlO1xyXG5cclxuICAgICAgICBwdWJsaWMgQmF0dGxlUmVuZGVyKEJhdHRsZU1haW4gYmF0dGxlTG9naWMsIFN0YWdlRGF0YSBzdGFnZURhdGEsIFByZXZpZXdTeXN0ZW0gUHJldmlld1N5c3RlbSwgTGlzdDxzdHJpbmc+IGVudGl0eVRleHRzLCBMaXN0PE1vdmVNZXRhRGF0YT4gbW92ZVJlbmRlcnMpXHJcbiAgICAgICAge1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vc3RyaW5nW10gZW50aXR5VGV4dHMgPSB7IFwiQFwiLCBcIiZcIiwgXCIlXCIsIFwiJFwiLCBcIk9cIiwgXCJYXCIsIFwiSlwiLCBcIllcIiwgXCJaXCIsIFwiTVwiLFwiQ1wiLCBcIkRcIiwgXCJFXCIgfTtcclxuICAgICAgICAgICAgZW50aXRpZXNDaGFycyA9IG5ldyBjaGFyW2VudGl0eVRleHRzLkNvdW50XVtdO1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGVudGl0eVRleHRzLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGVudGl0aWVzQ2hhcnNbaV0gPSBlbnRpdHlUZXh0c1tpXS5Ub0NoYXJBcnJheSgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0dXJuQmFzZVRyeSA9IGJhdHRsZUxvZ2ljO1xyXG4gICAgICAgICAgICB0aGlzLnN0YWdlRGF0YSA9IHN0YWdlRGF0YTtcclxuICAgICAgICAgICAgcHJldmlld1N5c3RlbSA9IFByZXZpZXdTeXN0ZW07XHJcbiAgICAgICAgICAgIHRoaXMubW92ZVJlbmRlcnMgPSBtb3ZlUmVuZGVycztcclxuICAgICAgICAgICAgdGV4dFdvcmxkID0gbmV3IFRleHRXb3JsZCgpO1xyXG4gICAgICAgICAgICBwb3NBbmltID0gdGV4dFdvcmxkLkFkZEFuaW1hdGlvbjxnbG9iYWw6OlBpZHJvaC5UZXh0UmVuZGVyaW5nLlBvc2l0aW9uQW5pbWF0aW9uPihuZXcgUG9zaXRpb25BbmltYXRpb24oKSk7XHJcbiAgICAgICAgICAgIGNoYXJCeUNoYXJBbmltID0gdGV4dFdvcmxkLkFkZEFuaW1hdGlvbjxnbG9iYWw6OlBpZHJvaC5UZXh0UmVuZGVyaW5nLkNoYXJCeUNoYXJBbmltYXRpb24+KG5ldyBDaGFyQnlDaGFyQW5pbWF0aW9uKCkpO1xyXG4gICAgICAgICAgICBkZWxheUFuaW0gPSB0ZXh0V29ybGQuQWRkQW5pbWF0aW9uPGdsb2JhbDo6UGlkcm9oLlRleHRSZW5kZXJpbmcuRGVsYXlzQW5pbWF0aW9uPihuZXcgRGVsYXlzQW5pbWF0aW9uKCkpO1xyXG4gICAgICAgICAgICB0ZXh0V29ybGQuSW5pdChHYW1lTWFpbi5XaWR0aCwgR2FtZU1haW4uSGVpZ2h0KTtcclxuICAgICAgICAgICAgVGV4dEJvYXJkID0gdGV4dFdvcmxkLm1haW5Cb2FyZDtcclxuICAgICAgICAgICAgLy9UZXh0Qm9hcmQgPSBuZXcgVGV4dEJvYXJkKDcwLCAyNSk7XHJcblxyXG4gICAgICAgICAgICAvL3ZhciBwb3NBbmltID0gdGV4dFdvcmxkLkFkZEFuaW1hdGlvbihuZXcgUG9zaXRpb25BbmltYXRpb24oKSk7XHJcbiAgICAgICAgICAgIHZhciBibGlua0FuaW0gPSB0ZXh0V29ybGQuQWRkQW5pbWF0aW9uPGdsb2JhbDo6UGlkcm9oLlRleHRSZW5kZXJpbmcuQmxpbmtBbmltPihuZXcgQmxpbmtBbmltKCkpO1xyXG5cclxuICAgICAgICAgICAgYmF0dGxlclJlbmRlcnMgPSBuZXcgTGlzdDxUZXh0RW50aXR5PigpO1xyXG4gICAgICAgICAgICBVcGRhdGVCYXR0bGVSZW5kZXJDb3VudCgpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIG1lc3NhZ2VFbnQgPSB0ZXh0V29ybGQuR2V0RnJlZUVudGl0eSg0MCwgNCk7XHJcblxyXG4gICAgICAgICAgICB0dXJuQmFzZVRyeS5oYXBwTWFuYWdlci5BZGRIYW5kbGVyKG5ldyBIYXBwcy5IYXBwSGFuZGxlcihQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5IYXBwVGFnLkF0dGFja0hpdCwgKGgpID0+XHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBhdHRhY2tlciA9IHR1cm5CYXNlVHJ5LmVudGl0aWVzW2guR2V0QXR0cmlidXRlX0ludCgxKV07XHJcbiAgICAgICAgICAgICAgICBpbnQgZGVmZW5kZXJFSUQgPSBoLkdldEF0dHJpYnV0ZV9JbnQoMCk7XHJcbiAgICAgICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5CYXR0bGVFbnRpdHkgZGVmZW5kZXIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKGRlZmVuZGVyRUlEID49IDApXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZW5kZXIgPSB0dXJuQmFzZVRyeS5lbnRpdGllc1tkZWZlbmRlckVJRF07XHJcbiAgICAgICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5FbGVtZW50IGVsZW1lbnQgPSAoUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uRWxlbWVudCloLkdldEF0dHJpYnV0ZV9JbnQoMik7XHJcbiAgICAgICAgICAgICAgICBUZXh0RW50aXR5IGZlID0gR2V0UHJvalRleHRFbnRpdHkoZWxlbWVudCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGRlZmVuZGVyICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBvcyA9IGF0dGFja2VyLlBvc2l0aW9uVjJEO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3MyID0gZGVmZW5kZXIuUG9zaXRpb25WMkQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHhEaXMgPSBNYXRoLkFicyhwb3MuWCAtIHBvczIuWCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmxvYXQgdGltZSA9IChmbG9hdCl4RGlzICogMC4xZjtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHBvc0FuaW0uQWRkKGZlLkFuaW1CYXNlKHRpbWUpLCBuZXcgUG9zaXRpb25BbmltYXRpb24uUG9zaXRpb25EYXRhKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBCYXR0bGVFbnRpdHlUb1NjcmVlblBvc2l0aW9uKGF0dGFja2VyLlBvc2l0aW9uVjJEKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgQmF0dGxlRW50aXR5VG9TY3JlZW5Qb3NpdGlvbihkZWZlbmRlci5Qb3NpdGlvblYyRCkpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gYXR0YWNrZXIuUG9zaXRpb25WMkQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBvczIgPSBwb3M7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGF0dGFja2VyLlR5cGUgPT0gQmF0dGxlTWFpbi5FbnRpdHlUeXBlLmVuZW15KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3MyLlggPSAtMTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvczIuWCA9IDY7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHhEaXMgPSBNYXRoLkFicyhwb3MuWCAtIHBvczIuWCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmxvYXQgdGltZSA9IChmbG9hdCl4RGlzICogMC4xZjtcclxuICAgICAgICAgICAgICAgICAgICBwb3NBbmltLkFkZChmZS5BbmltQmFzZSh0aW1lKSwgbmV3IFBvc2l0aW9uQW5pbWF0aW9uLlBvc2l0aW9uRGF0YShcclxuICAgICAgICAgICAgICAgICAgICAgICAgQmF0dGxlRW50aXR5VG9TY3JlZW5Qb3NpdGlvbihwb3MpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBCYXR0bGVFbnRpdHlUb1NjcmVlblBvc2l0aW9uKHBvczIpKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgICAgICB0dXJuQmFzZVRyeS5oYXBwTWFuYWdlci5BZGRIYW5kbGVyKG5ldyBIYXBwcy5IYXBwSGFuZGxlcihCYXR0bGVNYWluLkhhcHBUYWcuQXR0YWNrTWlzcywgKGgpID0+XHJcbiAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgYXR0YWNrZXIgPSB0dXJuQmFzZVRyeS5lbnRpdGllc1toLkdldEF0dHJpYnV0ZV9JbnQoMCldO1xyXG4gICAgICAgICAgICAgICAgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uRWxlbWVudCBlbGVtZW50ID0gKFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVsZW1lbnQpaC5HZXRBdHRyaWJ1dGVfSW50KDEpO1xyXG4gICAgICAgICAgICAgICAgVGV4dEVudGl0eSBmZSA9IEdldFByb2pUZXh0RW50aXR5KGVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHBvcyA9IGF0dGFja2VyLlBvc2l0aW9uVjJEO1xyXG4gICAgICAgICAgICAgICAgdmFyIHBvczIgPSBwb3M7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXR0YWNrZXIuVHlwZSA9PSBCYXR0bGVNYWluLkVudGl0eVR5cGUuZW5lbXkpXHJcbiAgICAgICAgICAgICAgICAgICAgcG9zMi5YID0gLTE7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgcG9zMi5YID0gNjtcclxuICAgICAgICAgICAgICAgIHZhciB4RGlzID0gTWF0aC5BYnMocG9zLlggLSBwb3MyLlgpO1xyXG4gICAgICAgICAgICAgICAgZmxvYXQgdGltZSA9IChmbG9hdCl4RGlzICogMC4xZjtcclxuICAgICAgICAgICAgICAgIHBvc0FuaW0uQWRkKGZlLkFuaW1CYXNlKHRpbWUpLCBuZXcgUG9zaXRpb25BbmltYXRpb24uUG9zaXRpb25EYXRhKFxyXG4gICAgICAgICAgICAgICAgICAgIEJhdHRsZUVudGl0eVRvU2NyZWVuUG9zaXRpb24ocG9zKSxcclxuICAgICAgICAgICAgICAgICAgICBCYXR0bGVFbnRpdHlUb1NjcmVlblBvc2l0aW9uKHBvczIpKSk7XHJcbiAgICAgICAgICAgIH0pKTtcclxuXHJcblxyXG4gICAgICAgICAgICAvL21vdmVDaGFycyA9IG5ldyBEaWN0aW9uYXJ5PG9iamVjdCwgc3RyaW5nPigpXHJcbiAgICAgICAgICAgIC8ve1xyXG4gICAgICAgICAgICAvLyAgICB7IEJhdHRsZU1haW4uTW92ZVR5cGUuRmlyZSwgXCJGXCJ9LFxyXG4gICAgICAgICAgICAvLyAgICB7IEJhdHRsZU1haW4uTW92ZVR5cGUuSWNlLCBcIklcIn0sXHJcbiAgICAgICAgICAgIC8vICAgIHsgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5UaHVuZGVyLCBcIlRcIn0sXHJcbiAgICAgICAgICAgIC8vICAgIHsgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5Ob3JtYWxTaG90LCBcIkdcIn0sXHJcbiAgICAgICAgICAgIC8vICAgIHsgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5Nb3ZlUmlnaHQsIFVuaWNvZGUuUmlnaHRhcnJvdzIrXCJcIn0sXHJcbiAgICAgICAgICAgIC8vICAgIHsgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5Nb3ZlVXAsIFVuaWNvZGUuVXBhcnJvdzIrXCJcIn0sXHJcbiAgICAgICAgICAgIC8vICAgIHsgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5Nb3ZlRG93biwgVW5pY29kZS5Eb3duYXJyb3cyK1wiXCJ9LFxyXG4gICAgICAgICAgICAvLyAgICB7IEJhdHRsZU1haW4uTW92ZVR5cGUuTW92ZUxlZnQsIFVuaWNvZGUuTGVmdGFycm93MitcIlwifSxcclxuICAgICAgICAgICAgLy8gICAgeyBCYXR0bGVNYWluLk1vdmVUeXBlLkljZUJvbWIsIFwiSUJcIn0sXHJcbiAgICAgICAgICAgIC8vICAgIHsgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5UaHVuZGVyQm9tYiwgXCJUQlwifSxcclxuICAgICAgICAgICAgLy8gICAgeyBCYXR0bGVNYWluLk1vdmVUeXBlLlN1bW1vbkVudGl0eSwgXCJTVVwifSxcclxuICAgICAgICAgICAgLy8gICAgeyBCYXR0bGVNYWluLk1vdmVUeXBlLkRvTm90aGluZywgXCIgXCJ9LFxyXG4gICAgICAgICAgICAvLyAgICB7IEJhdHRsZU1haW4uTW92ZVR5cGUuRG93bkZpcmUsIFwiRkRcIn0sXHJcbiAgICAgICAgICAgIC8vICAgIHsgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5UcmlwbGVGaXJlLCBcIlRGXCJ9LFxyXG4gICAgICAgICAgICAvL307XHJcblxyXG4gICAgICAgICAgICAvL21vdmVEZXNjcmlwdGlvbnMgPSBuZXcgRGljdGlvbmFyeTxvYmplY3QsIHN0cmluZz4oKVxyXG4gICAgICAgICAgICAvL3tcclxuXHJcbiAgICAgICAgICAgIC8vICAgIHsgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5JY2UsIFwiSWNlIFNob3RcIn0sXHJcbiAgICAgICAgICAgIC8vICAgIHsgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5GaXJlLCBcIkZpcmUgU2hvdFwifSxcclxuICAgICAgICAgICAgLy8gICAgeyBCYXR0bGVNYWluLk1vdmVUeXBlLlRodW5kZXIsIFwiVGh1bmRlciBTaG90XCJ9LFxyXG4gICAgICAgICAgICAvLyAgICB7IEJhdHRsZU1haW4uTW92ZVR5cGUuSWNlQm9tYiwgXCJJY2UgQm9tYlwifSxcclxuICAgICAgICAgICAgLy8gICAgeyBCYXR0bGVNYWluLk1vdmVUeXBlLk5vcm1hbFNob3QsIFwiR3VuXCJ9LFxyXG4gICAgICAgICAgICAvLyAgICB7IEJhdHRsZU1haW4uTW92ZVR5cGUuTW92ZVJpZ2h0LCBVbmljb2RlLlJpZ2h0YXJyb3cyK1wiXCJ9LFxyXG4gICAgICAgICAgICAvLyAgICB7IEJhdHRsZU1haW4uTW92ZVR5cGUuTW92ZVVwLCBVbmljb2RlLlVwYXJyb3cyK1wiXCJ9LFxyXG4gICAgICAgICAgICAvLyAgICB7IEJhdHRsZU1haW4uTW92ZVR5cGUuTW92ZURvd24sIFVuaWNvZGUuRG93bmFycm93MitcIlwifSxcclxuICAgICAgICAgICAgLy8gICAgeyBCYXR0bGVNYWluLk1vdmVUeXBlLk1vdmVMZWZ0LCBVbmljb2RlLkxlZnRhcnJvdzIrXCJcIn0sXHJcbiAgICAgICAgICAgIC8vICAgIHsgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5UaHVuZGVyQm9tYiwgXCJUaHVuZGVyIEJvbWJcIn0sXHJcbiAgICAgICAgICAgIC8vICAgIHsgQmF0dGxlTWFpbi5Nb3ZlVHlwZS5TdW1tb25FbnRpdHksIFwiU3VtbW9uXCJ9LFxyXG4gICAgICAgICAgICAvL307XHJcblxyXG4gICAgICAgICAgICB2YXIgbWVzT25Qb3MgPSBuZXcgTWVzc2FnZU9uUG9zaXRpb24odGhpcyk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHR1cm5CYXNlVHJ5LmVudGl0aWVzLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBlID0gdHVybkJhc2VUcnkuZW50aXRpZXNbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoZS5UeXBlID09IFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVudGl0eVR5cGUuaGVybylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gYmF0dGxlclJlbmRlcnNbaV0uR2V0UG9zaXRpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICAvL21lc09uUG9zLk1lc3NhZ2VPblBvcyhCYXR0bGVFbnRpdHlUb1NjcmVlblBvc2l0aW9uKHR1cm5CYXNlVHJ5LmVudGl0aWVzW2ldLnBvcyksIFwiWU9VXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vTWVzc2FnZU9uUG9zKFZlY3RvcjJELlplcm8sIFwiWU9VXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgLy9Db25zb2xlLlJlYWRMaW5lKCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBVcGRhdGVCYXR0bGVSZW5kZXJDb3VudCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB3aGlsZSAoYmF0dGxlclJlbmRlcnMuQ291bnQgPCB0aGlzLnR1cm5CYXNlVHJ5LmVudGl0aWVzLkNvdW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUZXh0RW50aXR5IGl0ZW0gPSB0ZXh0V29ybGQuR2V0RnJlZUVudGl0eSgyLCAyKTtcclxuICAgICAgICAgICAgICAgIGJhdHRsZXJSZW5kZXJzLkFkZChpdGVtKTtcclxuICAgICAgICAgICAgICAgIGl0ZW0uU2V0UG9zaXRpb24oQmF0dGxlRW50aXR5VG9TY3JlZW5Qb3NpdGlvbih0dXJuQmFzZVRyeS5lbnRpdGllc1tiYXR0bGVyUmVuZGVycy5Db3VudCAtIDFdLnBvcykpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoYmF0dGxlclJlbmRlcnMuQ291bnQgPiB0aGlzLnR1cm5CYXNlVHJ5LmVudGl0aWVzLkNvdW50KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gdGhpcy50dXJuQmFzZVRyeS5lbnRpdGllcy5Db3VudDsgaSA8IGJhdHRsZXJSZW5kZXJzLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmF0dGxlclJlbmRlcnNbaV0uT3JpZ2luLlJlc2V0SW52aXNpYmxlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHN0cmluZyBHZXRFbnRpdHlOYW1lKGludCB1c2VyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uQmF0dGxlRW50aXR5IGdhbWVFbnRpdHkgPSB0dXJuQmFzZVRyeS5lbnRpdGllc1t1c2VyXTtcclxuICAgICAgICAgICAgdmFyIGNoYXJzID0gR2V0Q2hhcihnYW1lRW50aXR5KTtcclxuICAgICAgICAgICAgc3RyaW5nIG5hbWUgPSBuZXcgc3RyaW5nKGNoYXJzKTtcclxuICAgICAgICAgICAgaWYgKGdhbWVFbnRpdHkuZ3JhcGhpY1JlcGVhdGVkSW5kZXggPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmFtZSArIChnYW1lRW50aXR5LmdyYXBoaWNSZXBlYXRlZEluZGV4ICsgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmFtZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVGV4dEVudGl0eSBHZXRQcm9qVGV4dEVudGl0eShQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5FbGVtZW50IGVsZW1lbnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgZmUgPSB0ZXh0V29ybGQuR2V0VGVtcEVudGl0eSgxLCAxKTtcclxuICAgICAgICAgICAgZmUuT3JpZ2luLkRyYXdDaGFyKFRleHRCb2FyZC5JTlZJU0lCTEVDSEFSLCAwLCAwKTtcclxuICAgICAgICAgICAgaW50IGVsZW1lbnRDb2xvciA9IEVsZW1lbnRUb1Byb2pDb2xvcihlbGVtZW50KTtcclxuICAgICAgICAgICAgZmUuT3JpZ2luLlNldEJhY2tDb2xvcihlbGVtZW50Q29sb3IsIDAsIDApO1xyXG4gICAgICAgICAgICByZXR1cm4gZmU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3KGZsb2F0IGRlbHRhKVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgIElucHV0S2V5IGlucHV0ID0gKElucHV0S2V5KUlucHV0O1xyXG4gICAgICAgICAgICBpZiAoaW5wdXQgIT0gSW5wdXRLZXkuTk9ORSAmJiB3YWl0aW5nRm9yTWVzc2FnZUlucHV0KVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB3YWl0aW5nRm9yTWVzc2FnZUlucHV0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2lmIChpbnB1dCAhPSBJbnB1dEtleS5OT05FKSBDb25zb2xlLldyaXRlTGluZShpbnB1dCk7XHJcbiAgICAgICAgICAgIC8vaW50IGlucHV0TnVtYmVyID0gaW5wdXQgLSAnMCc7XHJcbiAgICAgICAgICAgIC8vaWYgKGRlYnVnT24gJiYgaW5wdXQgPT0gJ2snKVxyXG4gICAgICAgICAgICAvL3tcclxuICAgICAgICAgICAgLy8gICAgRGVidWdFeHRyYS5EZWJ1Z0V4LlNob3coKTtcclxuICAgICAgICAgICAgLy99XHJcblxyXG4gICAgICAgICAgICBpZiAobGFzdFBoYXNlICE9IHR1cm5CYXNlVHJ5LmJhdHRsZVN0YXRlLnBoYXNlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHVybkJhc2VUcnkuYmF0dGxlU3RhdGUucGhhc2UgPT0gUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uQmF0dGxlUGhhc2UuUGlja0hhbmRzKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vU2hvd01lc3NhZ2UoXCJQaWNrIHlvdXIgY29tbWFuZHNcIiwgZmFsc2UsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vVGV4dEJvYXJkLlNldEFsbChUZXh0Qm9hcmQuTk9DSEFOR0VDSEFSLCBUZXh0Qm9hcmQuTk9DSEFOR0VDT0xPUiwgQ29sb3JzLkZpcmVBdXJhKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAobGFzdFBoYXNlID09IFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkJhdHRsZVBoYXNlLlBpY2tIYW5kcylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGUoXCJYX19YXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIEhpZGVNZXNzYWdlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9UZXh0Qm9hcmQuU2V0QWxsKFRleHRCb2FyZC5OT0NIQU5HRUNIQVIsIFRleHRCb2FyZC5OT0NIQU5HRUNPTE9SLCAwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsYXN0UGhhc2UgPSB0dXJuQmFzZVRyeS5iYXR0bGVTdGF0ZS5waGFzZTtcclxuICAgICAgICAgICAgaWYgKGlucHV0UGhhc2VzLkNvbnRhaW5zKHR1cm5CYXNlVHJ5LmJhdHRsZVN0YXRlLnBoYXNlKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGtleURvd25Vbmljb2RlID49IDApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleURvd25Vbmljb2RlID09ICdwJylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoXCJQUkVWSUVXXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmV2aWV3U3lzdGVtLlN0YXJ0UHJldmlldygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXlEb3duVW5pY29kZSA9PSAnZScgJiYgSGFzQXR0YWNrcygpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNrTWVudSA9ICFhdHRhY2tNZW51O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhdHRhY2tNZW51ICYmIGtleURvd25Vbmljb2RlID09IFVuaWNvZGUuRXNjYXBlKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNrTWVudSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5wdXRYID0gaW5wdXRILklucHV0dGVkKGtleURvd25Vbmljb2RlLCB0dXJuQmFzZVRyeS5pbnB1dHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dFgudHlwZSA9PSBJbnB1dFR5cGUuTWlzY0JhdHRsZSAmJiBpbnB1dFguYXJnMSA9PSAoaW50KU1pc2NCYXR0bGVJbnB1dC5IZWxwKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9oZWxwVmlzdWFsaXplUmVxdWVzdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlbHAuU2hvdyh0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dFgudHlwZSAhPSBJbnB1dFR5cGUuTm9uZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0dXJuQmFzZVRyeS5JbnB1dERvbmUoaW5wdXRYKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKEtleWJvYXJkLmRvd25Vbmljb2Rlcy5Db250YWlucygnYycpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGF0dGFja01lbnUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBhdHRhY2tNZW51ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0dXJuQmFzZVRyeS5pbnB1dHMuaW5wdXRGb3JDb25maXJtYXRpb24udHlwZSAhPSBJbnB1dFR5cGUuTm9uZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmFsc2UpXHJcbiAgICAgICAgICAgICAgICAgICAgLy9pZiAodHVybkJhc2VUcnkuaW5wdXRzLmlucHV0Rm9yQ29uZmlybWF0aW9uLnR5cGUgPT0gSW5wdXRUeXBlLk1vdmUpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRhY2tQcmV2aWV3LlNob3dQcmV2aWV3KDAsIHR1cm5CYXNlVHJ5LmlucHV0cy5pbnB1dEZvckNvbmZpcm1hdGlvbi5hcmcxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHVybkJhc2VUcnkuQ29uZmlybUlucHV0U3RhcnQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNrUHJldmlldy5FbmQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHVybkJhc2VUcnkuSW5wdXRDb25maXJtZWQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGF0dGFja1ByZXZpZXcuRW5kKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIC8vZm9yZWFjaCAodmFyIGl0ZW0gaW4gbW92ZUtleXMpXHJcbiAgICAgICAgICAgICAgICAvL3tcclxuICAgICAgICAgICAgICAgIC8vICAgIGlmIChpdGVtLlZhbHVlID09IGlucHV0KVxyXG4gICAgICAgICAgICAgICAgLy8gICAge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgIHR1cm5CYXNlVHJ5LklucHV0RG9uZShpdGVtLktleSk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICB9XHJcbiAgICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBVcGRhdGVCYXR0bGVSZW5kZXJDb3VudCgpO1xyXG4gICAgICAgICAgICBEcmF3R3JhcGhpY3MoZGVsdGEpO1xyXG4gICAgICAgICAgICBpZiAoQ2FuQWR2YW5jZV9Mb2dpYygpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHVybkJhc2VUcnkuYmF0dGxlU3RhdGUucGhhc2UgIT0gUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uQmF0dGxlUGhhc2UgLkV4ZWN1dGVNb3ZlICYmIHByZXZpZXdTeXN0ZW0ucHJldmlld0FjdGl2ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBwcmV2aWV3U3lzdGVtLkVuZFByZXZpZXcoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHN3aXRjaCAodHVybkJhc2VUcnkuYmF0dGxlU3RhdGUucGhhc2UpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBCYXR0bGVNYWluLkJhdHRsZVBoYXNlLkVuZW15TW92ZUNob2ljZTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHVybkJhc2VUcnkuVGljaygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIEJhdHRsZU1haW4uQmF0dGxlUGhhc2UuSGFuZFJlY2hhcmdlOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0dXJuQmFzZVRyeS5UaWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgQmF0dGxlTWFpbi5CYXR0bGVQaGFzZS5QaWNrSGFuZHM6XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIEJhdHRsZU1haW4uQmF0dGxlUGhhc2UuRXhlY3V0ZU1vdmU6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vU3lzdGVtLlRocmVhZGluZy5UaHJlYWQuU2xlZXAoMzAwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHVybkJhc2VUcnkuVGljaygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9VcGRhdGVCYXR0bGVSZW5kZXJDb3VudCgpO1xyXG4gICAgICAgICAgICAvL0RyYXdHcmFwaGljcyhkZWx0YSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGJvb2wgQ2FuQWR2YW5jZUdyYXBoaWNzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0V29ybGQuSXNEb25lKCkgJiYgIXdhaXRpbmdGb3JNZXNzYWdlSW5wdXQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGJvb2wgQ2FuQWR2YW5jZV9Mb2dpYygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gQ2FuQWR2YW5jZUdyYXBoaWNzKCkgJiYgSGFwcEhhbmRsaW5nLklzRG9uZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2hvd01lc3NhZ2Uoc3RyaW5nIHMsIGJvb2wgd2FpdEZvcklucHV0ID0gdHJ1ZSwgYm9vbCBkb05vdEhpZGUgPSBmYWxzZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuTWVzc2FnZURvTm90SGlkZSA9IGRvTm90SGlkZTtcclxuICAgICAgICAgICAgbWVzc2FnZSA9IHM7XHJcbiAgICAgICAgICAgIG1lc3NhZ2VFbnQuT3JpZ2luLlJlc2V0SW52aXNpYmxlKCk7XHJcbiAgICAgICAgICAgIGZsb2F0IHRpbWVUb1dyaXRlID0gbWVzc2FnZS5MZW5ndGggKiAwLjAxNWY7XHJcbiAgICAgICAgICAgIGlmICh0aW1lVG9Xcml0ZSA+IDAuNGYpIHRpbWVUb1dyaXRlID0gMC40ZjtcclxuICAgICAgICAgICAgY2hhckJ5Q2hhckFuaW0uQWRkKG1lc3NhZ2VFbnQuQW5pbUJhc2UodGltZVRvV3JpdGUpLCBuZXcgQ2hhckJ5Q2hhckFuaW1hdGlvbi5DaGFyQnlDaGFyRGF0YSgwLCBtZXNzYWdlLkxlbmd0aCArIDEpKTtcclxuICAgICAgICAgICAgZGVsYXlBbmltLkRlbGF5KHRpbWVUb1dyaXRlICsgMC44Zik7XHJcblxyXG4gICAgICAgICAgICAvL3dhaXRpbmdGb3JNZXNzYWdlSW5wdXQgPSB3YWl0Rm9ySW5wdXQ7XHJcbiAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZShcIk06IFwiK3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgSGlkZU1lc3NhZ2UoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbWVzc2FnZSA9IG51bGw7XHJcbiAgICAgICAgICAgIHdhaXRpbmdGb3JNZXNzYWdlSW5wdXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlKFwiTTogXCIrcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBTaG93QmF0dGxlTWVzc2FnZShzdHJpbmcgcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICghdHVybkJhc2VUcnkuQmF0dGxlRGVjaWRlZCgpKVxyXG4gICAgICAgICAgICAgICAgU2hvd01lc3NhZ2Uocyk7XHJcbiAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZShcIk06IFwiK3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhd0dyYXBoaWNzKGZsb2F0IGRlbHRhKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbW91c2VIb3Zlci5tb3VzZUhvdmVycy5DbGVhcigpO1xyXG4gICAgICAgICAgICB0dXJuQmFzZVRyeS5VcGRhdGUoZGVsdGEpO1xyXG4gICAgICAgICAgICAvL2NsZWFyIGdyaWRcclxuICAgICAgICAgICAgVGV4dEJvYXJkLlJlc2V0KCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoaW5wdXRQaGFzZXMuQ29udGFpbnModHVybkJhc2VUcnkuYmF0dGxlU3RhdGUucGhhc2UpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUZXh0Qm9hcmQuU2V0QWxsKFRleHRCb2FyZC5OT0NIQU5HRUNIQVIsIFRleHRCb2FyZC5OT0NIQU5HRUNPTE9SLCBDb2xvcnMuQmFja2dyb3VuZElucHV0KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaW50IGNvbnRyb2xzWSA9IGdyaWRTY2FsZSAqIDMgKyAxMCArIDMgKyAyO1xyXG5cclxuICAgICAgICAgICAgaW50IGVuZW15R3JpZE9mZlggPSBncmlkU2NhbGUgKiAzO1xyXG4gICAgICAgICAgICBib29sIGRyYXdEb3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgVGV4dEJvYXJkLkRyYXdSZXBlYXRlZCgnICcsIGdyaWRPZmZzZXR4LCBncmlkT2Zmc2V0eSwgZ3JpZFNjYWxlICogNiwgZ3JpZFNjYWxlICogMywgVGV4dEJvYXJkLk5PQ0hBTkdFQ09MT1IsIENvbG9ycy5CYWNrQmF0dGxlKTtcclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAzICogZ3JpZFNjYWxlOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgMyAqIGdyaWRTY2FsZTsgaisrKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkcmF3RG90KVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVGV4dEJvYXJkLkRyYXdDaGFyKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnLicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRPZmZzZXR4ICsgaSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZE9mZnNldHkgKyBqLCBDb2xvcnMuR3JpZEhlcm8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUZXh0Qm9hcmQuRHJhd0NoYXIoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnLicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkT2Zmc2V0eCArIGkgKyBlbmVteUdyaWRPZmZYLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZE9mZnNldHkgKyBqLCBDb2xvcnMuR3JpZEVuZW15KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGkgJSBncmlkU2NhbGUgPT0gMCAmJiBqICUgZ3JpZFNjYWxlID09IDApXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgVGV4dEJvYXJkLkRyYXdHcmlkKGkgKyBncmlkT2Zmc2V0eCArIGVuZW15R3JpZE9mZlgsIGogKyBncmlkT2Zmc2V0eSwgZ3JpZFNjYWxlLCBncmlkU2NhbGUsIENvbG9ycy5HcmlkRW5lbXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUZXh0Qm9hcmQuRHJhd0dyaWQoaSArIGdyaWRPZmZzZXR4LCBqICsgZ3JpZE9mZnNldHksIGdyaWRTY2FsZSwgZ3JpZFNjYWxlLCBDb2xvcnMuR3JpZEhlcm8pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0dXJuQmFzZVRyeS5lbnRpdGllcy5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgQmF0dGxlTWFpbi5CYXR0bGVFbnRpdHkgZ2FtZUVudGl0eSA9IHR1cm5CYXNlVHJ5LmVudGl0aWVzW2ldO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBlYyA9IEdldENoYXIoZ2FtZUVudGl0eSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHBvcyA9IGdhbWVFbnRpdHkuUG9zaXRpb25WMkQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2NyZWVuUG9zID0gQmF0dGxlRW50aXR5VG9TY3JlZW5Qb3NpdGlvbigoQmFzZVV0aWxzLlZlY3RvcjJEKXBvcyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZUVudGl0eS5UeXBlID09IFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVudGl0eVR5cGUucGFuZWxlZmZlY3QpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NyZWVuUG9zLlkgPSBzY3JlZW5Qb3MuWSArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NyZWVuUG9zLlggPSBzY3JlZW5Qb3MuWCAtIDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGV4dFdvcmxkLklzRG9uZSgpICYmIEhhcHBIYW5kbGluZy5Jc0RvbmUoKSlcclxuICAgICAgICAgICAgICAgICAgICBiYXR0bGVyUmVuZGVyc1tpXS5PcmlnaW4uUG9zaXRpb24gPSBzY3JlZW5Qb3M7XHJcbiAgICAgICAgICAgICAgICBpZiAoYmF0dGxlclJlbmRlcnNbaV0uT3JpZ2luLlBvc2l0aW9uICE9IHNjcmVlblBvcyAmJiB0ZXh0V29ybGQuSXNEb25lKCkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9iYXR0bGVyUmVuZGVyc1tpXS5PcmlnaW4uUG9zaXRpb24gPSBzY3JlZW5Qb3M7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9mbG9hdCB0aW1lID0gMC4xNWY7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8vL3RpbWUgPSA1O1xyXG4gICAgICAgICAgICAgICAgICAgIC8vcG9zQW5pbS5BZGQoYmF0dGxlclJlbmRlcnNbaV0uQW5pbUJhc2UodGltZSksIG5ldyBQb3NpdGlvbkFuaW1hdGlvbi5Qb3NpdGlvbkRhdGEoYmF0dGxlclJlbmRlcnNbaV0uT3JpZ2luLlBvc2l0aW9uLCBzY3JlZW5Qb3MsIHRydWUpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgYyA9IENvbG9ycy5IZXJvO1xyXG4gICAgICAgICAgICAgICAgaWYgKGdhbWVFbnRpdHkuVHlwZSA9PSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5FbnRpdHlUeXBlLmVuZW15KSBjID0gQ29sb3JzLkVuZW15O1xyXG4gICAgICAgICAgICAgICAgaWYgKGdhbWVFbnRpdHkuVHlwZSA9PSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5FbnRpdHlUeXBlLnBpY2t1cCkgYyA9IENvbG9ycy5pbnB1dEtleTtcclxuICAgICAgICAgICAgICAgIGlmIChnYW1lRW50aXR5LkRlYWQpXHJcbiAgICAgICAgICAgICAgICAgICAgYyA9IFRleHRCb2FyZC5JTlZJU0lCTEVDT0xPUjtcclxuICAgICAgICAgICAgICAgIGludCBiYyA9IFRleHRCb2FyZC5JTlZJU0lCTEVDT0xPUjtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZUVudGl0eS5BbGl2ZSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5FbGVtZW50IGVsZW1lbnQgPSBnYW1lRW50aXR5LmVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQgIT0gUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uRWxlbWVudC5Ob3RoaW5nbmVzcylcclxuICAgICAgICAgICAgICAgICAgICAgICAgYyA9IEVsZW1lbnRUb0F1cmFDb2xvcihlbGVtZW50KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZUVudGl0eS5EZWFkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgZWMuTGVuZ3RoICsgMTsgaisrKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmF0dGxlclJlbmRlcnNbaV0uT3JpZ2luLkRyYXdDaGFyKFRleHRCb2FyZC5JTlZJU0lCTEVDSEFSLCBqLCAwLCBjLCBiYyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBiYXR0bGVyUmVuZGVyc1tpXS5PcmlnaW4uRHJhdyhlYywgMCwgMCwgYywgYmMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChnYW1lRW50aXR5LmdyYXBoaWNSZXBlYXRlZEluZGV4ID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmF0dGxlclJlbmRlcnNbaV0uT3JpZ2luLkRyYXdPbmVEaWdpdChnYW1lRW50aXR5LmdyYXBoaWNSZXBlYXRlZEluZGV4ICsgMSwgMCArIGVjLkxlbmd0aCwgMCwgYywgYmMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBpbnQgdGV4dEJvYXJkSGVpZ2h0ID0gMyAqIGdyaWRTY2FsZTtcclxuXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vaW50IHkgPSAyO1xyXG4gICAgICAgICAgICAgICAgLy9pbnQgeCA9IDYgKiBncmlkU2NhbGUgKyAyMDtcclxuXHJcbiAgICAgICAgICAgICAgICBpbnQgeCA9IDM7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGlucHV0UGhhc2VzLkNvbnRhaW5zKHR1cm5CYXNlVHJ5LmJhdHRsZVN0YXRlLnBoYXNlKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBEcmF3Q29udHJvbHMoY29udHJvbHNZLCA3KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHVybkJhc2VUcnkudGltZVRvQ2hvb3NlID4gMClcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsb2F0IHJhdGlvID0gdHVybkJhc2VUcnkudGltZVRvQ2hvb3NlIC8gdHVybkJhc2VUcnkudGltZVRvQ2hvb3NlTWF4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBUZXh0Qm9hcmQuRHJhd1JlcGVhdGVkKCcgJywgeCwgY29udHJvbHNZICsgMTYsIChpbnQpKHJhdGlvICogMTUpLCAxLCBDb2xvcnMuQm9hcmQsIENvbG9ycy5HcmlkSGVybyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFRleHRCb2FyZC5EcmF3UmVwZWF0ZWQoJyAnLCB4IC0gMSwgY29udHJvbHNZIC0gMSwgMTUsIDE1LCBDb2xvcnMuQm9hcmQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpbnQgdHVybk9yZGVyWCA9IDYgKiBncmlkU2NhbGUgKyA1O1xyXG4gICAgICAgICAgICBpbnQgdHVybk9yZGVyWSA9IDI7XHJcbiAgICAgICAgICAgIHR1cm5PcmRlclggPSAyO1xyXG4gICAgICAgICAgICB0dXJuT3JkZXJZID0gMyAqIGdyaWRTY2FsZSArIDE7XHJcbiAgICAgICAgICAgIGlmIChpbnB1dFBoYXNlcy5Db250YWlucyh0dXJuQmFzZVRyeS5iYXR0bGVTdGF0ZS5waGFzZSkpXHJcbiAgICAgICAgICAgICAgICB0dXJuT3JkZXJZICs9IDM7XHJcblxyXG4gICAgICAgICAgICBEcmF3VHVybk9yZGVyKHR1cm5PcmRlclgsIHR1cm5PcmRlclkpO1xyXG4gICAgICAgICAgICBpZiAoIXN0YWdlRGF0YS5oaWRlTGlmZVVJKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBEcmF3TGlmZSh0dXJuT3JkZXJYICsgMTQsIHR1cm5PcmRlclkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbnQgWCA9IDI7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnN0IGludCBZID0gMTY7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlRW50LlNldFBvc2l0aW9uKFgsIGNvbnRyb2xzWSAtIDIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UgIT0gbnVsbCAmJiAoIUNhbkFkdmFuY2VHcmFwaGljcygpKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvL1RleHRCb2FyZC5EcmF3R3JpZChcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICBtZXNzYWdlRW50Lk9yaWdpbi5Qb3NpdGlvbi5YSW50LCBtZXNzYWdlRW50Lk9yaWdpbi5Qb3NpdGlvbi5ZSW50LCBcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICBtZXNzYWdlRW50LldpZHRoLCBtZXNzYWdlRW50LkhlaWdodCwgQ29sb3JzLkJvYXJkKTtcclxuICAgICAgICAgICAgICAgICAgICAvL21lc3NhZ2VFbnQuT3JpZ2luLkRyYXdHcmlkKDAsIDAsIDQwLCA0LCBDb2xvcnMuQm9hcmQpO1xyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VFbnQuT3JpZ2luLkRyYXdXaXRoTGluZWJyZWFrcyhtZXNzYWdlLCAxLCAwLCAxLCBDb2xvcnMuSGVyb1R1cm4pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghTWVzc2FnZURvTm90SGlkZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlRW50Lk9yaWdpbi5TZXRBbGwoVGV4dEJvYXJkLklOVklTSUJMRUNIQVIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy9UZXh0Qm9hcmQuRHJhd1JlcGVhdGVkKCcgJyxYLCBZLCA0MCwgNCwgQ29sb3JzLkJvYXJkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBUZXh0Qm9hcmQuQ3Vyc29yTmV3TGluZSgxKTtcclxuICAgICAgICAgICAgVGV4dEJvYXJkLkN1cnNvck5ld0xpbmUoMSk7XHJcbiAgICAgICAgICAgIC8vdGV4dEJvYXJkLkRyYXdfQ3Vyc29yKHR1cm5CYXNlVHJ5LmJhdHRsZVN0YXRlLnBoYXNlLlRvU3RyaW5nKCkpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHRleHRXb3JsZC5EcmF3Q2hpbGRyZW4oKTtcclxuICAgICAgICAgICAgdGV4dFdvcmxkLlRyeUVuZEFuaW1hdGlvbnMoKTtcclxuICAgICAgICAgICAgdGV4dFdvcmxkLkFkdmFuY2VUaW1lKGRlbHRhKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChDYW5BZHZhbmNlR3JhcGhpY3MoKSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgSGFwcEhhbmRsaW5nLkhhbmRsZSgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKENhbkFkdmFuY2VHcmFwaGljcygpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHR1cm5CYXNlVHJ5LmhhcHBNYW5hZ2VyLlRyeUhhbmRsZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vaWYgKENhbkFkdmFuY2UoKSlcclxuICAgICAgICAgICAgLy97XHJcblxyXG4gICAgICAgICAgICAvL31cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgaW50IEVsZW1lbnRUb0F1cmFDb2xvcihQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5FbGVtZW50IGVsZW1lbnQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgYmMgPSBUZXh0Qm9hcmQuSU5WSVNJQkxFQ09MT1I7XHJcbiAgICAgICAgICAgIGlmIChlbGVtZW50ID09IFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVsZW1lbnQuRmlyZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYmMgPSBDb2xvcnMuRmlyZUF1cmE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQgPT0gUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uRWxlbWVudC5JY2UpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGJjID0gQ29sb3JzLkljZUF1cmE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQgPT0gUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uRWxlbWVudC5UaHVuZGVyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBiYyA9IENvbG9ycy5UaHVuZGVyQXVyYTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGJjO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyBpbnQgRWxlbWVudFRvUHJvakNvbG9yKFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVsZW1lbnQgZWxlbWVudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludCBiYyA9IENvbG9ycy5pbnB1dEtleTtcclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQgPT0gUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uRWxlbWVudC5GaXJlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBiYyA9IENvbG9ycy5GaXJlU2hvdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZWxlbWVudCA9PSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5FbGVtZW50LkljZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYmMgPSBDb2xvcnMuSWNlQXVyYTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZWxlbWVudCA9PSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5FbGVtZW50LlRodW5kZXIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGJjID0gQ29sb3JzLlRodW5kZXJBdXJhO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYmM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVmVjdG9yMkQgQmF0dGxlRW50aXR5VG9TY3JlZW5Qb3NpdGlvbihCYXNlVXRpbHMuVmVjdG9yMkQgcG9zKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIHggPSBwb3MuWDtcclxuICAgICAgICAgICAgdmFyIHkgPSBwb3MuWTtcclxuICAgICAgICAgICAgdmFyIHNjcmVlblBvcyA9IG5ldyBCYXNlVXRpbHMuVmVjdG9yMkQoeCAqIGdyaWRTY2FsZSArIGdyaWRTY2FsZSAvIDIgKyBncmlkT2Zmc2V0eCwgMiAqIGdyaWRTY2FsZSAtIHkgKiBncmlkU2NhbGUgKyBncmlkU2NhbGUgLyAyICsgZ3JpZE9mZnNldHkpO1xyXG4gICAgICAgICAgICByZXR1cm4gc2NyZWVuUG9zO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIERyYXdDb250cm9scyhpbnQgeSwgaW50IHgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAvL1RleHRCb2FyZC5EcmF3R3JpZCh4IC0gMiwgeSAtIDEsIDIwLCAxNSwgQ29sb3JzLkJvYXJkKTtcclxuICAgICAgICAgICAgLy9UZXh0Qm9hcmQuRHJhdyhcIkNvbnRyb2xzXCIsIHgsIHksICk7XHJcbiAgICAgICAgICAgIFRleHRCb2FyZC5TZXRDdXJzb3JBdCh4ICsgNSwgeSk7XHJcbiAgICAgICAgICAgIFRleHRCb2FyZC5EcmF3X0N1cnNvcihcIkNvbnRyb2xzXCIsIENvbG9ycy5XaW5kb3dMYWJlbCk7XHJcbiAgICAgICAgICAgIFRleHRCb2FyZC5DdXJzb3JOZXdMaW5lKHgpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vSW5wdXRUYWdzIGlucHV0VGFnID0gSW5wdXRUYWdzLk1PVkVGSVg7XHJcbiAgICAgICAgICAgIGludCB5T2ZmID0gMDtcclxuXHJcbiAgICAgICAgICAgIGlmICghYXR0YWNrTWVudSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgeU9mZiA9IERyYXdJbnB1dHNfRml4KHksIHgsIElucHV0VGFncy5NT1ZFRklYLCB5T2ZmKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL2lmIChIYXNBdHRhY2tzKCkpXHJcbiAgICAgICAgICAgICAgICAvLyAgICBHYW1lTWFpbi5EcmF3SW5wdXQoeCwgeSArIDIgKyB5T2ZmLCAnZScsIFwiQVRUQUNLXCIsIFRleHRCb2FyZCk7XHJcbiAgICAgICAgICAgICAgICAvL2Vsc2VcclxuICAgICAgICAgICAgICAgIC8vICAgIERyYXdJbnB1dCh4LCB5ICsgMiArIHlPZmYsIFwiXCIsIFwiXCIsIFRleHRCb2FyZCk7XHJcbiAgICAgICAgICAgICAgICAvL3lPZmYgKz0gMjtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgLy95T2ZmKys7XHJcbiAgICAgICAgICAgICAgICB5T2ZmID0gRHJhd0lucHV0c19GaXgoeSwgeCwgSW5wdXRUYWdzLk1JU0MsIHlPZmYpO1xyXG4gICAgICAgICAgICAgICAgLy95T2ZmKys7XHJcbiAgICAgICAgICAgICAgICAvL3lPZmYgPSBEcmF3SW5wdXRzX0ZpeCh5LCB4LCBJbnB1dFRhZ3MuTU9WRVVORklYLCB5T2ZmKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgaW50IGF0dGFja051bWJlciA9IDE7XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdHVybkJhc2VUcnkuaW5wdXRzLmlucHV0cy5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnQgeDIgPSB4O1xyXG4gICAgICAgICAgICAgICAgaW50IHkyID0geSArIDIgKyB5T2ZmO1xyXG4gICAgICAgICAgICAgICAgdmFyIGlucHV0ID0gdHVybkJhc2VUcnkuaW5wdXRzLmlucHV0c1tpXTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodHVybkJhc2VUcnkuaW5wdXRzLlRhZ0lzKGksIElucHV0VGFncy5NT1ZFVU5GSVgpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHlPZmYrKztcclxuICAgICAgICAgICAgICAgICAgICB5T2ZmKys7XHJcbiAgICAgICAgICAgICAgICAgICAgaW50IHVuaWNvZGUgPSAnMCcgKyBhdHRhY2tOdW1iZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgYXR0YWNrTnVtYmVyKys7XHJcbiAgICAgICAgICAgICAgICAgICAgbW91c2VIb3Zlci5tb3VzZUhvdmVycy5BZGQobmV3IE1vdXNlSG92ZXIobmV3IFJlY3QoeDIgLSAyLCB5MiwgMjAsIDEpLCAwLCBpbnB1dC5hcmcxKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9UZXh0Qm9hcmQuRHJhd0NoYXIoJ1snLCB4MiAtIDEsIHkyLCBDb2xvcnMuSGVyb1R1cm4gICk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vVGV4dEJvYXJkLkRyYXdDaGFyKCddJywgeDIgKyBsZW5ndGhCbmFtZSwgeTIsIENvbG9ycy5IZXJvVHVybik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZyBkZXNjcmlwdGlvbiA9IHN0cmluZy5FbXB0eTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQudHlwZSA9PSBJbnB1dFR5cGUuTW92ZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC5hcmcxID49IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLk1vdmVUeXBlIG0gPSAoUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uTW92ZVR5cGUpaW5wdXQuYXJnMTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IG1vdmVSZW5kZXJzW2lucHV0LmFyZzFdLkxhYmVsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9tb3ZlRGVzY3JpcHRpb25zLlRyeUdldFZhbHVlKG0sIG91dCBkZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVzY3JpcHRpb24gPT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IG0uVG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC50eXBlID09IElucHV0VHlwZS5NaXNjQmF0dGxlKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTWlzY0JhdHRsZUlucHV0IGFyZzEgPSAoTWlzY0JhdHRsZUlucHV0KWlucHV0LmFyZzE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gbWlzY0Rlc2NyaXB0aW9uc1thcmcxXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIFRleHRCb2FyZCA9IHRoaXMuVGV4dEJvYXJkO1xyXG4gICAgICAgICAgICAgICAgICAgIEdhbWVNYWluLkRyYXdJbnB1dCh4MiwgeTIsIHVuaWNvZGUsIGRlc2NyaXB0aW9uLCBUZXh0Qm9hcmQpO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvL3ZhciBjID0gbW92ZUNoYXJzW21vdmVdO1xyXG4gICAgICAgICAgICAgICAgLy9EcmF3TW92ZShtb3ZlLCBDb2xvcnMuSGVyb1R1cm4pO1xyXG4gICAgICAgICAgICAgICAgLy9UZXh0Qm9hcmQuRHJhdyhjLCB4MiArIDMsIHkyLCBDb2xvcnMuSGVyb1R1cm4pO1xyXG4gICAgICAgICAgICAgICAgLy9UZXh0Qm9hcmQuRHJhd1dpdGhHcmlkKGMrXCJcIiwgeDIsIHkgKyAyLCBDb2xvcnMuSGVyb1R1cm4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChQcmV2aWV3VmlzaWJsZSgpKVxyXG4gICAgICAgICAgICAgICAgR2FtZU1haW4uRHJhd0lucHV0KHgsIHkgKyAyICsgeU9mZiwgJ3AnLCBcIlBSRVZJRVdcIiwgVGV4dEJvYXJkKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgRHJhd0lucHV0KHgsIHkgKyAyICsgeU9mZiwgXCJcIiwgXCJcIiwgVGV4dEJvYXJkKTtcclxuICAgICAgICAgICAgeU9mZiArPSAyO1xyXG4gICAgICAgICAgICBHYW1lTWFpbi5EcmF3SW5wdXQoeCwgeSArIDIgKyB5T2ZmLCAnYycsIFwiQ09OVFJPTFNcIiwgVGV4dEJvYXJkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgYm9vbCBIYXNBdHRhY2tzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdHVybkJhc2VUcnkuaW5wdXRzLmlucHV0cy5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHVybkJhc2VUcnkuaW5wdXRzLlRhZ0lzKGksIElucHV0VGFncy5NT1ZFVU5GSVgpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgYm9vbCBQcmV2aWV3VmlzaWJsZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3JlYWNoICh2YXIgZSBpbiB0dXJuQmFzZVRyeS5lbnRpdGllcylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUuVHlwZSA9PSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5FbnRpdHlUeXBlLmVuZW15KSByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIGludCBEcmF3SW5wdXRzX0ZpeChpbnQgeSwgaW50IHgsIElucHV0VGFncyBpbnB1dFRhZywgaW50IHlPZmYpXHJcbiAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0dXJuQmFzZVRyeS5pbnB1dHMuaW5wdXRzLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCB4MiA9IHg7XHJcbiAgICAgICAgICAgICAgICBpbnQgeTIgPSB5ICsgMiArIHlPZmY7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5wdXQgPSB0dXJuQmFzZVRyeS5pbnB1dHMuaW5wdXRzW2ldO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0dXJuQmFzZVRyeS5pbnB1dHMuVGFnSXMoaSwgaW5wdXRUYWcpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB1bmljb2RlID0gaW5wdXRILkdldEZpeGVkTW92ZVVuaWNvZGUoaW5wdXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZyBmb3JjZUlucHV0TGFiZWwgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZyBmb3JjZUNvbW1hbmRMYWJlbCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgYm9vbCBtb3ZlbWVudENvbW1hbmQgPSB1bmljb2RlID09ICd3JztcclxuICAgICAgICAgICAgICAgICAgICBpZiAobW92ZW1lbnRDb21tYW5kKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yY2VJbnB1dExhYmVsID0gVUlSZXVzYWJsZS5XQVNEO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JjZUNvbW1hbmRMYWJlbCA9IFVJUmV1c2FibGUuYXJyb3dzO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodW5pY29kZSA9PSAnYScgfHwgdW5pY29kZSA9PSAncycgfHwgdW5pY29kZSA9PSAnZCcpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgeU9mZisrO1xyXG4gICAgICAgICAgICAgICAgICAgIHlPZmYrKztcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL1RleHRCb2FyZC5EcmF3Q2hhcignWycsIHgyIC0gMSwgeTIsIENvbG9ycy5IZXJvVHVybik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vVGV4dEJvYXJkLkRyYXdDaGFyKCddJywgeDIgKyBsZW5ndGhCbmFtZSwgeTIsIENvbG9ycy5IZXJvVHVybik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHN0cmluZyBkZXNjcmlwdGlvbiA9IHN0cmluZy5FbXB0eTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQudHlwZSA9PSBJbnB1dFR5cGUuTW92ZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmb3JjZUNvbW1hbmRMYWJlbCAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiA9IGZvcmNlQ29tbWFuZExhYmVsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gPSBtb3ZlUmVuZGVyc1tpbnB1dC5hcmcxXS5MYWJlbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC50eXBlID09IElucHV0VHlwZS5NaXNjQmF0dGxlKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTWlzY0JhdHRsZUlucHV0IGFyZzEgPSAoTWlzY0JhdHRsZUlucHV0KWlucHV0LmFyZzE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gbWlzY0Rlc2NyaXB0aW9uc1thcmcxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbW91c2VIb3Zlci5tb3VzZUhvdmVycy5BZGQobmV3IE1vdXNlSG92ZXIobmV3IFJlY3QoeDIgLSAyLCB5MiwgMjAsIDEpLCAxLCBpbnB1dC5hcmcxKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb3ZlbWVudENvbW1hbmQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3VzZUhvdmVyLm1vdXNlSG92ZXJzLkFkZChuZXcgTW91c2VIb3ZlcihuZXcgUmVjdCh4MiAtIDIsIHkyLCAyMCwgMSksIDIsIDApKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW91c2VIb3Zlci5tb3VzZUhvdmVycy5BZGQobmV3IE1vdXNlSG92ZXIobmV3IFJlY3QoeDIgLSAyLCB5MiwgMjAsIDEpLCAwLCBpbnB1dC5hcmcxKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBUZXh0Qm9hcmQgPSB0aGlzLlRleHRCb2FyZDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZm9yY2VJbnB1dExhYmVsID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBEcmF3SW5wdXQoeDIsIHkyLCB1bmljb2RlLCBkZXNjcmlwdGlvbiwgVGV4dEJvYXJkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRHJhd0lucHV0KHgyLCB5MiwgZm9yY2VJbnB1dExhYmVsLCBkZXNjcmlwdGlvbiwgVGV4dEJvYXJkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvL3ZhciBjID0gbW92ZUNoYXJzW21vdmVdO1xyXG4gICAgICAgICAgICAgICAgLy9EcmF3TW92ZShtb3ZlLCBDb2xvcnMuSGVyb1R1cm4pO1xyXG4gICAgICAgICAgICAgICAgLy9UZXh0Qm9hcmQuRHJhdyhjLCB4MiArIDMsIHkyLCBDb2xvcnMuSGVyb1R1cm4pO1xyXG4gICAgICAgICAgICAgICAgLy9UZXh0Qm9hcmQuRHJhd1dpdGhHcmlkKGMrXCJcIiwgeDIsIHkgKyAyLCBDb2xvcnMuSGVyb1R1cm4pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4geU9mZjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBEcmF3SW5wdXQoaW50IHgyLCBpbnQgeTIsIGludCBrZXlVbmljb2RlLCBzdHJpbmcgZGVzY3JpcHRpb24sIFRleHRCb2FyZCBUZXh0Qm9hcmQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpbnQgeDMgPSBEcmF3SW5wQ29tbW9uKHgyLCB5MiwgZGVzY3JpcHRpb24sIFRleHRCb2FyZCk7XHJcblxyXG4gICAgICAgICAgICBUZXh0Qm9hcmQuRHJhd1VuaWNvZGVMYWJlbChrZXlVbmljb2RlLCB4MywgeTIsIENvbG9ycy5pbnB1dEtleSk7XHJcbiAgICAgICAgICAgIC8vVGV4dEJvYXJkLkRyYXdSZWN0KFRleHRCb2FyZC5OT0NIQU5HRUNIQVIsIGJhcngsIHkyLCA2K3gzLWJhcngsIDEsIFRleHRCb2FyZC5OT0NIQU5HRUNPTE9SLCBDb2xvcnMuQmFja0JhdHRsZSk7XHJcbiAgICAgICAgICAgIC8vVGV4dEJvYXJkLkRyYXdSZWN0KFRleHRCb2FyZC5OT0NIQU5HRUNIQVIsIHgyLCB5MiwgNiArIHgzIC0geDIsIDEsIFRleHRCb2FyZC5OT0NIQU5HRUNPTE9SLCBDb2xvcnMuQmFja0JhdHRsZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHN0YXRpYyBpbnQgRHJhd0lucENvbW1vbihpbnQgeDIsIGludCB5Miwgc3RyaW5nIGRlc2NyaXB0aW9uLCBUZXh0Qm9hcmQgVGV4dEJvYXJkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgRHJhd0Jyb3duU3RyaXBlKHkyLCBUZXh0Qm9hcmQpO1xyXG4gICAgICAgICAgICBUZXh0Qm9hcmQuRHJhdyhkZXNjcmlwdGlvbiwgeDIsIHkyLCBDb2xvcnMuSW5wdXREZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgIGludCB4MyA9IHgyICsgMTQ7XHJcblxyXG4gICAgICAgICAgICAvL2ludCBvZmZiID0gNztcclxuICAgICAgICAgICAgaW50IGJhcnggPSB4MiArIGRlc2NyaXB0aW9uLkxlbmd0aDtcclxuICAgICAgICAgICAgVGV4dEJvYXJkLkRyYXdSZWN0KFRleHRCb2FyZC5OT0NIQU5HRUNIQVIsIHgzLCB5MiwgNiwgMSwgVGV4dEJvYXJkLk5PQ0hBTkdFQ09MT1IsIENvbG9ycy5CYWNrQmF0dGxlKTtcclxuICAgICAgICAgICAgcmV0dXJuIHgzO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgc3RhdGljIHZvaWQgRHJhd1N0cmlwcGVkVGV4dChpbnQgeCwgaW50IHksIHN0cmluZyBkZXNjcmlwdGlvbiwgVGV4dEJvYXJkIFRleHRCb2FyZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIERyYXdCcm93blN0cmlwZSh5LCBUZXh0Qm9hcmQpO1xyXG4gICAgICAgICAgICBUZXh0Qm9hcmQuRHJhdyhkZXNjcmlwdGlvbiwgeCwgeSwgQ29sb3JzLklucHV0RGVzY3JpcHRpb24pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIERyYXdTdWJUZXh0KGludCB4LCBpbnQgeSwgc3RyaW5nIGRlc2NyaXB0aW9uLCBUZXh0Qm9hcmQgVGV4dEJvYXJkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVGV4dEJvYXJkLkRyYXdSZWN0KFRleHRCb2FyZC5OT0NIQU5HRUNIQVIsIHgsIHksIDYsIDEsIFRleHRCb2FyZC5OT0NIQU5HRUNPTE9SLCBDb2xvcnMuQmFja0JhdHRsZSk7XHJcbiAgICAgICAgICAgIFRleHRCb2FyZC5EcmF3KGRlc2NyaXB0aW9uLCB4ICsgMSwgeSwgQ29sb3JzLmlucHV0S2V5KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBEcmF3SW5wdXQoaW50IHgyLCBpbnQgeTIsIHN0cmluZyBrZXlMYWJlbCwgc3RyaW5nIGRlc2NyaXB0aW9uLCBUZXh0Qm9hcmQgVGV4dEJvYXJkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaW50IHgzID0gRHJhd0lucENvbW1vbih4MiwgeTIsIGRlc2NyaXB0aW9uLCBUZXh0Qm9hcmQpO1xyXG4gICAgICAgICAgICBUZXh0Qm9hcmQuRHJhdyhrZXlMYWJlbCwgeDMsIHkyLCBDb2xvcnMuaW5wdXRLZXkpO1xyXG4gICAgICAgICAgICAvL1RleHRCb2FyZC5EcmF3UmVjdChUZXh0Qm9hcmQuTk9DSEFOR0VDSEFSLCBiYXJ4LCB5MiwgNiArIHgzIC0gYmFyeCwgMSwgVGV4dEJvYXJkLk5PQ0hBTkdFQ09MT1IsIENvbG9ycy5CYWNrQmF0dGxlKTtcclxuICAgICAgICAgICAgLy9UZXh0Qm9hcmQuRHJhd1JlY3QoVGV4dEJvYXJkLk5PQ0hBTkdFQ0hBUiwgeDIsIHkyLCA2ICsgeDMgLSB4MiwgMSwgVGV4dEJvYXJkLk5PQ0hBTkdFQ09MT1IsIENvbG9ycy5CYWNrQmF0dGxlKTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgRHJhd0xpZmUoaW50IHR1cm5PcmRlclgsIGludCB0dXJuT3JkZXJZKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9UZXh0Qm9hcmQuRHJhd0dyaWQodHVybk9yZGVyWCAtIDEsIHR1cm5PcmRlclkgLSAxLCAyMCwgOSwgQ29sb3JzLldpbmRvd0xhYmVsKTtcclxuICAgICAgICAgICAgVGV4dEJvYXJkLlNldEN1cnNvckF0KHR1cm5PcmRlclggKyAxLCB0dXJuT3JkZXJZKTtcclxuICAgICAgICAgICAgaWYgKHR1cm5CYXNlVHJ5LmJhdHRsZVN0YXRlLnBoYXNlID09IFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkJhdHRsZVBoYXNlLlBpY2tIYW5kcylcclxuICAgICAgICAgICAgICAgIFRleHRCb2FyZC5EcmF3X0N1cnNvcihcIkxpZmVcIiwgQ29sb3JzLldpbmRvd0xhYmVsKTtcclxuICAgICAgICAgICAgVGV4dEJvYXJkLlNldEN1cnNvckF0KHR1cm5PcmRlclggKyA4LCB0dXJuT3JkZXJZKTtcclxuICAgICAgICAgICAgaWYgKHR1cm5CYXNlVHJ5LmJhdHRsZVN0YXRlLnBoYXNlID09IFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkJhdHRsZVBoYXNlLlBpY2tIYW5kcylcclxuICAgICAgICAgICAgICAgIFRleHRCb2FyZC5EcmF3X0N1cnNvcihcIkVsZW1lbnRcIiwgQ29sb3JzLldpbmRvd0xhYmVsKTtcclxuICAgICAgICAgICAgaW50IGluZGV4ID0gLTE7IC8vdXNpbmcgdGhpcyBiZWNhdXNlIG5vdCBhbGwgdW5pdHMgZ2V0IGRyYXduXHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgNDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnQgeE9mZiA9IHR1cm5PcmRlclggKyAxO1xyXG4gICAgICAgICAgICAgICAgaW50IHlPZmYgPSB0dXJuT3JkZXJZICsgMiArIGkgKiAyO1xyXG4gICAgICAgICAgICAgICAgVGV4dEJvYXJkLkRyYXdSZWN0KFRleHRCb2FyZC5OT0NIQU5HRUNIQVIsIHhPZmYsIHlPZmYsIDQsIDEsIFRleHRCb2FyZC5OT0NIQU5HRUNPTE9SLCBCYXR0bGVSZW5kZXIuQ29sb3JzLkJhY2tCYXR0bGUpO1xyXG4gICAgICAgICAgICAgICAgVGV4dEJvYXJkLkRyYXdSZWN0KFRleHRCb2FyZC5OT0NIQU5HRUNIQVIsIHhPZmYgKyA3LCB5T2ZmLCA4LCAxLCBUZXh0Qm9hcmQuTk9DSEFOR0VDT0xPUiwgQmF0dGxlUmVuZGVyLkNvbG9ycy5CYWNrQmF0dGxlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHR1cm5CYXNlVHJ5LmVudGl0aWVzLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChpID49IHR1cm5CYXNlVHJ5LmVudGl0aWVzLkNvdW50KVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgQmF0dGxlTWFpbi5CYXR0bGVFbnRpdHkgZSA9IHR1cm5CYXNlVHJ5LmVudGl0aWVzW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFlLmRyYXdMaWZlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFlLkRlYWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICBpbnQgeE9mZiA9IHR1cm5PcmRlclggKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIGludCB5T2ZmID0gdHVybk9yZGVyWSArIDIgKyBpbmRleCAqIDI7XHJcbiAgICAgICAgICAgICAgICAgICAgaW50IGNvbG9yID0gQ29sb3JzLkhlcm9UdXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLlR5cGUgPT0gQmF0dGxlTWFpbi5FbnRpdHlUeXBlLmVuZW15KVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBDb2xvcnMuRW5lbXlUdXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS5lbGVtZW50ICE9IFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVsZW1lbnQuTm90aGluZ25lc3MpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gRWxlbWVudFRvQXVyYUNvbG9yKGUuZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9UZXh0Qm9hcmQuRHJhd09uZURpZ2l0X0N1cnNvcigoaW50KWUubGlmZS5WYWwpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvL0RyYXdFbnRpdHlDaGFyKGUsIGNvbG9yLCB4T2ZmLCB5T2ZmKTtcclxuICAgICAgICAgICAgICAgICAgICAvL1RleHRCb2FyZC5EcmF3Q2hhcihHZXRDaGFyKGUpLCB4T2ZmLCB0dXJuT3JkZXJZICsgMiwgY29sb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIFRleHRCb2FyZC5EcmF3VHdvRGlnaXRzKChpbnQpZS5saWZlLCB4T2ZmLCB5T2ZmLCBjb2xvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGVsZW1lbnQgPSBzdHJpbmcuRW1wdHk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChlLmVsZW1lbnQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVsZW1lbnQuRmlyZTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBcIkZpcmVcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVsZW1lbnQuSWNlOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IFwiSWNlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5FbGVtZW50LlRodW5kZXI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50ID0gXCJUaHVuZGVyXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlTWFpbi5FbGVtZW50Lk5vdGhpbmduZXNzOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVDb2xvciA9IEVsZW1lbnRUb0F1cmFDb2xvcihlLmVsZW1lbnQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBUZXh0Qm9hcmQuRHJhdyhlbGVtZW50LCB4T2ZmICsgNywgeU9mZiwgZUNvbG9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvL1RleHRCb2FyZC5EcmF3T25lRGlnaXRfQ3Vyc29yKChpbnQpZS5saWZlLlZhbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9UZXh0Qm9hcmQuQ3Vyc29yTmV3TGluZSh4OiAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSB2b2lkIERyYXdCcm93blN0cmlwZShpbnQgeU9mZilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIERyYXdCcm93blN0cmlwZSh5T2ZmLCBUZXh0Qm9hcmQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3RhdGljIHByaXZhdGUgdm9pZCBEcmF3QnJvd25TdHJpcGUoaW50IHlPZmYsIFRleHRCb2FyZCB0ZXh0Qm9hcmQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB0ZXh0Qm9hcmQuRHJhd1JlY3QoVGV4dEJvYXJkLk5PQ0hBTkdFQ0hBUiwgMCwgeU9mZiwgdGV4dEJvYXJkLldpZHRoLCAxLCBUZXh0Qm9hcmQuTk9DSEFOR0VDT0xPUiwgQmF0dGxlUmVuZGVyLkNvbG9ycy5CYWNrU3RyaXBlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBEcmF3VHVybk9yZGVyKGludCB0dXJuT3JkZXJYLCBpbnQgdHVybk9yZGVyWSwgYm9vbCBob3Jpem9udGFsID0gdHJ1ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFZhbHVlIHR1cm5zUGVyUGhhc2UgPSB0dXJuQmFzZVRyeS5iYXR0bGVTdGF0ZS50dXJuc1BlclBoYXNlO1xyXG4gICAgICAgICAgICBUZXh0Qm9hcmQuU2V0Q3Vyc29yQXQodHVybk9yZGVyWCArIDMsIHR1cm5PcmRlclkpO1xyXG4gICAgICAgICAgICBpZiAodHVybkJhc2VUcnkuYmF0dGxlU3RhdGUucGhhc2UgPT0gUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uQmF0dGxlUGhhc2UuUGlja0hhbmRzKVxyXG4gICAgICAgICAgICAgICAgVGV4dEJvYXJkLkRyYXdfQ3Vyc29yKFwiVHVyblwiLCBDb2xvcnMuV2luZG93TGFiZWwpO1xyXG5cclxuICAgICAgICAgICAgaW50IGRyYXdpbmdJZCA9IC0xO1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDQ7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW50IHlPZmYgPSB0dXJuT3JkZXJZICsgMiArIGkgKiAyO1xyXG4gICAgICAgICAgICAgICAgRHJhd0Jyb3duU3RyaXBlKHlPZmYsIFRleHRCb2FyZCk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IDM7IGorKylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnQgeE9mZiA9IHR1cm5PcmRlclggKyBqICogMyArIDM7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICBUZXh0Qm9hcmQuRHJhd1JlY3QoVGV4dEJvYXJkLk5PQ0hBTkdFQ0hBUiwgeE9mZiwgeU9mZiwgMiwgMSwgVGV4dEJvYXJkLk5PQ0hBTkdFQ09MT1IsIEJhdHRsZVJlbmRlci5Db2xvcnMuQmFja0JhdHRsZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0dXJuQmFzZVRyeS5lbnRpdGllcy5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgQmF0dGxlTWFpbi5CYXR0bGVFbnRpdHkgZSA9IHR1cm5CYXNlVHJ5LmVudGl0aWVzW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFlLmRyYXdUdXJuKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFlLkRlYWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZHJhd2luZ0lkKys7XHJcbiAgICAgICAgICAgICAgICAgICAgaW50IGNvbG9yID0gQ29sb3JzLkhlcm9UdXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLlR5cGUgPT0gQmF0dGxlTWFpbi5FbnRpdHlUeXBlLmVuZW15KVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBDb2xvcnMuRW5lbXlUdXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS5lbGVtZW50ICE9IFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVNYWluLkVsZW1lbnQuTm90aGluZ25lc3MpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gRWxlbWVudFRvQXVyYUNvbG9yKGUuZWxlbWVudCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vVGV4dEJvYXJkLkRyYXdPbmVEaWdpdF9DdXJzb3IoKGludCllLmxpZmUuVmFsKTtcclxuICAgICAgICAgICAgICAgICAgICBpbnQgeE9mZiA9IHR1cm5PcmRlclggKyAxICsgZHJhd2luZ0lkICogMztcclxuICAgICAgICAgICAgICAgICAgICBpbnQgeUVudGl0eSA9IHR1cm5PcmRlclkgKyAyO1xyXG4gICAgICAgICAgICAgICAgICAgIGludCB5Rmlyc3RNb3ZlID0gdHVybk9yZGVyWSArIDM7XHJcbiAgICAgICAgICAgICAgICAgICAgaW50IHhGaXJzdE1vdmUgPSB4T2ZmO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChob3Jpem9udGFsKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeE9mZiA9IHR1cm5PcmRlclg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHlFbnRpdHkgPSB0dXJuT3JkZXJZICsgMiArIGRyYXdpbmdJZCAqIDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHlGaXJzdE1vdmUgPSB5RW50aXR5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB4Rmlyc3RNb3ZlID0gdHVybk9yZGVyWCArIDM7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIERyYXdFbnRpdHlDaGFyKGUsIGNvbG9yLCB4T2ZmLCB5RW50aXR5KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgVGV4dEJvYXJkLlNldEN1cnNvckF0KHhGaXJzdE1vdmUsIHlGaXJzdE1vdmUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpMiA9IDA7IGkyIDwgdHVybnNQZXJQaGFzZTsgaTIrKylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludCBjb2xvcjIgPSBjb2xvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50IGJhY2tDb2xvciA9IENvbG9ycy5CYWNrQ29tbWFuZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR1cm5CYXNlVHJ5LmJhdHRsZVN0YXRlLnBoYXNlID09IEJhdHRsZU1haW4uQmF0dGxlUGhhc2UuRXhlY3V0ZU1vdmUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkcmF3aW5nSWQgPT0gdHVybkJhc2VUcnkuYmF0dGxlU3RhdGUuYWN0aW5nRW50aXR5ICYmIGkyID09IHR1cm5CYXNlVHJ5LmJhdHRsZVN0YXRlLnR1cm4pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbG9yMiA9IENvbG9ycy5IZXJvO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tDb2xvciA9IENvbG9ycy5CYWNrQmF0dGxlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yMiA9IENvbG9ycy5JbnB1dERlc2NyaXB0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkyIDwgdHVybnNQZXJQaGFzZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIGMgPSBHZXRDaGFyT2ZNb3ZlKGUsIGkyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNlSG92ZXIubW91c2VIb3ZlcnMuQWRkKG5ldyBNb3VzZUhvdmVyKG5ldyBSZWN0KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRCb2FyZC5DdXJzb3JYLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRCb2FyZC5DdXJzb3JZLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuTGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsIGUubW92ZXNbaTJdKSk7IC8vYWRkIGhlcmUuLi4/IEBfQFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRCb2FyZC5EcmF3X0N1cnNvcihjLCBjb2xvcjIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhvcml6b250YWwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaiA9IGMuTGVuZ3RoOyBqIDwgMzsgaisrKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dEJvYXJkLkFkdmFuY2VDdXJzb3IoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vVGV4dEJvYXJkLkRyYXdfQ3Vyc29yKCcgJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0Qm9hcmQuRHJhd19DdXJzb3IoJyAnLCBjb2xvciwgQ29sb3JzLkJhY2tDb21tYW5kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaG9yaXpvbnRhbClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRleHRCb2FyZC5DdXJzb3JOZXdMaW5lKHg6IHhGaXJzdE1vdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAvL1RleHRCb2FyZC5DdXJzb3JOZXdMaW5lKHg6IDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgRHJhd0VudGl0eUNoYXIoUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZU1haW4uQmF0dGxlRW50aXR5IGUsIGludCBjb2xvciwgaW50IHgsIGludCB5KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgY2hhcltdIGNoYXJzID0gR2V0Q2hhcihlKTtcclxuXHJcbiAgICAgICAgICAgIFRleHRCb2FyZC5EcmF3KGNoYXJzLCB4LCB5LCBjb2xvcik7XHJcbiAgICAgICAgICAgIGlmIChlLmdyYXBoaWNSZXBlYXRlZEluZGV4ID4gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgVGV4dEJvYXJkLkRyYXdPbmVEaWdpdChlLmdyYXBoaWNSZXBlYXRlZEluZGV4ICsgMSwgeCArIGNoYXJzLkxlbmd0aCwgeSwgY29sb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHN0cmluZyBHZXRDaGFyT2ZNb3ZlKEJhdHRsZU1haW4uQmF0dGxlRW50aXR5IGUsIGludCBpMilcclxuICAgICAgICB7XHJcblxyXG5cclxuICAgICAgICAgICAgaW50IHZhbCA9IGUubW92ZXNbaTJdO1xyXG4gICAgICAgICAgICBpZiAodmFsID49IDApXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbW92ZVJlbmRlcnNbdmFsXS5BYnJldjtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiIFwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGNoYXJbXSBHZXRDaGFyKEJhdHRsZU1haW4uQmF0dGxlRW50aXR5IGdhbWVFbnRpdHkpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gZW50aXRpZXNDaGFyc1tnYW1lRW50aXR5LmdyYXBoaWNdO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBEcmF3TW92ZShWYWx1ZSBtb3ZlLCBpbnQgY29sb3IpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAobW92ZS5WYWwgPj0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgQmF0dGxlTWFpbi5Nb3ZlVHlwZSBtID0gKEJhdHRsZU1haW4uTW92ZVR5cGUpbW92ZS5WYWw7XHJcbiAgICAgICAgICAgICAgICBEcmF3TW92ZShtLCBjb2xvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBUZXh0Qm9hcmQuRHJhd19DdXJzb3IoJyAnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgdm9pZCBEcmF3TW92ZShCYXR0bGVNYWluLk1vdmVUeXBlIG1vdmUsIGludCBjb2xvcilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBjID0gbW92ZVJlbmRlcnNbKGludCltb3ZlXS5BYnJldjtcclxuICAgICAgICAgICAgVGV4dEJvYXJkLkRyYXdfQ3Vyc29yKGMsIGNvbG9yKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBUZXh0Qm9hcmQgR2V0Qm9hcmQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIFRleHRCb2FyZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgQ29sb3JzXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwdWJsaWMgY29uc3QgaW50IEdyaWRIZXJvID0gMTtcclxuICAgICAgICAgICAgcHVibGljIGNvbnN0IGludCBHcmlkRW5lbXkgPSAyO1xyXG4gICAgICAgICAgICBwdWJsaWMgY29uc3QgaW50IEhlcm8gPSAzO1xyXG4gICAgICAgICAgICBwdWJsaWMgY29uc3QgaW50IEVuZW15ID0gNDtcclxuICAgICAgICAgICAgcHVibGljIGNvbnN0IGludCBIZXJvVHVybiA9IDU7XHJcbiAgICAgICAgICAgIHB1YmxpYyBjb25zdCBpbnQgRW5lbXlUdXJuID0gNjtcclxuICAgICAgICAgICAgcHVibGljIGNvbnN0IGludCBpbnB1dEtleSA9IDc7XHJcbiAgICAgICAgICAgIHB1YmxpYyBjb25zdCBpbnQgQm9hcmQgPSA4O1xyXG4gICAgICAgICAgICBwdWJsaWMgY29uc3QgaW50IFdpbmRvd0xhYmVsID0gOTtcclxuICAgICAgICAgICAgaW50ZXJuYWwgc3RhdGljIGludCBGaXJlQXVyYSA9IDEwO1xyXG4gICAgICAgICAgICBpbnRlcm5hbCBzdGF0aWMgaW50IEljZUF1cmEgPSAxMTtcclxuICAgICAgICAgICAgaW50ZXJuYWwgc3RhdGljIGludCBUaHVuZGVyQXVyYSA9IDEyO1xyXG4gICAgICAgICAgICBpbnRlcm5hbCBzdGF0aWMgaW50IEZpcmVTaG90ID0gMTM7XHJcbiAgICAgICAgICAgIGludGVybmFsIHN0YXRpYyBpbnQgSWNlU2hvdCA9IDE0O1xyXG4gICAgICAgICAgICBpbnRlcm5hbCBzdGF0aWMgaW50IFRodW5kZXJTaG90ID0gMTU7XHJcbiAgICAgICAgICAgIHB1YmxpYyBjb25zdCBpbnQgQmFja2dyb3VuZElucHV0ID0gMTY7XHJcbiAgICAgICAgICAgIHB1YmxpYyBjb25zdCBpbnQgSW5wdXREZXNjcmlwdGlvbiA9IDE3O1xyXG4gICAgICAgICAgICBpbnRlcm5hbCBzdGF0aWMgaW50IEJhY2tCYXR0bGUgPSAxODtcclxuICAgICAgICAgICAgaW50ZXJuYWwgc3RhdGljIGludCBCYWNrQ29tbWFuZCA9IDE5O1xyXG4gICAgICAgICAgICBpbnRlcm5hbCBjb25zdCBpbnQgQmFja1N0cmlwZSA9IDIwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIGVudW0gSW5wdXRLZXlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIE5PTkUsIExFRlQsIFJJR0hULCBET1dOLCBVUCwgRklSRSwgUkVETywgRE9ORSxcclxuICAgICAgICAgICAgSUNFLFxyXG4gICAgICAgICAgICBUSFVOREVSLFxyXG4gICAgICAgICAgICBOT1JNQUxTSE9UXHJcbiAgICAgICAgfVxyXG5cblxyXG5cclxuICAgIFxucHJpdmF0ZSBpbnQgX19Qcm9wZXJ0eV9fSW5pdGlhbGl6ZXJfX2tleURvd25Vbmljb2RlPS0xO31cclxuXHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLkxpbnE7XHJcbnVzaW5nIFN5c3RlbS5UZXh0O1xyXG51c2luZyBQaWRyb2guQmFzZVV0aWxzO1xyXG51c2luZyBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQ29udGVudENyZWF0b3I7XHJcbnVzaW5nIFBpZHJvaC5FQ1M7XHJcbnVzaW5nIFBpZHJvaC5UZXh0UmVuZGVyaW5nO1xyXG51c2luZyBQaWRyb2guVGV4dFJlbmRlcmluZy5HYW1lU2NyZWVuO1xyXG51c2luZyBQaWRyb2guVHVybkJhc2VkLlRleHRSZW5kZXJpbmc7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBHYW1lTWFpbiA6IElUZXh0U2NyZWVuX1xyXG4gICAge1xyXG4gICAgICAgIHByaXZhdGUgQmF0dGxlTWFpbiBiYXR0bGVNYWluO1xyXG4gICAgICAgIHByaXZhdGUgQmF0dGxlUmVuZGVyIGJhdHRsZVJlbmRlcjtcclxuICAgICAgICBwcml2YXRlIE1vZGVTZWxlY3Rpb25TY3JlZW4gbW9kZVNlbGVjdGlvblNjcmVlbjtcclxuICAgICAgICBJVGV4dFNjcmVlbl8gbWFpbkRyYXc7XHJcbiAgICAgICAgcHJpdmF0ZSBHZW5lcmljQ2hvaWNlU2NyZWVuIGJlZm9yZUxldmVsTWVudVNjcmVlbjtcclxuICAgICAgICBwcml2YXRlIEhlbHBTY3JlZW4gaGVscFNjcmVlbjtcclxuICAgICAgICBIZWxwU2NyZWVuSW50ZWdyYXRpb24gaGVscEludCA9IG5ldyBIZWxwU2NyZWVuSW50ZWdyYXRpb24oKTtcclxuICAgICAgICBwcml2YXRlIFJlc3VsdFNjcmVlbiByZXN1bHRTY3JlZW47XHJcbiAgICAgICAgaW50IHN0YWdlSWQ7XHJcblxyXG4gICAgICAgIHByaXZhdGUgTW91c2VIb3ZlclRleHQgbW91c2VIb3ZlcjtcclxuICAgICAgICBwdWJsaWMgU3RhZ2VUb0JhdHRsZSBzdGFnZVRvQmF0dGxlID0gbmV3IFN0YWdlVG9CYXR0bGUoKTtcclxuICAgICAgICBMaXN0PFN0YWdlUHJvZ3Jlc3NQZXJzaXN0ZW5jZT4gc3RhZ2VQcm9ncmVzc1BlcnNpc3RlbmNlID0gbmV3IExpc3Q8U3RhZ2VQcm9ncmVzc1BlcnNpc3RlbmNlPigpO1xyXG4gICAgICAgIHB1YmxpYyBLZXlib2FyZElPIEtleWJvYXJkIHsgc2V0OyBnZXQ7IH1cclxuICAgICAgICBTdGFnZUdyb3VwTmF2aWdhdG9yIHN0YWdlR3JvdXBOYXY7XHJcbiAgICAgICAgaW50IG1vdmVQcmV2aWV3Q291bnRlciA9IC0xO1xyXG4gICAgICAgIExpc3Q8aW50PiBhdXggPSBuZXcgTGlzdDxpbnQ+KCk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBHYW1lTWFpbigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBtb2RlU2VsZWN0aW9uU2NyZWVuID0gbmV3IE1vZGVTZWxlY3Rpb25TY3JlZW4oKTtcclxuICAgICAgICAgICAgc3RhZ2VTZWxlY1NjcmVlbiA9IG5ldyBTdGFnZVNlbGVjdGlvblNjcmVlbigpO1xyXG4gICAgICAgICAgICBhdHRhY2tJbnZlbnRvcnkgPSBuZXcgQXR0YWNrSW52ZW50b3J5KCk7XHJcbiAgICAgICAgICAgIGN1cnJlbmN5SG9sZGVyID0gbmV3IEN1cnJlbmN5SG9sZGVyKCk7XHJcbiAgICAgICAgICAgIGN1cnJlbmN5SG9sZGVyLmN1cnJlbmN5ID0gMjAwO1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gKGludClCYXR0bGVNYWluLk1vdmVUeXBlLkZpcmU7IGkgPD0gKGludClCYXR0bGVNYWluLk1vdmVUeXBlLlRodW5kZXI7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYXR0YWNrSW52ZW50b3J5LmF0dGFja0ludmVudG9yeS5BZGQoaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYXR0YWNrSW52ZW50b3J5LmVxdWlwcGVkQXR0YWNrc1swXSA9IChpbnQpQmF0dGxlTWFpbi5Nb3ZlVHlwZS5GaXJlO1xyXG4gICAgICAgICAgICBhdHRhY2tJbnZlbnRvcnkuZXF1aXBwZWRBdHRhY2tzWzFdID0gKGludClCYXR0bGVNYWluLk1vdmVUeXBlLkljZTtcclxuICAgICAgICAgICAgYXR0YWNrSW52ZW50b3J5LmVxdWlwcGVkQXR0YWNrc1syXSA9IChpbnQpQmF0dGxlTWFpbi5Nb3ZlVHlwZS5UaHVuZGVyO1xyXG4gICAgICAgICAgICAvL2F0dGFja0ludmVudG9yeS5hdHRhY2tJbnZlbnRvcnkuQWRkKChpbnQpQmF0dGxlTWFpbi5Nb3ZlVHlwZS5JY2VCb21iKTtcclxuICAgICAgICAgICAgLy9hdHRhY2tJbnZlbnRvcnkuYXR0YWNrSW52ZW50b3J5LkFkZCgoaW50KUJhdHRsZU1haW4uTW92ZVR5cGUuVGh1bmRlckJvbWIpO1xyXG4gICAgICAgICAgICAvL2F0dGFja0ludmVudG9yeS5lcXVpcHBlZEF0dGFja3NbMF0gPSAoaW50KUJhdHRsZU1haW4uTW92ZVR5cGUuRmlyZTtcclxuICAgICAgICAgICAgLy9hdHRhY2tJbnZlbnRvcnkuZXF1aXBwZWRBdHRhY2tzWzFdID0gKGludClCYXR0bGVNYWluLk1vdmVUeXBlLlRodW5kZXI7XHJcbiAgICAgICAgICAgIC8vYXR0YWNrSW52ZW50b3J5LmVxdWlwcGVkQXR0YWNrc1syXSA9IChpbnQpQmF0dGxlTWFpbi5Nb3ZlVHlwZS5JY2U7XHJcblxyXG4gICAgICAgICAgICBSZXNldCgpO1xyXG4gICAgICAgICAgICBtb2RlU2VsZWN0aW9uU2NyZWVuLm1vZGUgPSAxO1xyXG4gICAgICAgICAgICBtb2RlU2VsZWN0aW9uU2NyZWVuLndhbm5hTGVhdmUgPSAxO1xyXG4gICAgICAgICAgICBtYWluRHJhdyA9IG1vZGVTZWxlY3Rpb25TY3JlZW47XHJcbiAgICAgICAgICAgIGJlZm9yZUxldmVsTWVudVNjcmVlbiA9IG5ldyBHZW5lcmljQ2hvaWNlU2NyZWVuKCk7XHJcbiAgICAgICAgICAgIGJlZm9yZUxldmVsTWVudVNjcmVlbi5jaG9pY2VzLkFkZChcIkJlZ2luIFN0YWdlXCIpO1xyXG4gICAgICAgICAgICBiZWZvcmVMZXZlbE1lbnVTY3JlZW4uY2hvaWNlcy5BZGQoXCJDaGFuZ2UgQXR0YWNrc1wiKTtcclxuICAgICAgICAgICAgYmVmb3JlTGV2ZWxNZW51U2NyZWVuLmNob2ljZXMuQWRkKFwiQWNxdWlyZSBOZXcgQXR0YWNrICAgQ29zdDogMTAwXCIpO1xyXG4gICAgICAgICAgICBiZWZvcmVMZXZlbE1lbnVTY3JlZW4udGl0bGUgPSBcIlN0YWdlIFByZWx1ZGVcIjtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHZvaWQgUmVzZXQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIHdhc0luQmVmb3JlTGV2ZWxNZW51ID0gbWFpbkRyYXcgPT0gYmVmb3JlTGV2ZWxNZW51U2NyZWVuO1xyXG5cclxuICAgICAgICAgICAgc3RyaW5nW10gbW92ZURlc2NyaXB0aW9ucyA9IG5ldyBzdHJpbmdbXSB7XHJcbiAgICAgICAgICAgICAgICBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJNb3ZlIHVwXCIsXHJcbiAgICAgICAgICAgICAgICBcIk1vdmUgbGVmdFwiLFxyXG4gICAgICAgICAgICAgICAgXCJNb3ZlIGRvd25cIixcclxuICAgICAgICAgICAgICAgIFwiTW92ZSByaWdodFwiLFxyXG4gICAgICAgICAgICAgICAgXCJTaG9vdHMgZm9yd2FyZFwiLFxyXG4gICAgICAgICAgICAgICAgXCJTaG9vdHMgZmlyZSBmb3J3YXJkXCIsXHJcbiAgICAgICAgICAgICAgICBcIlNob290cyBpY2UgZm9yd2FyZFwiLFxyXG4gICAgICAgICAgICAgICAgXCJTaG9vdHMgYm9sdCBmb3J3YXJkXCIsXHJcbiAgICAgICAgICAgICAgICBcIlRocm93cyBpY2UgYm9tYiB0aHJlZSBzcXVhcmVzIGZvcndhcmRcIixcclxuICAgICAgICAgICAgICAgIFwiVGhyb3dzIGJvbHQgYm9tYiB0aHJlZSBzcXVhcmVzIGZvcndhcmRcIixcclxuICAgICAgICAgICAgICAgIFwiU3VtbW9ucyBhbm90aGVyIGVuZW15XCIsXHJcbiAgICAgICAgICAgICAgICBcIlNob290LCBkb3duLCBzaG9vdFwiLFxyXG4gICAgICAgICAgICAgICAgXCJTaG9vdHMgaW4gdGhyZWUgbGluZXMgYXJvdW5kIHVzZXJcIixcclxuICAgICAgICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJcIixcclxuICAgICAgICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJcIixcclxuICAgICAgICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJcIixcclxuICAgICAgICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJcIixcclxuICAgICAgICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJcIixcclxuICAgICAgICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJcIixcclxuICAgICAgICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJcIixcclxuICAgICAgICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJcIixcclxuICAgICAgICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJcIixcclxuICAgICAgICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJcIixcclxuICAgICAgICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJcIixcclxuICAgICAgICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICAgICAgICBcIlwiLFxyXG4gICAgICAgICAgICAgICAgXCJcIixcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGludCBtb2RlID0gbW9kZVNlbGVjdGlvblNjcmVlbi5tb2RlO1xyXG4gICAgICAgICAgICBib29sIHRpbWVBdHRhY2sgPSBtb2RlU2VsZWN0aW9uU2NyZWVuLnRpbWVBdHRhY2s7XHJcblxyXG4gICAgICAgICAgICB2YXIgZWNzID0gRUNTTWFuYWdlci5DcmVhdGUoKTtcclxuXHJcblxyXG4gICAgICAgICAgICBTdGFnZURhdGFDcmVhdG9yIHNkYyA9IG5ldyBTdGFnZURhdGFDcmVhdG9yKGVjcyk7XHJcbiAgICAgICAgICAgIC8vc2RjLkNyZWF0ZURlZmF1bHRTdGFnZURhdGEoKTtcclxuXHJcbiAgICAgICAgICAgIG5ldyBTdGFnZURhdGFQcm9jZWR1cmFsX0Eoc2RjKTtcclxuXHJcbiAgICAgICAgICAgIC8vdmFyIHN0YWdlcyA9IGVjcy5RdWlja0FjY2Vzc29yMTxTdGFnZURhdGE+KCk7XHJcbiAgICAgICAgICAgIHZhciBncm91cHMgPSBlY3MuUXVpY2tBY2Nlc3NvcjE8U3RhZ2VEYXRhR3JvdXA+KCk7XHJcbiAgICAgICAgICAgIGlmIChzdGFnZUdyb3VwTmF2ID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHN0YWdlR3JvdXBOYXYgPSBuZXcgU3RhZ2VHcm91cE5hdmlnYXRvcihlY3MpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgZ3JvdXAgPSBzdGFnZUdyb3VwTmF2LmN1cnJlbnRTREc7XHJcblxyXG4gICAgICAgICAgICBzdGFnZVNlbGVjU2NyZWVuLnN0YWdlR3JvdXAgPSBncm91cDtcclxuXHJcbiAgICAgICAgICAgIHN0YWdlSWQgPSBzdGFnZVNlbGVjU2NyZWVuLmNob3NlblN0YWdlO1xyXG4gICAgICAgICAgICBpZiAoc3RhZ2VTZWxlY1NjcmVlbi5jaG9zZW5TdGFnZSA8IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHN0YWdlSWQgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGludCBkID0gc3RhZ2VJZDtcclxuICAgICAgICAgICAgaWYgKGdyb3VwLmNoaWxkSWRzLkNvdW50IDw9IGQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG1haW5EcmF3ID0gbW9kZVNlbGVjdGlvblNjcmVlbjtcclxuICAgICAgICAgICAgICAgIG1vZGVTZWxlY3Rpb25TY3JlZW4uUmVzZXQoKTtcclxuICAgICAgICAgICAgICAgIHN0YWdlSWQgPSAwO1xyXG4gICAgICAgICAgICAgICAgc3RhZ2VHcm91cE5hdi5CYWNrdHJhY2soKTtcclxuICAgICAgICAgICAgICAgIFJlc2V0KCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIExpc3Q8c3RyaW5nPiBlbnRpdHlSZW5kZXJUZXh0cyA9IG5ldyBMaXN0PHN0cmluZz4oKTtcclxuICAgICAgICAgICAgdmFyIG1vdmVDcmVhdG9yID0gbmV3IE1vdmVDcmVhdG9yUHJvZyhlY3MpO1xyXG5cclxuICAgICAgICAgICAgRW5lbXlEYXRhQ3JlYXRvciBlbmVteURhdGEgPSBuZXcgRW5lbXlEYXRhQ3JlYXRvcihlbnRpdHlSZW5kZXJUZXh0cywgbW92ZUNyZWF0b3IpO1xyXG4gICAgICAgICAgICBzZGMuQ2FsY3VsYXRlVHJhY2tJbmZvKGVuZW15RGF0YS5lbmVteURhdGFzKTtcclxuICAgICAgICAgICAgc2RjLkluaXRpYWxpemVQcm9ncmVzcyhzdGFnZVByb2dyZXNzUGVyc2lzdGVuY2UpO1xyXG5cclxuICAgICAgICAgICAgU3RhZ2VEYXRhIHN0YWdlRGF0YSA9IGdyb3VwLmNoaWxkSWRzW3N0YWdlSWRdLkdldENvbXBvbmVudDxTdGFnZURhdGE+KCk7XHJcbiAgICAgICAgICAgIGlmIChzdGFnZVNlbGVjU2NyZWVuLmNob3NlblN0YWdlIDwgMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0YWdlRGF0YSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YWdlU2VsZWNTY3JlZW4uUmVzZXRDaG9pY2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBzdGFnZVNlbGVjU2NyZWVuLmNob3NlblN0YWdlID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlKFwiU1RBR0UgR1JPVVAgREFUQVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGFnZURhdGEgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBzdGFnZVNlbGVjU2NyZWVuLlJlc2V0Q2hvaWNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhZ2VTZWxlY1NjcmVlbi5jaG9zZW5TdGFnZSA9IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgIFN0YWdlRGF0YUdyb3VwIHN0YWdlRGF0YUdyb3VwID0gZ3JvdXAuY2hpbGRJZHNbc3RhZ2VJZF0uR2V0Q29tcG9uZW50PFN0YWdlRGF0YUdyb3VwPigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YWdlU2VsZWNTY3JlZW4uc3RhZ2VHcm91cCA9IHN0YWdlRGF0YUdyb3VwO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YWdlR3JvdXBOYXYuRW50ZXIoc3RhZ2VJZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKHN0YWdlU2VsZWNTY3JlZW4uY2hvc2VuU3RhZ2UgPCAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBtYWluRHJhdyA9IHN0YWdlU2VsZWNTY3JlZW47XHJcbiAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGUoXCJTVEFHRSBTRUxFQyBTQ1JFRU5cIik7XHJcbiAgICAgICAgICAgICAgICBzdGFnZVNlbGVjU2NyZWVuLlJlc2V0Q2hvaWNlKCk7XHJcbiAgICAgICAgICAgICAgICBzdGFnZVNlbGVjU2NyZWVuLlJlc2V0Q3Vyc29yKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL2JhdHRsZSBjb2RlIGluaXRpYWxpemF0aW9uXHJcbiAgICAgICAgICAgIC8vbWlnaHQgcmV0dXJuIGJlZm9yZSBjb21pbmcgaGVyZVxyXG5cclxuICAgICAgICAgICAgdmFyIGJhdHRsZUNvbmZpZyA9IHN0YWdlRGF0YS5iYXR0bGVDb25maWc7XHJcblxyXG4gICAgICAgICAgICBzdGFnZUVudGl0eSA9IGdyb3VwLmNoaWxkSWRzW3N0YWdlSWRdO1xyXG4gICAgICAgICAgICBpZiAoZ3JvdXAuY2hpbGRJZHMuQ291bnQgPiBzdGFnZUlkICsgMSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc3RhZ2VUb0JhdHRsZS5zdGFnZVRvVW5sb2NrID0gZ3JvdXAuY2hpbGRJZHNbc3RhZ2VJZCArIDFdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc3RhZ2VUb0JhdHRsZS5zdGFnZVRvVW5sb2NrID0gRW50aXR5Lk5vbmU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3RhZ2VUb0JhdHRsZS5DdXJyZW50U3RhZ2UgPSBzdGFnZUVudGl0eTtcclxuXHJcbiAgICAgICAgICAgIC8vRmluZCBtb3ZlIGZvciBwcmV2aWV3LCBpZiB0aGVyZSBpcyBvbmVcclxuICAgICAgICAgICAgaW50IG1vdmVQb3NpdGlvbiA9IC0xO1xyXG4gICAgICAgICAgICB2YXIgc3Bhd25zID0gc3RhZ2VEYXRhLnNwYXduRGF0YXM7XHJcbiAgICAgICAgICAgIE1vdmVEYXRhIG1vdmVEYXRhQ2hvc2VuUHJldmlldyA9IG51bGw7XHJcbiAgICAgICAgICAgIGludCBtb3ZlRGF0YUNob3NlblByZXZpZXdJbmRleCA9IC0xO1xyXG4gICAgICAgICAgICBhdXguQ2xlYXIoKTtcclxuICAgICAgICAgICAgaWYgKGZhbHNlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBmb3JlYWNoICh2YXIgcyBpbiBzcGF3bnMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHMuZW50aXR5VHlwZSA9PSAoaW50KUJhdHRsZU1haW4uRW50aXR5VHlwZS5lbmVteSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlbmVteSA9IGVuZW15RGF0YS5lbmVteURhdGFzW3MuaWRdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWkgPSBlbmVteS5lbmVteUFJO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbW92ZXMgPSBhaS5tb3ZlcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yZWFjaCAodmFyIG1vdmUgaW4gbW92ZXMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb3ZlIGlzIE1vdmVVc2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgbW92ZUluZGV4ID0gKChNb3ZlVXNlKW1vdmUpLm1vdmU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1vdmVEYXRhID0gbW92ZUNyZWF0b3IubW92ZURhdGFzW21vdmVJbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFtb3ZlRGF0YS50YWdzLkNvbnRhaW5zKChpbnQpTW92ZURhdGFUYWdzLk1vdmVtZW50KSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYXV4LkNvbnRhaW5zKG1vdmVJbmRleCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1eC5BZGQobW92ZUluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVQb3NpdGlvbisrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1vdmVQb3NpdGlvbiA9PSBtb3ZlUHJldmlld0NvdW50ZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ZVByZXZpZXdDb3VudGVyKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ZURhdGFDaG9zZW5QcmV2aWV3ID0gbW92ZURhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ZURhdGFDaG9zZW5QcmV2aWV3SW5kZXggPSBtb3ZlSW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb3ZlRGF0YUNob3NlblByZXZpZXcgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBCYXR0bGVTZXR1cCBiYXR0bGVTZXR1cCA9IG5ldyBCYXR0bGVTZXR1cChtb2RlLCBlY3MsIGVuZW15RGF0YSwgbW92ZUNyZWF0b3IpO1xyXG4gICAgICAgICAgICBpZiAobW92ZURhdGFDaG9zZW5QcmV2aWV3ID09IG51bGwpXHJcbiAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICBiYXR0bGVTZXR1cC5TdGFnZUluaXRpYWxpemF0aW9uKHN0YWdlRW50aXR5LCBlY3MpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZpeGVkQXR0YWNrID0gc3RhZ2VFbnRpdHkuR2V0Q29tcG9uZW50PEZpeGVkQXR0YWNrU3RhZ2U+KCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZml4ZWRBdHRhY2sgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGF0dGFja0ludmVudG9yeS5lcXVpcHBlZEF0dGFja3MuTGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXR0bGVTZXR1cC5TZXREZWZhdWx0QXR0YWNrKGksIGF0dGFja0ludmVudG9yeS5lcXVpcHBlZEF0dGFja3NbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBiYXR0bGVTZXR1cC5BdHRhY2tQcmV2aWV3SW5pdGlhbGl6YXRpb24obW92ZURhdGFDaG9zZW5QcmV2aWV3LCBlbmVteURhdGEuc3RhcnRPZlR1dG9yaWFsRW5lbXksIG1vdmVEYXRhQ2hvc2VuUHJldmlld0luZGV4KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBiYXR0bGVNYWluID0gYmF0dGxlU2V0dXAuYmF0dGxlTWFpbjtcclxuICAgICAgICAgICAgTGlzdDxNb3ZlTWV0YURhdGE+IG1vdmVSZW5kZXJzID0gbW92ZUNyZWF0b3IubW92ZVJlbmRlcnM7XHJcbiAgICAgICAgICAgIC8vZm9yIChpbnQgaSA9IDA7IGkgPCBtb3ZlUmVuZGVycy5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICAvL3tcclxuICAgICAgICAgICAgLy8gICAgaWYgKG1vdmVEZXNjcmlwdGlvbnMuTGVuZ3RoID4gaSlcclxuICAgICAgICAgICAgLy8gICAgICAgIG1vdmVSZW5kZXJzW2ldLkRlc2NyaXB0aW9uID0gbW92ZURlc2NyaXB0aW9uc1tpXTtcclxuICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgIGVxdWlwU2NyZWVuID0gbmV3IEVxdWlwU2NyZWVuKG1vdmVSZW5kZXJzKTtcclxuICAgICAgICAgICAgZXF1aXBTY3JlZW4uaW52ZW50b3J5ID0gYXR0YWNrSW52ZW50b3J5O1xyXG4gICAgICAgICAgICBIZWxwU2NyZWVuTW9kZWwgaGVscE1vZGVsID0gbmV3IEhlbHBTY3JlZW5Nb2RlbChiYXR0bGVNYWluKTtcclxuICAgICAgICAgICAgaGVscFNjcmVlbiA9IG5ldyBIZWxwU2NyZWVuKGhlbHBNb2RlbCwgbW92ZVJlbmRlcnMsIG1vdmVDcmVhdG9yLm1vdmVEYXRhcyk7XHJcblxyXG4gICAgICAgICAgICB2YXIgcHMgPSBuZXcgUHJldmlld1N5c3RlbShlY3MsIGJhdHRsZU1haW4pO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGZsb2F0IHRpbWVUb0Nob29zZSA9IC0xO1xyXG4gICAgICAgICAgICBpZiAodGltZUF0dGFjaylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGltZVRvQ2hvb3NlID0gMzBmO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBiYXR0bGVNYWluLnRpbWVUb0Nob29zZU1heCA9IHRpbWVUb0Nob29zZTtcclxuICAgICAgICAgICAgYmF0dGxlTWFpbi5Jbml0KCk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIGJhdHRsZVJlbmRlciA9IG5ldyBCYXR0bGVSZW5kZXIoYmF0dGxlTWFpbiwgc3RhZ2VEYXRhOiBzdGFnZURhdGEsIFByZXZpZXdTeXN0ZW06IHBzLCBlbnRpdHlUZXh0czogZW50aXR5UmVuZGVyVGV4dHMsIG1vdmVSZW5kZXJzOiBtb3ZlUmVuZGVycyk7XHJcbiAgICAgICAgICAgIGJhdHRsZVJlbmRlci5oZWxwID0gaGVscEludDtcclxuICAgICAgICAgICAgbmV3IEF0dGFja1ByZXZpZXcoZWNzLCBiYXR0bGVSZW5kZXIpO1xyXG4gICAgICAgICAgICBuZXcgSGFwcEhhbmRsaW5nKGJhdHRsZVJlbmRlciwgYmF0dGxlU2V0dXApO1xyXG4gICAgICAgICAgICAvL1xyXG5cclxuICAgICAgICAgICAgaWYgKGhlbHBTY3JlZW4uSXNXYW5uYVNob3dJbnRybygpKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBoZWxwU2NyZWVuLlNob3coKTtcclxuICAgICAgICAgICAgICAgIG1haW5EcmF3ID0gaGVscFNjcmVlbjtcclxuICAgICAgICAgICAgICAgIGhlbHBNb2RlbC5iYXR0bGVJbnRyb01vZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbWFpbkRyYXcgPSBiYXR0bGVSZW5kZXI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJlc3VsdFNjcmVlbiA9IG5ldyBSZXN1bHRTY3JlZW4oYmF0dGxlTWFpbi50cmFja0JhdHRsZSk7XHJcblxyXG4gICAgICAgICAgICByZXN1bHRTY3JlZW4uYmF0dGxlUmVzdWx0ID0gYmF0dGxlTWFpbi5iYXR0bGVSZXN1bHQ7XHJcbiAgICAgICAgICAgIHJlc3VsdFNjcmVlbi5tb3ZlUmVuZGVycyA9IG1vdmVSZW5kZXJzO1xyXG5cclxuICAgICAgICAgICAgTW91c2VIb3Zlck1hbmFnZXIgaG92ZXJNYW5hZ2VyID0gbmV3IE1vdXNlSG92ZXJNYW5hZ2VyKE1vdXNlKTtcclxuICAgICAgICAgICAgaG92ZXJNYW5hZ2VyLm1vdXNlSG92ZXJzLkFkZChuZXcgTW91c2VIb3ZlcihuZXcgQmFzZVV0aWxzLlJlY3QoNSwgNSwgNSwgNSksIDAsIDApKTtcclxuXHJcblxyXG4gICAgICAgICAgICBtb3VzZUhvdmVyID0gbmV3IE1vdXNlSG92ZXJUZXh0KGhvdmVyTWFuYWdlciwgYmF0dGxlUmVuZGVyLnRleHRXb3JsZC5HZXRGcmVlRW50aXR5KGJhdHRsZVJlbmRlci50ZXh0V29ybGQubWFpbkJvYXJkLldpZHRoIC0gMiwgMyksIG1vdmVEZXNjcmlwdGlvbnMpO1xyXG5cclxuICAgICAgICAgICAgYmF0dGxlUmVuZGVyLm1vdXNlSG92ZXIgPSBob3Zlck1hbmFnZXI7XHJcblxyXG4gICAgICAgICAgICAvL3RoaXMubWFpbkRyYXcgPSBlcXVpcFNjcmVlbjtcclxuICAgICAgICAgICAgYm9vbCBpbnRlcm1pc3Npb25TY3JlZW4gPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAoYmF0dGxlQ29uZmlnICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICBpbnRlcm1pc3Npb25TY3JlZW4gPSBiYXR0bGVDb25maWcuaW50ZXJtaXNzaW9uU2NyZWVuO1xyXG4gICAgICAgICAgICBpZiAoIXdhc0luQmVmb3JlTGV2ZWxNZW51ICYmIGludGVybWlzc2lvblNjcmVlbilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5tYWluRHJhdyA9IGJlZm9yZUxldmVsTWVudVNjcmVlbjtcclxuICAgICAgICAgICAgICAgIGJlZm9yZUxldmVsTWVudVNjcmVlbi5TZXRFeHRyYVRleHQoMiwgXCJGcmFnbWVudHM6IFwiICsgY3VycmVuY3lIb2xkZXIuY3VycmVuY3kpO1xyXG4gICAgICAgICAgICAgICAgYmVmb3JlTGV2ZWxNZW51U2NyZWVuLlNldEVuYWJsZWQoMiwgY3VycmVuY3lIb2xkZXIuY3VycmVuY3kgPj0gMTAwKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgSW5wdXQgeyBzZXQgeyBtYWluRHJhdy5JbnB1dCA9IHZhbHVlOyB9IGdldCB7IHJldHVybiAnYyc7IH0gfVxyXG4gICAgICAgIHB1YmxpYyBpbnQga2V5RG93blVuaWNvZGUgeyBzZXQgeyB2YWx1ZSA9IHJlbWFwLlJlbWFwKHZhbHVlKTsgbWFpbkRyYXcua2V5RG93blVuaWNvZGUgPSB2YWx1ZTsgfSBnZXQgeyByZXR1cm4gJ2MnOyB9IH1cclxuXHJcbiAgICAgICAgcHVibGljIE1vdXNlSU8gTW91c2UgeyBzZXQ7IGdldDsgfVxyXG4gICAgICAgIFVuaWNvZGVSZW1hcCByZW1hcCA9IG5ldyBVbmljb2RlUmVtYXAoKTtcclxuICAgICAgICAvL3ByaXZhdGUgU3RhZ2VHcm91cFNlbGVjdGlvblNjcmVlbiBzdGFnZUdyb3VwU2VsZWN0aW9uO1xyXG4gICAgICAgIHByaXZhdGUgU3RhZ2VTZWxlY3Rpb25TY3JlZW4gc3RhZ2VTZWxlY1NjcmVlbjtcclxuICAgICAgICBwcml2YXRlIEF0dGFja0ludmVudG9yeSBhdHRhY2tJbnZlbnRvcnk7XHJcbiAgICAgICAgcHJpdmF0ZSBDdXJyZW5jeUhvbGRlciBjdXJyZW5jeUhvbGRlcjtcclxuICAgICAgICBwcml2YXRlIEVxdWlwU2NyZWVuIGVxdWlwU2NyZWVuO1xyXG4gICAgICAgIHByaXZhdGUgRW50aXR5IHN0YWdlRW50aXR5O1xyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgaW50IFdpZHRoID0gMzU7XHJcbiAgICAgICAgcHVibGljIHN0YXRpYyByZWFkb25seSBpbnQgSGVpZ2h0ID0gNDY7XHJcblxyXG4gICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBEcmF3SW5wdXQoaW50IHgyLCBpbnQgeTIsIGludCB1bmljb2RlLCBzdHJpbmcgZGVzY3JpcHRpb24sIFRleHRCb2FyZCB0ZXh0Qm9hcmQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBCYXR0bGVSZW5kZXIuRHJhd0lucHV0KHgyLCB5MiwgdW5pY29kZSwgZGVzY3JpcHRpb24sIHRleHRCb2FyZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3KGZsb2F0IGYpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAobW91c2VIb3ZlciAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgbW91c2VIb3Zlci5VcGRhdGUoKTtcclxuICAgICAgICAgICAgbWFpbkRyYXcuRHJhdyhmKTtcclxuICAgICAgICAgICAgbWFpbkRyYXcuTW91c2UgPSBNb3VzZTtcclxuICAgICAgICAgICAgbWFpbkRyYXcuS2V5Ym9hcmQgPSBLZXlib2FyZDtcclxuICAgICAgICAgICAgaWYgKG1haW5EcmF3ID09IHN0YWdlU2VsZWNTY3JlZW4gJiYgc3RhZ2VTZWxlY1NjcmVlbi5jaG9zZW5TdGFnZSA+PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBtb3ZlUHJldmlld0NvdW50ZXIgPSAwO1xyXG4gICAgICAgICAgICAgICAgUmVzZXQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAobWFpbkRyYXcgPT0gYmVmb3JlTGV2ZWxNZW51U2NyZWVuKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYmVmb3JlTGV2ZWxNZW51U2NyZWVuLldhbm5hTGVhdmUoKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBzdGFnZVNlbGVjU2NyZWVuLlJlc2V0Q2hvaWNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFpbkRyYXcgPSBzdGFnZVNlbGVjU2NyZWVuO1xyXG4gICAgICAgICAgICAgICAgICAgIGJlZm9yZUxldmVsTWVudVNjcmVlbi5SZXNldENob2ljZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGJlZm9yZUxldmVsTWVudVNjcmVlbi5jaG9zZW5PcHRpb24gPj0gMClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYmVmb3JlTGV2ZWxNZW51U2NyZWVuLmNob3Nlbk9wdGlvbiA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVzZXQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJlZm9yZUxldmVsTWVudVNjcmVlbi5jaG9zZW5PcHRpb24gPT0gMSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1haW5EcmF3ID0gZXF1aXBTY3JlZW47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChiZWZvcmVMZXZlbE1lbnVTY3JlZW4uY2hvc2VuT3B0aW9uID09IDIpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVuY3lIb2xkZXIuY3VycmVuY3kgPj0gMTAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUhvbGRlci5jdXJyZW5jeSA9IGN1cnJlbmN5SG9sZGVyLmN1cnJlbmN5IC0gMTAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV4LkNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMTQ7IGkgPCAzODsgaSsrKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYXR0YWNrSW52ZW50b3J5LmF0dGFja0ludmVudG9yeS5Db250YWlucyhpKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1eC5BZGQoaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IGF0dGFjayA9IFBpZHJvaC5CYXNlVXRpbHMuRXh0ZW5zaW9ucy5SYW5kb21FbGVtZW50PGludD4oYXV4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFja0ludmVudG9yeS5hdHRhY2tJbnZlbnRvcnkuQWRkKGF0dGFjayk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL25ld0F0dGFja1Jlc3VsdFNjcmVlbk1vZGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbkRyYXcgPSByZXN1bHRTY3JlZW47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRTY3JlZW4uQWRkTW92ZVByaXplKGF0dGFjayk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRTY3JlZW4uU2tpcFRvU2hvd01vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYmVmb3JlTGV2ZWxNZW51U2NyZWVuLlJlc2V0Q2hvaWNlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG1haW5EcmF3ID09IGVxdWlwU2NyZWVuKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXF1aXBTY3JlZW4ud2FudFRvUmV0dXJuKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG1haW5EcmF3ID0gYmVmb3JlTGV2ZWxNZW51U2NyZWVuO1xyXG4gICAgICAgICAgICAgICAgICAgIGVxdWlwU2NyZWVuLlJlc2V0Q2hvaWNlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHN0YWdlU2VsZWNTY3JlZW4ud2FudFRvUmV0dXJuKVxyXG4gICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgc3RhZ2VTZWxlY1NjcmVlbi5SZXNldENob2ljZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vc3RhZ2VHcm91cFNlbGVjdGlvbi5SZXNldENob2ljZSgpO1xyXG4gICAgICAgICAgICAgICAgLy9zdGFnZUdyb3VwU2VsZWN0aW9uLndhbnRlZEdyb3VwID0gLTE7XHJcbiAgICAgICAgICAgICAgICAvL3N0YWdlR3JvdXBTZWxlY3Rpb24ud2FudGVkR3JvdXBFbnRpdHkgPSBFbnRpdHkuTm9uZTtcclxuXHJcbiAgICAgICAgICAgICAgICBzdGFnZVNlbGVjU2NyZWVuLmNob3NlblN0YWdlID0gLTE7XHJcbiAgICAgICAgICAgICAgICBzdGFnZUdyb3VwTmF2LkJhY2t0cmFjaygpO1xyXG5cclxuICAgICAgICAgICAgICAgIFJlc2V0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGhlbHBTY3JlZW4gIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKGhlbHBTY3JlZW4ud2FubmFMZWF2ZSA9PSB0cnVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGhlbHBTY3JlZW4ud2FubmFMZWF2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIG1haW5EcmF3ID0gYmF0dGxlUmVuZGVyO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGhlbHBJbnQuc2hvd1JlcXVlc3QpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGhlbHBTY3JlZW4uU2hvdygpO1xyXG4gICAgICAgICAgICAgICAgaGVscEludC5zaG93UmVxdWVzdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgbWFpbkRyYXcgPSBoZWxwU2NyZWVuO1xyXG4gICAgICAgICAgICAgICAgaGVscFNjcmVlbi5IZWxwTW9kZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChtYWluRHJhdyA9PSBiYXR0bGVSZW5kZXIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChiYXR0bGVNYWluLklzT3ZlcigpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChiYXR0bGVNYWluLkJhdHRsZUNvbmZpZy5hdHRhY2tEZW1vbnN0cmF0aW9uTW9kZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFJlc2V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXR0bGVNYWluLklzVmljdG9yeSgpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFnZUlkKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFnZVRvQmF0dGxlLlZpY3RvcnkoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWdlU2VsZWNTY3JlZW4uUmVzZXRDaG9pY2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWdlVG9CYXR0bGUuQmF0dGxlTWV0cmljc1VwZGF0ZShiYXR0bGVNYWluLnRyYWNrQmF0dGxlLm1ldHJpY3MpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dGFja1ByaXplID0gc3RhZ2VUb0JhdHRsZS5DdXJyZW50U3RhZ2UuR2V0Q29tcG9uZW50PEF0dGFja1ByaXplPigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dGFja1ByaXplICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dGFja1ByaXplLnByaXplcyAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0YWNrSW52ZW50b3J5LmF0dGFja0ludmVudG9yeS5BZGRSYW5nZShhdHRhY2tQcml6ZS5wcml6ZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRTY3JlZW4uQWRkTW92ZVByaXplKGF0dGFja1ByaXplLnByaXplc1swXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW5jeVByaXplID0gc3RhZ2VUb0JhdHRsZS5DdXJyZW50U3RhZ2UuR2V0Q29tcG9uZW50PEN1cnJlbmN5UHJpemU+KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVuY3lQcml6ZSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW5jeVByaXplLmN1cnJlbmN5ICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeUhvbGRlci5jdXJyZW5jeSArPSBjdXJyZW5jeVByaXplLmN1cnJlbmN5WzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRTY3JlZW4uY3VycmVuY3lQcml6ZSA9IGN1cnJlbmN5UHJpemUuY3VycmVuY3lbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFNjcmVlbi5FbnRlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYWluRHJhdyA9IHJlc3VsdFNjcmVlbjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChtYWluRHJhdyA9PSByZXN1bHRTY3JlZW4pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHRTY3JlZW4ud2FubmFMZWF2ZSA9PSAxKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFJlc2V0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG1haW5EcmF3ID09IG1vZGVTZWxlY3Rpb25TY3JlZW4pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChtb2RlU2VsZWN0aW9uU2NyZWVuLndhbm5hTGVhdmUgPT0gMSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBSZXNldCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIFRleHRCb2FyZCBHZXRCb2FyZCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gbWFpbkRyYXcuR2V0Qm9hcmQoKTtcclxuICAgICAgICB9XHJcblxuICAgIFxucHJpdmF0ZSBLZXlib2FyZElPIF9fUHJvcGVydHlfX0luaXRpYWxpemVyX19LZXlib2FyZD1uZXcgS2V5Ym9hcmRJTygpO3ByaXZhdGUgTW91c2VJTyBfX1Byb3BlcnR5X19Jbml0aWFsaXplcl9fTW91c2U9bmV3IE1vdXNlSU8oKTt9XHJcbn1cclxuIiwidXNpbmcgUGlkcm9oLkJhc2VVdGlscztcclxudXNpbmcgUGlkcm9oLlRleHRSZW5kZXJpbmc7XHJcbnVzaW5nIFBpZHJvaC5UZXh0UmVuZGVyaW5nLkdhbWVTY3JlZW47XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWRcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFJlc3VsdFNjcmVlbiA6IElUZXh0U2NyZWVuX1xyXG4gICAge1xyXG4gICAgICAgIHByaXZhdGUgVGV4dFdvcmxkIHRleHRXb3JsZDtcclxuICAgICAgICBzdHJpbmcgeW91V2luID0gXCJZb3UgV2luXCI7XHJcbiAgICAgICAgcHVibGljIE1vdXNlSU8gTW91c2UgeyBzZXQ7IGdldDsgfVxyXG4gICAgICAgIHN0cmluZyB5b3VMb3NlID0gXCJZb3UgbG9zZVwiO1xyXG4gICAgICAgIHB1YmxpYyBCYXR0bGVSZXN1bHQgYmF0dGxlUmVzdWx0O1xyXG4gICAgICAgIHB1YmxpYyBUcmFja0JhdHRsZSB0cmFja0JhdHRsZTtcclxuICAgICAgICBwcml2YXRlIFRleHRFbnRpdHkgcHJpemVFbnRpdHk7XHJcblxyXG4gICAgICAgIHB1YmxpYyBLZXlib2FyZElPIEtleWJvYXJkIHsgc2V0OyBnZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIExpc3Q8aW50PiBtb3ZlUHJpemVzID0gbmV3IExpc3Q8aW50PigpO1xyXG5cclxuICAgICAgICBwdWJsaWMgUmVzdWx0U2NyZWVuKFRyYWNrQmF0dGxlIHRyYWNrQmF0dGxlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGV4dFdvcmxkID0gbmV3IFRleHRXb3JsZCgpO1xyXG4gICAgICAgICAgICB0ZXh0V29ybGQuSW5pdChHYW1lTWFpbi5XaWR0aCwgR2FtZU1haW4uSGVpZ2h0KTtcclxuICAgICAgICAgICAgdGhpcy50cmFja0JhdHRsZSA9IHRyYWNrQmF0dGxlO1xyXG4gICAgICAgICAgICBwcml6ZUVudGl0eSA9IHRleHRXb3JsZC5HZXRGcmVlRW50aXR5KEdhbWVNYWluLldpZHRoLCBHYW1lTWFpbi5IZWlnaHQpO1xyXG4gICAgICAgICAgICBwcml6ZUVudGl0eS5PcmlnaW4uUmVzZXRJbnZpc2libGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBpbnQgd2FubmFMZWF2ZTtcclxuICAgICAgICBwcml2YXRlIGludCBtb2RlO1xyXG4gICAgICAgIGludGVybmFsIExpc3Q8TW92ZU1ldGFEYXRhPiBtb3ZlUmVuZGVycztcclxuXHJcbiAgICAgICAgcHVibGljIGludCBJbnB1dCB7IHNldDsgZ2V0OyB9XHJcbiAgICAgICAgcHVibGljIGludCBrZXlEb3duVW5pY29kZSB7IHNldDsgZ2V0OyB9XHJcbiAgICAgICAgcHVibGljIExpc3Q8TW92ZU1ldGFEYXRhPiBNb3ZlUmVuZGVycyB7IGdldDsgaW50ZXJuYWwgc2V0OyB9XHJcbiAgICAgICAgcHVibGljIGludCBjdXJyZW5jeVByaXplID0gLTE7XHJcblxyXG4gICAgICAgIGludCBtb3ZlSW5kZXggPSAwO1xyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBFbnRlcigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB3YW5uYUxlYXZlID0gMDtcclxuICAgICAgICAgICAgbW9kZSA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3KGZsb2F0IGYpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAoa2V5RG93blVuaWNvZGUgPiAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAobW9kZSA9PSAxKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vdmVJbmRleCsrO1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihtb2RlID09IDIpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3YW5uYUxlYXZlID0gMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYobW9kZSA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RlID0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChtb3ZlUHJpemVzLkNvdW50IDw9IG1vdmVJbmRleClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihjdXJyZW5jeVByaXplID4gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGUgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBEcmF3Q3VycmVuY3lHZXQoY3VycmVuY3lQcml6ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdhbm5hTGVhdmUgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAvL3dhbm5hTGVhdmUgPSAxO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIERyYXdNb3ZlR2V0KG1vdmVQcml6ZXNbbW92ZUluZGV4XSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLlNldEFsbCgnICcsIFRleHRCb2FyZC5OT0NIQU5HRUNPTE9SLCBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5CYWNrZ3JvdW5kSW5wdXQpO1xyXG4gICAgICAgICAgICBzdHJpbmcgbWVzc2FnZSA9IHlvdVdpbjtcclxuICAgICAgICAgICAgaWYgKGJhdHRsZVJlc3VsdC5yZXN1bHQgPT0gMikgbWVzc2FnZSA9IHlvdUxvc2U7XHJcbiAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhd09uQ2VudGVyKG1lc3NhZ2UsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLlRodW5kZXJTaG90KTtcclxuXHJcbiAgICAgICAgICAgIGludCB4ID0gMztcclxuICAgICAgICAgICAgaW50IHkgPSAzO1xyXG4gICAgICAgICAgICBCYXR0bGVSZW5kZXIuRHJhd1N0cmlwcGVkVGV4dCh4LHksIFwiVFVSTlNcIiwgdGV4dFdvcmxkLm1haW5Cb2FyZCk7XHJcbiAgICAgICAgICAgIHZhciBtZXRyaWNzID0gdGhpcy50cmFja0JhdHRsZS5tZXRyaWNzO1xyXG4gICAgICAgICAgICBCYXR0bGVSZW5kZXIuRHJhd1N1YlRleHQoeCsxNCwgeSwgbWV0cmljcy5yb3VuZCtcIlwiLCB0ZXh0V29ybGQubWFpbkJvYXJkKTtcclxuICAgICAgICAgICAgQmF0dGxlUmVuZGVyLkRyYXdTdHJpcHBlZFRleHQoeCwgeSsyLCBcIlRJTUVTIEhJVFwiLCB0ZXh0V29ybGQubWFpbkJvYXJkKTtcclxuICAgICAgICAgICAgQmF0dGxlUmVuZGVyLkRyYXdTdWJUZXh0KHggKyAxNCwgeSsyLCBtZXRyaWNzLmRhbWFnZVRpbWVzICsgXCJcIiwgdGV4dFdvcmxkLm1haW5Cb2FyZCk7XHJcblxyXG4gICAgICAgICAgICBCYXR0bGVSZW5kZXIuRHJhd1N0cmlwcGVkVGV4dCh4LCB5ICsgMTAsIFwiUkFOS1wiLCB0ZXh0V29ybGQubWFpbkJvYXJkKTtcclxuICAgICAgICAgICAgQmF0dGxlUmVuZGVyLkRyYXdTdWJUZXh0KHggKyAxNCwgeSArIDEwLCBtZXRyaWNzLnJhbmsgKyBcIlwiLCB0ZXh0V29ybGQubWFpbkJvYXJkKTtcclxuXHJcbiAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhd0hvcml6b250YWxMaW5lKFVuaWNvZGUuQXNjaWlHcmlkSG9yLCB5ICsgNywgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5Db2xvcnMuSW5wdXREZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhd0hvcml6b250YWxMaW5lKFVuaWNvZGUuQXNjaWlHcmlkSG9yLCB5ICsgMTMsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLklucHV0RGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICB0ZXh0V29ybGQuRHJhd0NoaWxkcmVuKCk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgU2tpcFRvU2hvd01vdmUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbW9kZSA9IDE7XHJcbiAgICAgICAgICAgIERyYXdNb3ZlR2V0KG1vdmVQcml6ZXNbbW92ZUluZGV4XSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVGV4dEJvYXJkIEdldEJvYXJkKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0V29ybGQubWFpbkJvYXJkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhd01vdmVHZXQoaW50IG1vdmUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBwcml6ZUVudGl0eS5PcmlnaW4uU2V0QWxsKCcgJywgVGV4dEJvYXJkLk5PQ0hBTkdFQ09MT1IsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkJhY2tncm91bmRJbnB1dCk7XHJcbiAgICAgICAgICAgIHByaXplRW50aXR5Lk9yaWdpbi5EcmF3T25DZW50ZXJIb3Jpem9udGFsKFwiWW91IHJlY2VpdmVkIGEgbmV3IGF0dGFja1wiLCBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5JbnB1dERlc2NyaXB0aW9uLCB5OiAxOCk7XHJcbiAgICAgICAgICAgIHByaXplRW50aXR5Lk9yaWdpbi5EcmF3T25DZW50ZXJIb3Jpem9udGFsKG1vdmVSZW5kZXJzW21vdmVdLkxhYmVsLCBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5pbnB1dEtleSwgeToyMCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3Q3VycmVuY3lHZXQoaW50IGFtb3VudClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHByaXplRW50aXR5Lk9yaWdpbi5TZXRBbGwoJyAnLCBUZXh0Qm9hcmQuTk9DSEFOR0VDT0xPUiwgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5Db2xvcnMuQmFja2dyb3VuZElucHV0KTtcclxuICAgICAgICAgICAgcHJpemVFbnRpdHkuT3JpZ2luLkRyYXdPbkNlbnRlckhvcml6b250YWwoXCJZb3UgcmVjZWl2ZWQgZGF0YSBmcmFnbWVudHNcIiwgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5Db2xvcnMuSW5wdXREZXNjcmlwdGlvbiwgeTogMTgpO1xyXG4gICAgICAgICAgICBwcml6ZUVudGl0eS5PcmlnaW4uRHJhd09uQ2VudGVySG9yaXpvbnRhbChcIlwiK2Ftb3VudCwgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5Db2xvcnMuaW5wdXRLZXksIHk6IDIwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgQWRkTW92ZVByaXplKGludCB2KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbW92ZVByaXplcy5BZGQodik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFBpZHJvaC5FQ1M7XHJcbnVzaW5nIFBpZHJvaC5UZXh0UmVuZGVyaW5nO1xyXG51c2luZyBQaWRyb2guVGV4dFJlbmRlcmluZy5HYW1lU2NyZWVuO1xyXG51c2luZyBQaWRyb2guVHVybkJhc2VkLlRleHRSZW5kZXJpbmc7XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWRcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFN0YWdlR3JvdXBTZWxlY3Rpb25TY3JlZW4gOiBJVGV4dFNjcmVlbl9cclxuICAgIHtcclxuICAgICAgICBwcml2YXRlIFF1aWNrQWNjZXNzb3JPbmU8U3RhZ2VEYXRhR3JvdXA+IHN0YWdlR3JvdXBzO1xyXG4gICAgICAgIHByaXZhdGUgVGV4dFdvcmxkIHRleHRXb3JsZDtcclxuICAgICAgICBwdWJsaWMgTW91c2VJTyBNb3VzZSB7IHNldDsgZ2V0OyB9XHJcbiAgICAgICAgcHVibGljIEtleWJvYXJkSU8gS2V5Ym9hcmQgeyBzZXQ7IGdldDsgfVxyXG5cclxuICAgICAgICBwdWJsaWMgaW50IHdhbnRlZEdyb3VwID0gLTE7XHJcbiAgICAgICAgcHVibGljIEVudGl0eSB3YW50ZWRHcm91cEVudGl0eSA9IEVudGl0eS5Ob25lO1xyXG5cclxuICAgICAgICBwdWJsaWMgU3RhZ2VHcm91cFNlbGVjdGlvblNjcmVlbigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdGV4dFdvcmxkID0gbmV3IFRleHRXb3JsZCgpO1xyXG4gICAgICAgICAgICB0ZXh0V29ybGQuSW5pdChHYW1lTWFpbi5XaWR0aCwgR2FtZU1haW4uSGVpZ2h0KTtcclxuICAgICAgICAgICAgbmF2S2V5ID0gbmV3IE5hdmlnYXRpb25LZXlib2FyZCh0ZXh0V29ybGQpO1xyXG4gICAgICAgICAgICBuYXZLZXkuc2hvd0VzY2FwZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLlNldEFsbChUZXh0Qm9hcmQuTk9DSEFOR0VDSEFSLCBUZXh0Qm9hcmQuTk9DSEFOR0VDT0xPUiwgQmF0dGxlUmVuZGVyLkNvbG9ycy5CYWNrZ3JvdW5kSW5wdXQpO1xyXG5cclxuICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5EcmF3T25DZW50ZXJIb3Jpem9udGFsKFwiU3RhZ2UgU2VsZWN0aW9uXCIsIEJhdHRsZVJlbmRlci5Db2xvcnMuSGVybywgMCwgMSk7XHJcblxyXG4gICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXdPbkNlbnRlckhvcml6b250YWwoXCJDb250cm9sc1wiLCBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5XaW5kb3dMYWJlbCwgMCwgNik7XHJcbiAgICAgICAgICAgIFxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFNldEVDUyhFQ1NNYW5hZ2VyIGVjcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHN0YWdlR3JvdXBzID0gZWNzLlF1aWNrQWNjZXNzb3IxPFN0YWdlRGF0YUdyb3VwPigpO1xyXG5cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgaW50IHdhbm5hTGVhdmU7XHJcbiAgICAgICAgcHJpdmF0ZSBOYXZpZ2F0aW9uS2V5Ym9hcmQgbmF2S2V5O1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IElucHV0IHsgc2V0OyBnZXQ7IH1cclxuICAgICAgICBwdWJsaWMgaW50IGtleURvd25Vbmljb2RlIHsgc2V0OyBnZXQ7IH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRW50ZXIoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgd2FubmFMZWF2ZSA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgdm9pZCBEcmF3KGZsb2F0IGYpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBuYXZLZXkuQ2xlYXIoKTtcclxuICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5SZXNldCgpO1xyXG4gICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLlNldEFsbCgnICcsIFRleHRCb2FyZC5OT0NIQU5HRUNPTE9SLCBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5CYWNrZ3JvdW5kSW5wdXQpO1xyXG4gICAgICAgICAgICB0ZXh0V29ybGQuRHJhd0NoaWxkcmVuKCk7XHJcbiAgICAgICAgICAgIC8vdGV4dFdvcmxkLm1haW5Cb2FyZC5EcmF3T25DZW50ZXJIb3Jpem9udGFsKFwiQ29udHJvbHNcIiwgQ29sb3JzLldpbmRvd0xhYmVsLCAwLCA2KTtcclxuICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5EcmF3T25DZW50ZXJIb3Jpem9udGFsKFwiU3RhZ2UgU2VsZWN0aW9uXCIsIEJhdHRsZVJlbmRlci5Db2xvcnMuSGVybywgMCwgMSk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN0YWdlR3JvdXBzLkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCB4ID0gNTtcclxuICAgICAgICAgICAgICAgIGludCB5ID0gNSArIGkgKiAyO1xyXG4gICAgICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5EcmF3KFwiV29ybGQgXCIgKyAoaSArIDEpLCB4LCB5LCBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5XaW5kb3dMYWJlbCk7XHJcbiAgICAgICAgICAgICAgICBuYXZLZXkuQWRkKHggLSAyLCB5KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGtleURvd25Vbmljb2RlID49IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG5hdktleS5DaGVja0lucHV0KGtleURvd25Vbmljb2RlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgd2FudGVkR3JvdXAgPSBuYXZLZXkuY2hvc2VuT3B0aW9uO1xyXG4gICAgICAgICAgICBpZih3YW50ZWRHcm91cCA+PTApXHJcbiAgICAgICAgICAgICAgICB3YW50ZWRHcm91cEVudGl0eSA9IHN0YWdlR3JvdXBzLkVudGl0eSh3YW50ZWRHcm91cCk7XHJcbiAgICAgICAgICAgIG5hdktleS5EcmF3Q29udHJvbHMoKTtcclxuXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBSZXNldENob2ljZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB3YW50ZWRHcm91cCA9IC0xO1xyXG4gICAgICAgICAgICBuYXZLZXkuUmVzZXRDaG9pY2UoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBUZXh0Qm9hcmQgR2V0Qm9hcmQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRleHRXb3JsZC5tYWluQm9hcmQ7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLlRleHRSZW5kZXJpbmdcclxue1xyXG4gICAgcHVibGljIGNsYXNzIFRlc3RHYW1lIDogSVRleHRHYW1lXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIFRleHRTY3JlZW5Ib2xkZXIgU2NyZWVuSG9sZGVyIHsgZ2V0OyBwcml2YXRlIHNldDsgfVxyXG4gICAgICAgIHB1YmxpYyBQYWxldHRlIHBhbGV0dGUgPSBEZWZhdWx0UGFsZXR0ZXMuQzROb3ZlbDtcclxuXHJcbiAgICAgICAgcHVibGljIFBhbGV0dGUgR2V0UGFsZXR0ZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gcGFsZXR0ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEluaXQoaW50IHcsIGludCBoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgVGV4dFNjcmVlbk4gc2NyZWVuID0gbmV3IFRlc3RTY3JlZW4oKTtcclxuICAgICAgICAgICAgU2NyZWVuSG9sZGVyLlNldEFsbChzY3JlZW4pO1xyXG4gICAgICAgICAgICBzY3JlZW4uSW5pdCh3LCBoKTtcclxuICAgICAgICAgICAgc2NyZWVuLkdldEJvYXJkKCkuRHJhdyhcIlRlc3RcIiwgMCwwLCAyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIFVwZGF0ZShmbG9hdCBkZWx0YSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXG4gICAgXG5wcml2YXRlIFRleHRTY3JlZW5Ib2xkZXIgX19Qcm9wZXJ0eV9fSW5pdGlhbGl6ZXJfX1NjcmVlbkhvbGRlcj1uZXcgVGV4dFNjcmVlbkhvbGRlcigpO31cclxuXHJcbiAgICBwdWJsaWMgY2xhc3MgVGVzdFNjcmVlbiA6IFRleHRTY3JlZW5OXHJcbiAgICB7XHJcbiAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgVXBkYXRlKGZsb2F0IGYpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkO1xyXG51c2luZyBQaWRyb2guVGV4dFJlbmRlcmluZztcclxudXNpbmcgUGlkcm9oLlRleHRSZW5kZXJpbmcuR2FtZVNjcmVlbjtcclxudXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLlR1cm5CYXNlZC5UZXh0UmVuZGVyaW5nXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBFcXVpcFNjcmVlbiA6IElUZXh0U2NyZWVuX1xyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBBdHRhY2tJbnZlbnRvcnkgaW52ZW50b3J5O1xyXG4gICAgICAgIHByaXZhdGUgVGV4dFdvcmxkIHRleHRXb3JsZDtcclxuICAgICAgICBwcml2YXRlIE5hdmlnYXRpb25LZXlib2FyZCBuYXZLZXlfSW52ZW50b3J5O1xyXG4gICAgICAgIHByaXZhdGUgTmF2aWdhdGlvbktleWJvYXJkIG5hdktleV9FcXVpcDtcclxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IExpc3Q8TW92ZU1ldGFEYXRhPiBtb3ZlTWV0YURhdGFzO1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IElucHV0IHsgc2V0OyBnZXQ7IH1cclxuICAgICAgICBwdWJsaWMgaW50IGtleURvd25Vbmljb2RlIHsgc2V0OyBnZXQ7IH1cclxuICAgICAgICBwdWJsaWMgTW91c2VJTyBNb3VzZSB7IHNldDsgZ2V0OyB9XHJcbiAgICAgICAgcHVibGljIEtleWJvYXJkSU8gS2V5Ym9hcmQgeyBzZXQ7IGdldDsgfVxyXG4gICAgICAgIGludCBtb2RlID0gMDtcclxuICAgICAgICBpbnRlcm5hbCBib29sIHdhbnRUb1JldHVybjtcclxuXHJcbiAgICAgICAgcHVibGljIEVxdWlwU2NyZWVuKExpc3Q8TW92ZU1ldGFEYXRhPiBtb3ZlTWV0YURhdGFzKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGV4dFdvcmxkID0gbmV3IFRleHRXb3JsZCgpO1xyXG4gICAgICAgICAgICB0ZXh0V29ybGQuSW5pdChHYW1lTWFpbi5XaWR0aCwgR2FtZU1haW4uSGVpZ2h0KTtcclxuICAgICAgICAgICAgbmF2S2V5X0ludmVudG9yeSA9IG5ldyBOYXZpZ2F0aW9uS2V5Ym9hcmQodGV4dFdvcmxkKTtcclxuICAgICAgICAgICAgbmF2S2V5X0VxdWlwID0gbmV3IE5hdmlnYXRpb25LZXlib2FyZCh0ZXh0V29ybGQpO1xyXG4gICAgICAgICAgICB0aGlzLm1vdmVNZXRhRGF0YXMgPSBtb3ZlTWV0YURhdGFzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhdyhmbG9hdCBmKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbmF2S2V5X0ludmVudG9yeS5DbGVhcigpO1xyXG4gICAgICAgICAgICBuYXZLZXlfRXF1aXAuQ2xlYXIoKTtcclxuICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5SZXNldCgpO1xyXG4gICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLlNldEFsbCgnICcsIFRleHRCb2FyZC5OT0NIQU5HRUNPTE9SLCBCYXR0bGVSZW5kZXIuQ29sb3JzLkJhY2tncm91bmRJbnB1dCk7XHJcbiAgICAgICAgICAgIHRleHRXb3JsZC5EcmF3Q2hpbGRyZW4oKTtcclxuXHJcbiAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhd09uQ2VudGVySG9yaXpvbnRhbChcIkFUVEFDSyBFUVVJUE1FTlRcIiwgQmF0dGxlUmVuZGVyLkNvbG9ycy5IZXJvLCAwLCAxKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaW52ZW50b3J5LmVxdWlwcGVkQXR0YWNrcy5MZW5ndGg7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW50IHggPSA0O1xyXG4gICAgICAgICAgICAgICAgaW50IHkgPSBpKjIgKyA1O1xyXG4gICAgICAgICAgICAgICAgbmF2S2V5X0VxdWlwLkFkZCh4IC0gMiwgeSk7XHJcbiAgICAgICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXdPbmVEaWdpdChpKzEsIHgsIHksIEJhdHRsZVJlbmRlci5Db2xvcnMuSW5wdXREZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXdDaGFyKCcuJywgeCsxLCB5LCBCYXR0bGVSZW5kZXIuQ29sb3JzLklucHV0RGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGludmVudG9yeS5lcXVpcHBlZEF0dGFja3NbaV0gPj0gMCkgeyBcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5EcmF3KG1vdmVNZXRhRGF0YXNbaW52ZW50b3J5LmVxdWlwcGVkQXR0YWNrc1tpXV0uTGFiZWwsIHgrMywgeSwgQmF0dGxlUmVuZGVyLkNvbG9ycy5JbnB1dERlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXcoXCJfX19fX1wiLCB4KzMsIHksIEJhdHRsZVJlbmRlci5Db2xvcnMuSW5wdXREZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGludCB5T2Zmc2V0ID0gNSArIGludmVudG9yeS5lcXVpcHBlZEF0dGFja3MuTGVuZ3RoICogMiArIDI7XHJcblxyXG4gICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXdIb3Jpem9udGFsTGluZSgnXycseU9mZnNldC0yLCBCYXR0bGVSZW5kZXIuQ29sb3JzLldpbmRvd0xhYmVsKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgaW52ZW50b3J5LmF0dGFja0ludmVudG9yeS5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnQgeCA9IDQ7XHJcbiAgICAgICAgICAgICAgICBpbnQgeSA9IGkgKyB5T2Zmc2V0O1xyXG4gICAgICAgICAgICAgICAgbmF2S2V5X0ludmVudG9yeS5BZGQoeCAtIDIsIHkpO1xyXG4gICAgICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5EcmF3KG1vdmVNZXRhRGF0YXNbaW52ZW50b3J5LmF0dGFja0ludmVudG9yeVtpXV0uTGFiZWwsIHgsIHksIEJhdHRsZVJlbmRlci5Db2xvcnMuSW5wdXREZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGtleURvd25Vbmljb2RlID49IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmKG1vZGUgPT0gMSlcclxuICAgICAgICAgICAgICAgICAgICBuYXZLZXlfSW52ZW50b3J5LkNoZWNrSW5wdXQoa2V5RG93blVuaWNvZGUpO1xyXG4gICAgICAgICAgICAgICAgaWYobW9kZSA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIG5hdktleV9FcXVpcC5DaGVja0lucHV0KGtleURvd25Vbmljb2RlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc3RyaW5nIGF0dGFja0Rlc2NyaXB0aW9uID0gXCJcIjtcclxuICAgICAgICAgICAgaW50IG1vdmUgPSAtMTtcclxuICAgICAgICAgICAgaWYobW9kZSA9PSAxKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnQgY3AgPSBuYXZLZXlfSW52ZW50b3J5LmN1cnJlbnRQb2ludDtcclxuICAgICAgICAgICAgICAgIGlmKGNwID49IDApXHJcbiAgICAgICAgICAgICAgICAgICAgbW92ZSA9IGludmVudG9yeS5hdHRhY2tJbnZlbnRvcnlbY3BdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChtb2RlID09IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCBjcCA9IG5hdktleV9FcXVpcC5jdXJyZW50UG9pbnQ7XHJcbiAgICAgICAgICAgICAgICBpZihjcCA+PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIG1vdmUgPSBpbnZlbnRvcnkuZXF1aXBwZWRBdHRhY2tzW2NwXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZihtb3ZlID49IDApe1xyXG4gICAgICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5EcmF3KG1vdmVNZXRhRGF0YXNbbW92ZV0uRGVzY3JpcHRpb24sIDQsIHlPZmZzZXQgKyAxMywgQmF0dGxlUmVuZGVyLkNvbG9ycy5JbnB1dERlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhdyhcIlBvd2VyOiBcIiwgNCwgeU9mZnNldCArIDE0LCBCYXR0bGVSZW5kZXIuQ29sb3JzLklucHV0RGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5EcmF3VHdvRGlnaXRzKG1vdmVNZXRhRGF0YXNbbW92ZV0uZGFtYWdlLCA0K1wiUG93ZXI6IFwiLkxlbmd0aCwgeU9mZnNldCArIDE0LCBCYXR0bGVSZW5kZXIuQ29sb3JzLklucHV0RGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIG5hdktleV9JbnZlbnRvcnkuRHJhd0NvbnRyb2xzKCk7XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKG5hdktleV9JbnZlbnRvcnkuY2hvc2VuT3B0aW9uID49IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCBhdHRhY2sgPSBpbnZlbnRvcnkuYXR0YWNrSW52ZW50b3J5W25hdktleV9JbnZlbnRvcnkuY2hvc2VuT3B0aW9uXTtcclxuICAgICAgICAgICAgICAgIGludmVudG9yeS5lcXVpcHBlZEF0dGFja3NbbmF2S2V5X0VxdWlwLmNob3Nlbk9wdGlvbl0gPSBhdHRhY2s7XHJcbiAgICAgICAgICAgICAgICBuYXZLZXlfRXF1aXAuUmVzZXRDaG9pY2UoKTtcclxuICAgICAgICAgICAgICAgIG5hdktleV9JbnZlbnRvcnkuUmVzZXRDaG9pY2UoKTtcclxuICAgICAgICAgICAgICAgIG1vZGUgPSAwO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG5hdktleV9FcXVpcC5jaG9zZW5PcHRpb24gPj0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbW9kZSA9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG5hdktleV9JbnZlbnRvcnkud2FudFRvRXNjYXBlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBuYXZLZXlfRXF1aXAuUmVzZXRDaG9pY2UoKTtcclxuICAgICAgICAgICAgICAgIG5hdktleV9JbnZlbnRvcnkuUmVzZXRDaG9pY2UoKTtcclxuICAgICAgICAgICAgICAgIG1vZGUgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG5hdktleV9JbnZlbnRvcnkuU2hvd0N1cnNvcihtb2RlID09IDEpO1xyXG4gICAgICAgICAgICBuYXZLZXlfRXF1aXAuU2hvd0N1cnNvcihtb2RlID09IDApO1xyXG4gICAgICAgICAgICB3YW50VG9SZXR1cm4gPSBuYXZLZXlfRXF1aXAud2FudFRvRXNjYXBlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIFRleHRCb2FyZCBHZXRCb2FyZCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm4gdGV4dFdvcmxkLm1haW5Cb2FyZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgUmVzZXRDaG9pY2UoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbmF2S2V5X0VxdWlwLlJlc2V0Q2hvaWNlKCk7XHJcbiAgICAgICAgICAgIHdhbnRUb1JldHVybiA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQ7XHJcbnVzaW5nIFBpZHJvaC5UZXh0UmVuZGVyaW5nO1xyXG51c2luZyBQaWRyb2guVGV4dFJlbmRlcmluZy5HYW1lU2NyZWVuO1xyXG51c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guVHVybkJhc2VkLlRleHRSZW5kZXJpbmdcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEdlbmVyaWNDaG9pY2VTY3JlZW4gOiBJVGV4dFNjcmVlbl9cclxuICAgIHtcclxuXHJcbiAgICAgICAgcHJpdmF0ZSBUZXh0V29ybGQgdGV4dFdvcmxkO1xyXG4gICAgICAgIHByaXZhdGUgTmF2aWdhdGlvbktleWJvYXJkIG5hdktleTtcclxuXHJcbiAgICAgICAgcHVibGljIGludCBJbnB1dCB7IHNldDsgZ2V0OyB9XHJcbiAgICAgICAgcHVibGljIGludCBrZXlEb3duVW5pY29kZSB7IHNldDsgZ2V0OyB9XHJcbiAgICAgICAgcHVibGljIE1vdXNlSU8gTW91c2UgeyBzZXQ7IGdldDsgfVxyXG4gICAgICAgIHB1YmxpYyBLZXlib2FyZElPIEtleWJvYXJkIHsgc2V0OyBnZXQ7IH1cclxuICAgICAgICBpbnQgbW9kZSA9IDA7XHJcbiAgICAgICAgcHVibGljIGludCBjaG9zZW5PcHRpb24gPSAtMTtcclxuXHJcbiAgICAgICAgcHVibGljIExpc3Q8c3RyaW5nPiBjaG9pY2VzID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PHN0cmluZz4gZXh0cmFUZXh0ID0gbmV3IExpc3Q8c3RyaW5nPigpO1xyXG4gICAgICAgIHB1YmxpYyBMaXN0PGJvb2w+IGVuYWJsZWQgPSBuZXcgTGlzdDxib29sPigpO1xyXG4gICAgICAgIHB1YmxpYyBzdHJpbmcgdGl0bGU7XHJcblxyXG4gICAgICAgIHB1YmxpYyBHZW5lcmljQ2hvaWNlU2NyZWVuKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRleHRXb3JsZCA9IG5ldyBUZXh0V29ybGQoKTtcclxuICAgICAgICAgICAgdGV4dFdvcmxkLkluaXQoR2FtZU1haW4uV2lkdGgsIEdhbWVNYWluLkhlaWdodCk7XHJcbiAgICAgICAgICAgIG5hdktleSA9IG5ldyBOYXZpZ2F0aW9uS2V5Ym9hcmQodGV4dFdvcmxkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIERyYXcoZmxvYXQgZilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG5hdktleS5DbGVhcigpO1xyXG4gICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLlJlc2V0KCk7XHJcbiAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuU2V0QWxsKCcgJywgVGV4dEJvYXJkLk5PQ0hBTkdFQ09MT1IsIEJhdHRsZVJlbmRlci5Db2xvcnMuQmFja2dyb3VuZElucHV0KTtcclxuICAgICAgICAgICAgdGV4dFdvcmxkLkRyYXdDaGlsZHJlbigpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRpdGxlICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXdPbkNlbnRlckhvcml6b250YWwodGl0bGUsIEJhdHRsZVJlbmRlci5Db2xvcnMuSGVybywgMCwgMSk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNob2ljZXMuQ291bnQ7IGkrKylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaW50IHkgPSBpICogMiArIDU7XHJcbiAgICAgICAgICAgICAgICBpbnQgeCA9IDQ7XHJcbiAgICAgICAgICAgICAgICBpbnQgY29sb3IgPSBCYXR0bGVSZW5kZXIuQ29sb3JzLklucHV0RGVzY3JpcHRpb247XHJcbiAgICAgICAgICAgICAgICBpZiAoZW5hYmxlZC5Db3VudCA+IGkpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoIWVuYWJsZWRbaV0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gQmF0dGxlUmVuZGVyLkNvbG9ycy5XaW5kb3dMYWJlbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhdyhjaG9pY2VzW2ldLCB4LCB5LCBjb2xvcik7XHJcbiAgICAgICAgICAgICAgICBuYXZLZXkuQWRkKHggLSAyLCB5KTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZXh0cmFUZXh0LkNvdW50OyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGludCB5ID0gaSAqIDIgKyA1ICsgMTtcclxuICAgICAgICAgICAgICAgIGludCB4ID0gMTI7XHJcbiAgICAgICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXcoZXh0cmFUZXh0W2ldLCB4LCB5LCBCYXR0bGVSZW5kZXIuQ29sb3JzLldpbmRvd0xhYmVsKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGtleURvd25Vbmljb2RlID49IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG5hdktleS5DaGVja0lucHV0KGtleURvd25Vbmljb2RlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIG5hdktleS5EcmF3Q29udHJvbHMoKTtcclxuXHJcbiAgICAgICAgICAgIGNob3Nlbk9wdGlvbiA9IG5hdktleS5jaG9zZW5PcHRpb247XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVGV4dEJvYXJkIEdldEJvYXJkKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0V29ybGQubWFpbkJvYXJkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBSZXNldENob2ljZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBuYXZLZXkuUmVzZXRDaG9pY2UoKTtcclxuICAgICAgICAgICAgY2hvc2VuT3B0aW9uID0gLTE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCBib29sIFdhbm5hTGVhdmUoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5hdktleS53YW50VG9Fc2NhcGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIFNldEV4dHJhVGV4dChpbnQgaWQsIHN0cmluZyB0ZXh0KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgd2hpbGUgKHRoaXMuZXh0cmFUZXh0LkNvdW50IDw9IGlkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmV4dHJhVGV4dC5BZGQoU3RyaW5nLkVtcHR5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBleHRyYVRleHRbaWRdID0gdGV4dDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGludGVybmFsIHZvaWQgU2V0RW5hYmxlZChpbnQgaWQsIGJvb2wgZW5hYmxlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgd2hpbGUgKHRoaXMuZW5hYmxlZC5Db3VudCA8PSBpZClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbmFibGVkLkFkZCh0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbmFibGVkW2lkXSA9IGVuYWJsZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG59XHJcbiIsInVzaW5nIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZDtcclxudXNpbmcgUGlkcm9oLlRleHRSZW5kZXJpbmc7XHJcbnVzaW5nIFBpZHJvaC5UZXh0UmVuZGVyaW5nLkdhbWVTY3JlZW47XHJcbnVzaW5nIFN5c3RlbTtcclxudXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7XHJcbnVzaW5nIFN5c3RlbS5MaW5xO1xyXG51c2luZyBTeXN0ZW0uVGV4dDtcclxuXHJcbm5hbWVzcGFjZSBQaWRyb2guVHVybkJhc2VkLlRleHRSZW5kZXJpbmdcclxue1xyXG4gICAgcHVibGljIGNsYXNzIE1vZGVTZWxlY3Rpb25TY3JlZW4gOiBJVGV4dFNjcmVlbl9cclxuICAgIHtcclxuICAgICAgICBwcml2YXRlIFRleHRXb3JsZCB0ZXh0V29ybGQ7XHJcbiAgICAgICAgcHVibGljIE1vdXNlSU8gTW91c2UgeyBzZXQ7IGdldDsgfVxyXG4gICAgICAgIGludCBzZWxlY3Rpb247XHJcbiAgICAgICAgcHVibGljIEJhdHRsZVJlc3VsdCBiYXR0bGVSZXN1bHQ7XHJcbiAgICAgICAgcHVibGljIEtleWJvYXJkSU8gS2V5Ym9hcmQgeyBzZXQ7IGdldDsgfVxyXG4gICAgICAgIHB1YmxpYyBNb2RlU2VsZWN0aW9uU2NyZWVuKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRleHRXb3JsZCA9IG5ldyBUZXh0V29ybGQoKTtcclxuICAgICAgICAgICAgdGV4dFdvcmxkLkluaXQoNzAsIDI1KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHVibGljIGludCB3YW5uYUxlYXZlO1xyXG4gICAgICAgIHB1YmxpYyBpbnQgbW9kZTtcclxuICAgICAgICBwdWJsaWMgYm9vbCB0aW1lQXR0YWNrID0gZmFsc2U7XHJcbiAgICAgICAgcHVibGljIGludCBzY3JlZW5TdGFnZTtcclxuXHJcbiAgICAgICAgcHVibGljIGludCBJbnB1dCB7IHNldDsgZ2V0OyB9XHJcbiAgICAgICAgcHVibGljIGludCBrZXlEb3duVW5pY29kZSB7IHNldDsgZ2V0OyB9XHJcblxyXG4gICAgICAgIHB1YmxpYyB2b2lkIEVudGVyKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHdhbm5hTGVhdmUgPSAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhdyhmbG9hdCBmKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5SZXNldCgpO1xyXG4gICAgICAgICAgICBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLklucHV0S2V5IGlrID0gKFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuSW5wdXRLZXkpIElucHV0O1xyXG4gICAgICAgICAgICBtb2RlID0gLTE7XHJcbiAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhdyhcIlByb2dCYXR0bGUgUHJvdG90eXBlIHYwLjNcIiwgMSwgMSwgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5Db2xvcnMuR3JpZEhlcm8pO1xyXG4gICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXcoXCJBIGdhbWUgYnkgUGlkcm9oXCIsIDEsIDIsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkdyaWRIZXJvKTtcclxuICAgICAgICAgICAgaWYgKHNjcmVlblN0YWdlID09IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoaWspXHJcbiAgICAgICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5JbnB1dEtleS5MRUZUOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5TdGFnZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVBdHRhY2sgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLklucHV0S2V5LlJJR0hUOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JlZW5TdGFnZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVBdHRhY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuSW5wdXRLZXkuRE9XTjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZUF0dGFjayA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGUgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuSW5wdXRLZXkuVVA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGUgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lQXR0YWNrID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5EcmF3T25DZW50ZXIoXCJbd10gVmFuaWxsYVwiLCBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5HcmlkSGVybywgeU9mZjogNCwgYWxpZ25TdHJpbmc6IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhd09uQ2VudGVyKFwiW2FdIEVsZW1lbnRhbFwiLCBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5HcmlkSGVybywgeU9mZjogNSwgYWxpZ25TdHJpbmc6IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhd09uQ2VudGVyKFwiW3NdIFZhbmlsbGEgVGltZSBBdHRhY2tcIiwgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5Db2xvcnMuR3JpZEhlcm8sIHlPZmY6IDYsIGFsaWduU3RyaW5nOiBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXdPbkNlbnRlcihcIltkXSBFbGVtZW50YWwgVGltZSBBdHRhY2tcIiwgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5Db2xvcnMuR3JpZEhlcm8sIHlPZmY6IDcsIGFsaWduU3RyaW5nOiBmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHNjcmVlblN0YWdlID09IDEpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChpayA9PSBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLklucHV0S2V5LlVQKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZGUgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGlrID09IFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuSW5wdXRLZXkuRE9XTilcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBzY3JlZW5TdGFnZSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXdPbkNlbnRlcihcIkVsZW1lbnRhbCBNb2RlXCIsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkdyaWRIZXJvLCB5T2ZmOiAtNSk7XHJcbiAgICAgICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXdPbkNlbnRlcihcIkZpcmUgYmVhdHMgSWNlLCBJY2UgYmVhdHMgVGh1bmRlciwgVGh1bmRlciBiZWF0cyBmaXJlXCIsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkdyaWRIZXJvLCB5T2ZmOiAtMik7XHJcbiAgICAgICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXdPbkNlbnRlcihcIlNhbWUgZWxlbWVudCA9IG5vIGRhbWFnZVwiLCBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5HcmlkSGVybywgeU9mZjogMCk7XHJcbiAgICAgICAgICAgICAgICB0ZXh0V29ybGQubWFpbkJvYXJkLkRyYXdPbkNlbnRlcihcIkl0IGlzIGJlc3QgdG8gaGF2ZSBoYWQgc29tZSBleHBlcmllbmNlIHdpdGggdmFuaWxsYSBtb2RlXCIsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkdyaWRIZXJvLCB5T2ZmOiAxKTtcclxuICAgICAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhd09uQ2VudGVyKFwiW3ddIFN0YXJ0IEVsZW1lbnRhbCBNb2RlXCIsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLkdyaWRIZXJvLCB5T2ZmOiA0LCBhbGlnblN0cmluZzogZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5EcmF3T25DZW50ZXIoXCJbc10gR28gYmFja1wiLCBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5HcmlkSGVybywgeU9mZjogNSwgYWxpZ25TdHJpbmc6IGZhbHNlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGlmIChtb2RlID49IDApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHdhbm5hTGVhdmUgPSAxO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAvL3N0cmluZyBtZXNzYWdlID0geW91V2luO1xyXG4gICAgICAgICAgICAvL2lmIChiYXR0bGVSZXN1bHQucmVzdWx0ID09IDIpIG1lc3NhZ2UgPSB5b3VMb3NlO1xyXG4gICAgICAgICAgICAvL3RleHRXb3JsZC5tYWluQm9hcmQuRHJhd09uQ2VudGVyKG1lc3NhZ2UsIENvbG9ycy5Cb2FyZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIFJlc2V0KClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG1vZGUgPSAtMTtcclxuICAgICAgICAgICAgd2FubmFMZWF2ZSA9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVGV4dEJvYXJkIEdldEJvYXJkKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0V29ybGQubWFpbkJvYXJkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbn1cclxuIiwidXNpbmcgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkO1xyXG51c2luZyBQaWRyb2guRUNTO1xyXG51c2luZyBQaWRyb2guVGV4dFJlbmRlcmluZztcclxudXNpbmcgUGlkcm9oLlRleHRSZW5kZXJpbmcuR2FtZVNjcmVlbjtcclxudXNpbmcgU3lzdGVtO1xyXG51c2luZyBTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYztcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLlR1cm5CYXNlZC5UZXh0UmVuZGVyaW5nXHJcbntcclxuICAgIHB1YmxpYyBjbGFzcyBTdGFnZVNlbGVjdGlvblNjcmVlbiA6IElUZXh0U2NyZWVuX1xyXG4gICAge1xyXG4gICAgICAgIHB1YmxpYyBTdGFnZURhdGFHcm91cCBzdGFnZUdyb3VwO1xyXG5cclxuICAgICAgICBwdWJsaWMgaW50IElucHV0IHsgc2V0OyBnZXQ7IH1cclxuICAgICAgICBwdWJsaWMgaW50IGtleURvd25Vbmljb2RlIHsgc2V0OyBnZXQ7IH1cclxuICAgICAgICBwdWJsaWMgTW91c2VJTyBNb3VzZSB7IHNldDsgZ2V0OyB9XHJcbiAgICAgICAgcHVibGljIEtleWJvYXJkSU8gS2V5Ym9hcmQgeyBzZXQ7IGdldDsgfVxyXG4gICAgICAgIFRleHRXb3JsZCB0ZXh0V29ybGQ7XHJcbiAgICAgICAgcHJpdmF0ZSBOYXZpZ2F0aW9uS2V5Ym9hcmQgbmF2S2V5O1xyXG4gICAgICAgIHB1YmxpYyBpbnQgY2hvc2VuU3RhZ2UgPSAtMTtcclxuICAgICAgICBwdWJsaWMgYm9vbCB3YW50VG9SZXR1cm47XHJcbiAgICAgICAgcHVibGljIHN0cmluZ1tdIGdyb3VwTGFiZWxzID0geyBcIlNlY3RvciBcIiwgXCJXb3JsZCBcIiB9O1xyXG5cclxuICAgICAgICBwdWJsaWMgU3RhZ2VTZWxlY3Rpb25TY3JlZW4oKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdGV4dFdvcmxkID0gbmV3IFRleHRXb3JsZCgpO1xyXG4gICAgICAgICAgICB0ZXh0V29ybGQuSW5pdChHYW1lTWFpbi5XaWR0aCwgR2FtZU1haW4uSGVpZ2h0KTtcclxuICAgICAgICAgICAgbmF2S2V5ID0gbmV3IE5hdmlnYXRpb25LZXlib2FyZCh0ZXh0V29ybGQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHVibGljIHZvaWQgRHJhdyhmbG9hdCBmKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbmF2S2V5LkNsZWFyKCk7XHJcbiAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuUmVzZXQoKTtcclxuICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5TZXRBbGwoJyAnLCBUZXh0Qm9hcmQuTk9DSEFOR0VDT0xPUiwgUGlkcm9oLkNvbnNvbGVBcHAuVHVybmJhc2VkLkJhdHRsZVJlbmRlci5Db2xvcnMuQmFja2dyb3VuZElucHV0KTtcclxuICAgICAgICAgICAgdGV4dFdvcmxkLkRyYXdDaGlsZHJlbigpO1xyXG4gICAgICAgICAgICAvL3RleHRXb3JsZC5tYWluQm9hcmQuRHJhd09uQ2VudGVySG9yaXpvbnRhbChcIkNvbnRyb2xzXCIsIENvbG9ycy5XaW5kb3dMYWJlbCwgMCwgNik7XHJcbiAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhd09uQ2VudGVySG9yaXpvbnRhbChcIlN0YWdlIFNlbGVjdGlvblwiLCBCYXR0bGVSZW5kZXIuQ29sb3JzLkhlcm8sIDAsIDEpO1xyXG5cclxuICAgICAgICAgICAgaW50IHN0YWdlTiA9IDE7XHJcbiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgc3RhZ2VHcm91cC5jaGlsZElkcy5Db3VudDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnQgeCA9IDU7XHJcbiAgICAgICAgICAgICAgICBpbnQgeSA9IDUgKyBpICogMztcclxuICAgICAgICAgICAgICAgIEVudGl0eSBlID0gc3RhZ2VHcm91cC5jaGlsZElkc1tpXTtcclxuICAgICAgICAgICAgICAgIFN0YWdlUHJvZ3Jlc3NQZXJzaXN0ZW5jZSBzdGFnZVByb2dyZXNzUGVyc2lzdGVuY2UgPSBlLkdldENvbXBvbmVudDxTdGFnZVByb2dyZXNzUGVyc2lzdGVuY2U+KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZ3JvdXAgPSBlLkdldENvbXBvbmVudDxTdGFnZURhdGFHcm91cD4oKTtcclxuICAgICAgICAgICAgICAgIHN0cmluZyBzdGFnZUxhYmVsUHJlZml4ID0gXCJTdGFnZSBcIjtcclxuICAgICAgICAgICAgICAgIHZhciB0YWdzID0gZS5HZXRDb21wb25lbnQ8VGFnQ29tcG9uZW50PigpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGdyb3VwICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhZ2VMYWJlbFByZWZpeCA9IGdyb3VwTGFiZWxzW2dyb3VwLmxldmVsXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHN0cmluZyBmaW5hbExhYmVsID0gXCJcIjtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGFncyAhPSBudWxsICYmIHRhZ3MuQ29udGFpbnMoXCJ0dXRvcmlhbFwiKSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBmaW5hbExhYmVsID0gXCJUdXRvcmlhbFwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbmFsTGFiZWwgPSBzdGFnZUxhYmVsUHJlZml4ICsgc3RhZ2VOO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YWdlTisrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHN0YWdlUHJvZ3Jlc3NQZXJzaXN0ZW5jZSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGFnZVByb2dyZXNzUGVyc2lzdGVuY2UuYXZhaWxhYmxlKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5EcmF3KGZpbmFsTGFiZWwsIHgsIHksIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLmlucHV0S2V5KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludCByYW5rID0gc3RhZ2VQcm9ncmVzc1BlcnNpc3RlbmNlLmJlc3RCYXR0bGVNZXRyaWNzLnJhbms7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYW5rID49IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhdyhcIkJlc3QgUmFuazogXCIgKyByYW5rLCB4ICsgMiwgeSArIDEsIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLldpbmRvd0xhYmVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRXb3JsZC5tYWluQm9hcmQuRHJhdyhcIj8/P1wiLCB4LCB5LCBQaWRyb2guQ29uc29sZUFwcC5UdXJuYmFzZWQuQmF0dGxlUmVuZGVyLkNvbG9ycy5XaW5kb3dMYWJlbCk7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dFdvcmxkLm1haW5Cb2FyZC5EcmF3KGZpbmFsTGFiZWwsIHgsIHksIFBpZHJvaC5Db25zb2xlQXBwLlR1cm5iYXNlZC5CYXR0bGVSZW5kZXIuQ29sb3JzLmlucHV0S2V5KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBuYXZLZXkuQWRkKHggLSAyLCB5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoa2V5RG93blVuaWNvZGUgPj0gMClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbmF2S2V5LkNoZWNrSW5wdXQoa2V5RG93blVuaWNvZGUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjaG9zZW5TdGFnZSA9IG5hdktleS5jaG9zZW5PcHRpb247XHJcbiAgICAgICAgICAgIGlmIChjaG9zZW5TdGFnZSA+PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBTdGFnZVByb2dyZXNzUGVyc2lzdGVuY2Ugc3RhZ2VQcm9ncmVzc1BlcnNpc3RlbmNlMSA9IHN0YWdlR3JvdXAuY2hpbGRJZHNbY2hvc2VuU3RhZ2VdLkdldENvbXBvbmVudDxTdGFnZVByb2dyZXNzUGVyc2lzdGVuY2U+KCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RhZ2VQcm9ncmVzc1BlcnNpc3RlbmNlMSAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghc3RhZ2VQcm9ncmVzc1BlcnNpc3RlbmNlMS5hdmFpbGFibGUpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaG9zZW5TdGFnZSA9IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYXZLZXkuY2hvc2VuT3B0aW9uID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBuYXZLZXkuRHJhd0NvbnRyb2xzKCk7XHJcbiAgICAgICAgICAgIHdhbnRUb1JldHVybiA9IG5hdktleS53YW50VG9Fc2NhcGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwdWJsaWMgVGV4dEJvYXJkIEdldEJvYXJkKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiB0ZXh0V29ybGQubWFpbkJvYXJkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaW50ZXJuYWwgdm9pZCBSZXNldENob2ljZSgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjaG9zZW5TdGFnZSA9IC0xO1xyXG4gICAgICAgICAgICBuYXZLZXkuUmVzZXRDaG9pY2UoKTtcclxuICAgICAgICAgICAgd2FudFRvUmV0dXJuID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnRlcm5hbCB2b2lkIFJlc2V0Q3Vyc29yKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIG5hdktleS5SZXNldEN1cnNvcigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iLCJ1c2luZyBTeXN0ZW07XHJcbnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljO1xyXG51c2luZyBTeXN0ZW0uTGlucTtcclxudXNpbmcgU3lzdGVtLlRleHQ7XHJcblxyXG5uYW1lc3BhY2UgUGlkcm9oLlRleHRSZW5kZXJpbmdcclxue1xyXG4gICAgcHVibGljIGNsYXNzIEJsaW5rQW5pbSA6IFRleHRBbmltYXRpb248QmxpbmtBbmltLkJsaW5rRGF0YT5cclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBNb2RpZnkoVGV4dEVudGl0eSBlbnRpdHksIEJsaW5rRGF0YSBtYWluRGF0YSwgZmxvYXQgcHJvZ3Jlc3MsIGZsb2F0IGxlbmd0aClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGJhc2UuTW9kaWZ5KGVudGl0eSwgbWFpbkRhdGEsIHByb2dyZXNzLCBsZW5ndGgpO1xyXG4gICAgICAgICAgICBmbG9hdCBhdXggPSBwcm9ncmVzcztcclxuICAgICAgICAgICAgYm9vbCBibGluayA9IHRydWU7XHJcbiAgICAgICAgICAgIHdoaWxlICh0cnVlKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYmxpbmspXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXV4IC09IG1haW5EYXRhLmJsaW5rQWN0aXZlVGltZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBhdXggLT0gbWFpbkRhdGEuYmxpbmtJbmFjdGl2ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChhdXggPCAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGJsaW5rID0gIWJsaW5rO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghYmxpbmspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChtYWluRGF0YS5jaGFuZ2VJbnZpc2libGUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW50aXR5LkFuaW1hdGlvbi5TZXRBbGwobWFpbkRhdGEudGV4dCwgbWFpbkRhdGEudGV4dENvbG9yLCBtYWluRGF0YS5iYWNrQ29sb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW50aXR5LkFuaW1hdGlvbi5TZXRBbGxJZlZpc2libGUobWFpbkRhdGEudGV4dCwgbWFpbkRhdGEudGV4dENvbG9yLCBtYWluRGF0YS5iYWNrQ29sb3IpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgc3RydWN0IEJsaW5rRGF0YVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcHVibGljIHJlYWRvbmx5IGNoYXIgdGV4dDtcclxuICAgICAgICAgICAgcHVibGljIHJlYWRvbmx5IGludCBiYWNrQ29sb3IsIHRleHRDb2xvcjtcclxuICAgICAgICAgICAgcHVibGljIHJlYWRvbmx5IGZsb2F0IGJsaW5rQWN0aXZlVGltZTtcclxuICAgICAgICAgICAgcHVibGljIHJlYWRvbmx5IGZsb2F0IGJsaW5rSW5hY3RpdmU7XHJcbiAgICAgICAgICAgIHB1YmxpYyByZWFkb25seSBib29sIGNoYW5nZUludmlzaWJsZTtcclxuXHJcbiAgICAgICAgICAgIHB1YmxpYyBCbGlua0RhdGEoY2hhciB0ZXh0LCBpbnQgYmFja0NvbG9yLCBpbnQgdGV4dENvbG9yLCBmbG9hdCBibGlua0FjdGl2ZVRpbWUsIGZsb2F0IGJsaW5rSW5hY3RpdmUsIGJvb2wgY2hhbmdlTm9DaGFuZ2VDb2xvciA9IHRydWUpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGV4dCA9IHRleHQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJhY2tDb2xvciA9IGJhY2tDb2xvcjtcclxuICAgICAgICAgICAgICAgIHRoaXMudGV4dENvbG9yID0gdGV4dENvbG9yO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ibGlua0FjdGl2ZVRpbWUgPSBibGlua0FjdGl2ZVRpbWU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJsaW5rSW5hY3RpdmUgPSBibGlua0luYWN0aXZlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VJbnZpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBwdWJsaWMgc3RhdGljIEJsaW5rRGF0YSBCYWNrQ29sb3IoaW50IGJhY2tDb2xvciwgZmxvYXQgYmxpbmtEdXJhdGlvbiwgYm9vbCBjaGFuZ2VOb0NoYW5nZUNvbG9yID0gdHJ1ZSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCbGlua0RhdGEoVGV4dEJvYXJkLk5PQ0hBTkdFQ0hBUiwgYmFja0NvbG9yLCBUZXh0Qm9hcmQuTk9DSEFOR0VDT0xPUiwgYmxpbmtEdXJhdGlvbiwgYmxpbmtEdXJhdGlvbiwgY2hhbmdlTm9DaGFuZ2VDb2xvcik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgQmxpbmtEYXRhIEZyb250Q29sb3IoaW50IGZyb250Q29sb3IsIGZsb2F0IGJsaW5rRHVyYXRpb24pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQmxpbmtEYXRhKFRleHRCb2FyZC5OT0NIQU5HRUNIQVIsIFRleHRCb2FyZC5OT0NIQU5HRUNPTE9SLCBmcm9udENvbG9yLCAgYmxpbmtEdXJhdGlvbiwgYmxpbmtEdXJhdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgQmxpbmtEYXRhIENoYXIoY2hhciBjLCBmbG9hdCBibGlua0R1cmF0aW9uKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJsaW5rRGF0YShjLCBUZXh0Qm9hcmQuTk9DSEFOR0VDT0xPUiwgVGV4dEJvYXJkLk5PQ0hBTkdFQ09MT1IsIGJsaW5rRHVyYXRpb24sIGJsaW5rRHVyYXRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsIm5hbWVzcGFjZSBQaWRyb2guVGV4dFJlbmRlcmluZ1xyXG57XHJcbiAgICBwdWJsaWMgY2xhc3MgQ2hhckJ5Q2hhckFuaW1hdGlvbiA6IFRleHRBbmltYXRpb248Q2hhckJ5Q2hhckFuaW1hdGlvbi5DaGFyQnlDaGFyRGF0YT5cclxuICAgIHtcclxuICAgICAgICBwdWJsaWMgb3ZlcnJpZGUgdm9pZCBNb2RpZnkoVGV4dEVudGl0eSBlbnRpdHksIENoYXJCeUNoYXJEYXRhIG1haW5EYXRhLCBmbG9hdCBwcm9ncmVzcywgZmxvYXQgbGVuZ3RoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYmFzZS5Nb2RpZnkoZW50aXR5LCBtYWluRGF0YSwgcHJvZ3Jlc3MsIGxlbmd0aCk7XHJcbiAgICAgICAgICAgIGZsb2F0IHJhdGlvID0gcHJvZ3Jlc3MgLyBsZW5ndGg7XHJcbiAgICAgICAgICAgIGZsb2F0IGxlbmd0aFRleHQgPSBtYWluRGF0YS5jaGFyRW5kIC0gbWFpbkRhdGEuY2hhclN0YXJ0O1xyXG4gICAgICAgICAgICBpbnQgbGluZUJyZWFrcyA9IDA7XHJcbiAgICAgICAgICAgIGludCBvZmZzZXRlZFBlcm0gPSAwO1xyXG4gICAgICAgICAgICBmb3IgKGludCBpID0gbWFpbkRhdGEuY2hhclN0YXJ0OyBpIDwgbWFpbkRhdGEuY2hhckVuZDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpbnQgb2Zmc2V0ZWQgPSBpICsgb2Zmc2V0ZWRQZXJtO1xyXG4gICAgICAgICAgICAgICAgaW50IGxpbmUgPSAwO1xyXG4gICAgICAgICAgICAgICAgdmFyIHRiID0gZW50aXR5LkFuaW1hdGlvbjtcclxuICAgICAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgICAgIHdoaWxlIChvZmZzZXRlZCA+PSB0Yi5XaWR0aClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBsaW5lKys7XHJcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ZWQgLT0gdGIuV2lkdGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZW50aXR5Lk9yaWdpbi5DaGFyQXQob2Zmc2V0ZWQsIGxpbmUgKyBsaW5lQnJlYWtzKSA9PSAnXFxuJylcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBsaW5lQnJlYWtzKys7XHJcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ZWRQZXJtIC09IG9mZnNldGVkO1xyXG4gICAgICAgICAgICAgICAgICAgIG9mZnNldGVkID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpID4gKChsZW5ndGhUZXh0ICogcmF0aW8pICsgbWFpbkRhdGEuY2hhclN0YXJ0KSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0Yi5EcmF3Q2hhcignICcsIG9mZnNldGVkLCBsaW5lICsgbGluZUJyZWFrcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy90Yi5EcmF3KFwiXCIgKyBpLCA2LCA1LCAxKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBwdWJsaWMgY2xhc3MgQ2hhckJ5Q2hhckRhdGFcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGludGVybmFsIGludCBjaGFyU3RhcnQ7XHJcbiAgICAgICAgICAgIGludGVybmFsIGludCBjaGFyRW5kO1xyXG5cclxuICAgICAgICAgICAgcHVibGljIENoYXJCeUNoYXJEYXRhKGludCBjaGFyU3RhcnQsIGludCBjaGFyRW5kKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXJTdGFydCA9IGNoYXJTdGFydDtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hhckVuZCA9IGNoYXJFbmQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl0KfQo=
